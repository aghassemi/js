{"version":3,"file":"bundle.js","sources":["/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/browser-pack/_prelude.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/veyron.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/process/browser.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/runtime/runtime.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/lib/deferred.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/lib/vlog.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/namespace/util.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/lib/verror.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/ipc/server.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/ipc/server_router.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/ipc/client.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/proxy/websocket.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/proxy/message_type.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/namespace/namespace.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/security/private.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/security/public.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/lib/promise.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/proxy/simple_handler.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/util/util.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/postie/index.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/is-browser/client.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/xtend/immutable.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/idl/idl.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/proxy/stream.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/proxy/incoming_payload_type.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/proxy/error_conversion.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/lib/websocket.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/proxy/proxy.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/util/support/isBufferBrowser.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/events/events.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/stream-browserify/index.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/inherits/inherits_browser.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/bluebird.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/readable.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/promise.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/writable.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/duplex.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/transform.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/passthrough.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/ws/lib/browser.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/lib/_stream_readable.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/lib/_stream_writable.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/lib/_stream_duplex.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/lib/_stream_transform.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/lib/_stream_passthrough.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/async.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/util.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/errors.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/thenables.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/promise_array.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/captured_trace.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/catch_filter.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/promise_resolver.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/finally.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/direct_resolve.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/synchronous_inspection.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/join.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/timers.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/race.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/call_get.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/generators.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/map.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/nodeify.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/promisify.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/props.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/reduce.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/settle.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/some.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/progress.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/cancel.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/filter.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/any.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/each.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/using.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/errors_api_rejection.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/buffer/index.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/schedule.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/queue.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/bluebird/js/main/es5.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/node_modules/isarray/index.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/node_modules/string_decoder/index.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/buffer/node_modules/is-array/index.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/node_modules/core-util-is/lib/util.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/buffer/node_modules/ieee754/index.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/buffer/node_modules/base64-js/lib/b64.js"],"names":["init","config","callback","extend","defaults","def","Deferred","runtimeOpts","wspr","process","env","isBrowser","authenticate","getIdentity","authTimeout","err","name","reject","promise","identityName","resolve","Runtime","authTimeoutMs","clearTimingEvents","window","clearInterval","authRequestInterval","clearTimeout","timeout","handleAuthSuccess","data","removeListeners","handleAuthError","handleAuthReceived","handleTimeout","Error","contentScript","removeListener","Postie","require","on","setInterval","post","setTimeout","vlog","logLevel","level","module","exports","logLevels","levels","namespaceUtil","errors","noop","nextTick","canSetImmediate","setImmediate","canPost","postMessage","addEventListener","f","queue","ev","source","stopPropagation","length","fn","shift","push","title","browser","argv","addListener","once","off","removeAllListeners","emit","binding","cwd","chdir","options","this","_wspr","identity","PrivateId","_getProxyConnection","Server","ServerRouter","Client","ProxyConnection","MessageType","Namespace","PublicId","Promise","SimpleHandler","prototype","bindTo","optServiceSignature","runtime","client","_getClient","undefined","bind","close","websocket","onclose","deferred","getWebSocket","then","catch","serve","serviceObject","serviceMetadata","server","_getServer","addIDL","updates","_proxyConnection","_getRouter","_router","_client","_server","newNamespace","roots","rt","proxy","mounttableRoot","newIdentity","cb","id","nextId","handler","sendRequest","JSON","stringify","NEW_ID","message","names","handle","success","value","error","NOLOG","ERROR","WARN","DEBUG","INFO","_log","arguments","warn","debug","info","args","_write","c","_getConsole","consoleFunc","log","apply","console","vlogInstance","_numInitialSlashes","s","i","charAt","_numTailSlashes","_removeInitialSlashes","replace","_removeTailSlashes","_joinNamePartsOnArray","parts","addedPart","numNameSlashes","numAddedPartSlashes","join","Array","isArray","slice","call","isRooted","isTerminal","numInitialSlashes","nextSlashIndex","substr","indexOf","nextDoubleSlashIndex","convertToTerminalName","substring","inherits","vError","Ids","Aborted","BadArg","BadProtocol","Exists","Internal","NoAccess","NoExist","NoExistOrNoAccess","VeyronError","captureStackTrace","stack","equals","a","b","ais","bis","AbortedError","BadArgError","BadProtocolError","ExistsError","InternalError","NoAccessError","NoExistError","NoExistOrNoAccessError","router","nextServerID","_knownServiceDefinitions","IdlHelper","ServiceWrapper","prefix","package","key","toUpperCase","hasOwnProperty","_getAndValidateMetadata","shouldCheckDefinition","serviceDefinitions","object","k","wrapper","err2","validate","stop","stopServer","generateIdlWireDescription","Stream","IncomingPayloadType","ErrorConversion","vLog","ServerStream","stream","_stream","handleResponse","type","STREAM_RESPONSE","_queueRead","STREAM_CLOSE","ERROR_RESPONSE","toJSerror","Router","_servers","_proxy","_streamMap","addIncomingHandler","INVOKE_REQUEST","inject","injectionPositions","injections","keys","Object","invertedMap","forEach","values","map","filter","sort","keysInserted","pos","splice","invokeMethod","receiver","method","e","handleRequest","messageId","request","serverId","sendResult","serviceWrapper","sendResulttResult","serviceMethod","metadata","self","sendInvocationError","stackTrace","result","numOutArgs","context","suffix","remoteId","remoteID","finished","v","release","$stream","senderPromise","$callback","$context","$suffix","$name","$remoteId","variables","rpc","addIncomingStreamHandler","resultPromise","results","errorStruct","toStandardErrorStruct","serverClose","dequeue","responseData","responseDataJSON","RESPONSE","messageJSON","service","SERVE","toString","STOP","proxyConnection","OutstandingRPC","_id","_name","_methodName","methodName","_args","_numOutParams","numOutParams","_isStreaming","isStreaming","_cb","_def","start","streamingDeferred","constructMessage","REQUEST","ws","FINAL_RESPONSE","handleCompletion","handleStreamData","handleError","handleStreamClose","queueRead","jsonMessage","inArgs","serviceSignaturePromise","getServiceSignature","serviceSignature","boundObject","bindMethod","methodInfo","signature","url","currentWebSocketPromise","Proxy","WebSocket","create","constructor","onopen","configDeferred","_configDeferred","onerror","onmessage","frame","parse","STREAM_VALUE","SIGNATURE","BLESS","UNLINK_ID","convertServersToStrings","servers","out","nameUtil","makeAllTerminal","allAreTerminal","every","_roots","errNotAMountTable","errNoSuchName","errNoSuchNameRoot","_maxDepth","_rootNames","_resolveAgainstMountTable","resolveStep","_resolveLoop","curr","last","depth","handleErrors","resolveToMountTable","resolveMaximally","bless","blessee","duration","caveats","durationMs","_count","nameMatches","pattern","paths","split","expectedPaths","match","retain","toJSON","Handler","inspect","obj","opts","ctx","seen","stylize","stylizeNoColor","colors","isBoolean","showHidden","_extend","isUndefined","customInspect","stylizeWithColor","formatValue","str","styleType","style","styles","arrayToHash","array","hash","val","recurseTimes","isFunction","ret","isString","primitive","formatPrimitive","visibleKeys","getOwnPropertyNames","isError","formatError","isRegExp","RegExp","isDate","Date","base","braces","n","toUTCString","output","formatArray","formatProperty","pop","reduceToSingleString","simple","isNumber","isNull","l","String","desc","getOwnPropertyDescriptor","get","set","line","numLinesEst","reduce","prev","cur","ar","arg","isNullOrUndefined","isSymbol","re","isObject","objectToString","d","isPrimitive","o","pad","timestamp","time","getHours","getMinutes","getSeconds","getDate","months","getMonth","prop","formatRegExp","format","objects","len","x","Number","_","deprecate","msg","deprecated","warned","throwDeprecation","traceDeprecation","trace","global","noDeprecation","debugs","debugEnviron","debuglog","NODE_DEBUG","test","pid","bold","italic","underline","inverse","white","grey","black","blue","cyan","green","magenta","red","yellow","special","number","boolean","null","string","date","regexp","isBuffer","origin","add","EventEmitter","__bind","me","__hasProp","__extends","child","parent","ctor","__super__","__slice","_super","target","handleMessage","listen","channel","packed","pkg","pack","attachEvent","event","unpackaged","unpack","concat","_postie","_error","idlHelper","idlWire","methodMetadata","params","param","InArgs","NumOutArgs","IsStreaming","getParamNames","func","fnStr","extraMetadata","camelCaseName","toLowerCase","extra","definition","expected","inputArgs","numInArgs","hasStreaming","expectingStreaming","inputStreaming","outputStreaming","Duplex","flowId","webSocketPromise","isClient","objectMode","wsBuffer","shouldQueue","clientClose","write","_read","chunk","encoding","send","end","ec","_standard","iD","errId","errMessage","errIdConstrMap","verr","ErrIdConstr","WS","sender","outstandingRequests","bindCache","_hasResolvedConfig","incomingRequestHandlers","BIND_CACHE_TTL","payload","isServerOriginatedMessage","cachedEntry","now","fetched","body","h","copy","fill","readUInt8","_events","_maxListeners","defaultMaxListeners","setMaxListeners","isNaN","TypeError","er","listeners","listener","m","newListener","g","fired","list","position","listenerCount","emitter","EE","Readable","Writable","Transform","PassThrough","pipe","dest","ondata","writable","pause","ondrain","readable","resume","onend","didOnEnd","destroy","cleanup","_isStdio","superCtor","super_","enumerable","configurable","TempCtor","noConflict","bluebird","old","resolver","_bitField","_fulfillmentHandler0","_rejectionHandler0","_promise0","_receiver0","_settledValue","_boundTo","INTERNAL","_resolveFromResolver","returnFirstElement","elements","util","async","APPLY","NEXT_FILTER","cast","PromiseArray","CapturedTrace","CatchFilter","PromiseResolver","errorObj","tryCatch1","tryCatch2","tryCatchApply","RangeError","CancellationError","TimeoutError","OperationalError","originatesFromRejection","markAsOriginatingFromRejection","canAttach","thrower","apiRejection","makeSelfResolutionError","thisArg","maybePromise","binder","_setBoundTo","p","all","_follow","_propagateFrom","caught","catchInstances","j","item","catchFilterTypeError","_attachExtraTrace","invoke","_reject","_resetTrace","catchFilter","_then","doFilter","didFulfill","didReject","didProgress","done","_setIsFinal","spread","isCancellable","isResolved","_cancellable","isFulfilled","isRejected","fulfillmentValue","rejectionReason","is","promises","_resolveFromSyncValue","_cleanValues","_setRejected","_ensurePossibleRejectionHandled","_setFulfilled","$_len","$_i","_setTrace","attempt","defer","pending","fulfilled","rejected","reason","_setCarriedStackTrace","onPossiblyUnhandledRejection","possiblyUnhandledRejection","unhandledRejectionHandled","onUnhandledRejectionHandled","debugging","execPath","longStackTraces","haveItemsQueued","isSupported","hasLongStackTraces","internalData","haveInternalData","haveSameContext","_peekContext","_traceParent","callbackIndex","_addCallbacks","_queueSettleAt","_length","_isFollowingOrFulfilledOrRejected","_isFollowing","_setLength","_setFollowing","_isFinal","_setCancellable","_unsetCancellable","_setRejectionIsUnhandled","_unsetRejectionIsUnhandled","_isUnhandledRejectionNotified","_unsetUnhandledRejectionIsNotified","_notifyUnhandledRejectionIsHandled","_isRejectionUnhandled","_setUnhandledRejectionIsNotified","capturedTrace","_unsetCarriedStackTrace","_isCarryingStackTrace","_getCarriedStackTrace","_receiverAt","index","_isBound","_promiseAt","_fulfillmentHandlerAt","_rejectionHandlerAt","fulfill","progress","_progressHandler0","_setProxyHandlers","promiseSlotValue","_proxyPromiseArray","promiseArray","_proxyPromise","_setProxied","Promise$_resolver","_tryFollow","_fulfill","Promise$_rejecter","_pushContext","r","_popContext","_spreadSlowCase","targetFn","boundTo","promiseForAll","promise2","_callSpread","_callHandler","_settlePromiseFromHandler","_rejectUnchecked","castValue","_fulfillUnchecked","isPending","_trace","isTopLevel","protectErrorMessageNewlines","headerLineCount","combinedTraces","combine","stackTraceLimit","max","_cancellationParent","flags","carriedStackTrace","_settlePromiseAt","_isProxied","_unsetProxied","_promiseFulfilled","_promiseRejected","_queueGC","_isGcQueued","_setGcQueued","_unsetGcQueued","invokeLater","_gc","_clearFirstHandlerData","_settlePromises","_rejectUncheckedCheckError","_rejectPromises","_notifyUnhandledRejection","contextStack","lastIndex","setScheduler","_schedule","_makeSelfResolutionError","RejectionError","AggregateError","toFastProperties","uri","protocols","instance","MozWebSocket","ReadableState","hwm","highWaterMark","buffer","pipes","pipesCount","flowing","ended","endEmitted","reading","calledRead","sync","needReadable","emittedReadable","readableListening","defaultEncoding","ranOut","awaitDrain","readingMore","decoder","StringDecoder","_readableState","readableAddChunk","state","addToFront","chunkInvalid","onEofChunk","unshift","emitReadable","maybeReadMore","needMoreData","roundUpToNextPowerOf2","MAX_HWM","howMuchToRead","Buffer","endReadable","emitReadable_","maybeReadMore_","read","pipeOnDrain","src","flow","written","emitDataEvents","pipeOnReadable","startPaused","paused","fromList","stringMode","buf","cpy","Math","min","xs","setEncoding","enc","nOrig","doRead","pipeOpts","onunpipe","onfinish","_writableState","needDrain","unpipe","doEnd","stdout","stderr","endFn","dests","res","wrap","events","_fromList","WriteReq","WritableState","ending","noDecode","decodeStrings","writing","bufferProcessing","onwrite","writecb","writelen","errorEmitted","writeAfterEnd","validChunk","valid","decodeChunk","writeOrBuffer","doWrite","onwriteError","onwriteStateUpdate","needFinish","clearBuffer","afterWrite","onwriteDrain","finishMaybe","entry","need","endWritable","allowHalfOpen","objectKeys","TransformState","afterTransform","needTransform","transforming","writechunk","ts","_transformState","rs","_flush","_transform","writeencoding","Async","_isTickUsed","schedule","_lateBuffer","Queue","_functionBuffer","consumeFunctionBuffer","_consumeFunctionBuffer","_process","domain","_queueTick","functionBuffer","_reset","_consumeLateBuffer","arg2","tryCatch3","arg3","tryCatch4","arg4","asString","maybeWrapAsError","maybeError","withAppended","appendee","getDataPropertyOrDefault","defaultValue","es5","isES5","notEnumerableProp","descriptor","defineProperty","isClass","isIdentifier","rident","filledRange","count","haveGetters","canEvaluate","navigator","Child","Parent","T","constructor$","propertyName","hasProp","wrapsPrimitiveReceiver","inheritedDataKeys","visitedKeys","getKeys","includeHidden","getPrototypeOf","ignore","subError","nameProperty","defaultMessage","SubError","cause","Objectfreeze","freeze","_TypeError","_RangeError","methods","indent","lines","errorTypes","getThen","Promise$_Cast","originalPromise","isAnyBluebirdPromise","_progressUnchecked","Promise$_doThenable","Promise$_resolveFromThenable","y","called","Promise$_rejectFromThenable","Promise$_progressFromThenable","_progress","toResolutionValue","_promise","_values","_totalResolved","_init","PromiseArray$_init","resolveValueIfEmpty","__hardReject__","_resolveEmptyArray","_resolve","getActualLength","newLen","newValues","shouldCopyValues","isDirectScanNeeded","_scanDirectValues","_isResolved","_promiseProgressed","progressValue","totalResolved","formatNonError","ruselessToString","newStr","snip","maxChars","ignoreUntil","rignore","rtraceline","formatStack","current","curLast","errorMessageLines","stackDetection","startsWith","rline","instances","_instances","_callback","CatchFilter$_safePredicate","predicate","safeObject","retfilter","safeKeys","itemIsErrorType","shouldHandle","isUntypedError","wrapAsOperationalError","nodebackForPromise","PromiseResolver$_callback","wrapped","asCallback","_nodebackForPromise","cancel","returnThis","throwThis","return$","throw$","promisedFinally","reasonOrValue","finallyHandler","tapHandler","_passThroughHandler","isFinally","promiseAndHandler","lastly","tap","returner","action","thenReturn","thenThrow","PromiseInspection","thenCallback","Function","caller","thenCallbacks","callers","Holder","total","p1","p2","p3","p4","p5","checkFulfillment","holder","callbacks","_setTimeout","ms","arg0","arg1","afterTimeout","_cancel","afterDelay","delay","cancellable","Promise$_Race","raceLater","hasOwn","race","cr","callerCache","getterCache","makeMethodCaller","makeGetter","getCompiled","compiler","cache","getMethodCaller","getGetter","namedGetter","indexedGetter","maybeCaller","getter","isIndex","maybeGetter","promiseFromYieldHandler","yieldHandlers","_errorObj","_Promise","PromiseSpawn","generatorFunction","yieldHandler","_generatorFunction","_receiver","_generator","_yieldHandlers","_run","_next","_continue","_throw","next","coroutine","PromiseSpawn$","generator","spawn","addYieldHandler","MappingPromiseArray","limit","_filter","_preservedValues","_limit","_inFlight","_queue","EMPTY_ARRAY","_init$","concurrency","isFinite","PENDING","preservedValues","_drainQueue","booleans","Promise$_spreadAdapter","Promise$_successAdapter","nodeback","Promise$_errorAdapter","nodeify","adapter","escapeIdentRegex","isPromisified","__isPromisified__","hasPromisified","defaultPromisified","checkValid","suffixRegexp","keyWithoutAsyncSuffix","promisifiableMethods","switchCaseArgumentOrder","likelyArgumentCount","argumentSequence","argumentCount","parameterDeclaration","parameterCount","generatePropertyAccess","makeNodePromisifiedEval","originalName","generateCallForArgumentCount","comma","THIS","generateArgumentSwitchCase","argumentOrder","codeForCall","newParameterCount","callbackName","makeNodePromisifiedClosure","promisified","promisifyAll","promisifier","promisifiedKey","makeNodePromisified","promisify","defaultSuffix","defaultFilter","PropertiesPromiseArray","Promise$_Props","props","keyOffset","ReductionPromiseArray","accum","_each","_zerothIsAccum","_gotAccum","_reducingIndex","_valuesPhase","isPromise","_accum","initialValue","valuesPhaseIndex","isEach","gotAccum","valuesPhase","SettledPromiseArray","_promiseResolved","inspection","settle","SomePromiseArray","_howMany","_unwrap","_initialized","Promise$_Some","howMany","setHowMany","isArrayResolved","_canPossiblyFulfill","_getRangeError","setUnwrap","_addFulfilled","_fulfilled","_addRejected","_rejected","some","_SomePromiseArray","progressed","_clearFirstHandlerData$Base","_progressHandlerAt","_doProgressWith","progression","promiseToReject","uncancellable","fork","PromiseMap","Promise$_Any","any","PromiseReduce","each","inspectionMapper","inspections","castPreservingDisposable","thenable","_isDisposable","_getDisposer","_setDisposable","dispose","resources","iterator","tryDispose","disposerSuccess","disposerFail","Disposer","_data","FunctionDisposer","resource","doDispose","_unsetDisposable","isDisposer","using","disposer","_disposer","subject","noZero","base64clean","byteLength","floor","kMaxLength","TYPED_ARRAY_SUPPORT","_augment","Uint8Array","_isBuffer","_set","isArrayish","hexWrite","offset","remaining","strLen","byte","parseInt","utf8Write","charsWritten","blitBuffer","utf8ToBytes","asciiWrite","asciiToBytes","binaryWrite","base64Write","base64ToBytes","utf16leWrite","utf16leToBytes","base64Slice","base64","fromByteArray","utf8Slice","tmp","decodeUtf8Char","fromCharCode","asciiSlice","binarySlice","hexSlice","toHex","utf16leSlice","bytes","checkOffset","ext","checkInt","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","ieee754","writeDouble","stringtrim","INVALID_BASE64_RE","trim","byteArray","charCodeAt","encodeURIComponent","hi","lo","toByteArray","dst","decodeURIComponent","SlowBuffer","INSPECT_MAX_BYTES","poolSize","ArrayBuffer","arr","foo","subarray","compare","isEncoding","totalLength","loweredCase","Infinity","writeUInt8","swap","_arr","sliceLen","newBuf","readUInt16LE","readUInt16BE","readUInt32LE","readUInt32BE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","target_start","toArrayBuffer","BP","_get","toLocaleString","_MutationObserver","version","MutationObserver","WebKitMutationObserver","div","document","createElement","queuedFn","observer","observe","attributes","classList","toggle","arrayCopy","srcIndex","dstIndex","capacity","_capacity","_front","_makeCapacity","_willBeOverCapacity","size","_pushOne","_checkCapacity","wrapMask","front","_resizeTo","oldFront","oldCapacity","oldQueue","lengthBeforeWrapping","has","proto","ObjectKeys","ObjectDefineProperty","ObjectFreeze","ObjectGetPrototypeOf","ArrayIsArray","assertEncoding","isBufferEncoding","passThroughWrite","utf16DetectIncompleteChar","charReceived","charLength","base64DetectIncompleteChar","surrogateSize","detectIncompleteChar","charBuffer","charStr","available","charCode","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","NaN","pow","abs","LN2","lookup","decode","elt","code","PLUS","SLASH","NUMBER","UPPER","LOWER","b64ToByteArray","b64","L","placeHolders","Arr","uint8ToBase64","uint8","encode","num","tripletToBase64","temp","extraBytes","base64js"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\n *  @fileoverview Public API and entry point to the Veyron API\n */\n\nvar Runtime = require('./runtime/runtime');\nvar Deferred = require('./lib/deferred');\nvar vlog = require('./lib/vlog');\nvar extend = require('xtend');\nvar isBrowser = require('is-browser');\n\nvar defaults = {\n  logLevel: vlog.level,\n  authenticate: false,\n  authTimeout: 5000, // ms\n};\n\n/**\n * Exports\n */\nmodule.exports = {\n  init: init,\n  logLevels: require('./lib/vlog').levels,\n  namespaceUtil: require('./namespace/util'),\n  errors: require('./lib/verror')\n};\n\n/**\n * Create a Veyron Runtime\n * @param {Object} config Configuration Options\n */\nfunction init(config, callback) {\n  if (typeof config === 'function') {\n    callback = config;\n    config = {};\n  }\n\n  config = extend(defaults, config);\n\n  var def = new Deferred(callback);\n\n  var runtimeOpts = {\n    wspr: config.wspr || process.env['WSPR'] || 'http://localhost:8124'\n  };\n\n  // If we are running in a browser, and the user has not set\n  // config.skipAuthentication to true, then we will get an authenticated\n  // (blessed-by-identity-server) identity for the user.  This requires the\n  // Veyron Chrome Extension to be installed and enabled, and WSPR must be\n  // configured to talk to Veyron identity server, e.g. the one currently hosted\n  // at: /proxy.envyor.com:8101/identity/veyron-test/google The resulting\n  // runtime will have runtime.identityName set to the name of the authenticated\n  // identity.\n  //\n  // If we are not in a browser, or if the user has set\n  // config.authenticate to true, then create a runtime with the\n  // identityName 'unknown'.\n  if (isBrowser && config.authenticate) {\n    getIdentity(config.authTimeout, function(err, name) {\n      if (err) {\n        def.reject(err);\n        return def.promise;\n      }\n      runtimeOpts.identityName = name;\n      def.resolve(new Runtime(runtimeOpts));\n    });\n  } else {\n    runtimeOpts.identityName = 'unknown';\n    def.resolve(new Runtime(runtimeOpts));\n  }\n\n  return def.promise;\n}\n\n// getIdentity tells the Veyron Extension to start an OAuth flow, get an access\n// token for the user, and exchange that access token for a blessed identity in\n// WSPR, which is then associated with the origin of the web app.\n//\n// The flow starts by repeatedly sending an 'auth' message to the Veyron\n// Extension content script.  It must perform this repeatedly because the first\n// messages might get sent before the content script has had time to start.\n//\n// When the content script eventually receives the 'auth' message, it responds\n// with an 'auth:received' message to let us know we can stop requesting auth.\n//\n// If no 'auth:received' message is received within config.authTimeout\n// milliseconds, we timeout with an error.\n//\n// Once the extension has received the 'auth' message, it will perform the OAuth\n// <-> WSPR identity flow, and respond with either an 'auth:success' message or\n// an 'auth:error' message.\nfunction getIdentity(authTimeoutMs, callback) {\n  var Postie = require('postie');\n  var contentScript = new Postie(window);\n\n  function clearTimingEvents() {\n    // Stop asking for auth.\n    window.clearInterval(authRequestInterval);\n    // Cancel timeout timer.\n    window.clearTimeout(timeout);\n  }\n\n  // Runs when the auth request succeeds.\n  function handleAuthSuccess(data) {\n    removeListeners();\n    callback(null, data.name);\n  }\n\n  // Runs when the auth request fails.\n  function handleAuthError(err) {\n    removeListeners();\n    callback(err);\n  }\n\n  // Runs when the extension receives the auth request.\n  function handleAuthReceived() {\n    clearTimingEvents();\n  }\n\n  // Runs when timeout occurs before getting 'auth:received' message.\n  function handleTimeout() {\n    handleAuthError(new Error(\n        'Auth timeout. Please ensure that the Veyron Chrome Extension is ' +\n        'installed and enabled. Download it here: ' +\n        'https://github.com/veyron/veyron.js/raw/master/extension/veyron.crx'\n    ));\n  }\n\n  function removeListeners() {\n    clearTimingEvents();\n    contentScript.removeListener('auth:success', handleAuthSuccess);\n    contentScript.removeListener('auth:error', handleAuthError);\n  }\n\n  contentScript.on('auth:success', handleAuthSuccess);\n  contentScript.on('auth:error', handleAuthError);\n  contentScript.on('auth:received', handleAuthReceived);\n\n  // Repeatedly ask the extension to auth.  The first time this runs, the\n  // extension might not be running yet, so we need to ask in a setInterval.\n  var authRequestInterval = window.setInterval(function(){\n    contentScript.post('auth');\n  }, 200);\n\n  // Timeout if we don't get an 'auth:received' message before authTimeoutMs\n  // milliseconds.\n  var timeout = setTimeout(handleTimeout, authTimeoutMs);\n}\n","// shim for using process in browser\n\nvar process = module.exports = {};\n\nprocess.nextTick = (function () {\n    var canSetImmediate = typeof window !== 'undefined'\n    && window.setImmediate;\n    var canPost = typeof window !== 'undefined'\n    && window.postMessage && window.addEventListener\n    ;\n\n    if (canSetImmediate) {\n        return function (f) { return window.setImmediate(f) };\n    }\n\n    if (canPost) {\n        var queue = [];\n        window.addEventListener('message', function (ev) {\n            var source = ev.source;\n            if ((source === window || source === null) && ev.data === 'process-tick') {\n                ev.stopPropagation();\n                if (queue.length > 0) {\n                    var fn = queue.shift();\n                    fn();\n                }\n            }\n        }, true);\n\n        return function nextTick(fn) {\n            queue.push(fn);\n            window.postMessage('process-tick', '*');\n        };\n    }\n\n    return function nextTick(fn) {\n        setTimeout(fn, 0);\n    };\n})();\n\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n}\n\n// TODO(shtylman)\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\n","/**\n * @fileoverview Veyron Runtime\n */\n\nvar Server = require('../ipc/server');\nvar ServerRouter = require('../ipc/server_router');\nvar Client = require('../ipc/client');\nvar ProxyConnection = require('../proxy/websocket');\nvar MessageType = require('../proxy/message_type');\nvar Namespace = require('../namespace/namespace');\nvar PrivateId = require('../security/private');\nvar PublicId = require('../security/public');\nvar Promise = require('../lib/promise');\nvar Deferred = require('../lib/deferred');\nvar SimpleHandler = require('../proxy/simple_handler');\n\nmodule.exports = Runtime;\n\nfunction Runtime(options) {\n  if (!(this instanceof Runtime)) {\n    return new Runtime(options);\n  }\n\n  this.identityName = options.identityName;\n  this._wspr = options.wspr;\n  this.identity = new PrivateId(this._getProxyConnection());\n}\n\n/**\n * Performs client side binding of a remote service to a native javascript\n * stub object.\n *\n * Usage:\n * var service = runtime.bindTo('EndpointAddress', 'ServiceName')\n * var resultPromise = service.MethodName(arg);\n *\n * @param {string} name the veyron name of the service to bind to.\n * @param {object} optServiceSignature if set, javascript signature of methods\n * available in the remote service.\n * @param {function} [callback] if given, this function will be called on\n * completion of the bind.  The first argument will be an error if there is\n * one, and the second argument is an object with methods that perform rpcs to\n * service\n * methods.\n * @return {Promise} An object with methods that perform rpcs to service methods\n *\n */\nRuntime.prototype.bindTo = function(name, optServiceSignature, callback) {\n  var runtime = this;\n  var client = this._getClient();\n\n  if (typeof optServiceSignature === 'function') {\n    callback = optServiceSignature;\n    optServiceSignature = undefined;\n  }\n\n  // Bind the callback to runtime\n  if (callback) {\n    callback = callback.bind(runtime);\n  }\n\n  return client.bindTo(name, optServiceSignature, callback);\n};\n\n/**\n * Closes the underlying websocket connection.\n *\n * @example\n *\n * runtime.close(function(err, code, message){\n *   if (err) throw err;\n *   console.log('code: %s, message: %s', code, message)\n * });\n *\n * @param {Function} [callback] - Gets called once the underlying\n * websocket is closed. Arguments: error, code, message.\n *\n * @see {@link http://goo.gl/6nC1xs|WS Event: \"close\"}\n *\n */\nRuntime.prototype.close = function(callback) {\n  var runtime = this;\n  var deferred = new Deferred(callback);\n\n  runtime\n  ._getProxyConnection()\n  .getWebSocket()\n  .then(close)\n  .catch(deferred.reject);\n\n  return deferred.promise;\n\n  function close(websocket) {\n    websocket.onclose = deferred.resolve;\n    websocket.close();\n  }\n};\n\n/**\n * A Veyron server allows registration of services that can be\n * invoked remotely via RPCs.\n *\n * Usage:\n * var videoService = {\n *   play: function(videoName) {\n *     // Play video\n *   }\n * };\n *\n * var service = runtime.serve('mymedia/video', videoService)\n *\n * @param {string} name Name to serve under\n * @param {Object} serviceObject service object to serve\n * @param {*} serviceMetadata if provided a set of metadata for functions\n * in the service (such as number of return values).  It could either be\n * passed in as a properties object or a string that is the name of a\n * service that was defined in the idl files that the server knows about.\n * @param {function} callback if provided, the function will be called on\n * completion. The only argument is an error if there was one.\n * @return {Promise} Promise to be called when serve completes or fails\n * the endpoint address of the server will be returned as the value of promise\n */\nRuntime.prototype.serve = function(name, serviceObject, serviceMetadata,\n    callback) {\n  var server = this._getServer();\n  return server.serve(name, serviceObject, serviceMetadata, callback);\n};\n\n/**\n * addIDL adds an IDL file to the set of definitions known by the server.\n * Services defined in IDL files passed into this method can be used to\n * describe the interface exported by a serviceObject passed into register.\n * @param {object} updates the output of the vdl tool on an idl.\n */\nRuntime.prototype.addIDL = function(updates) {\n  var server = this._getServer();\n  return server.addIDL(updates);\n};\n\n/**\n * Get or creates a new proxy connection\n * @return {ProxyConnection} A proxy connection\n */\nRuntime.prototype._getProxyConnection = function() {\n  if (!this._proxyConnection) {\n    this._proxyConnection = new ProxyConnection(this._wspr);\n  }\n  return this._proxyConnection;\n};\n\n/**\n * Get or creates a router\n * @return {ServerRouter} A router\n */\nRuntime.prototype._getRouter = function() {\n  if (!this._router) {\n    this._router = new ServerRouter(\n        this._getProxyConnection());\n  }\n  return this._router;\n};\n\n\n/**\n * Get or creates a client\n * @return {Client} A client\n */\nRuntime.prototype._getClient = function() {\n  this._client = this._client || new Client(this._getProxyConnection());\n  return this._client;\n};\n\n/**\n * Get or creates a server\n * @return {Server} A server\n */\nRuntime.prototype._getServer = function() {\n  this._server = this._server || new Server(this._getRouter());\n  return this._server;\n};\n\n/**\n * Create a new Namespace\n * @return {Promise} A promise that resolves to a Namespace instance.\n */\nRuntime.prototype.newNamespace = function(roots) {\n  var rt = this;\n  var proxy = this._getProxyConnection();\n\n  if (roots) {\n    return Promise.resolve(new Namespace(this._getClient(), roots));\n  }\n\n  // We have to ask for the websocket now, otherwise the config\n  // wont arrive until the first time someone tries to make a call\n  // which is deadlock prone.\n  proxy.getWebSocket();\n  return proxy.config.then(function(config) {\n    return new Namespace(rt._getClient(), config.mounttableRoot);\n  });\n};\n\n/**\n * TODO(bjornick): This should probably produce a PrivateId and not a PublicId,\n * but we don't have PrivateId store yet. This is mostly used for tests anyway.\n * Create a new Identity\n * @param {String} name the name for the identity.\n * @param {function} cb if provided a callback that will be called with the\n * new publicId.\n * @return {Promise} A promise that resolves to the new PublicId\n */\nRuntime.prototype.newIdentity = function(name, cb) {\n  var def = new Deferred(cb);\n\n  var proxy = this._getProxyConnection();\n  var id = proxy.nextId();\n  var handler = new SimpleHandler(def, proxy, id);\n  proxy.sendRequest(JSON.stringify(name), MessageType.NEW_ID, handler, id);\n  return def.promise.then(function(message) {\n    return new PublicId(message.names, message.handle, proxy);\n  });\n};\n","/**\n * @fileoverview A lightweight deferred implementation using ES6 Promise\n * Deferred are sometimes easier to use since they can be passed around\n * and rejected, resolved by other code whereas Promise API does not expose\n * reject and resolve publicly.\n */\n\nvar Promise = require('./promise');\n\nmodule.exports = Deferred;\n\nfunction Deferred(cb) {\n  var deferred = this;\n\n  deferred.promise = new Promise(function(resolve, reject) {\n    deferred.resolve = resolve;\n    deferred.reject = reject;\n  });\n\n  if (cb) {\n    deferred.promise\n    .then(success, error)\n  }\n\n  function success(value) {\n    cb(null, value);\n  }\n\n  function error(err) {\n    cb(err);\n  }\n}\n","/**\n * @fileoverview A lightweight logging framework for JavaScript to be used\n * in place of console so that we can persist the logs if needed and turn\n * logging off at different levels.\n */\nvar vlog = function() {\n\n  // default level is nolog\n  this.level = this.levels.NOLOG;\n};\n\n/**\n * Enum for different log levels\n * @readonly\n * @enum {number}\n */\nvlog.prototype.levels = {\n  NOLOG: 0, // No logs are written\n  ERROR : 1, // Only errors are written\n  WARN: 2, // Only errors and warnings are written\n  DEBUG : 3, // Errors, warnings and debug messages are written\n  INFO : 4 // All logs are written,\n};\n\n/**\n * Logs arguments as errors to the console if log level is error or higher\n */\nvlog.prototype.error = function() {\n  this._log(this.levels.ERROR, arguments);\n};\n\n/**\n * Logs arguments as warnings to the console if log level is warning or higher\n */\nvlog.prototype.warn = function() {\n  this._log(this.levels.WARN, arguments);\n};\n\n/**\n * Logs arguments as logs to the console if log level is debug or higher\n */\nvlog.prototype.debug = function() {\n  this._log(this.levels.DEBUG, arguments);\n};\n\n/**\n * Logs arguments as info to the console if log level is info or higher\n */\nvlog.prototype.info = function() {\n  this._log(this.levels.INFO, arguments);\n};\n\nvlog.prototype._log = function(level, args) {\n  if (this.level >= level) {\n    this._write(level, args);\n  }\n};\n\nvlog.prototype._write = function(level, args) {\n  var c = this._getConsole();\n\n  if (!c) {\n    return;\n  }\n\n  var consoleFunc = c.log;\n  switch (level) {\n    case this.levels.ERROR:\n      consoleFunc = c.error;\n      break;\n    case this.levels.WARN:\n      consoleFunc = c.warn;\n      break;\n    case this.levels.DEBUG:\n      consoleFunc = c.log;\n      break;\n    case this.levels.INFO:\n      consoleFunc = c.info;\n      break;\n  }\n\n  consoleFunc.apply(c, args);\n};\n\nvlog.prototype._getConsole = function() {\n  if (typeof console !== 'undefined') {\n    return console;\n  }\n\n  return null;\n};\n\nvar vlogInstance = new vlog();\n/*\n * Export the module\n */\nmodule.exports = vlogInstance;\n","/**\n * @fileoverview Helpers for manipulating veyron names.\n */\n\nvar _numInitialSlashes = function(s) {\n  for (var i = 0; i < s.length; i++) {\n    if (s.charAt(i) !== '/') {\n      return i;\n    }\n  }\n  return s.length;\n};\nvar _numTailSlashes = function(s) {\n  for (var i = s.length - 1; i >= 0; i--) {\n    if (s.charAt(i) !== '/') {\n      return s.length - 1 - i;\n    }\n  }\n  return s.length;\n};\n\n\nvar _removeInitialSlashes = function(s) {\n  return s.replace(/^\\/*/g, '');\n};\nvar _removeTailSlashes = function(s) {\n  return s.replace(/\\/*$/g, '');\n};\n\nvar _joinNamePartsOnArray = function(parts) {\n  if (parts.length === 0) {\n    return '';\n  }\n\n  var name = parts[0];\n  for (var i = 1; i < parts.length; i++) {\n    var addedPart = parts[i];\n\n    var numNameSlashes = _numTailSlashes(name);\n    var numAddedPartSlashes = _numInitialSlashes(addedPart);\n\n    if (numNameSlashes === 0 && numAddedPartSlashes === 0) {\n      name += '/' + addedPart;\n      continue;\n    }\n\n    if (numAddedPartSlashes > numNameSlashes) {\n      name = _removeTailSlashes(name);\n      name += addedPart;\n    } else {\n      name += _removeInitialSlashes(addedPart);\n    }\n  }\n\n  return name;\n};\n\n/**\n * Joins parts of a name into a whole.\n * It preserves the rootedness and terminality of the name components.\n * Examples:\n * join(['a, b']) -> 'a/b'\n * join('/a/b/', '//d') -> '/a/b//d'\n * join('//a/b', 'c/') -> '//a/b/c/'\n * @param {array | varargs} Either a single array that contains the strings\n * to join or a variable number of string arguments that will be joined.\n * @return {string} A joined string\n */\nvar join = function(parts) {\n  if (Array.isArray(parts)) {\n    return _joinNamePartsOnArray(parts);\n  }\n  return _joinNamePartsOnArray(Array.prototype.slice.call(arguments));\n};\n\n/**\n  * Determines if a name is rooted, that is beginning with a single '/'.\n  * @param {string} The veyron name.\n  * @return {boolean} True if the name is rooted, false otherwise.\n  */\nvar isRooted = function(name) {\n  return _numInitialSlashes(name) === 1;\n};\n\n/**\n  * Determines if a name is terminal, meaning that it corresponds to a final\n  * endpoint and name and does not need to be resolved further.\n  * @param {string} The veyron name.\n  * @return {boolean} True if the name is a terminal name, false otherwise.\n  */\nvar isTerminal = function(name) {\n  var numInitialSlashes = _numInitialSlashes(name);\n  if (numInitialSlashes >= 2) {\n    // If the name begins with '//', it is terminal.\n    return true;\n  } else if (numInitialSlashes === 1) {\n    // If the name begins with a single slash, it is terminal if there are no\n    // more slashes (indexOf === -1) or if the next slash is a double slash.\n    var nextSlashIndex = name.substr(1).indexOf('/');\n    var nextDoubleSlashIndex = name.substr(1).indexOf('//');\n    return nextSlashIndex === nextDoubleSlashIndex;\n  } else {\n    // If there are no initial slashes, it is only terminal if it is the empty\n    // string.\n    return name.length === 0;\n  }\n};\n\n/**\n  * Converts a veyron name to a terminal name. This is used to generate a final\n  * name when a name has finished resolving.\n  * @param {string} The initial veyron name.\n  * @return {string} A terminal veyron name.\n  */\nvar convertToTerminalName = function(name) {\n  // '' -> '' and '/' -> ''\n  if (name === '' || name === '/') {\n    return '';\n  }\n\n  if (isRooted(name)) {\n    if (name.substr(1).indexOf('/') === -1) {\n      // '/endpoint' -> '/endpoint'\n      return name;\n    }\n    if (name.substr(1).indexOf('/') === name.length - 2) {\n      // '/endpoint/' -> '/endpoint'\n      return name.substring(0, name.length - 1);\n    }\n    // '/endpoint/something' -> '/endpoint//something'\n    // '/endpoint//something -> '/endpoint//something'\n    return name.replace(/^(\\/[^/]+?)[/]*\\//, '$1//');\n  } else {\n    // '/////something' -> '//something'\n    return '//' + _removeInitialSlashes(name);\n  }\n};\n\nmodule.exports = {\n  join: join,\n  isTerminal: isTerminal,\n  isRooted: isRooted,\n  convertToTerminalName: convertToTerminalName\n};\n","/**\n * @fileoverview built-in Veyron errors\n */\n\nvar inherits = require('util').inherits;\n\nvar vError = {};\n\n/*\n * List of predefined error ids. Matches veyron2/vError/common.idl\n */\nvError.Ids = {\n  Aborted: 'veyron.io/veyron/veyron2/verror.Aborted',\n  BadArg: 'veyron.io/veyron/veyron2/verror.BadArg',\n  BadProtocol: 'veyron.io/veyron/veyron2/verror.BadProtocol',\n  Exists: 'veyron.io/veyron/veyron2/verror.Exists',\n  Internal: 'veyron.io/veyron/veyron2/verror.Internal',\n  NoAccess: 'veyron.io/veyron/veyron2/verror.NoAccess',\n  NoExist: 'veyron.io/veyron/veyron2/verror.NoExist',\n  NoExistOrNoAccess: 'veyron.io/veyron/veyron2/verror.NoExistOrNoAccess'\n};\n\n/*\n * Creates an error object given the ID as the name and a message\n * @constructor\n * @param {string} message message\n * @param {vError.Ids} id Error id\n */\nvError.VeyronError = function(message, id) {\n  if (!(this instanceof vError.VeyronError)) {\n    return new vError.VeyronError(message, id);\n  }\n  Error.call(this);\n  this.message = message;\n  if (id) {\n    this.name = id;\n  }\n  if (typeof Error.captureStackTrace === 'function') {\n    Error.captureStackTrace(this, vError.VeyronError);\n  } else {\n    this.stack = (new Error()).stack;\n  }\n};\ninherits(vError.VeyronError, Error);\n\n/*\n * Tests if two errors are equal.\n * If the errors are both VeyronErrors then this returns true\n * when their messange and names are equal.  Other cases return false.\n * @param {Error} a An error to compare\n * @param {Error} a An error to compare\n * @return {boolean} Returns true if the errors are equal.\n */\nvError.equals = function(a, b) {\n  var ais = a instanceof vError.VeyronError;\n  var bis = b instanceof vError.VeyronError;\n  if (ais && bis) {\n    return a.message === b.message && a.id === b.id;\n  }\n  return false;\n};\n\n/*\n * Creates an error object indicating operation aborted, e.g. connection closed.\n * @constructor\n * @param {string} message message\n */\nvError.AbortedError = function(message) {\n  if (!(this instanceof vError.AbortedError)) {\n    return new vError.AbortedError(message);\n  }\n  vError.VeyronError.call(this, message, vError.Ids.Aborted);\n};\ninherits(vError.AbortedError, vError.VeyronError);\n\n/*\n * Creates an error object indicating requester specified an invalid argument.\n * @constructor\n * @param {string} message message\n * @return {Error} Error object with name set to the badarg error id.\n */\nvError.BadArgError = function(message) {\n  if (!(this instanceof vError.BadArgError)) {\n    return new vError.BadArgError(message);\n  }\n  vError.VeyronError.call(this, message, vError.Ids.BadArg);\n};\ninherits(vError.BadArgError, vError.VeyronError);\n\n/*\n * Creates an error object indicating protocol mismatch,\n * including type or argument errors.\n * @param {string} message message\n * @return {Error} Error object with name set to the bad protocol error id.\n */\nvError.BadProtocolError = function(message) {\n  if (!(this instanceof vError.BadProtocolError)) {\n    return new vError.BadProtocolError(message);\n  }\n  vError.VeyronError.call(this, message, vError.Ids.BadProtocol);\n};\ninherits(vError.BadProtocolError, vError.VeyronError);\n\n/*\n * Creates an error object indicating requested entity already exists\n * @param {string} message message\n * @return {Error} Error object with name set to the exists error id.\n */\nvError.ExistsError = function(message) {\n  if (!(this instanceof vError.ExistsError)) {\n    return new vError.ExistsError(message);\n  }\n  vError.VeyronError.call(this, message, vError.Ids.Exists);\n};\ninherits(vError.ExistsError, vError.VeyronError);\n\n/*\n * Creates an error object indicating internal invariants broken;\n * something is very wrong\n * @param {string} message message\n * @return {Error} Error object with name set to the internal error id.\n */\nvError.InternalError = function(message) {\n  if (!(this instanceof vError.InternalError)) {\n    return new vError.InternalError(message);\n  }\n  vError.VeyronError.call(this, message, vError.Ids.Internal);\n};\ninherits(vError.InternalError, vError.VeyronError);\n\n/*\n * Creates an error object indicating requester isn't authorized\n * to access the entity.\n * @param {string} message message\n * @return {Error} Error object with name set to the not authorized error id.\n */\nvError.NoAccessError = function(message) {\n  if (!(this instanceof vError.NoAccessError)) {\n    return new vError.NoAccessError(message);\n  }\n  vError.VeyronError.call(this, message, vError.Ids.NoAccess);\n};\ninherits(vError.NoAccessError, vError.VeyronError);\n\n/*\n * Creates an Error object indicating requested entity (e.g. object, method)\n * does not exist.\n * @param {string} message message\n * @return {Error} Error object with name set to the not found error id.\n */\nvError.NoExistError = function(message) {\n  if (!(this instanceof vError.NoExistError)) {\n    return new vError.NoExistError(message);\n  }\n  vError.VeyronError.call(this, message, vError.Ids.NoExist);\n};\ninherits(vError.NoExistError, vError.VeyronError);\n\n/*\n * Creates an Error object indicating requested entity (e.g. object, method)\n * either does not exist, or that the requester is not authorized to access it.\n * @param {string} message message\n * @return {Error} Error object with name set to the not found error id.\n */\nvError.NoExistOrNoAccessError = function(message) {\n  if (!(this instanceof vError.NoExistOrNoAccessError)) {\n    return new vError.NoExistOrNoAccessError(message);\n  }\n  vError.VeyronError.call(this, message, vError.Ids.NoExistOrNoAccess);\n};\ninherits(vError.NoExistOrNoAccessError, vError.VeyronError);\nmodule.exports = vError;\n","/**\n *  @fileoverview Server allows creation of services that can be invoked\n *  remotely via RPCs.\n *\n *  Usage:\n *  var videoService = {\n *    play: {\n *      // Play video\n *    }\n *  };\n *\n *  var s = new server(proxyConnection);\n *  s.serve('mymedia/video', videoService);\n */\n\nvar Deferred = require('./../lib/deferred');\nvar IdlHelper = require('./../idl/idl');\nvar vError = require('./../lib/verror');\nvar ServiceWrapper = IdlHelper.ServiceWrapper;\n\nvar nextServerID = 1; // The ID for the next server.\n\n/**\n * represents a veyron server which allows registration of services that can be\n * invoked remotely via RPCs.\n * @constructor\n * @param {Object} router the server router.\n */\nfunction Server(router) {\n  if (!(this instanceof Server)) {\n    return new Server(router);\n  }\n\n  this._router = router;\n  this.id = nextServerID++;\n  this.serviceObject = null;\n  this._knownServiceDefinitions = {};\n}\n\n/**\n * addIDL adds an IDL file to the set of definitions known by the server.\n * Services defined in IDL files passed into this method can be used to\n * describe the interface exported by a serviceObject passed into register.\n * @param {object} updates the output of the vdl tool on an idl.\n */\nServer.prototype.addIDL = function(updates) {\n  var prefix = updates.package;\n  for (var key in updates) {\n    if (key[0] === key[0].toUpperCase() && updates.hasOwnProperty(key)) {\n      this._knownServiceDefinitions[prefix + '.' + key] = updates[key];\n    }\n  }\n};\n\n// Returns an error if the validation of metadata failed.\nServer.prototype._getAndValidateMetadata = function(serviceObject,\n    serviceMetadata) {\n  var shouldCheckDefinition = false;\n  if (typeof(serviceMetadata) === 'string') {\n    serviceMetadata = [serviceMetadata];\n  }\n\n  if (Array.isArray(serviceMetadata)) {\n    shouldCheckDefinition = true;\n    var serviceDefinitions = {};\n\n    for (var i = 0; i < serviceMetadata.length; i++) {\n      var key = serviceMetadata[i];\n      var object = this._knownServiceDefinitions[key];\n      if (!object) {\n        return new vError.NoExistError('unknown service ' + key);\n      }\n      // Merge the results into the single definitions object.\n      for (var k in object) {\n        if (object.hasOwnProperty(k)) {\n          serviceDefinitions[k] = object[k];\n        }\n      }\n    }\n    serviceMetadata = serviceDefinitions;\n  }\n\n  var wrapper = new ServiceWrapper(serviceObject, serviceMetadata);\n\n  if (shouldCheckDefinition) {\n    var err2 = wrapper.validate(serviceMetadata);\n    if (err2) {\n      return err2;\n    }\n  }\n\n  this.serviceObject = wrapper;\n\n  return null;\n};\n\n/**\n * Serve serves the given service object under the given name.  It will\n * register them with the mount table and maintain that registration so long\n * as the stop() method has not been called.  The name determines where\n * in the mount table's name tree the new services will appear.\n *\n * To serve names of the form \"mymedia/*\" make the calls:\n * serve(\"mymedia\", myService);\n\n * serve may be called multiple times to serve the same service under\n * multiple names.  If different objects are given on the different calls\n * it is considered an error.\n *\n * @param {string} name Name to serve under\n * @param {Object} serviceObject service object to serve\n * @param {*} serviceMetadata if provided a set of metadata for functions\n * in the service (such as number of return values).  It could either be\n * passed in as a properties object or a string that is the name of a\n * service that was defined in the idl files that the server knows about.\n * @param {function} callback if provided, the function will be called on\n * completion. The only argument is an error if there was one.\n * @return {Promise} Promise to be called when serve completes or fails\n * the endpoint address of the server will be returned as the value of promise\n */\nServer.prototype.serve = function(name, serviceObject,\n    serviceMetadata, callback) {\n  if (!callback && typeof(serviceMetadata) === 'function') {\n    callback = serviceMetadata;\n    serviceMetadata = null;\n  }\n\n  var err = this._getAndValidateMetadata(serviceObject, serviceMetadata);\n  if (err) {\n    var def = new Deferred(callback);\n    def.reject(err);\n    return def.promise;\n  }\n\n  return this._router.serve(name, this, callback);\n};\n\n/**\n * Stop gracefully stops all services on this Server.\n * New calls are rejected, but any in-flight calls are allowed to complete.\n * All published named are unmounted.\n * @param {function} callback if provided, the function will be called on\n * completion. The only argument is an error if there was one.\n * @return {Promise} Promise to be called when stop service completes or fails\n */\nServer.prototype.stop = function(callback) {\n  return this._router.stopServer(this, callback);\n};\n\n/**\n * Generates an IDL wire description for all the registered services\n * @return {Object.<string, Object>} map from service name to idl wire\n * description\n */\nServer.prototype.generateIdlWireDescription = function() {\n  return IdlHelper.generateIdlWireDescription(this.serviceObject);\n};\n\n/**\n * Export the module\n */\nmodule.exports = Server;\n","/**\n * @fileoveriew A router that handles incoming server rpcs.\n */\n\nvar Promise = require('../lib/promise');\nvar Stream = require('../proxy/stream');\nvar MessageType = require('../proxy/message_type');\nvar IncomingPayloadType = require('../proxy/incoming_payload_type');\nvar ErrorConversion = require('../proxy/error_conversion');\nvar Deferred = require('./../lib/deferred');\nvar vLog = require('./../lib/vlog');\nvar SimpleHandler = require('../proxy/simple_handler');\nvar PublicId = require('../security/public');\n\n\nvar ServerStream = function(stream) {\n  this._stream = stream;\n};\n\nServerStream.prototype.handleResponse = function(type, data) {\n  switch (type) {\n    case IncomingPayloadType.STREAM_RESPONSE:\n      this._stream._queueRead(data);\n      break;\n    case IncomingPayloadType.STREAM_CLOSE:\n      this._stream._queueRead(null);\n      break;\n    case IncomingPayloadType.ERROR_RESPONSE:\n      this._stream.emit('error', ErrorConversion.toJSerror(data));\n      break;\n  }\n};\n\n/**\n * A router that handles routing incoming requests to the right\n * server\n * @constructor\n */\nvar Router = function(proxy) {\n  this._servers = {};\n  this._proxy = proxy;\n  this._streamMap = {};\n  proxy.addIncomingHandler(IncomingPayloadType.INVOKE_REQUEST, this);\n};\n\n/**\n * Injects the injections into the eight positions in args and\n * returns what was injected.\n * @param {Array} args The arguments to inject into.\n * @param {Object} injectionPositions A map of injected variables to the\n * position to put in args.\n * @param {Object} injections A map of injected variables to values.\n * @return {Array} the array of variables that were injected.\n */\nvar inject = function(args, injectionPositions, injections) {\n  var keys = Object.keys(injectionPositions);\n  var invertedMap = {};\n  keys.forEach(function(key) {\n    invertedMap[injectionPositions[key]] = key;\n  });\n  var values = keys.map(function getValue(k) {\n    return injectionPositions[k];\n  });\n  values.filter(function removeUndefined(value) {\n    return value !== undefined;\n  });\n  values.sort();\n  var keysInserted = [];\n  values.forEach(function actuallyInject(pos) {\n    var key = invertedMap[pos];\n    args.splice(pos, 0, injections[key]);\n    keysInserted.push(key);\n  });\n  return keysInserted;\n};\n\n// Wraps the call to the method with a try block in the smallest\n// function possible, so that v8 de-optimizes as little as possible.\nRouter.prototype.invokeMethod = function (receiver, method, args) {\n  // Call the registered method on the requested service\n  try {\n    return method.apply(receiver, args);\n  } catch (e) {\n    if (e instanceof Error) {\n      return e;\n    }\n    return new Error(e);\n  }\n};\n\n/**\n * Handles incoming requests from the server to invoke methods on registered\n * services in JavaScript.\n * @param {string} messageId Message Id set by the server.\n * @param {Object} request Invocation request JSON. Request's structure is\n * {\n *   serverId: number // the server id\n *   method: string // Name of the method on the service to call\n *   args: [] // Array of positional arguments to be passed into the method\n * }\n */\nRouter.prototype.handleRequest = function(messageId, request) {\n  var err;\n  var server = this._servers[request.serverId];\n  if (!server) {\n    err = new Error('Request for unknown server ' + request.serverId);\n    this.sendResult(messageId, request.method, null, err);\n    return;\n  }\n\n  var serviceWrapper = server.serviceObject;\n  if (!serviceWrapper) {\n    err = new Error('No service found');\n    this.sendResulttResult(messageId, request.method, null, err);\n    return;\n  }\n\n  var serviceObject = serviceWrapper.object;\n\n  // Find the method\n  var serviceMethod = serviceObject[request.method];\n  if (serviceMethod === undefined) {\n    err = new Error('Requested method ' + request.method +\n        ' not found on');\n    this.sendResult(messageId, request.method, null, err);\n    return;\n  }\n  var metadata = serviceWrapper.metadata[request.method];\n\n  var self = this;\n  var sendInvocationError = function(e, metadata) {\n    var stackTrace;\n    if (e instanceof Error && e.stack !== undefined) {\n      stackTrace = e.stack;\n    }\n    vLog.debug('Requested method ' + request.method +\n        ' threw an exception on invoke: ', e, stackTrace);\n    var numOutArgs = metadata.numOutArgs;\n    var result;\n    switch (numOutArgs) {\n      case 0:\n        break;\n      case 1:\n        result = null;\n        break;\n      default:\n        result = new Array(numOutArgs);\n    }\n    self.sendResult(messageId, request.method, result, e,\n        metadata);\n  };\n  var args = request.args;\n\n  var context = {\n    suffix: request.context.suffix,\n    name: request.context.name,\n    remoteId: new PublicId(request.context.remoteID.names,\n                           request.context.remoteID.handle,\n                           this._proxy)\n  };\n\n  // Create callback to pass to the function, if it is requested.\n  var finished = false;\n  var cb = function callback(e, v) {\n    if (finished) {\n      return;\n    }\n    finished = true;\n    context.remoteId.release();\n    self.sendResult(messageId, request.method, v, e, metadata);\n  };\n\n  var injections = {\n    $stream: new Stream(messageId, this._proxy.senderPromise, false),\n    $callback: cb,\n    $context: context,\n    $suffix: context.suffix,\n    $name: context.name,\n    $remoteId: context.remoteId\n  };\n\n  var variables = inject(args, metadata.injections, injections);\n  if (variables.indexOf('$stream') !== -1) {\n    var stream = injections['$stream'];\n    this._streamMap[messageId] = stream;\n    var rpc = new ServerStream(stream);\n    this._proxy.addIncomingStreamHandler(messageId, rpc);\n  }\n\n  // Invoke the method\n  var result = this.invokeMethod(serviceObject, serviceMethod, args);\n\n  if (result instanceof Error) {\n    sendInvocationError(result, metadata);\n    return;\n  }\n\n  // Normalize result to be a promise\n  var resultPromise = Promise.resolve(result);\n\n  if (variables.indexOf('$callback') !== -1) {\n    // The callback takes care of sending the result, so we don't use the\n    // promises.\n    return;\n  }\n\n  // Send the result back to the server\n  resultPromise.then(function(value) {\n    if (finished) {\n      return;\n    }\n    context.remoteId.release();\n    finished = true;\n    self.sendResult(messageId, request.method, value,\n        null, metadata);\n  }, function(err) {\n    if (finished) {\n      return;\n    }\n    finished = true;\n    sendInvocationError(err, metadata);\n  });\n};\n\n/**\n * Sends the result of a requested invocation back to jspr\n * @param {string} messageId Message id of the original invocation request\n * @param {string} name Name of method\n * @param {Object} value Result of the call\n * @param {Object} err Error from the call\n * @param {Object} metadata Metadata about the function.\n */\nRouter.prototype.sendResult = function(messageId, name, value, err, metadata) {\n  var results = [];\n  if (metadata) {\n    switch (metadata.numOutArgs) {\n      case 0:\n        if (value !== undefined) {\n          vLog.error('Unexpected return value from ' + name + ': ' + value);\n        }\n        results = [];\n        break;\n      case 1:\n        results = [value];\n        break;\n      default:\n        if (Array.isArray(value)) {\n          if (value.length !== metadata.numOutArgs) {\n            vLog.error('Wrong number of arguments returned by ' + name +\n                '. expected: ' + metadata.numOutArgs + ', got:' +\n                value.length);\n          }\n          results = value;\n        } else {\n          vLog.error('Wrong number of arguments returned by ' + name +\n              '. expected: ' + metadata.numOutArgs + ', got: 1');\n          results = [value];\n        }\n    }\n  } else {\n    results = [value];\n  }\n\n  var errorStruct = null;\n  if (err !== undefined && err !== null) {\n    errorStruct = ErrorConversion.toStandardErrorStruct(err);\n  }\n\n  // If this is a streaming request, queue up the final response after all\n  // the other stream requests are done.\n  var stream = this._streamMap[messageId];\n  if (stream) {\n    // We should probably remove the stream from the dictionary, but it's\n    // not clear if there is still a reference being held elsewhere.  If there\n    // isn't, then GC might prevent this final message from being sent out.\n    stream.serverClose(value, errorStruct);\n    this._proxy.dequeue(messageId);\n  } else {\n    var responseData = {\n      results: results,\n      err: errorStruct\n    };\n\n    var responseDataJSON = JSON.stringify(responseData);\n    this._proxy.sendRequest(responseDataJSON, MessageType.RESPONSE, null,\n        messageId);\n  }\n};\n\n/**\n * Serves the server under the given name\n * @param {string} name Name to serve under\n * @param {Veyron.Server} The server who will handle the requests for this\n * name.\n * @param {function} [callback] If provided, the function will be called when\n * serve completes.  The first argument passed in is the error if there\n * was any and the second argument is the endpoint.\n * @return {Promise} Promise to be called when serve completes or fails\n * the endpoint string of the server will be returned as the value of promise\n */\nRouter.prototype.serve = function(name, server, callback) {\n  vLog.info('Serving under the name: ', name);\n\n  var messageJSON = {\n    name: name,\n    serverId: server.id,\n    service: server.generateIdlWireDescription()\n  };\n\n  this._servers[server.id] = server;\n\n  var def = new Deferred(callback);\n  var message = JSON.stringify(messageJSON);\n  var id = this._proxy.id;\n  this._proxy.id += 2;\n  var handler = new SimpleHandler(def, this._proxy, id);\n  // Send the serve request to the proxy\n  this._proxy.sendRequest(message, MessageType.SERVE, handler, id);\n\n  return def.promise;\n};\n\n/**\n * Sends a stop server request to jspr.\n * @param {Server} server Server object to stop.\n * @param {function} callback if provided, the function will be called on\n * completion. The only argument is an error if there was one.\n * @return {Promise} Promise to be called when stop service completes or fails\n */\nRouter.prototype.stopServer = function(server, callback) {\n  var self = this;\n\n  var def = new Deferred(callback);\n  var id = this._proxy.id;\n  this._proxy.id += 2;\n  var handler = new SimpleHandler(def, this._proxy, id);\n  // Send the stop request to jspr\n  this._proxy.sendRequest(server.id.toString(), MessageType.STOP, handler, id);\n\n  return def.promise.then(function(result) {\n    delete self._servers[server.id];\n    return result;\n  });\n};\n\n\nmodule.exports = Router;\n\n","/**\n *  @fileoverview Client for the veyron service.\n *\n *  Usage:\n *  var cl = new client(proxyConnection);\n *  var service = cl.bindTo('EndpointAddress', 'ServiceName');\n *  resultPromise = service.MethodName(arg);\n */\n\nvar Promise = require('../lib/promise');\nvar Deferred = require('../lib/deferred');\nvar vLog = require('../lib/vlog');\nvar ErrorConversion = require('../proxy/error_conversion');\nvar Stream = require('../proxy/stream');\nvar vError = require('../lib/verror');\nvar MessageType = require('../proxy/message_type');\nvar IncomingPayloadType = require('../proxy/incoming_payload_type');\n\nvar OutstandingRPC = function(options, cb) {\n  this._proxy = options.proxy;\n  this._id = -1;\n  this._name = options.name;\n  this._methodName = options.methodName,\n  this._args = options.args;\n  this._numOutParams = options.numOutParams;\n  this._isStreaming = options.isStreaming || false;\n  this._cb = cb;\n  this._def = null;\n};\n\nOutstandingRPC.prototype.start = function() {\n  this._id = this._proxy.nextId();\n  var def = new Deferred(this._cb);\n\n  var streamingDeferred = null;\n  if (this._isStreaming) {\n    streamingDeferred = new Deferred();\n    def.stream = new Stream(this._id, streamingDeferred.promise, true);\n    def.promise.stream = def.stream;\n  }\n\n  var message = this.constructMessage();\n\n  this._def = def;\n  this._proxy.sendRequest(message, MessageType.REQUEST, this, this._id);\n  if (streamingDeferred) {\n    this._proxy.senderPromise.then(function(ws) {\n      streamingDeferred.resolve(ws);\n    }, function(err) {\n      streamingDeferred.reject(err);\n    });\n  }\n\n  return def.promise;\n};\n\nOutstandingRPC.prototype.handleResponse = function(type, data) {\n  switch (type) {\n    case IncomingPayloadType.FINAL_RESPONSE:\n      this.handleCompletion(data);\n      break;\n    case IncomingPayloadType.STREAM_RESPONSE:\n      this.handleStreamData(data);\n      break;\n    case IncomingPayloadType.ERROR_RESPONSE:\n      this.handleError(data);\n      break;\n    case IncomingPayloadType.STREAM_CLOSE:\n      this.handleStreamClose();\n      break;\n    default:\n      this.handleError(\n          new vError.InternalError('Recieved unknown response type from wspr'));\n      break;\n  }\n};\n\nOutstandingRPC.prototype.handleCompletion = function(data) {\n  if (data.length === 1) {\n    data = data[0];\n  }\n  this._def.resolve(data);\n  if (this._def.stream) {\n    this._def.stream._queueRead(null);\n  }\n  this._proxy.dequeue(this._id);\n};\n\nOutstandingRPC.prototype.handleStreamData = function(data) {\n  if (this._def.stream) {\n    this._def.stream._queueRead(data);\n  } else {\n    vLog.warn('Ignoring streaming message for non-streaming flow : ' +\n        this._id);\n  }\n};\n\nOutstandingRPC.prototype.handleStreamClose = function() {\n  if (this._def.stream) {\n    this._def.stream._queueRead(null);\n  }\n};\n\nOutstandingRPC.prototype.handleError = function(data) {\n  var err;\n  if (data instanceof vError.VeyronError) {\n    err = data;\n  } else {\n    err = ErrorConversion.toJSerror(data);\n  }\n\n  if (this._def.stream) {\n    this._def.stream.emit('error', err);\n    this._def.stream.queueRead(null);\n  }\n  this._def.reject(err);\n  this._proxy.dequeue(this._id);\n};\n\n\n/**\n * Construct a message to send to the veyron native code\n * @return {string} json string to send to jspr\n */\nOutstandingRPC.prototype.constructMessage = function() {\n  var jsonMessage = {\n    name: this._name,\n    method: this._methodName,\n    inArgs: this._args || [],\n    numOutArgs: this._numOutParams || 1,\n    isStreaming: this._isStreaming\n  };\n  return JSON.stringify(jsonMessage);\n};\n\n/**\n * Client for the veyron service.\n * @constructor\n * @param {Object} proxyConnection Veyron proxy client\n */\nfunction Client(proxyConnection) {\n  if (!(this instanceof Client)) {\n    return new Client(proxyConnection);\n  }\n\n  this._proxyConnection = proxyConnection;\n}\n\n/**\n * Performs client side binding of a remote service to a native javascript\n * stub object.\n * @param {string} name the veyron name of the service to bind to.\n * @param {object} optServiceSignature if set, javascript signature of methods\n * available in the remote service.\n * @param {function} [callback] if given, this function will be called on\n * completion of the bind.  The first argument will be an error if there is\n * one, and the second argument is an object with methods that perform rpcs to\n * service\n * methods.\n * @return {Promise} An object with methods that perform rpcs to service methods\n */\nClient.prototype.bindTo = function(name, optServiceSignature, callback) {\n  var self = this;\n\n  if (typeof optServiceSignature === 'function') {\n    callback = optServiceSignature;\n    optServiceSignature = undefined;\n  }\n\n  var def = new Deferred(callback);\n  var serviceSignaturePromise;\n\n  if (optServiceSignature !== undefined) {\n    serviceSignaturePromise = Promise.resolve(optServiceSignature);\n  } else {\n    vLog.debug('Requesting service signature for:', name);\n    serviceSignaturePromise = self._proxyConnection.getServiceSignature(name);\n  }\n\n  var promise = def.promise;\n\n  serviceSignaturePromise.then(function(serviceSignature) {\n    vLog.debug('Received signature for:', name, serviceSignature);\n    var boundObject = {};\n\n    var bindMethod = function(methodName) {\n      var methodInfo = serviceSignature[methodName];\n      var numOutParams = methodInfo.numOutArgs;\n      boundObject[methodName] = function() {\n        var args = Array.prototype.slice.call(arguments, 0);\n        var cb = null;\n        if (args.length === methodInfo.inArgs.length + 1) {\n          cb = args[args.length - 1];\n          args = args.slice(0, methodInfo.inArgs.length);\n        }\n        if (args.length !== methodInfo.inArgs.length) {\n          throw new Error('Invalid number of arguments to \"' +\n            methodName + '\". Expected ' + methodInfo.inArgs.length +\n            ' but there were ' + args.length);\n        }\n        var rpc = new OutstandingRPC({\n           proxy: self._proxyConnection,\n           name: name,\n           methodName: methodName,\n           args: args,\n           numOutParams: numOutParams,\n           isStreaming: methodInfo.isStreaming\n        }, cb);\n        return rpc.start();\n      };\n    };\n\n    for (var methodName in serviceSignature) {\n      if (serviceSignature.hasOwnProperty(methodName)) {\n        bindMethod(methodName);\n      }\n    }\n\n    //Also stub out signature() on the bound object.\n    boundObject.signature = function() {\n      return Promise.resolve(serviceSignature);\n    };\n\n    def.resolve(boundObject);\n  }).catch (def.reject);\n\n  return promise;\n};\n\n/**\n * Export the module\n */\nmodule.exports = Client;\n","/**\n * @fileoverview WebSocket client implementation\n */\n\nvar WebSocket = require('./../lib/websocket');\nvar Deferred = require('./../lib/deferred');\nvar vLog = require('./../lib/vlog');\nvar Proxy = require('./proxy');\n\n/**\n * A client for the veyron service using websockets. Connects to the veyron wspr\n * and performs RPCs.\n * @constructor\n * @param {string} url of wspr that connects to the veyron network\n * identity\n */\nfunction ProxyConnection(url) {\n  this.url = url.replace(/^(http|https)/, 'ws') + '/ws';\n  this.currentWebSocketPromise = null;\n  // Since we haven't finished constructing the Proxy object,\n  // we can't call this.getWebsocket() to return the sender promise.\n  // Instead, we create a new promise that will eventually call\n  // getWebsocket and only resolve the promise after Proxy.call\n  // has completed.\n  var def = new Deferred();\n  Proxy.call(this, def.promise);\n  def.resolve(this.getWebSocket());\n}\n\nProxyConnection.prototype = Object.create(Proxy.prototype);\n\nProxyConnection.prototype.constructor = ProxyConnection;\n\n/**\n * Connects to the server and returns an open web socket connection\n * @return {promise} a promise that will be fulfilled with a websocket object\n * when the connection is established.\n */\nProxyConnection.prototype.getWebSocket = function() {\n  // We are either connecting or already connected, return the same promise\n  if (this.currentWebSocketPromise) {\n    return this.currentWebSocketPromise;\n  }\n\n  // TODO(bjornick): Implement a timeout mechanism.\n  var websocket = new WebSocket(this.url);\n  var self = this;\n  var deferred = new Deferred();\n  this.currentWebSocketPromise = deferred.promise;\n  websocket.onopen = function() {\n    vLog.info('Connected to proxy at', self.url);\n    deferred.resolve(websocket);\n  };\n  var configDeferred = this._configDeferred;\n  websocket.onerror = function(e) {\n    vLog.error('Failed to connect to proxy at url:', self.url);\n    deferred.reject(e);\n\n    // TODO(nlacasse): This causes an unhandledRejection, since nothing is\n    // chained on this promise at the point when we reject it.\n    //\n    // Later on, configDeferred becomes proxy.config, and a lot of places in the\n    // code do proxy.config.then(), so I'm leaving this in for now.\n    //\n    // This should be refactored so that there is a handler chained to this\n    // promise at the point it is created, or at least before it gets rejected.\n    configDeferred.reject(\n      'Proxy connection closed, failed to get config ' + e);\n  };\n\n  websocket.onmessage = function(frame) {\n    var message;\n    try {\n      message = JSON.parse(frame.data);\n    } catch (e) {\n      vLog.warn('Failed to parse ' + frame.data);\n      return;\n    }\n\n    self.process(message);\n  };\n\n  return deferred.promise;\n};\n\n/**\n * Export the module\n */\nmodule.exports = ProxyConnection;\n","/**\n * @fileoverview Enum for outgoing message types\n */\n\nvar MessageType = {\n  REQUEST: 0, // Request to invoke a method on a Veyron name\n  SERVE: 1, // Request to serve a server in JavaScript under a Veyron name\n  RESPONSE: 2, // Indicates a response from a registered service in JavaScript\n  STREAM_VALUE: 3, // Indicates a stream value\n  STREAM_CLOSE: 4, // Request to close a stream\n  SIGNATURE: 5, // Request to get signature of a remote server\n  STOP: 6, // Request to stop a server\n  BLESS: 8, // Blesses an identity\n  UNLINK_ID: 9, // Unlinks an identity\n  NEW_ID: 10\n};\n\nmodule.exports = MessageType;\n","/**\n *  @fileoverview Client library for the Namespace.\n */\n\nvar nameUtil = require('./util.js');\nvar Promise = require('../lib/promise');\nvar Deferred = require('../lib/deferred');\nvar vError = require('../lib/verror');\n\n/**\n * Namespace handles manipulating and querying from the mount table.\n * @param {object} client A veyron client.\n * @param {...string} roots root addresses to use as the root mount tables.\n * @constructor\n */\nvar Namespace = function(client, roots) {\n  this._client = client;\n  this._roots = roots;\n};\n\n/*\n * Error returned when resolution hits a non-mount table.\n */\nNamespace.errNotAMountTable = function() {\n  return new vError.VeyronError(\n    'Resolution target is not a mount table', vError.Ids.Aborted);\n};\n\n/*\n * Error returned from the mount table server when reading a non-existant name.\n */\nNamespace.errNoSuchName = function() {\n  return new vError.VeyronError(\n    'Name doesn\\'t exist', vError.Ids.NoExist);\n};\n\n/*\n * Error returned from the mount table server when reading a non-existant name.\n */\nNamespace.errNoSuchNameRoot = function() {\n  return new vError.VeyronError(\n    'Name doesn\\'t exist: root of namespace', vError.NoExist);\n};\n\n/*\n * Maximum number of hops between servers we will make to resolve a name.\n */\nNamespace._maxDepth = 32;\n\n/*\n * Make a name relative to the roots of this namespace.\n * @param {string} name A name.\n * @return {Array} A list of rooted names.\n */\nNamespace.prototype._rootNames = function(name) {\n  if (nameUtil.isRooted(name) && name !== '/') {\n    return [name];\n  }\n  var out = [];\n  for (var i = 0; i < this._roots.length; i++) {\n    out.push(nameUtil.join(this._roots[i], name));\n  }\n  return out;\n};\n\n/*\n * Utility function to join a suffix to a list of servers.\n * @param {Array} results An array of return values from a\n * resolveStep call.  The first element of the array is a list of servers.\n * The second element should be a string suffix.\n * @return {Array} list of servers with suffix appended.\n */\nfunction convertServersToStrings(results) {\n  var servers = results[0];\n  var suffix = results[1];\n  var out = [];\n  for (var i = 0; i < servers.length; i++) {\n    var name = servers[i].server;\n    if (suffix !== '') {\n      name = nameUtil.join(name, suffix);\n    }\n    out.push(name);\n  }\n  return out;\n}\n\n/*\n * Utility function to make an array of names terminal.\n * @param {Array} names List of names.\n * @return {Array} list of terminal names.\n */\nfunction makeAllTerminal(names) {\n  return names.map(nameUtil.convertToTerminalName);\n}\n\n/*\n * Utility function to check if every name in an array is terminal.\n * @param {Array} names List of names.\n * @return {boolean} true if every name in the input was terminal.\n */\nfunction allAreTerminal(names) {\n  return names.every(nameUtil.isTerminal);\n}\n\n/*\n * Utility method to try a single resolve step against a list of\n * mirrored MountTable servers.\n * @param {Array} names List of names representing mirrored MountTable servers.\n * @return {Promise} a promise that will be fulfilled with a list of further\n * resolved names.\n */\nNamespace.prototype._resolveAgainstMountTable = function(names) {\n  if (names.length === 0) {\n    return Promise.reject(\n      new vError.BadArgError('No servers to resolve query.'));\n  }\n\n  // TODO(mattr): Maybe make this take a service signature.\n  // That would be more efficient, but we would need to do error handling\n  // differently.\n  var self = this;\n  var name = nameUtil.convertToTerminalName(names[0]);\n  return this._client.bindTo(name).then(function onBind(service) {\n    if (service.resolveStep === undefined) {\n      throw Namespace.errNotAMountTable();\n    }\n    return service.resolveStep().then(convertServersToStrings);\n  }).catch(function onError(err) {\n    if (vError.equals(err, Namespace.errNoSuchName()) ||\n        vError.equals(err, Namespace.errNoSuchNameRoot()) ||\n        names.length <= 1) {\n      throw err;\n    } else {\n      return self._resolveAgainstMountTable(names.slice(1));\n    }\n  });\n};\n\n/*\n * Utility method to try a sequence of resolves until the resulting names are\n * entirely terminal.\n * @param {Array} curr List of equivalent names to try on this step.\n * @param {Array} last List of names that were tried on the previous step.\n * @param {number} depth The current depth of the recursive traversal.\n * @param {function} handleErrors A function that errors will be passed to\n * for special handling depending on the caller.\n * @return {Promise} a promise that will be fulfilled with a list of terminal\n * names.\n */\nNamespace.prototype._resolveLoop = function(curr, last, depth, handleErrors) {\n  var self = this;\n  return self._resolveAgainstMountTable(curr).then(function onResolve(names) {\n    if (allAreTerminal(names)) {\n      return names;\n    }\n    depth++;\n    if (depth > Namespace._maxDepth) {\n      throw new vError.InternalError('Maxiumum resolution depth exceeded.');\n    }\n    return self._resolveLoop(names, curr, depth, handleErrors);\n  }, function onError(err) {\n    return handleErrors(err, curr, last);\n  });\n};\n\n/**\n * resolveToMountTable resolves a veyron name to the terminal name of the\n * innermost mountable that owns the name.\n * @param {string} name The name to resolve.\n * @param {function} [callback] if given, this fuction will be called on\n * completion of the resolve.  The first argument will be an error if there\n * is one, and the second argument is a list of terminal names.\n * @return {Promise} A promise to a list of terminal names.\n */\nNamespace.prototype.resolveToMountTable = function(name, callback) {\n  var names = this._rootNames(name);\n  var deferred = new Deferred(callback);\n  var handleErrors = function(err, curr, last) {\n    if (vError.equals(err, Namespace.errNoSuchNameRoot()) ||\n        vError.equals(err, Namespace.errNotAMountTable())) {\n      return makeAllTerminal(last);\n    }\n    if (vError.equals(err, Namespace.errNoSuchName())) {\n      return makeAllTerminal(curr);\n    }\n    throw err;\n  };\n\n  deferred.resolve(this._resolveLoop(names, names, 0, handleErrors));\n\n  return deferred.promise;\n};\n\n/**\n * resolveMaximally resolves a veyron name as far as it can, whether the\n * target is a mount table or not.\n * @param {string} name The name to resolve.\n * @param {function} [callback] if given, this fuction will be called on\n * completion of the resolve.  The first argument will be an error if there\n * is one, and the second argument is a list of terminal names.\n * @return {Promise} A promise to a list of terminal names.\n */\nNamespace.prototype.resolveMaximally = function(name, callback) {\n  var names = this._rootNames(name);\n  var deferred = new Deferred(callback);\n  var handleErrors = function(err, curr, last){\n    if (vError.equals(err, Namespace.errNoSuchNameRoot()) ||\n        vError.equals(err, Namespace.errNoSuchName()) ||\n        vError.equals(err, Namespace.errNotAMountTable())) {\n      return makeAllTerminal(curr);\n    }\n    throw err;\n  };\n\n  deferred.resolve(this._resolveLoop(names, names, 0, handleErrors));\n\n  return deferred.promise;\n};\n\nmodule.exports = Namespace;\n","/**\n * @fileoverview PrivateId stub for veyron identities\n */\n\nvar Deferred = require('../lib/deferred');\nvar SimpleHandler = require('../proxy/simple_handler');\nvar PublicId = require('./public');\nvar MessageType = require('../proxy/message_type');\n\n/**\n * The private portion of a veyron identity\n */\nfunction PrivateId(proxy) {\n  this._proxy = proxy;\n}\n\n/*\n * Blesses the given PublicId with the given caveats.\n * @param {PublicId} blessee the PublicId to bless.\n * @param {String} name the name the bless the id under.\n * @param {Number} duration the duration of the blessing in milliseconds.\n * @param {Array} caveats an array of ServiceCavaeats.\n * @papram {function} cb an optional callback that will return the blessing\n * @return {Promise} a promise that will be resolved with the blessing\n */\n\nPrivateId.prototype.bless = function(blessee, name, duration, caveats, cb) {\n  var def = new Deferred(cb);\n  if (!(blessee instanceof PublicId)) {\n    def.reject(new Error('blessee should be of type PublicId'));\n    return def.promise;\n  }\n\n  var message = JSON.stringify({\n    handle: blessee._id,\n    name: name,\n    durationMs: duration,\n    caveats: caveats\n  });\n  var id = this._proxy.nextId();\n  var handler = new SimpleHandler(def, this._proxy, id);\n  this._proxy.sendRequest(message, MessageType.BLESS, handler, id);\n  var self = this._proxy;\n  return def.promise.then(function(message) {\n    var id = new PublicId(message.names, message.handle, self._proxy);\n    return id;\n  });\n};\n\nmodule.exports = PrivateId;\n","/**\n * @fileoverview PublicId stub of veyron identities\n */\n\nvar MessageType = require('../proxy/message_type');\n\n/**\n * The public portion of a veyron identity.\n */\nfunction PublicId(names, id, proxy) {\n  this.names = names;\n  this._id = id;\n  this._count = 1;\n  this._proxy = proxy;\n}\n\n// A name matches if it is a prefix of the pattern or if the pattern ends\n// in a '/*' and the pattern is a prefix of the name.\nfunction nameMatches(name, pattern) {\n  var paths = name.split('/');\n  var expectedPaths = pattern.split('/');\n  for (var i = 0; i < expectedPaths.length; i++) {\n    // If there is a star at the end of the pattern then\n    // we have a match, since the prefix of the pattern\n    // was matched by the name.\n    if (expectedPaths[i] === '*') {\n      return i === expectedPaths.length - 1;\n    }\n\n    // name is a prefix of pattern\n    if (i === paths.length) {\n      return true;\n    }\n\n    if (paths[i] !== expectedPaths[i]) {\n      return false;\n    }\n  }\n\n  return paths.length === expectedPaths.length;\n}\n\n\n/**\n * Returns whether the PublicId matches a principal pattern. There\n * are basically two types of patterns.  A fixed name pattern\n * looks like 'a/b' and matches names 'a/b' and 'a', but not\n * 'a/b/c', 'aa', or 'a/bb'. 'a' is considered a match because\n * the owner of 'a' can trivially create the name 'a/b'.  A star\n * pattern looks like 'a/b/*' and it matches anything that 'a/b' matches\n * as well as any name blessed by 'a/b', i.e 'a/b/c', 'a/b/c/d'.\n * @param {string} pattern The pattern to match against.\n * @return {boolean} Returns true iff the PublicId has a name that matches\n * the pattern passed in.\n */\nPublicId.prototype.match = function(pattern) {\n  if (pattern === '' || !pattern) {\n    return false;\n  }\n  for (var i = 0; i < this.names.length; i++) {\n    if (nameMatches(this.names[i], pattern)) {\n      return true;\n    }\n  }\n  return false;\n};\n\n/**\n * Increments the reference count on the PublicId.  When the reference count\n * goes to zero, the PublicId will be removed from the cache in the go code.\n */\nPublicId.prototype.retain = function() {\n  this._count++;\n};\n\n/**\n * Decrements the reference count on the PublicId.  When the reference count\n * goes to zero, the PublicId will be removed from the cache in the go code.\n */\nPublicId.prototype.release = function() {\n  this._count--;\n  if (this._count === 0) {\n    var message = JSON.stringify(this._id);\n    this._proxy.sendRequest(message, MessageType.UNLINK_ID, null,\n        this._proxy.nextId());\n  }\n};\n\nPublicId.prototype.toJSON = function() {\n  return {\n    id: this._id,\n    names: this.names\n  };\n};\n\nmodule.exports = PublicId;\n","/**\n * @fileoverview Veyron.js promise implementation.\n *\n * Currently this is just bluebird promises.\n *\n * We'd like our promise implementation to follow the es6/A+ promise spec, but\n * the \"es6-promises\" module eats errors, so we are using bluebird.\n *\n * See for reference:\n *   http://blog.soareschen.com/the-problem-with-es6-promises\n *   https://github.com/soareschen/es6-promise-debugging\n *   https://github.com/petkaantonov/bluebird#error-handling\n *\n * TODO(nlacasse): Wrap bluebird promises to only expose es6/A+ promise API.\n * Otherwise users might rely on non-A+ parts of the bluebird API, preventing us\n * from switching in the future.\n */\n\nmodule.exports = require('bluebird');\n","/**\n * @fileoverview A simple handler that resolves or rejects a promise\n * on a response from the proxy.\n */\nvar IncomingPayloadType = require('./incoming_payload_type');\nvar ErrorConversion = require('./error_conversion');\nvar vError = require('./../lib/verror');\n\n/**\n * An object that rejects/resolves a promise based on a response\n * from the proxy.\n * @constructor\n * @param def the promise to resolve/reject\n * @param proxy the proxy from which to dequeue the handler\n * @param id the flow id of the message\n */\nvar Handler = function(def, proxy, id) {\n  this._proxy = proxy;\n  this._def = def;\n  this._id = id;\n};\n\nHandler.prototype.handleResponse = function(type, message) {\n  switch (type) {\n    case IncomingPayloadType.FINAL_RESPONSE:\n      this._def.resolve(message);\n      break;\n    case IncomingPayloadType.ERROR_RESPONSE:\n      var err = ErrorConversion.toJSerror(message);\n      this._def.reject(err);\n      break;\n    default:\n      this._def.reject(\n          new vError.InternalError('unknown response type ' + type));\n  }\n  this._proxy.dequeue(this._id);\n};\n\nmodule.exports = Handler;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  // Allow for deprecating things in the process of starting up.\n  if (isUndefined(global.process)) {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  if (process.noDeprecation === true) {\n    return fn;\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n","// Generated by CoffeeScript 1.6.3\n(function() {\n  var EventEmitter, Postie,\n    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    __hasProp = {}.hasOwnProperty,\n    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    __slice = [].slice;\n\n  EventEmitter = require('events').EventEmitter;\n\n  Postie = (function(_super) {\n    __extends(Postie, _super);\n\n    Postie.prototype.target = null;\n\n    Postie.prototype.origin = null;\n\n    function Postie(target, origin) {\n      if (origin == null) {\n        origin = '*';\n      }\n      this.handleMessage = __bind(this.handleMessage, this);\n      if (!(this instanceof Postie)) {\n        return new Postie(target, origin);\n      }\n      Postie.__super__.constructor.call(this);\n      this.target = target;\n      this.origin = origin;\n      this.listen();\n    }\n\n    /*\n    Sends a package over channel.\n    \n    - `channel` (String): The channel to send the package over\n    - `pkg...` (Array...): The package to send. It will take any arguments after the first,\n      stick them in a JSON array and then on the other end call the callback\n      with those arguments applied to the callback.\n    \n    Returns the result of the postMessage call.\n    */\n\n\n    Postie.prototype.post = function() {\n      var channel, packed, pkg;\n      channel = arguments[0], pkg = 2 <= arguments.length ? __slice.call(arguments, 1) : [];\n      packed = this.pack(channel, pkg);\n      return this.target.postMessage(packed, this.origin);\n    };\n\n    /*\n    Sets up the postMessage handler\n    */\n\n\n    Postie.prototype.listen = function() {\n      if (window.addEventListener) {\n        return window.addEventListener('message', this.handleMessage);\n      } else {\n        return window.attachEvent('onmessage', this.handleMessage);\n      }\n    };\n\n    /*\n    Handles a postmessage event. Attempt to unpack it, and if we can emit an\n    event.\n    \n    - `event` (Event): The event to handle.\n    */\n\n\n    Postie.prototype.handleMessage = function(event) {\n      var unpackaged;\n      if (unpackaged = this.unpack(event.data)) {\n        return this.emit.apply(this, [unpackaged.channel].concat(__slice.call(unpackaged[\"package\"])));\n      }\n    };\n\n    /*\n    Takes a string from a postmessage event and tries to unpack it. If it is\n    successful it will return the unpacked object, otherwise it will return\n    false.\n    \n    - `data` (String): The data to attempt to unpack.\n    \n    Returns the unpacked data as an Object, or `false`.\n    */\n\n\n    Postie.prototype.unpack = function(data) {\n      var error, pkg;\n      try {\n        pkg = JSON.parse(data);\n        return {\n          channel: pkg._postie.channel,\n          \"package\": pkg._postie[\"package\"]\n        };\n      } catch (_error) {\n        error = _error;\n        return false;\n      }\n    };\n\n    /*\n    Packs a channel string and a package to send into a String that we can send\n    over postMessage to be unpacked on the other side.\n    \n    - `channel` (String): The channel the package is being sent on.\n    - `pkg` (Mixed): The package to pack with the channel into the string.\n    \n    Returns a String which can be unpacked into its old representation via\n    `@unpack()`.\n    */\n\n\n    Postie.prototype.pack = function(channel, pkg) {\n      return JSON.stringify({\n        _postie: {\n          channel: channel,\n          \"package\": pkg\n        }\n      });\n    };\n\n    return Postie;\n\n  })(EventEmitter);\n\n  module.exports = Postie;\n\n}).call(this);\n","module.exports = true;","module.exports = extend\n\nfunction extend() {\n    var target = {}\n\n    for (var i = 0; i < arguments.length; i++) {\n        var source = arguments[i]\n\n        for (var key in source) {\n            if (source.hasOwnProperty(key)) {\n                target[key] = source[key]\n            }\n        }\n    }\n\n    return target\n}\n","/**\n * @fileoverview Parses the Veyron IDL\n */\n\nvar vError = require('../lib/verror');\nvar idlHelper = {};\n\n/**\n * Generates an IDL wire description for a given service by iterating over the\n * methods in the service object.\n * Method names beginning with '_' are considered private and skipped.\n * Arg names beginning with '$' are not part of the idl and are filled in by\n * the veyron libraries (e.g. $context).\n * @param {object} service a description of the service. This is a map from\n * method name to method description.\n * @return {object} a representation of the idl. This must match the format of\n * JSONServiceSignature in Veyron's go code.\n */\nidlHelper.generateIdlWireDescription = function(service) {\n  var idlWire = {};\n  var metadata = service.metadata;\n  for (var methodName in metadata) {\n    if (metadata.hasOwnProperty(methodName)) {\n      var methodMetadata = metadata[methodName];\n\n      var params = methodMetadata.params;\n      var inArgs = [];\n      for (var i = 0; i < params.length; i++) {\n        var param = params[i];\n        if (param[0] !== '$') {\n          inArgs.push(param);\n        }\n      }\n\n      idlWire[methodName] = {\n        InArgs: inArgs,\n        NumOutArgs: methodMetadata.numOutArgs + 1,\n        IsStreaming: methodMetadata.injections['$stream'] !== undefined\n      };\n    }\n  }\n\n  return idlWire;\n};\n\n/**\n * Returns an array of parameter names for a function.\n * from go/fypon (stack overflow) and based on angularjs's implementation\n * @param {function} func the function object\n * @return {string[]} list of the parameters\n */\nvar getParamNames = function(func) {\n  // represent the function as a string and strip comments\n  var fnStr = func.toString().replace(/((\\/\\/.*$)|(\\/\\*[\\s\\S]*?\\*\\/))/mg, '');\n  // get the arguments from the string\n  var result = fnStr.slice(fnStr.indexOf('(') + 1, fnStr.indexOf(')')).\n      match(/([^\\s,]+)/g);\n  if (result === null) {\n    result = [];\n  }\n  return result;\n};\n\n/**\n * Wraps a Service with annotations for each exported function.\n * @constructor\n * @param {object} service the service that is being exported.\n * @param {object} extraMetadata if provided, adds extra metadata for\n * the functions exported (such as number of return values).\n */\nidlHelper.ServiceWrapper = function(service, extraMetadata) {\n  this.object = service;\n  this.metadata = {};\n  extraMetadata = extraMetadata || {};\n\n  for (var methodName in service) {\n    if (service.hasOwnProperty(methodName) &&\n        methodName.length > 0 && methodName[0] !== '_') {\n      if (methodName[0] >= 'A' && methodName[0] <= 'Z') {\n        var camelCaseName = methodName.charAt(0).toLowerCase() +\n          methodName.slice(1);\n        throw new Error('Method names must be camel case. Perhaps rename \\'' +\n          methodName + '\\' to \\'' + camelCaseName + '\\'');\n      }\n      var method = service[methodName];\n      if (typeof method === 'function') {\n        var params = getParamNames(method);\n        var injections = {};\n        for (var i = 0; i < params.length; i++) {\n          var name = params[i];\n          if (name[0] === '$') {\n            injections[name] = i;\n          }\n        }\n        var metadata = {\n          params: params,\n          injections: injections,\n          numOutArgs: 1\n        };\n\n        // We only want to copy over the accepted metadata options.\n        if (extraMetadata[methodName]) {\n          var extra = extraMetadata[methodName];\n          if (extra.numOutArgs !== undefined) {\n            metadata.numOutArgs = extra.numOutArgs;\n          }\n        }\n\n        this.metadata[methodName] = metadata;\n      }\n    }\n  }\n};\n\nidlHelper.ServiceWrapper.prototype.validate = function(definition) {\n  for (var name in definition) {\n    if (definition.hasOwnProperty(name)) {\n      var metadata = this.metadata[name];\n      if (!metadata) {\n        return new vError.BadArgError('Missing method: ' + name);\n      }\n      var expected = definition[name];\n      var inputArgs = metadata.params.length -\n          Object.keys(metadata.injections).length;\n      if (inputArgs !== expected.numInArgs) {\n        return new vError.BadArgError('Wrong number of input args for ' +\n            name + ', got: ' + inputArgs + ', expected: ' +\n            expected.numInArgs);\n      }\n\n      if (metadata.numOutArgs !== expected.numOutArgs) {\n        return new vError.BadArgError('Wrong number of output args for ' +\n            name + ', got: ' + metadata.numOutArgs + ', expected ' +\n            expected.numOutArgs);\n      }\n\n      var hasStreaming = metadata.injections.hasOwnProperty('$stream');\n      var expectingStreaming = (expected.inputStreaming ||\n          expected.outputStreaming);\n      if (expectingStreaming && !hasStreaming) {\n        return new vError.BadArgError('Expected ' + name + ' to be ' +\n              'streaming');\n      } else if (!expectingStreaming && hasStreaming) {\n        return new vError.BadArgError('Expected ' + name + ' to not be ' +\n              'streaming');\n\n      }\n    }\n  }\n\n  for (name in this.metadata) {\n    if (this.metadata.hasOwnProperty(name) &&\n        !definition.hasOwnProperty(name)) {\n      return new vError.BadArgError('Unexpected method ' + name +\n          ' implemented.');\n    }\n  }\n  return null;\n};\n\n/**\n * Export the module\n */\nmodule.exports = idlHelper;\n","/**\n * @fileoverview Streaming RPC implementation on top of websockets.\n */\n\nvar MessageType = require('./message_type');\nvar Duplex = require('stream').Duplex;\nvar inherits = require('util').inherits;\n\n/*\n * A stream that allows sending and recieving data for a streaming rpc.  If\n * onmessage is set and a function, it will be called whenever there is data on.\n * the stream. The stream implements the promise api.  When the rpc is complete,\n * the stream will be fulfilled.  If there is an error, then the stream will be\n * rejected.\n * @constructor\n *\n * @param {number} flowId flow id\n * @param {Promise} webSocketPromise Promise of a websocket connection when\n * it's established\n * @param {boolean} isClient if set, then this is the client stream.\n */\nvar Stream = function(flowId, webSocketPromise, isClient) {\n  Duplex.call(this, { objectMode: true });\n  this.flowId = flowId;\n  this.isClient = isClient;\n  this.webSocketPromise = webSocketPromise;\n  this.onmessage = null;\n\n  // The buffer of messages that will be passed to push\n  // when the internal buffer has room.\n  this.wsBuffer = [];\n\n  // If set, objects are directly written to the internal buffer\n  // rather than wsBuffer.\n  this.shouldQueue = false;\n};\n\ninherits(Stream, Duplex);\n\n/**\n * Closes the stream, telling the other side that there is no more data.\n */\nStream.prototype.clientClose = function() {\n  var object = {\n    id: this.flowId,\n    type: MessageType.STREAM_CLOSE\n  };\n  Duplex.prototype.write.call(this, object);\n};\n\nStream.prototype.serverClose = function(value, err) {\n  var object = {\n    id: this.flowId,\n    type: MessageType.RESPONSE,\n    data: JSON.stringify({\n      results: [value || null],\n      err: err || null\n    })\n  };\n  Duplex.prototype.write.call(this, object);\n};\n\n/**\n * Implements the _read method needed by those subclassing Duplex.\n * The parameter passed in is ignored, since it doesn't really make\n * sense in object mode.\n */\nStream.prototype._read = function() {\n  // On a call to read, copy any objects in the websocket buffer into\n  // the internal stream buffer.  If we exhaust the websocket buffer\n  // and still have more room in the internal buffer, we set shouldQueue\n  // so we directly write to the internal buffer.\n  var i = 0;\n  while (i < this.wsBuffer.length && this.push(this.wsBuffer[i])) {\n    ++i;\n  }\n  if (i > 0) {\n    this.wsBuffer = this.wsBuffer.splice(i);\n  }\n\n  this.shouldQueue = this.wsBuffer.length === 0;\n};\n\n/**\n * Queue the object passed in for reading\n */\nStream.prototype._queueRead = function(object) {\n  if (this.shouldQueue) {\n    // If we have run into the limit of the internal buffer,\n    // update this.shouldQueue.\n    this.shouldQueue = this.push(object);\n  } else {\n    this.wsBuffer.push(object);\n  }\n};\n\n/**\n * Writes an object to the stream.\n * @param {*} chunk The data to write to the stream.\n * @param {null} encoding ignored for object streams.\n * @param {function} callback if set, the function to call when the write\n * completes.\n * @return {boolean} Returns false if the write buffer is full.\n */\nStream.prototype.write = function(chunk, encoding, callback) {\n  var object = {\n    id: this.flowId,\n    data: JSON.stringify(chunk),\n    type: MessageType.STREAM_VALUE\n  };\n  return Duplex.prototype.write.call(this, object, encoding, callback);\n};\n\nStream.prototype._write = function(chunk, encoding, callback) {\n  this.webSocketPromise.then(function(websocket) {\n    websocket.send(JSON.stringify(chunk));\n    callback();\n  });\n};\n\n/**\n * Writes an optional object to the stream and ends the stream.\n * @param {*} chunk The data to write to the stream.\n * @param {null} encoding ignored for object streams.\n * @param {function} callback if set, the function to call when the write\n * completes.\n */\nStream.prototype.end = function(chunk, encoding, callback) {\n  if (this.isClient) {\n    if (chunk !== undefined) {\n      this.write(chunk, encoding);\n    }\n    this.clientClose();\n  } else {\n    // We probably shouldn't allow direct calls to end, since we need\n    // a return value here, but if they are piping streams, the developer\n    // probably doesn't care about the return value.\n    this.serverClose();\n  }\n\n  Duplex.prototype.end.call(this, null, null, callback);\n};\n\nmodule.exports = Stream;\n","/**\n * @fileoverview Enum for incoming payload types\n */\n\nvar IncomingPayloadType = {\n  FINAL_RESPONSE: 0, // Final response to a call originating from JS\n  STREAM_RESPONSE: 1, // Stream response to a call originating from JS\n  ERROR_RESPONSE: 2, // Error response to a call originating from JS\n  INVOKE_REQUEST: 3, // Request to invoke a method in JS originating from server\n  STREAM_CLOSE: 4  // Response saying that the stream is closed.\n};\n\nmodule.exports = IncomingPayloadType;\n","/**\n * @fileoverview conversion between JavaScript and veyron2/verror Error object\n */\n\nvar vError = require('./../lib/verror');\n\nvar ec = {};\n\n/*\n * Implements the same structure as Standard struct in veyron2/verror\n * @private\n * @param {string} Id id of the error, which in JavaScript, corresponds to the\n * name property of an Error object.\n */\nvar _standard = function(id, message) {\n  this.iD = id;\n  this.msg = message;\n};\n\n/*\n * Converts from a JavaScript error object to verror standard struct which\n * wspr expects as error format.\n * @private\n * @param {Error} err JavaScript error object\n * @return {_standard} verror standard struct\n */\nec.toStandardErrorStruct = function(err) {\n  var errId = ''; // empty ID indicate an unknown error\n  var errMessage = '';\n  if (err instanceof Error) {\n    errMessage = err.message;\n    if (err.name !== 'Error') { // default name is considered unknown\n      errId = err.name;\n    }\n  } else if (err !== undefined && err !== null) {\n    errMessage = err + '';\n  }\n\n  return new _standard(errId, errMessage);\n};\n\nvar errIdConstrMap = {};\nerrIdConstrMap[vError.Ids.Aborted] = vError.AbortedError;\nerrIdConstrMap[vError.Ids.BadArg] = vError.BadArgError;\nerrIdConstrMap[vError.Ids.BadProtocol] = vError.BadProtocolError;\nerrIdConstrMap[vError.Ids.Exists] = vError.ExistsError;\nerrIdConstrMap[vError.Ids.Internal] = vError.InternalError;\nerrIdConstrMap[vError.Ids.NoAccess] = vError.NoAccessError;\nerrIdConstrMap[vError.Ids.NoExist] = vError.NoExistError;\nerrIdConstrMap[vError.Ids.NoExistOrNoAccess] = vError.NoExistOrNoAccessError;\n\n/*\n * Converts from a verror standard struct which comes from wspr to JavaScript\n * Error object ensuring message and name are set properly\n * @private\n * @param {_standard} verr verror standard struct\n * @return {Error} JavaScript error object\n */\nec.toJSerror = function(verr) {\n  var err;\n\n  var ErrIdConstr = errIdConstrMap[verr.iD];\n  if(ErrIdConstr) {\n    err = new ErrIdConstr(verr.msg);\n  } else {\n    err = new vError.VeyronError(verr.msg, verr.iD);\n  }\n\n  err.stack = ''; // stack does not make sense from a remote execution\n  return err;\n};\n\nmodule.exports = ec;\n","/**\n *  @fileoverview Web Socket provider for NodeJS\n */\n\nvar WS = require('ws');\n\n/**\n * Export module\n */\nmodule.exports = WS;\n\n","/**\n * @fileoverview An object that handles marshaling and unmarshal\n * messages from the native veyron implementation.\n */\n\nvar MessageType = require('./message_type');\nvar IncomingPayloadType = require('./incoming_payload_type');\nvar Deferred = require('./../lib/deferred');\nvar Promise = require('../lib/promise');\nvar vLog = require('./../lib/vlog');\nvar SimpleHandler = require('./simple_handler');\n\n// Cache the service signatures for one hour.\nvar BIND_CACHE_TTL = 3600 * 1000;\n\n/**\n * A client for the native veyron implementation.\n * @constructor\n * @param {Promise} sender A promise that is resolved when we are able to send\n * a message to the native veron implementation. It should be resolved with an\n * object that has a send function that will send messages to the native\n * implementation.\n */\nfunction Proxy(sender) {\n  // We use odd numbers for the message ids, so that the server can use even\n  // numbers.\n  this.id = 1;\n  this.outstandingRequests = {};\n  this.bindCache = {};\n  this._hasResolvedConfig = false;\n  this._configDeferred = new Deferred();\n  this.config = this._configDeferred.promise;\n  this.senderPromise = sender;\n  this.incomingRequestHandlers = {};\n}\n\n/**\n * Handles a message from native veyron implementation.\n * @param {Object} messsage The message from the native veyron code.\n */\nProxy.prototype.process = function(message) {\n  if (this._hasResolvedConfig === false) { // first message is the config.\n    this._hasResolvedConfig = true;\n    this._configDeferred.resolve(message);\n    return;\n  }\n\n  // Messages originating from server are even numbers\n  var isServerOriginatedMessage = (message.id % 2) === 0;\n\n  var handler = this.outstandingRequests[message.id];\n\n  var payload;\n  try {\n    payload = JSON.parse(message.data);\n  } catch (e) {\n    if (!isServerOriginatedMessage) {\n      handler.handleResponse(IncomingPayloadType.ERROR_RESPONSE, message.data);\n    }\n    return;\n  }\n\n  // If we don't know about this flow, just drop the message. Unless it\n  // originated from the sever.\n  if (!isServerOriginatedMessage && !handler) {\n    vLog.warn('Dropping message for unknown flow ' + message.id + ' ' +\n        message.data);\n    return;\n  }\n\n  if (!handler) {\n    handler = this.incomingRequestHandlers[payload.type];\n    if (!handler) {\n      vLog.warn('Dropping message for unknown invoke payload ' + payload.type);\n      return;\n    }\n    handler.handleRequest(message.id, payload.message);\n  } else {\n    handler.handleResponse(payload.type, payload.message);\n  }\n};\n\nProxy.prototype.dequeue = function(def, id) {\n  delete this.outstandingRequests[id];\n};\n\nProxy.prototype.nextId = function() {\n  var id = this.id;\n  this.id += 2;\n  return id;\n};\n\n/**\n * Gets the signature including methods names, number of arguments for a given\n * service name.\n * @param {string} name the veyron name of the service to get signature for.\n * @return {Promise} Signature of the service in JSON format\n */\nProxy.prototype.getServiceSignature = function(name) {\n  var cachedEntry = this.bindCache[name];\n  var now = new Date();\n  if (cachedEntry && now - cachedEntry.fetched < BIND_CACHE_TTL) {\n    return Promise.resolve(cachedEntry.signature);\n  }\n\n  var def = new Deferred();\n\n  var self = this;\n  def.promise.then(function(signature) {\n    self.bindCache[name] = {\n      signature: signature,\n      fetched: now\n    };\n  });\n  var messageJSON = { name: name };\n  var message = JSON.stringify(messageJSON);\n\n  var id = this.nextId();\n  // Send the get signature request to the proxy\n  var handler = new SimpleHandler(def, this, id);\n  this.sendRequest(message, MessageType.SIGNATURE, handler, id);\n\n  return def.promise;\n};\n\n\nProxy.prototype.addIncomingHandler = function(type, handler) {\n  this.incomingRequestHandlers[type] = handler;\n};\n\nProxy.prototype.addIncomingStreamHandler = function(id, handler) {\n  this.outstandingRequests[id] = handler;\n};\n\n/**\n * Establishes the connection if needed, frames the message with the next id,\n * adds the given deferred to outstanding requests queue and sends the request\n * to the server\n * @param {Object} message Message to send\n * @param {MessageType} type Type of message to send\n * @param {Object} handler An object with a handleResponse method that takes\n * a response type and a message.  If null, then responses for this flow\n * are ignored.\n * @param {Number} id Use this flow id instead of generating\n * a new one.\n */\nProxy.prototype.sendRequest = function(message, type, handler, id) {\n  if (handler) {\n    this.outstandingRequests[id] = handler;\n  }\n  var body = JSON.stringify({ id: id, data: message, type: type });\n\n  var self = this;\n  this.senderPromise.then(function(sender) {\n    sender.send(body);\n  }).catch(function(e) {\n    var h = self.outstandingRequests[id];\n    if (h) {\n      h.handleResponse(IncomingPayloadType.ERROR_RESPONSE, e);\n      delete self.outstandingRequests[id];\n    }\n  });\n};\n\n/**\n * Export the module\n */\nmodule.exports = Proxy;\n","module.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      }\n      throw TypeError('Uncaught, unspecified \"error\" event.');\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        len = arguments.length;\n        args = new Array(len - 1);\n        for (i = 1; i < len; i++)\n          args[i - 1] = arguments[i];\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    len = arguments.length;\n    args = new Array(len - 1);\n    for (i = 1; i < len; i++)\n      args[i - 1] = arguments[i];\n\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    var m;\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  var ret;\n  if (!emitter._events || !emitter._events[type])\n    ret = 0;\n  else if (isFunction(emitter._events[type]))\n    ret = 1;\n  else\n    ret = emitter._events[type].length;\n  return ret;\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nmodule.exports = Stream;\n\nvar EE = require('events').EventEmitter;\nvar inherits = require('inherits');\n\ninherits(Stream, EE);\nStream.Readable = require('readable-stream/readable.js');\nStream.Writable = require('readable-stream/writable.js');\nStream.Duplex = require('readable-stream/duplex.js');\nStream.Transform = require('readable-stream/transform.js');\nStream.PassThrough = require('readable-stream/passthrough.js');\n\n// Backwards-compat with node 0.4.x\nStream.Stream = Stream;\n\n\n\n// old-style streams.  Note that the pipe method (the only relevant\n// part of this class) is overridden in the Readable class.\n\nfunction Stream() {\n  EE.call(this);\n}\n\nStream.prototype.pipe = function(dest, options) {\n  var source = this;\n\n  function ondata(chunk) {\n    if (dest.writable) {\n      if (false === dest.write(chunk) && source.pause) {\n        source.pause();\n      }\n    }\n  }\n\n  source.on('data', ondata);\n\n  function ondrain() {\n    if (source.readable && source.resume) {\n      source.resume();\n    }\n  }\n\n  dest.on('drain', ondrain);\n\n  // If the 'end' option is not supplied, dest.end() will be called when\n  // source gets the 'end' or 'close' events.  Only dest.end() once.\n  if (!dest._isStdio && (!options || options.end !== false)) {\n    source.on('end', onend);\n    source.on('close', onclose);\n  }\n\n  var didOnEnd = false;\n  function onend() {\n    if (didOnEnd) return;\n    didOnEnd = true;\n\n    dest.end();\n  }\n\n\n  function onclose() {\n    if (didOnEnd) return;\n    didOnEnd = true;\n\n    if (typeof dest.destroy === 'function') dest.destroy();\n  }\n\n  // don't leave dangling pipes when there are errors.\n  function onerror(er) {\n    cleanup();\n    if (EE.listenerCount(this, 'error') === 0) {\n      throw er; // Unhandled stream error in pipe.\n    }\n  }\n\n  source.on('error', onerror);\n  dest.on('error', onerror);\n\n  // remove all the event listeners that were added.\n  function cleanup() {\n    source.removeListener('data', ondata);\n    dest.removeListener('drain', ondrain);\n\n    source.removeListener('end', onend);\n    source.removeListener('close', onclose);\n\n    source.removeListener('error', onerror);\n    dest.removeListener('error', onerror);\n\n    source.removeListener('end', cleanup);\n    source.removeListener('close', cleanup);\n\n    dest.removeListener('close', cleanup);\n  }\n\n  source.on('end', cleanup);\n  source.on('close', cleanup);\n\n  dest.on('close', cleanup);\n\n  dest.emit('pipe', source);\n\n  // Allow for unix-like usage: A.pipe(B).pipe(C)\n  return dest;\n};\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nvar Promise = require(\"./promise.js\")();\nmodule.exports = Promise;","exports = module.exports = require('./lib/_stream_readable.js');\nexports.Readable = exports;\nexports.Writable = require('./lib/_stream_writable.js');\nexports.Duplex = require('./lib/_stream_duplex.js');\nexports.Transform = require('./lib/_stream_transform.js');\nexports.PassThrough = require('./lib/_stream_passthrough.js');\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nvar old;\nif (typeof Promise !== \"undefined\") old = Promise;\nfunction noConflict(bluebird) {\n    try { if (Promise === bluebird) Promise = old; }\n    catch (e) {}\n    return bluebird;\n}\nmodule.exports = function() {\nvar util = require(\"./util.js\");\nvar async = require(\"./async.js\");\nvar errors = require(\"./errors.js\");\n\nvar INTERNAL = function(){};\nvar APPLY = {};\nvar NEXT_FILTER = {e: null};\n\nvar cast = require(\"./thenables.js\")(Promise, INTERNAL);\nvar PromiseArray = require(\"./promise_array.js\")(Promise, INTERNAL, cast);\nvar CapturedTrace = require(\"./captured_trace.js\")();\nvar CatchFilter = require(\"./catch_filter.js\")(NEXT_FILTER);\nvar PromiseResolver = require(\"./promise_resolver.js\");\n\nvar isArray = util.isArray;\n\nvar errorObj = util.errorObj;\nvar tryCatch1 = util.tryCatch1;\nvar tryCatch2 = util.tryCatch2;\nvar tryCatchApply = util.tryCatchApply;\nvar RangeError = errors.RangeError;\nvar TypeError = errors.TypeError;\nvar CancellationError = errors.CancellationError;\nvar TimeoutError = errors.TimeoutError;\nvar OperationalError = errors.OperationalError;\nvar originatesFromRejection = errors.originatesFromRejection;\nvar markAsOriginatingFromRejection = errors.markAsOriginatingFromRejection;\nvar canAttach = errors.canAttach;\nvar thrower = util.thrower;\nvar apiRejection = require(\"./errors_api_rejection\")(Promise);\n\n\nvar makeSelfResolutionError = function Promise$_makeSelfResolutionError() {\n    return new TypeError(\"circular promise resolution chain\");\n};\n\nfunction Promise(resolver) {\n    if (typeof resolver !== \"function\") {\n        throw new TypeError(\"the promise constructor requires a resolver function\");\n    }\n    if (this.constructor !== Promise) {\n        throw new TypeError(\"the promise constructor cannot be invoked directly\");\n    }\n    this._bitField = 0;\n    this._fulfillmentHandler0 = void 0;\n    this._rejectionHandler0 = void 0;\n    this._promise0 = void 0;\n    this._receiver0 = void 0;\n    this._settledValue = void 0;\n    this._boundTo = void 0;\n    if (resolver !== INTERNAL) this._resolveFromResolver(resolver);\n}\n\nfunction returnFirstElement(elements) {\n    return elements[0];\n}\n\nPromise.prototype.bind = function Promise$bind(thisArg) {\n    var maybePromise = cast(thisArg, void 0);\n    var ret = new Promise(INTERNAL);\n    if (maybePromise instanceof Promise) {\n        var binder = maybePromise.then(function(thisArg) {\n            ret._setBoundTo(thisArg);\n        });\n        var p = Promise.all([this, binder]).then(returnFirstElement);\n        ret._follow(p);\n    } else {\n        ret._follow(this);\n        ret._setBoundTo(thisArg);\n    }\n    ret._propagateFrom(this, 2 | 1);\n    return ret;\n};\n\nPromise.prototype.toString = function Promise$toString() {\n    return \"[object Promise]\";\n};\n\nPromise.prototype.caught = Promise.prototype[\"catch\"] =\nfunction Promise$catch(fn) {\n    var len = arguments.length;\n    if (len > 1) {\n        var catchInstances = new Array(len - 1),\n            j = 0, i;\n        for (i = 0; i < len - 1; ++i) {\n            var item = arguments[i];\n            if (typeof item === \"function\") {\n                catchInstances[j++] = item;\n            } else {\n                var catchFilterTypeError =\n                    new TypeError(\n                        \"A catch filter must be an error constructor \"\n                        + \"or a filter function\");\n\n                this._attachExtraTrace(catchFilterTypeError);\n                async.invoke(this._reject, this, catchFilterTypeError);\n                return;\n            }\n        }\n        catchInstances.length = j;\n        fn = arguments[i];\n\n        this._resetTrace();\n        var catchFilter = new CatchFilter(catchInstances, fn, this);\n        return this._then(void 0, catchFilter.doFilter, void 0,\n            catchFilter, void 0);\n    }\n    return this._then(void 0, fn, void 0, void 0, void 0);\n};\n\nPromise.prototype.then =\nfunction Promise$then(didFulfill, didReject, didProgress) {\n    return this._then(didFulfill, didReject, didProgress,\n        void 0, void 0);\n};\n\n\nPromise.prototype.done =\nfunction Promise$done(didFulfill, didReject, didProgress) {\n    var promise = this._then(didFulfill, didReject, didProgress,\n        void 0, void 0);\n    promise._setIsFinal();\n};\n\nPromise.prototype.spread = function Promise$spread(didFulfill, didReject) {\n    return this._then(didFulfill, didReject, void 0,\n        APPLY, void 0);\n};\n\nPromise.prototype.isCancellable = function Promise$isCancellable() {\n    return !this.isResolved() &&\n        this._cancellable();\n};\n\nPromise.prototype.toJSON = function Promise$toJSON() {\n    var ret = {\n        isFulfilled: false,\n        isRejected: false,\n        fulfillmentValue: void 0,\n        rejectionReason: void 0\n    };\n    if (this.isFulfilled()) {\n        ret.fulfillmentValue = this._settledValue;\n        ret.isFulfilled = true;\n    } else if (this.isRejected()) {\n        ret.rejectionReason = this._settledValue;\n        ret.isRejected = true;\n    }\n    return ret;\n};\n\nPromise.prototype.all = function Promise$all() {\n    return new PromiseArray(this).promise();\n};\n\n\nPromise.is = function Promise$Is(val) {\n    return val instanceof Promise;\n};\n\nPromise.all = function Promise$All(promises) {\n    return new PromiseArray(promises).promise();\n};\n\nPromise.prototype.error = function Promise$_error(fn) {\n    return this.caught(originatesFromRejection, fn);\n};\n\nPromise.prototype._resolveFromSyncValue =\nfunction Promise$_resolveFromSyncValue(value) {\n    if (value === errorObj) {\n        this._cleanValues();\n        this._setRejected();\n        this._settledValue = value.e;\n        this._ensurePossibleRejectionHandled();\n    } else {\n        var maybePromise = cast(value, void 0);\n        if (maybePromise instanceof Promise) {\n            this._follow(maybePromise);\n        } else {\n            this._cleanValues();\n            this._setFulfilled();\n            this._settledValue = value;\n        }\n    }\n};\n\nPromise.method = function Promise$_Method(fn) {\n    if (typeof fn !== \"function\") {\n        throw new TypeError(\"fn must be a function\");\n    }\n    return function Promise$_method() {\n        var value;\n        switch(arguments.length) {\n        case 0: value = tryCatch1(fn, this, void 0); break;\n        case 1: value = tryCatch1(fn, this, arguments[0]); break;\n        case 2: value = tryCatch2(fn, this, arguments[0], arguments[1]); break;\n        default:\n            var $_len = arguments.length;var args = new Array($_len); for(var $_i = 0; $_i < $_len; ++$_i) {args[$_i] = arguments[$_i];}\n            value = tryCatchApply(fn, args, this); break;\n        }\n        var ret = new Promise(INTERNAL);\n        ret._setTrace(void 0);\n        ret._resolveFromSyncValue(value);\n        return ret;\n    };\n};\n\nPromise.attempt = Promise[\"try\"] = function Promise$_Try(fn, args, ctx) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"fn must be a function\");\n    }\n    var value = isArray(args)\n        ? tryCatchApply(fn, args, ctx)\n        : tryCatch1(fn, ctx, args);\n\n    var ret = new Promise(INTERNAL);\n    ret._setTrace(void 0);\n    ret._resolveFromSyncValue(value);\n    return ret;\n};\n\nPromise.defer = Promise.pending = function Promise$Defer() {\n    var promise = new Promise(INTERNAL);\n    promise._setTrace(void 0);\n    return new PromiseResolver(promise);\n};\n\nPromise.bind = function Promise$Bind(thisArg) {\n    var maybePromise = cast(thisArg, void 0);\n    var ret = new Promise(INTERNAL);\n    ret._setTrace(void 0);\n\n    if (maybePromise instanceof Promise) {\n        var p = maybePromise.then(function(thisArg) {\n            ret._setBoundTo(thisArg);\n        });\n        ret._follow(p);\n    } else {\n        ret._setBoundTo(thisArg);\n        ret._setFulfilled();\n    }\n    return ret;\n};\n\nPromise.cast = function Promise$_Cast(obj) {\n    var ret = cast(obj, void 0);\n    if (!(ret instanceof Promise)) {\n        var val = ret;\n        ret = new Promise(INTERNAL);\n        ret._setTrace(void 0);\n        ret._setFulfilled();\n        ret._cleanValues();\n        ret._settledValue = val;\n    }\n    return ret;\n};\n\nPromise.resolve = Promise.fulfilled = Promise.cast;\n\nPromise.reject = Promise.rejected = function Promise$Reject(reason) {\n    var ret = new Promise(INTERNAL);\n    ret._setTrace(void 0);\n    markAsOriginatingFromRejection(reason);\n    ret._cleanValues();\n    ret._setRejected();\n    ret._settledValue = reason;\n    if (!canAttach(reason)) {\n        var trace = new Error(reason + \"\");\n        ret._setCarriedStackTrace(trace);\n    }\n    ret._ensurePossibleRejectionHandled();\n    return ret;\n};\n\nPromise.onPossiblyUnhandledRejection =\nfunction Promise$OnPossiblyUnhandledRejection(fn) {\n        CapturedTrace.possiblyUnhandledRejection = typeof fn === \"function\"\n                                                    ? fn : void 0;\n};\n\nvar unhandledRejectionHandled;\nPromise.onUnhandledRejectionHandled =\nfunction Promise$onUnhandledRejectionHandled(fn) {\n    unhandledRejectionHandled = typeof fn === \"function\" ? fn : void 0;\n};\n\nvar debugging = false || !!(\n    typeof process !== \"undefined\" &&\n    typeof process.execPath === \"string\" &&\n    typeof process.env === \"object\" &&\n    (process.env[\"BLUEBIRD_DEBUG\"] ||\n        process.env[\"NODE_ENV\"] === \"development\")\n);\n\n\nPromise.longStackTraces = function Promise$LongStackTraces() {\n    if (async.haveItemsQueued() &&\n        debugging === false\n   ) {\n        throw new Error(\"cannot enable long stack traces after promises have been created\");\n    }\n    debugging = CapturedTrace.isSupported();\n};\n\nPromise.hasLongStackTraces = function Promise$HasLongStackTraces() {\n    return debugging && CapturedTrace.isSupported();\n};\n\nPromise.prototype._then =\nfunction Promise$_then(\n    didFulfill,\n    didReject,\n    didProgress,\n    receiver,\n    internalData\n) {\n    var haveInternalData = internalData !== void 0;\n    var ret = haveInternalData ? internalData : new Promise(INTERNAL);\n\n    if (!haveInternalData) {\n        if (debugging) {\n            var haveSameContext = this._peekContext() === this._traceParent;\n            ret._traceParent = haveSameContext ? this._traceParent : this;\n        }\n        ret._propagateFrom(this, 7);\n    }\n\n    var callbackIndex =\n        this._addCallbacks(didFulfill, didReject, didProgress, ret, receiver);\n\n    if (this.isResolved()) {\n        async.invoke(this._queueSettleAt, this, callbackIndex);\n    }\n\n    return ret;\n};\n\nPromise.prototype._length = function Promise$_length() {\n    return this._bitField & 262143;\n};\n\nPromise.prototype._isFollowingOrFulfilledOrRejected =\nfunction Promise$_isFollowingOrFulfilledOrRejected() {\n    return (this._bitField & 939524096) > 0;\n};\n\nPromise.prototype._isFollowing = function Promise$_isFollowing() {\n    return (this._bitField & 536870912) === 536870912;\n};\n\nPromise.prototype._setLength = function Promise$_setLength(len) {\n    this._bitField = (this._bitField & -262144) |\n        (len & 262143);\n};\n\nPromise.prototype._setFulfilled = function Promise$_setFulfilled() {\n    this._bitField = this._bitField | 268435456;\n};\n\nPromise.prototype._setRejected = function Promise$_setRejected() {\n    this._bitField = this._bitField | 134217728;\n};\n\nPromise.prototype._setFollowing = function Promise$_setFollowing() {\n    this._bitField = this._bitField | 536870912;\n};\n\nPromise.prototype._setIsFinal = function Promise$_setIsFinal() {\n    this._bitField = this._bitField | 33554432;\n};\n\nPromise.prototype._isFinal = function Promise$_isFinal() {\n    return (this._bitField & 33554432) > 0;\n};\n\nPromise.prototype._cancellable = function Promise$_cancellable() {\n    return (this._bitField & 67108864) > 0;\n};\n\nPromise.prototype._setCancellable = function Promise$_setCancellable() {\n    this._bitField = this._bitField | 67108864;\n};\n\nPromise.prototype._unsetCancellable = function Promise$_unsetCancellable() {\n    this._bitField = this._bitField & (~67108864);\n};\n\nPromise.prototype._setRejectionIsUnhandled =\nfunction Promise$_setRejectionIsUnhandled() {\n    this._bitField = this._bitField | 2097152;\n};\n\nPromise.prototype._unsetRejectionIsUnhandled =\nfunction Promise$_unsetRejectionIsUnhandled() {\n    this._bitField = this._bitField & (~2097152);\n    if (this._isUnhandledRejectionNotified()) {\n        this._unsetUnhandledRejectionIsNotified();\n        this._notifyUnhandledRejectionIsHandled();\n    }\n};\n\nPromise.prototype._isRejectionUnhandled =\nfunction Promise$_isRejectionUnhandled() {\n    return (this._bitField & 2097152) > 0;\n};\n\nPromise.prototype._setUnhandledRejectionIsNotified =\nfunction Promise$_setUnhandledRejectionIsNotified() {\n    this._bitField = this._bitField | 524288;\n};\n\nPromise.prototype._unsetUnhandledRejectionIsNotified =\nfunction Promise$_unsetUnhandledRejectionIsNotified() {\n    this._bitField = this._bitField & (~524288);\n};\n\nPromise.prototype._isUnhandledRejectionNotified =\nfunction Promise$_isUnhandledRejectionNotified() {\n    return (this._bitField & 524288) > 0;\n};\n\nPromise.prototype._setCarriedStackTrace =\nfunction Promise$_setCarriedStackTrace(capturedTrace) {\n    this._bitField = this._bitField | 1048576;\n    this._fulfillmentHandler0 = capturedTrace;\n};\n\nPromise.prototype._unsetCarriedStackTrace =\nfunction Promise$_unsetCarriedStackTrace() {\n    this._bitField = this._bitField & (~1048576);\n    this._fulfillmentHandler0 = void 0;\n};\n\nPromise.prototype._isCarryingStackTrace =\nfunction Promise$_isCarryingStackTrace() {\n    return (this._bitField & 1048576) > 0;\n};\n\nPromise.prototype._getCarriedStackTrace =\nfunction Promise$_getCarriedStackTrace() {\n    return this._isCarryingStackTrace()\n        ? this._fulfillmentHandler0\n        : void 0;\n};\n\nPromise.prototype._receiverAt = function Promise$_receiverAt(index) {\n    var ret = index === 0\n        ? this._receiver0\n        : this[(index << 2) + index - 5 + 4];\n    if (this._isBound() && ret === void 0) {\n        return this._boundTo;\n    }\n    return ret;\n};\n\nPromise.prototype._promiseAt = function Promise$_promiseAt(index) {\n    return index === 0\n        ? this._promise0\n        : this[(index << 2) + index - 5 + 3];\n};\n\nPromise.prototype._fulfillmentHandlerAt =\nfunction Promise$_fulfillmentHandlerAt(index) {\n    return index === 0\n        ? this._fulfillmentHandler0\n        : this[(index << 2) + index - 5 + 0];\n};\n\nPromise.prototype._rejectionHandlerAt =\nfunction Promise$_rejectionHandlerAt(index) {\n    return index === 0\n        ? this._rejectionHandler0\n        : this[(index << 2) + index - 5 + 1];\n};\n\nPromise.prototype._addCallbacks = function Promise$_addCallbacks(\n    fulfill,\n    reject,\n    progress,\n    promise,\n    receiver\n) {\n    var index = this._length();\n\n    if (index >= 262143 - 5) {\n        index = 0;\n        this._setLength(0);\n    }\n\n    if (index === 0) {\n        this._promise0 = promise;\n        if (receiver !== void 0) this._receiver0 = receiver;\n        if (typeof fulfill === \"function\" && !this._isCarryingStackTrace())\n            this._fulfillmentHandler0 = fulfill;\n        if (typeof reject === \"function\") this._rejectionHandler0 = reject;\n        if (typeof progress === \"function\") this._progressHandler0 = progress;\n    } else {\n        var base = (index << 2) + index - 5;\n        this[base + 3] = promise;\n        this[base + 4] = receiver;\n        this[base + 0] = typeof fulfill === \"function\"\n                                            ? fulfill : void 0;\n        this[base + 1] = typeof reject === \"function\"\n                                            ? reject : void 0;\n        this[base + 2] = typeof progress === \"function\"\n                                            ? progress : void 0;\n    }\n    this._setLength(index + 1);\n    return index;\n};\n\nPromise.prototype._setProxyHandlers =\nfunction Promise$_setProxyHandlers(receiver, promiseSlotValue) {\n    var index = this._length();\n\n    if (index >= 262143 - 5) {\n        index = 0;\n        this._setLength(0);\n    }\n    if (index === 0) {\n        this._promise0 = promiseSlotValue;\n        this._receiver0 = receiver;\n    } else {\n        var base = (index << 2) + index - 5;\n        this[base + 3] = promiseSlotValue;\n        this[base + 4] = receiver;\n        this[base + 0] =\n        this[base + 1] =\n        this[base + 2] = void 0;\n    }\n    this._setLength(index + 1);\n};\n\nPromise.prototype._proxyPromiseArray =\nfunction Promise$_proxyPromiseArray(promiseArray, index) {\n    this._setProxyHandlers(promiseArray, index);\n};\n\nPromise.prototype._proxyPromise = function Promise$_proxyPromise(promise) {\n    promise._setProxied();\n    this._setProxyHandlers(promise, -15);\n};\n\nPromise.prototype._setBoundTo = function Promise$_setBoundTo(obj) {\n    if (obj !== void 0) {\n        this._bitField = this._bitField | 8388608;\n        this._boundTo = obj;\n    } else {\n        this._bitField = this._bitField & (~8388608);\n    }\n};\n\nPromise.prototype._isBound = function Promise$_isBound() {\n    return (this._bitField & 8388608) === 8388608;\n};\n\nPromise.prototype._resolveFromResolver =\nfunction Promise$_resolveFromResolver(resolver) {\n    var promise = this;\n    this._setTrace(void 0);\n    this._pushContext();\n\n    function Promise$_resolver(val) {\n        if (promise._tryFollow(val)) {\n            return;\n        }\n        promise._fulfill(val);\n    }\n    function Promise$_rejecter(val) {\n        var trace = canAttach(val) ? val : new Error(val + \"\");\n        promise._attachExtraTrace(trace);\n        markAsOriginatingFromRejection(val);\n        promise._reject(val, trace === val ? void 0 : trace);\n    }\n    var r = tryCatch2(resolver, void 0, Promise$_resolver, Promise$_rejecter);\n    this._popContext();\n\n    if (r !== void 0 && r === errorObj) {\n        var e = r.e;\n        var trace = canAttach(e) ? e : new Error(e + \"\");\n        promise._reject(e, trace);\n    }\n};\n\nPromise.prototype._spreadSlowCase =\nfunction Promise$_spreadSlowCase(targetFn, promise, values, boundTo) {\n    var promiseForAll = new PromiseArray(values).promise();\n    var promise2 = promiseForAll._then(function() {\n        return targetFn.apply(boundTo, arguments);\n    }, void 0, void 0, APPLY, void 0);\n    promise._follow(promise2);\n};\n\nPromise.prototype._callSpread =\nfunction Promise$_callSpread(handler, promise, value) {\n    var boundTo = this._boundTo;\n    if (isArray(value)) {\n        for (var i = 0, len = value.length; i < len; ++i) {\n            if (cast(value[i], void 0) instanceof Promise) {\n                this._spreadSlowCase(handler, promise, value, boundTo);\n                return;\n            }\n        }\n    }\n    promise._pushContext();\n    return tryCatchApply(handler, value, boundTo);\n};\n\nPromise.prototype._callHandler =\nfunction Promise$_callHandler(\n    handler, receiver, promise, value) {\n    var x;\n    if (receiver === APPLY && !this.isRejected()) {\n        x = this._callSpread(handler, promise, value);\n    } else {\n        promise._pushContext();\n        x = tryCatch1(handler, receiver, value);\n    }\n    promise._popContext();\n    return x;\n};\n\nPromise.prototype._settlePromiseFromHandler =\nfunction Promise$_settlePromiseFromHandler(\n    handler, receiver, value, promise\n) {\n    if (!(promise instanceof Promise)) {\n        handler.call(receiver, value, promise);\n        return;\n    }\n    var x = this._callHandler(handler, receiver, promise, value);\n    if (promise._isFollowing()) return;\n\n    if (x === errorObj || x === promise || x === NEXT_FILTER) {\n        var err = x === promise\n                    ? makeSelfResolutionError()\n                    : x.e;\n        var trace = canAttach(err) ? err : new Error(err + \"\");\n        if (x !== NEXT_FILTER) promise._attachExtraTrace(trace);\n        promise._rejectUnchecked(err, trace);\n    } else {\n        var castValue = cast(x, promise);\n        if (castValue instanceof Promise) {\n            if (castValue.isRejected() &&\n                !castValue._isCarryingStackTrace() &&\n                !canAttach(castValue._settledValue)) {\n                var trace = new Error(castValue._settledValue + \"\");\n                promise._attachExtraTrace(trace);\n                castValue._setCarriedStackTrace(trace);\n            }\n            promise._follow(castValue);\n            promise._propagateFrom(castValue, 1);\n        } else {\n            promise._fulfillUnchecked(x);\n        }\n    }\n};\n\nPromise.prototype._follow =\nfunction Promise$_follow(promise) {\n    this._setFollowing();\n\n    if (promise.isPending()) {\n        this._propagateFrom(promise, 1);\n        promise._proxyPromise(this);\n    } else if (promise.isFulfilled()) {\n        this._fulfillUnchecked(promise._settledValue);\n    } else {\n        this._rejectUnchecked(promise._settledValue,\n            promise._getCarriedStackTrace());\n    }\n\n    if (promise._isRejectionUnhandled()) promise._unsetRejectionIsUnhandled();\n\n    if (debugging &&\n        promise._traceParent == null) {\n        promise._traceParent = this;\n    }\n};\n\nPromise.prototype._tryFollow =\nfunction Promise$_tryFollow(value) {\n    if (this._isFollowingOrFulfilledOrRejected() ||\n        value === this) {\n        return false;\n    }\n    var maybePromise = cast(value, void 0);\n    if (!(maybePromise instanceof Promise)) {\n        return false;\n    }\n    this._follow(maybePromise);\n    return true;\n};\n\nPromise.prototype._resetTrace = function Promise$_resetTrace() {\n    if (debugging) {\n        this._trace = new CapturedTrace(this._peekContext() === void 0);\n    }\n};\n\nPromise.prototype._setTrace = function Promise$_setTrace(parent) {\n    if (debugging) {\n        var context = this._peekContext();\n        this._traceParent = context;\n        var isTopLevel = context === void 0;\n        if (parent !== void 0 &&\n            parent._traceParent === context) {\n            this._trace = parent._trace;\n        } else {\n            this._trace = new CapturedTrace(isTopLevel);\n        }\n    }\n    return this;\n};\n\nPromise.prototype._attachExtraTrace =\nfunction Promise$_attachExtraTrace(error) {\n    if (debugging) {\n        var promise = this;\n        var stack = error.stack;\n        stack = typeof stack === \"string\" ? stack.split(\"\\n\") : [];\n        CapturedTrace.protectErrorMessageNewlines(stack);\n        var headerLineCount = 1;\n        var combinedTraces = 1;\n        while(promise != null &&\n            promise._trace != null) {\n            stack = CapturedTrace.combine(\n                stack,\n                promise._trace.stack.split(\"\\n\")\n            );\n            promise = promise._traceParent;\n            combinedTraces++;\n        }\n\n        var stackTraceLimit = Error.stackTraceLimit || 10;\n        var max = (stackTraceLimit + headerLineCount) * combinedTraces;\n        var len = stack.length;\n        if (len > max) {\n            stack.length = max;\n        }\n\n        if (len > 0)\n            stack[0] = stack[0].split(\"\\u0002\\u0000\\u0001\").join(\"\\n\");\n\n        if (stack.length <= headerLineCount) {\n            error.stack = \"(No stack trace)\";\n        } else {\n            error.stack = stack.join(\"\\n\");\n        }\n    }\n};\n\nPromise.prototype._cleanValues = function Promise$_cleanValues() {\n    if (this._cancellable()) {\n        this._cancellationParent = void 0;\n    }\n};\n\nPromise.prototype._propagateFrom =\nfunction Promise$_propagateFrom(parent, flags) {\n    if ((flags & 1) > 0 && parent._cancellable()) {\n        this._setCancellable();\n        this._cancellationParent = parent;\n    }\n    if ((flags & 4) > 0) {\n        this._setBoundTo(parent._boundTo);\n    }\n    if ((flags & 2) > 0) {\n        this._setTrace(parent);\n    }\n};\n\nPromise.prototype._fulfill = function Promise$_fulfill(value) {\n    if (this._isFollowingOrFulfilledOrRejected()) return;\n    this._fulfillUnchecked(value);\n};\n\nPromise.prototype._reject =\nfunction Promise$_reject(reason, carriedStackTrace) {\n    if (this._isFollowingOrFulfilledOrRejected()) return;\n    this._rejectUnchecked(reason, carriedStackTrace);\n};\n\nPromise.prototype._settlePromiseAt = function Promise$_settlePromiseAt(index) {\n    var handler = this.isFulfilled()\n        ? this._fulfillmentHandlerAt(index)\n        : this._rejectionHandlerAt(index);\n\n    var value = this._settledValue;\n    var receiver = this._receiverAt(index);\n    var promise = this._promiseAt(index);\n\n    if (typeof handler === \"function\") {\n        this._settlePromiseFromHandler(handler, receiver, value, promise);\n    } else {\n        var done = false;\n        var isFulfilled = this.isFulfilled();\n        if (receiver !== void 0) {\n            if (receiver instanceof Promise &&\n                receiver._isProxied()) {\n                receiver._unsetProxied();\n\n                if (isFulfilled) receiver._fulfillUnchecked(value);\n                else receiver._rejectUnchecked(value,\n                    this._getCarriedStackTrace());\n                done = true;\n            } else if (receiver instanceof PromiseArray) {\n                if (isFulfilled) receiver._promiseFulfilled(value, promise);\n                else receiver._promiseRejected(value, promise);\n                done = true;\n            }\n        }\n\n        if (!done) {\n            if (isFulfilled) promise._fulfill(value);\n            else promise._reject(value, this._getCarriedStackTrace());\n        }\n    }\n\n    if (index >= 4) {\n        this._queueGC();\n    }\n};\n\nPromise.prototype._isProxied = function Promise$_isProxied() {\n    return (this._bitField & 4194304) === 4194304;\n};\n\nPromise.prototype._setProxied = function Promise$_setProxied() {\n    this._bitField = this._bitField | 4194304;\n};\n\nPromise.prototype._unsetProxied = function Promise$_unsetProxied() {\n    this._bitField = this._bitField & (~4194304);\n};\n\nPromise.prototype._isGcQueued = function Promise$_isGcQueued() {\n    return (this._bitField & -1073741824) === -1073741824;\n};\n\nPromise.prototype._setGcQueued = function Promise$_setGcQueued() {\n    this._bitField = this._bitField | -1073741824;\n};\n\nPromise.prototype._unsetGcQueued = function Promise$_unsetGcQueued() {\n    this._bitField = this._bitField & (~-1073741824);\n};\n\nPromise.prototype._queueGC = function Promise$_queueGC() {\n    if (this._isGcQueued()) return;\n    this._setGcQueued();\n    async.invokeLater(this._gc, this, void 0);\n};\n\nPromise.prototype._gc = function Promise$gc() {\n    var len = this._length() * 5 - 5;\n    for (var i = 0; i < len; i++) {\n        delete this[i];\n    }\n    this._clearFirstHandlerData();\n    this._setLength(0);\n    this._unsetGcQueued();\n};\n\nPromise.prototype._clearFirstHandlerData =\nfunction Promise$_clearFirstHandlerData() {\n    this._fulfillmentHandler0 = void 0;\n    this._rejectionHandler0 = void 0;\n    this._promise0 = void 0;\n    this._receiver0 = void 0;\n};\n\nPromise.prototype._queueSettleAt = function Promise$_queueSettleAt(index) {\n    if (this._isRejectionUnhandled()) this._unsetRejectionIsUnhandled();\n    async.invoke(this._settlePromiseAt, this, index);\n};\n\nPromise.prototype._fulfillUnchecked =\nfunction Promise$_fulfillUnchecked(value) {\n    if (!this.isPending()) return;\n    if (value === this) {\n        var err = makeSelfResolutionError();\n        this._attachExtraTrace(err);\n        return this._rejectUnchecked(err, void 0);\n    }\n    this._cleanValues();\n    this._setFulfilled();\n    this._settledValue = value;\n    var len = this._length();\n\n    if (len > 0) {\n        async.invoke(this._settlePromises, this, len);\n    }\n};\n\nPromise.prototype._rejectUncheckedCheckError =\nfunction Promise$_rejectUncheckedCheckError(reason) {\n    var trace = canAttach(reason) ? reason : new Error(reason + \"\");\n    this._rejectUnchecked(reason, trace === reason ? void 0 : trace);\n};\n\nPromise.prototype._rejectUnchecked =\nfunction Promise$_rejectUnchecked(reason, trace) {\n    if (!this.isPending()) return;\n    if (reason === this) {\n        var err = makeSelfResolutionError();\n        this._attachExtraTrace(err);\n        return this._rejectUnchecked(err);\n    }\n    this._cleanValues();\n    this._setRejected();\n    this._settledValue = reason;\n\n    if (this._isFinal()) {\n        async.invokeLater(thrower, void 0, trace === void 0 ? reason : trace);\n        return;\n    }\n    var len = this._length();\n\n    if (trace !== void 0) this._setCarriedStackTrace(trace);\n\n    if (len > 0) {\n        async.invoke(this._rejectPromises, this, null);\n    } else {\n        this._ensurePossibleRejectionHandled();\n    }\n};\n\nPromise.prototype._rejectPromises = function Promise$_rejectPromises() {\n    this._settlePromises();\n    this._unsetCarriedStackTrace();\n};\n\nPromise.prototype._settlePromises = function Promise$_settlePromises() {\n    var len = this._length();\n    for (var i = 0; i < len; i++) {\n        this._settlePromiseAt(i);\n    }\n};\n\nPromise.prototype._ensurePossibleRejectionHandled =\nfunction Promise$_ensurePossibleRejectionHandled() {\n    this._setRejectionIsUnhandled();\n    if (CapturedTrace.possiblyUnhandledRejection !== void 0) {\n        async.invokeLater(this._notifyUnhandledRejection, this, void 0);\n    }\n};\n\nPromise.prototype._notifyUnhandledRejectionIsHandled =\nfunction Promise$_notifyUnhandledRejectionIsHandled() {\n    if (typeof unhandledRejectionHandled === \"function\") {\n        async.invokeLater(unhandledRejectionHandled, void 0, this);\n    }\n};\n\nPromise.prototype._notifyUnhandledRejection =\nfunction Promise$_notifyUnhandledRejection() {\n    if (this._isRejectionUnhandled()) {\n        var reason = this._settledValue;\n        var trace = this._getCarriedStackTrace();\n\n        this._setUnhandledRejectionIsNotified();\n\n        if (trace !== void 0) {\n            this._unsetCarriedStackTrace();\n            reason = trace;\n        }\n        if (typeof CapturedTrace.possiblyUnhandledRejection === \"function\") {\n            CapturedTrace.possiblyUnhandledRejection(reason, this);\n        }\n    }\n};\n\nvar contextStack = [];\nPromise.prototype._peekContext = function Promise$_peekContext() {\n    var lastIndex = contextStack.length - 1;\n    if (lastIndex >= 0) {\n        return contextStack[lastIndex];\n    }\n    return void 0;\n\n};\n\nPromise.prototype._pushContext = function Promise$_pushContext() {\n    if (!debugging) return;\n    contextStack.push(this);\n};\n\nPromise.prototype._popContext = function Promise$_popContext() {\n    if (!debugging) return;\n    contextStack.pop();\n};\n\nPromise.noConflict = function Promise$NoConflict() {\n    return noConflict(Promise);\n};\n\nPromise.setScheduler = function(fn) {\n    if (typeof fn !== \"function\") throw new TypeError(\"fn must be a function\");\n    async._schedule = fn;\n};\n\nif (!CapturedTrace.isSupported()) {\n    Promise.longStackTraces = function(){};\n    debugging = false;\n}\n\nPromise._makeSelfResolutionError = makeSelfResolutionError;\nrequire(\"./finally.js\")(Promise, NEXT_FILTER, cast);\nrequire(\"./direct_resolve.js\")(Promise);\nrequire(\"./synchronous_inspection.js\")(Promise);\nrequire(\"./join.js\")(Promise, PromiseArray, cast, INTERNAL);\nPromise.RangeError = RangeError;\nPromise.CancellationError = CancellationError;\nPromise.TimeoutError = TimeoutError;\nPromise.TypeError = TypeError;\nPromise.OperationalError = OperationalError;\nPromise.RejectionError = OperationalError;\nPromise.AggregateError = errors.AggregateError;\n\nutil.toFastProperties(Promise);\nutil.toFastProperties(Promise.prototype);\nPromise.Promise = Promise;\nrequire('./timers.js')(Promise,INTERNAL,cast);\nrequire('./race.js')(Promise,INTERNAL,cast);\nrequire('./call_get.js')(Promise);\nrequire('./generators.js')(Promise,apiRejection,INTERNAL,cast);\nrequire('./map.js')(Promise,PromiseArray,apiRejection,cast,INTERNAL);\nrequire('./nodeify.js')(Promise);\nrequire('./promisify.js')(Promise,INTERNAL);\nrequire('./props.js')(Promise,PromiseArray,cast);\nrequire('./reduce.js')(Promise,PromiseArray,apiRejection,cast,INTERNAL);\nrequire('./settle.js')(Promise,PromiseArray);\nrequire('./some.js')(Promise,PromiseArray,apiRejection);\nrequire('./progress.js')(Promise,PromiseArray);\nrequire('./cancel.js')(Promise,INTERNAL);\nrequire('./filter.js')(Promise,INTERNAL);\nrequire('./any.js')(Promise,PromiseArray);\nrequire('./each.js')(Promise,INTERNAL);\nrequire('./using.js')(Promise,apiRejection,cast);\n\nPromise.prototype = Promise.prototype;\nreturn Promise;\n\n};\n","module.exports = require(\"./lib/_stream_writable.js\")\n","module.exports = require(\"./lib/_stream_duplex.js\")\n","module.exports = require(\"./lib/_stream_transform.js\")\n","module.exports = require(\"./lib/_stream_passthrough.js\")\n","\n/**\n * Module dependencies.\n */\n\nvar global = (function() { return this; })();\n\n/**\n * WebSocket constructor.\n */\n\nvar WebSocket = global.WebSocket || global.MozWebSocket;\n\n/**\n * Module exports.\n */\n\nmodule.exports = WebSocket ? ws : null;\n\n/**\n * WebSocket constructor.\n *\n * The third `opts` options object gets ignored in web browsers, since it's\n * non-standard, and throws a TypeError if passed to the constructor.\n * See: https://github.com/einaros/ws/issues/227\n *\n * @param {String} uri\n * @param {Array} protocols (optional)\n * @param {Object) opts (optional)\n * @api public\n */\n\nfunction ws(uri, protocols, opts) {\n  var instance;\n  if (protocols) {\n    instance = new WebSocket(uri, protocols);\n  } else {\n    instance = new WebSocket(uri);\n  }\n  return instance;\n}\n\nif (WebSocket) ws.prototype = WebSocket.prototype;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nmodule.exports = Readable;\n\n/*<replacement>*/\nvar isArray = require('isarray');\n/*</replacement>*/\n\n\n/*<replacement>*/\nvar Buffer = require('buffer').Buffer;\n/*</replacement>*/\n\nReadable.ReadableState = ReadableState;\n\nvar EE = require('events').EventEmitter;\n\n/*<replacement>*/\nif (!EE.listenerCount) EE.listenerCount = function(emitter, type) {\n  return emitter.listeners(type).length;\n};\n/*</replacement>*/\n\nvar Stream = require('stream');\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\nvar StringDecoder;\n\nutil.inherits(Readable, Stream);\n\nfunction ReadableState(options, stream) {\n  options = options || {};\n\n  // the point at which it stops calling _read() to fill the buffer\n  // Note: 0 is a valid value, means \"don't call _read preemptively ever\"\n  var hwm = options.highWaterMark;\n  this.highWaterMark = (hwm || hwm === 0) ? hwm : 16 * 1024;\n\n  // cast to ints.\n  this.highWaterMark = ~~this.highWaterMark;\n\n  this.buffer = [];\n  this.length = 0;\n  this.pipes = null;\n  this.pipesCount = 0;\n  this.flowing = false;\n  this.ended = false;\n  this.endEmitted = false;\n  this.reading = false;\n\n  // In streams that never have any data, and do push(null) right away,\n  // the consumer can miss the 'end' event if they do some I/O before\n  // consuming the stream.  So, we don't emit('end') until some reading\n  // happens.\n  this.calledRead = false;\n\n  // a flag to be able to tell if the onwrite cb is called immediately,\n  // or on a later tick.  We set this to true at first, becuase any\n  // actions that shouldn't happen until \"later\" should generally also\n  // not happen before the first write call.\n  this.sync = true;\n\n  // whenever we return null, then we set a flag to say\n  // that we're awaiting a 'readable' event emission.\n  this.needReadable = false;\n  this.emittedReadable = false;\n  this.readableListening = false;\n\n\n  // object stream flag. Used to make read(n) ignore n and to\n  // make all the buffer merging and length checks go away\n  this.objectMode = !!options.objectMode;\n\n  // Crypto is kind of old and crusty.  Historically, its default string\n  // encoding is 'binary' so we have to make this configurable.\n  // Everything else in the universe uses 'utf8', though.\n  this.defaultEncoding = options.defaultEncoding || 'utf8';\n\n  // when piping, we only care about 'readable' events that happen\n  // after read()ing all the bytes and not getting any pushback.\n  this.ranOut = false;\n\n  // the number of writers that are awaiting a drain event in .pipe()s\n  this.awaitDrain = 0;\n\n  // if true, a maybeReadMore has been scheduled\n  this.readingMore = false;\n\n  this.decoder = null;\n  this.encoding = null;\n  if (options.encoding) {\n    if (!StringDecoder)\n      StringDecoder = require('string_decoder/').StringDecoder;\n    this.decoder = new StringDecoder(options.encoding);\n    this.encoding = options.encoding;\n  }\n}\n\nfunction Readable(options) {\n  if (!(this instanceof Readable))\n    return new Readable(options);\n\n  this._readableState = new ReadableState(options, this);\n\n  // legacy\n  this.readable = true;\n\n  Stream.call(this);\n}\n\n// Manually shove something into the read() buffer.\n// This returns true if the highWaterMark has not been hit yet,\n// similar to how Writable.write() returns true if you should\n// write() some more.\nReadable.prototype.push = function(chunk, encoding) {\n  var state = this._readableState;\n\n  if (typeof chunk === 'string' && !state.objectMode) {\n    encoding = encoding || state.defaultEncoding;\n    if (encoding !== state.encoding) {\n      chunk = new Buffer(chunk, encoding);\n      encoding = '';\n    }\n  }\n\n  return readableAddChunk(this, state, chunk, encoding, false);\n};\n\n// Unshift should *always* be something directly out of read()\nReadable.prototype.unshift = function(chunk) {\n  var state = this._readableState;\n  return readableAddChunk(this, state, chunk, '', true);\n};\n\nfunction readableAddChunk(stream, state, chunk, encoding, addToFront) {\n  var er = chunkInvalid(state, chunk);\n  if (er) {\n    stream.emit('error', er);\n  } else if (chunk === null || chunk === undefined) {\n    state.reading = false;\n    if (!state.ended)\n      onEofChunk(stream, state);\n  } else if (state.objectMode || chunk && chunk.length > 0) {\n    if (state.ended && !addToFront) {\n      var e = new Error('stream.push() after EOF');\n      stream.emit('error', e);\n    } else if (state.endEmitted && addToFront) {\n      var e = new Error('stream.unshift() after end event');\n      stream.emit('error', e);\n    } else {\n      if (state.decoder && !addToFront && !encoding)\n        chunk = state.decoder.write(chunk);\n\n      // update the buffer info.\n      state.length += state.objectMode ? 1 : chunk.length;\n      if (addToFront) {\n        state.buffer.unshift(chunk);\n      } else {\n        state.reading = false;\n        state.buffer.push(chunk);\n      }\n\n      if (state.needReadable)\n        emitReadable(stream);\n\n      maybeReadMore(stream, state);\n    }\n  } else if (!addToFront) {\n    state.reading = false;\n  }\n\n  return needMoreData(state);\n}\n\n\n\n// if it's past the high water mark, we can push in some more.\n// Also, if we have no data yet, we can stand some\n// more bytes.  This is to work around cases where hwm=0,\n// such as the repl.  Also, if the push() triggered a\n// readable event, and the user called read(largeNumber) such that\n// needReadable was set, then we ought to push more, so that another\n// 'readable' event will be triggered.\nfunction needMoreData(state) {\n  return !state.ended &&\n         (state.needReadable ||\n          state.length < state.highWaterMark ||\n          state.length === 0);\n}\n\n// backwards compatibility.\nReadable.prototype.setEncoding = function(enc) {\n  if (!StringDecoder)\n    StringDecoder = require('string_decoder/').StringDecoder;\n  this._readableState.decoder = new StringDecoder(enc);\n  this._readableState.encoding = enc;\n};\n\n// Don't raise the hwm > 128MB\nvar MAX_HWM = 0x800000;\nfunction roundUpToNextPowerOf2(n) {\n  if (n >= MAX_HWM) {\n    n = MAX_HWM;\n  } else {\n    // Get the next highest power of 2\n    n--;\n    for (var p = 1; p < 32; p <<= 1) n |= n >> p;\n    n++;\n  }\n  return n;\n}\n\nfunction howMuchToRead(n, state) {\n  if (state.length === 0 && state.ended)\n    return 0;\n\n  if (state.objectMode)\n    return n === 0 ? 0 : 1;\n\n  if (n === null || isNaN(n)) {\n    // only flow one buffer at a time\n    if (state.flowing && state.buffer.length)\n      return state.buffer[0].length;\n    else\n      return state.length;\n  }\n\n  if (n <= 0)\n    return 0;\n\n  // If we're asking for more than the target buffer level,\n  // then raise the water mark.  Bump up to the next highest\n  // power of 2, to prevent increasing it excessively in tiny\n  // amounts.\n  if (n > state.highWaterMark)\n    state.highWaterMark = roundUpToNextPowerOf2(n);\n\n  // don't have that much.  return null, unless we've ended.\n  if (n > state.length) {\n    if (!state.ended) {\n      state.needReadable = true;\n      return 0;\n    } else\n      return state.length;\n  }\n\n  return n;\n}\n\n// you can override either this method, or the async _read(n) below.\nReadable.prototype.read = function(n) {\n  var state = this._readableState;\n  state.calledRead = true;\n  var nOrig = n;\n  var ret;\n\n  if (typeof n !== 'number' || n > 0)\n    state.emittedReadable = false;\n\n  // if we're doing read(0) to trigger a readable event, but we\n  // already have a bunch of data in the buffer, then just trigger\n  // the 'readable' event and move on.\n  if (n === 0 &&\n      state.needReadable &&\n      (state.length >= state.highWaterMark || state.ended)) {\n    emitReadable(this);\n    return null;\n  }\n\n  n = howMuchToRead(n, state);\n\n  // if we've ended, and we're now clear, then finish it up.\n  if (n === 0 && state.ended) {\n    ret = null;\n\n    // In cases where the decoder did not receive enough data\n    // to produce a full chunk, then immediately received an\n    // EOF, state.buffer will contain [<Buffer >, <Buffer 00 ...>].\n    // howMuchToRead will see this and coerce the amount to\n    // read to zero (because it's looking at the length of the\n    // first <Buffer > in state.buffer), and we'll end up here.\n    //\n    // This can only happen via state.decoder -- no other venue\n    // exists for pushing a zero-length chunk into state.buffer\n    // and triggering this behavior. In this case, we return our\n    // remaining data and end the stream, if appropriate.\n    if (state.length > 0 && state.decoder) {\n      ret = fromList(n, state);\n      state.length -= ret.length;\n    }\n\n    if (state.length === 0)\n      endReadable(this);\n\n    return ret;\n  }\n\n  // All the actual chunk generation logic needs to be\n  // *below* the call to _read.  The reason is that in certain\n  // synthetic stream cases, such as passthrough streams, _read\n  // may be a completely synchronous operation which may change\n  // the state of the read buffer, providing enough data when\n  // before there was *not* enough.\n  //\n  // So, the steps are:\n  // 1. Figure out what the state of things will be after we do\n  // a read from the buffer.\n  //\n  // 2. If that resulting state will trigger a _read, then call _read.\n  // Note that this may be asynchronous, or synchronous.  Yes, it is\n  // deeply ugly to write APIs this way, but that still doesn't mean\n  // that the Readable class should behave improperly, as streams are\n  // designed to be sync/async agnostic.\n  // Take note if the _read call is sync or async (ie, if the read call\n  // has returned yet), so that we know whether or not it's safe to emit\n  // 'readable' etc.\n  //\n  // 3. Actually pull the requested chunks out of the buffer and return.\n\n  // if we need a readable event, then we need to do some reading.\n  var doRead = state.needReadable;\n\n  // if we currently have less than the highWaterMark, then also read some\n  if (state.length - n <= state.highWaterMark)\n    doRead = true;\n\n  // however, if we've ended, then there's no point, and if we're already\n  // reading, then it's unnecessary.\n  if (state.ended || state.reading)\n    doRead = false;\n\n  if (doRead) {\n    state.reading = true;\n    state.sync = true;\n    // if the length is currently zero, then we *need* a readable event.\n    if (state.length === 0)\n      state.needReadable = true;\n    // call internal read method\n    this._read(state.highWaterMark);\n    state.sync = false;\n  }\n\n  // If _read called its callback synchronously, then `reading`\n  // will be false, and we need to re-evaluate how much data we\n  // can return to the user.\n  if (doRead && !state.reading)\n    n = howMuchToRead(nOrig, state);\n\n  if (n > 0)\n    ret = fromList(n, state);\n  else\n    ret = null;\n\n  if (ret === null) {\n    state.needReadable = true;\n    n = 0;\n  }\n\n  state.length -= n;\n\n  // If we have nothing in the buffer, then we want to know\n  // as soon as we *do* get something into the buffer.\n  if (state.length === 0 && !state.ended)\n    state.needReadable = true;\n\n  // If we happened to read() exactly the remaining amount in the\n  // buffer, and the EOF has been seen at this point, then make sure\n  // that we emit 'end' on the very next tick.\n  if (state.ended && !state.endEmitted && state.length === 0)\n    endReadable(this);\n\n  return ret;\n};\n\nfunction chunkInvalid(state, chunk) {\n  var er = null;\n  if (!Buffer.isBuffer(chunk) &&\n      'string' !== typeof chunk &&\n      chunk !== null &&\n      chunk !== undefined &&\n      !state.objectMode) {\n    er = new TypeError('Invalid non-string/buffer chunk');\n  }\n  return er;\n}\n\n\nfunction onEofChunk(stream, state) {\n  if (state.decoder && !state.ended) {\n    var chunk = state.decoder.end();\n    if (chunk && chunk.length) {\n      state.buffer.push(chunk);\n      state.length += state.objectMode ? 1 : chunk.length;\n    }\n  }\n  state.ended = true;\n\n  // if we've ended and we have some data left, then emit\n  // 'readable' now to make sure it gets picked up.\n  if (state.length > 0)\n    emitReadable(stream);\n  else\n    endReadable(stream);\n}\n\n// Don't emit readable right away in sync mode, because this can trigger\n// another read() call => stack overflow.  This way, it might trigger\n// a nextTick recursion warning, but that's not so bad.\nfunction emitReadable(stream) {\n  var state = stream._readableState;\n  state.needReadable = false;\n  if (state.emittedReadable)\n    return;\n\n  state.emittedReadable = true;\n  if (state.sync)\n    process.nextTick(function() {\n      emitReadable_(stream);\n    });\n  else\n    emitReadable_(stream);\n}\n\nfunction emitReadable_(stream) {\n  stream.emit('readable');\n}\n\n\n// at this point, the user has presumably seen the 'readable' event,\n// and called read() to consume some data.  that may have triggered\n// in turn another _read(n) call, in which case reading = true if\n// it's in progress.\n// However, if we're not ended, or reading, and the length < hwm,\n// then go ahead and try to read some more preemptively.\nfunction maybeReadMore(stream, state) {\n  if (!state.readingMore) {\n    state.readingMore = true;\n    process.nextTick(function() {\n      maybeReadMore_(stream, state);\n    });\n  }\n}\n\nfunction maybeReadMore_(stream, state) {\n  var len = state.length;\n  while (!state.reading && !state.flowing && !state.ended &&\n         state.length < state.highWaterMark) {\n    stream.read(0);\n    if (len === state.length)\n      // didn't get any data, stop spinning.\n      break;\n    else\n      len = state.length;\n  }\n  state.readingMore = false;\n}\n\n// abstract method.  to be overridden in specific implementation classes.\n// call cb(er, data) where data is <= n in length.\n// for virtual (non-string, non-buffer) streams, \"length\" is somewhat\n// arbitrary, and perhaps not very meaningful.\nReadable.prototype._read = function(n) {\n  this.emit('error', new Error('not implemented'));\n};\n\nReadable.prototype.pipe = function(dest, pipeOpts) {\n  var src = this;\n  var state = this._readableState;\n\n  switch (state.pipesCount) {\n    case 0:\n      state.pipes = dest;\n      break;\n    case 1:\n      state.pipes = [state.pipes, dest];\n      break;\n    default:\n      state.pipes.push(dest);\n      break;\n  }\n  state.pipesCount += 1;\n\n  var doEnd = (!pipeOpts || pipeOpts.end !== false) &&\n              dest !== process.stdout &&\n              dest !== process.stderr;\n\n  var endFn = doEnd ? onend : cleanup;\n  if (state.endEmitted)\n    process.nextTick(endFn);\n  else\n    src.once('end', endFn);\n\n  dest.on('unpipe', onunpipe);\n  function onunpipe(readable) {\n    if (readable !== src) return;\n    cleanup();\n  }\n\n  function onend() {\n    dest.end();\n  }\n\n  // when the dest drains, it reduces the awaitDrain counter\n  // on the source.  This would be more elegant with a .once()\n  // handler in flow(), but adding and removing repeatedly is\n  // too slow.\n  var ondrain = pipeOnDrain(src);\n  dest.on('drain', ondrain);\n\n  function cleanup() {\n    // cleanup event handlers once the pipe is broken\n    dest.removeListener('close', onclose);\n    dest.removeListener('finish', onfinish);\n    dest.removeListener('drain', ondrain);\n    dest.removeListener('error', onerror);\n    dest.removeListener('unpipe', onunpipe);\n    src.removeListener('end', onend);\n    src.removeListener('end', cleanup);\n\n    // if the reader is waiting for a drain event from this\n    // specific writer, then it would cause it to never start\n    // flowing again.\n    // So, if this is awaiting a drain, then we just call it now.\n    // If we don't know, then assume that we are waiting for one.\n    if (!dest._writableState || dest._writableState.needDrain)\n      ondrain();\n  }\n\n  // if the dest has an error, then stop piping into it.\n  // however, don't suppress the throwing behavior for this.\n  function onerror(er) {\n    unpipe();\n    dest.removeListener('error', onerror);\n    if (EE.listenerCount(dest, 'error') === 0)\n      dest.emit('error', er);\n  }\n  // This is a brutally ugly hack to make sure that our error handler\n  // is attached before any userland ones.  NEVER DO THIS.\n  if (!dest._events || !dest._events.error)\n    dest.on('error', onerror);\n  else if (isArray(dest._events.error))\n    dest._events.error.unshift(onerror);\n  else\n    dest._events.error = [onerror, dest._events.error];\n\n\n\n  // Both close and finish should trigger unpipe, but only once.\n  function onclose() {\n    dest.removeListener('finish', onfinish);\n    unpipe();\n  }\n  dest.once('close', onclose);\n  function onfinish() {\n    dest.removeListener('close', onclose);\n    unpipe();\n  }\n  dest.once('finish', onfinish);\n\n  function unpipe() {\n    src.unpipe(dest);\n  }\n\n  // tell the dest that it's being piped to\n  dest.emit('pipe', src);\n\n  // start the flow if it hasn't been started already.\n  if (!state.flowing) {\n    // the handler that waits for readable events after all\n    // the data gets sucked out in flow.\n    // This would be easier to follow with a .once() handler\n    // in flow(), but that is too slow.\n    this.on('readable', pipeOnReadable);\n\n    state.flowing = true;\n    process.nextTick(function() {\n      flow(src);\n    });\n  }\n\n  return dest;\n};\n\nfunction pipeOnDrain(src) {\n  return function() {\n    var dest = this;\n    var state = src._readableState;\n    state.awaitDrain--;\n    if (state.awaitDrain === 0)\n      flow(src);\n  };\n}\n\nfunction flow(src) {\n  var state = src._readableState;\n  var chunk;\n  state.awaitDrain = 0;\n\n  function write(dest, i, list) {\n    var written = dest.write(chunk);\n    if (false === written) {\n      state.awaitDrain++;\n    }\n  }\n\n  while (state.pipesCount && null !== (chunk = src.read())) {\n\n    if (state.pipesCount === 1)\n      write(state.pipes, 0, null);\n    else\n      forEach(state.pipes, write);\n\n    src.emit('data', chunk);\n\n    // if anyone needs a drain, then we have to wait for that.\n    if (state.awaitDrain > 0)\n      return;\n  }\n\n  // if every destination was unpiped, either before entering this\n  // function, or in the while loop, then stop flowing.\n  //\n  // NB: This is a pretty rare edge case.\n  if (state.pipesCount === 0) {\n    state.flowing = false;\n\n    // if there were data event listeners added, then switch to old mode.\n    if (EE.listenerCount(src, 'data') > 0)\n      emitDataEvents(src);\n    return;\n  }\n\n  // at this point, no one needed a drain, so we just ran out of data\n  // on the next readable event, start it over again.\n  state.ranOut = true;\n}\n\nfunction pipeOnReadable() {\n  if (this._readableState.ranOut) {\n    this._readableState.ranOut = false;\n    flow(this);\n  }\n}\n\n\nReadable.prototype.unpipe = function(dest) {\n  var state = this._readableState;\n\n  // if we're not piping anywhere, then do nothing.\n  if (state.pipesCount === 0)\n    return this;\n\n  // just one destination.  most common case.\n  if (state.pipesCount === 1) {\n    // passed in one, but it's not the right one.\n    if (dest && dest !== state.pipes)\n      return this;\n\n    if (!dest)\n      dest = state.pipes;\n\n    // got a match.\n    state.pipes = null;\n    state.pipesCount = 0;\n    this.removeListener('readable', pipeOnReadable);\n    state.flowing = false;\n    if (dest)\n      dest.emit('unpipe', this);\n    return this;\n  }\n\n  // slow case. multiple pipe destinations.\n\n  if (!dest) {\n    // remove all.\n    var dests = state.pipes;\n    var len = state.pipesCount;\n    state.pipes = null;\n    state.pipesCount = 0;\n    this.removeListener('readable', pipeOnReadable);\n    state.flowing = false;\n\n    for (var i = 0; i < len; i++)\n      dests[i].emit('unpipe', this);\n    return this;\n  }\n\n  // try to find the right one.\n  var i = indexOf(state.pipes, dest);\n  if (i === -1)\n    return this;\n\n  state.pipes.splice(i, 1);\n  state.pipesCount -= 1;\n  if (state.pipesCount === 1)\n    state.pipes = state.pipes[0];\n\n  dest.emit('unpipe', this);\n\n  return this;\n};\n\n// set up data events if they are asked for\n// Ensure readable listeners eventually get something\nReadable.prototype.on = function(ev, fn) {\n  var res = Stream.prototype.on.call(this, ev, fn);\n\n  if (ev === 'data' && !this._readableState.flowing)\n    emitDataEvents(this);\n\n  if (ev === 'readable' && this.readable) {\n    var state = this._readableState;\n    if (!state.readableListening) {\n      state.readableListening = true;\n      state.emittedReadable = false;\n      state.needReadable = true;\n      if (!state.reading) {\n        this.read(0);\n      } else if (state.length) {\n        emitReadable(this, state);\n      }\n    }\n  }\n\n  return res;\n};\nReadable.prototype.addListener = Readable.prototype.on;\n\n// pause() and resume() are remnants of the legacy readable stream API\n// If the user uses them, then switch into old mode.\nReadable.prototype.resume = function() {\n  emitDataEvents(this);\n  this.read(0);\n  this.emit('resume');\n};\n\nReadable.prototype.pause = function() {\n  emitDataEvents(this, true);\n  this.emit('pause');\n};\n\nfunction emitDataEvents(stream, startPaused) {\n  var state = stream._readableState;\n\n  if (state.flowing) {\n    // https://github.com/isaacs/readable-stream/issues/16\n    throw new Error('Cannot switch to old mode now.');\n  }\n\n  var paused = startPaused || false;\n  var readable = false;\n\n  // convert to an old-style stream.\n  stream.readable = true;\n  stream.pipe = Stream.prototype.pipe;\n  stream.on = stream.addListener = Stream.prototype.on;\n\n  stream.on('readable', function() {\n    readable = true;\n\n    var c;\n    while (!paused && (null !== (c = stream.read())))\n      stream.emit('data', c);\n\n    if (c === null) {\n      readable = false;\n      stream._readableState.needReadable = true;\n    }\n  });\n\n  stream.pause = function() {\n    paused = true;\n    this.emit('pause');\n  };\n\n  stream.resume = function() {\n    paused = false;\n    if (readable)\n      process.nextTick(function() {\n        stream.emit('readable');\n      });\n    else\n      this.read(0);\n    this.emit('resume');\n  };\n\n  // now make it start, just in case it hadn't already.\n  stream.emit('readable');\n}\n\n// wrap an old-style stream as the async data source.\n// This is *not* part of the readable stream interface.\n// It is an ugly unfortunate mess of history.\nReadable.prototype.wrap = function(stream) {\n  var state = this._readableState;\n  var paused = false;\n\n  var self = this;\n  stream.on('end', function() {\n    if (state.decoder && !state.ended) {\n      var chunk = state.decoder.end();\n      if (chunk && chunk.length)\n        self.push(chunk);\n    }\n\n    self.push(null);\n  });\n\n  stream.on('data', function(chunk) {\n    if (state.decoder)\n      chunk = state.decoder.write(chunk);\n\n    // don't skip over falsy values in objectMode\n    //if (state.objectMode && util.isNullOrUndefined(chunk))\n    if (state.objectMode && (chunk === null || chunk === undefined))\n      return;\n    else if (!state.objectMode && (!chunk || !chunk.length))\n      return;\n\n    var ret = self.push(chunk);\n    if (!ret) {\n      paused = true;\n      stream.pause();\n    }\n  });\n\n  // proxy all the other methods.\n  // important when wrapping filters and duplexes.\n  for (var i in stream) {\n    if (typeof stream[i] === 'function' &&\n        typeof this[i] === 'undefined') {\n      this[i] = function(method) { return function() {\n        return stream[method].apply(stream, arguments);\n      }}(i);\n    }\n  }\n\n  // proxy certain important events.\n  var events = ['error', 'close', 'destroy', 'pause', 'resume'];\n  forEach(events, function(ev) {\n    stream.on(ev, self.emit.bind(self, ev));\n  });\n\n  // when we try to consume some more bytes, simply unpause the\n  // underlying stream.\n  self._read = function(n) {\n    if (paused) {\n      paused = false;\n      stream.resume();\n    }\n  };\n\n  return self;\n};\n\n\n\n// exposed for testing purposes only.\nReadable._fromList = fromList;\n\n// Pluck off n bytes from an array of buffers.\n// Length is the combined lengths of all the buffers in the list.\nfunction fromList(n, state) {\n  var list = state.buffer;\n  var length = state.length;\n  var stringMode = !!state.decoder;\n  var objectMode = !!state.objectMode;\n  var ret;\n\n  // nothing in the list, definitely empty.\n  if (list.length === 0)\n    return null;\n\n  if (length === 0)\n    ret = null;\n  else if (objectMode)\n    ret = list.shift();\n  else if (!n || n >= length) {\n    // read it all, truncate the array.\n    if (stringMode)\n      ret = list.join('');\n    else\n      ret = Buffer.concat(list, length);\n    list.length = 0;\n  } else {\n    // read just some of it.\n    if (n < list[0].length) {\n      // just take a part of the first list item.\n      // slice is the same for buffers and strings.\n      var buf = list[0];\n      ret = buf.slice(0, n);\n      list[0] = buf.slice(n);\n    } else if (n === list[0].length) {\n      // first list is a perfect match\n      ret = list.shift();\n    } else {\n      // complex case.\n      // we have enough to cover it, but it spans past the first buffer.\n      if (stringMode)\n        ret = '';\n      else\n        ret = new Buffer(n);\n\n      var c = 0;\n      for (var i = 0, l = list.length; i < l && c < n; i++) {\n        var buf = list[0];\n        var cpy = Math.min(n - c, buf.length);\n\n        if (stringMode)\n          ret += buf.slice(0, cpy);\n        else\n          buf.copy(ret, c, 0, cpy);\n\n        if (cpy < buf.length)\n          list[0] = buf.slice(cpy);\n        else\n          list.shift();\n\n        c += cpy;\n      }\n    }\n  }\n\n  return ret;\n}\n\nfunction endReadable(stream) {\n  var state = stream._readableState;\n\n  // If we get here before consuming all the bytes, then that is a\n  // bug in node.  Should never happen.\n  if (state.length > 0)\n    throw new Error('endReadable called on non-empty stream');\n\n  if (!state.endEmitted && state.calledRead) {\n    state.ended = true;\n    process.nextTick(function() {\n      // Check that we didn't get one last unshift.\n      if (!state.endEmitted && state.length === 0) {\n        state.endEmitted = true;\n        stream.readable = false;\n        stream.emit('end');\n      }\n    });\n  }\n}\n\nfunction forEach (xs, f) {\n  for (var i = 0, l = xs.length; i < l; i++) {\n    f(xs[i], i);\n  }\n}\n\nfunction indexOf (xs, x) {\n  for (var i = 0, l = xs.length; i < l; i++) {\n    if (xs[i] === x) return i;\n  }\n  return -1;\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// A bit simpler than readable streams.\n// Implement an async ._write(chunk, cb), and it'll handle all\n// the drain event emission and buffering.\n\nmodule.exports = Writable;\n\n/*<replacement>*/\nvar Buffer = require('buffer').Buffer;\n/*</replacement>*/\n\nWritable.WritableState = WritableState;\n\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\nvar Stream = require('stream');\n\nutil.inherits(Writable, Stream);\n\nfunction WriteReq(chunk, encoding, cb) {\n  this.chunk = chunk;\n  this.encoding = encoding;\n  this.callback = cb;\n}\n\nfunction WritableState(options, stream) {\n  options = options || {};\n\n  // the point at which write() starts returning false\n  // Note: 0 is a valid value, means that we always return false if\n  // the entire buffer is not flushed immediately on write()\n  var hwm = options.highWaterMark;\n  this.highWaterMark = (hwm || hwm === 0) ? hwm : 16 * 1024;\n\n  // object stream flag to indicate whether or not this stream\n  // contains buffers or objects.\n  this.objectMode = !!options.objectMode;\n\n  // cast to ints.\n  this.highWaterMark = ~~this.highWaterMark;\n\n  this.needDrain = false;\n  // at the start of calling end()\n  this.ending = false;\n  // when end() has been called, and returned\n  this.ended = false;\n  // when 'finish' is emitted\n  this.finished = false;\n\n  // should we decode strings into buffers before passing to _write?\n  // this is here so that some node-core streams can optimize string\n  // handling at a lower level.\n  var noDecode = options.decodeStrings === false;\n  this.decodeStrings = !noDecode;\n\n  // Crypto is kind of old and crusty.  Historically, its default string\n  // encoding is 'binary' so we have to make this configurable.\n  // Everything else in the universe uses 'utf8', though.\n  this.defaultEncoding = options.defaultEncoding || 'utf8';\n\n  // not an actual buffer we keep track of, but a measurement\n  // of how much we're waiting to get pushed to some underlying\n  // socket or file.\n  this.length = 0;\n\n  // a flag to see when we're in the middle of a write.\n  this.writing = false;\n\n  // a flag to be able to tell if the onwrite cb is called immediately,\n  // or on a later tick.  We set this to true at first, becuase any\n  // actions that shouldn't happen until \"later\" should generally also\n  // not happen before the first write call.\n  this.sync = true;\n\n  // a flag to know if we're processing previously buffered items, which\n  // may call the _write() callback in the same tick, so that we don't\n  // end up in an overlapped onwrite situation.\n  this.bufferProcessing = false;\n\n  // the callback that's passed to _write(chunk,cb)\n  this.onwrite = function(er) {\n    onwrite(stream, er);\n  };\n\n  // the callback that the user supplies to write(chunk,encoding,cb)\n  this.writecb = null;\n\n  // the amount that is being written when _write is called.\n  this.writelen = 0;\n\n  this.buffer = [];\n\n  // True if the error was already emitted and should not be thrown again\n  this.errorEmitted = false;\n}\n\nfunction Writable(options) {\n  var Duplex = require('./_stream_duplex');\n\n  // Writable ctor is applied to Duplexes, though they're not\n  // instanceof Writable, they're instanceof Readable.\n  if (!(this instanceof Writable) && !(this instanceof Duplex))\n    return new Writable(options);\n\n  this._writableState = new WritableState(options, this);\n\n  // legacy.\n  this.writable = true;\n\n  Stream.call(this);\n}\n\n// Otherwise people can pipe Writable streams, which is just wrong.\nWritable.prototype.pipe = function() {\n  this.emit('error', new Error('Cannot pipe. Not readable.'));\n};\n\n\nfunction writeAfterEnd(stream, state, cb) {\n  var er = new Error('write after end');\n  // TODO: defer error events consistently everywhere, not just the cb\n  stream.emit('error', er);\n  process.nextTick(function() {\n    cb(er);\n  });\n}\n\n// If we get something that is not a buffer, string, null, or undefined,\n// and we're not in objectMode, then that's an error.\n// Otherwise stream chunks are all considered to be of length=1, and the\n// watermarks determine how many objects to keep in the buffer, rather than\n// how many bytes or characters.\nfunction validChunk(stream, state, chunk, cb) {\n  var valid = true;\n  if (!Buffer.isBuffer(chunk) &&\n      'string' !== typeof chunk &&\n      chunk !== null &&\n      chunk !== undefined &&\n      !state.objectMode) {\n    var er = new TypeError('Invalid non-string/buffer chunk');\n    stream.emit('error', er);\n    process.nextTick(function() {\n      cb(er);\n    });\n    valid = false;\n  }\n  return valid;\n}\n\nWritable.prototype.write = function(chunk, encoding, cb) {\n  var state = this._writableState;\n  var ret = false;\n\n  if (typeof encoding === 'function') {\n    cb = encoding;\n    encoding = null;\n  }\n\n  if (Buffer.isBuffer(chunk))\n    encoding = 'buffer';\n  else if (!encoding)\n    encoding = state.defaultEncoding;\n\n  if (typeof cb !== 'function')\n    cb = function() {};\n\n  if (state.ended)\n    writeAfterEnd(this, state, cb);\n  else if (validChunk(this, state, chunk, cb))\n    ret = writeOrBuffer(this, state, chunk, encoding, cb);\n\n  return ret;\n};\n\nfunction decodeChunk(state, chunk, encoding) {\n  if (!state.objectMode &&\n      state.decodeStrings !== false &&\n      typeof chunk === 'string') {\n    chunk = new Buffer(chunk, encoding);\n  }\n  return chunk;\n}\n\n// if we're already writing something, then just put this\n// in the queue, and wait our turn.  Otherwise, call _write\n// If we return false, then we need a drain event, so set that flag.\nfunction writeOrBuffer(stream, state, chunk, encoding, cb) {\n  chunk = decodeChunk(state, chunk, encoding);\n  if (Buffer.isBuffer(chunk))\n    encoding = 'buffer';\n  var len = state.objectMode ? 1 : chunk.length;\n\n  state.length += len;\n\n  var ret = state.length < state.highWaterMark;\n  // we must ensure that previous needDrain will not be reset to false.\n  if (!ret)\n    state.needDrain = true;\n\n  if (state.writing)\n    state.buffer.push(new WriteReq(chunk, encoding, cb));\n  else\n    doWrite(stream, state, len, chunk, encoding, cb);\n\n  return ret;\n}\n\nfunction doWrite(stream, state, len, chunk, encoding, cb) {\n  state.writelen = len;\n  state.writecb = cb;\n  state.writing = true;\n  state.sync = true;\n  stream._write(chunk, encoding, state.onwrite);\n  state.sync = false;\n}\n\nfunction onwriteError(stream, state, sync, er, cb) {\n  if (sync)\n    process.nextTick(function() {\n      cb(er);\n    });\n  else\n    cb(er);\n\n  stream._writableState.errorEmitted = true;\n  stream.emit('error', er);\n}\n\nfunction onwriteStateUpdate(state) {\n  state.writing = false;\n  state.writecb = null;\n  state.length -= state.writelen;\n  state.writelen = 0;\n}\n\nfunction onwrite(stream, er) {\n  var state = stream._writableState;\n  var sync = state.sync;\n  var cb = state.writecb;\n\n  onwriteStateUpdate(state);\n\n  if (er)\n    onwriteError(stream, state, sync, er, cb);\n  else {\n    // Check if we're actually ready to finish, but don't emit yet\n    var finished = needFinish(stream, state);\n\n    if (!finished && !state.bufferProcessing && state.buffer.length)\n      clearBuffer(stream, state);\n\n    if (sync) {\n      process.nextTick(function() {\n        afterWrite(stream, state, finished, cb);\n      });\n    } else {\n      afterWrite(stream, state, finished, cb);\n    }\n  }\n}\n\nfunction afterWrite(stream, state, finished, cb) {\n  if (!finished)\n    onwriteDrain(stream, state);\n  cb();\n  if (finished)\n    finishMaybe(stream, state);\n}\n\n// Must force callback to be called on nextTick, so that we don't\n// emit 'drain' before the write() consumer gets the 'false' return\n// value, and has a chance to attach a 'drain' listener.\nfunction onwriteDrain(stream, state) {\n  if (state.length === 0 && state.needDrain) {\n    state.needDrain = false;\n    stream.emit('drain');\n  }\n}\n\n\n// if there's something in the buffer waiting, then process it\nfunction clearBuffer(stream, state) {\n  state.bufferProcessing = true;\n\n  for (var c = 0; c < state.buffer.length; c++) {\n    var entry = state.buffer[c];\n    var chunk = entry.chunk;\n    var encoding = entry.encoding;\n    var cb = entry.callback;\n    var len = state.objectMode ? 1 : chunk.length;\n\n    doWrite(stream, state, len, chunk, encoding, cb);\n\n    // if we didn't call the onwrite immediately, then\n    // it means that we need to wait until it does.\n    // also, that means that the chunk and cb are currently\n    // being processed, so move the buffer counter past them.\n    if (state.writing) {\n      c++;\n      break;\n    }\n  }\n\n  state.bufferProcessing = false;\n  if (c < state.buffer.length)\n    state.buffer = state.buffer.slice(c);\n  else\n    state.buffer.length = 0;\n}\n\nWritable.prototype._write = function(chunk, encoding, cb) {\n  cb(new Error('not implemented'));\n};\n\nWritable.prototype.end = function(chunk, encoding, cb) {\n  var state = this._writableState;\n\n  if (typeof chunk === 'function') {\n    cb = chunk;\n    chunk = null;\n    encoding = null;\n  } else if (typeof encoding === 'function') {\n    cb = encoding;\n    encoding = null;\n  }\n\n  if (typeof chunk !== 'undefined' && chunk !== null)\n    this.write(chunk, encoding);\n\n  // ignore unnecessary end() calls.\n  if (!state.ending && !state.finished)\n    endWritable(this, state, cb);\n};\n\n\nfunction needFinish(stream, state) {\n  return (state.ending &&\n          state.length === 0 &&\n          !state.finished &&\n          !state.writing);\n}\n\nfunction finishMaybe(stream, state) {\n  var need = needFinish(stream, state);\n  if (need) {\n    state.finished = true;\n    stream.emit('finish');\n  }\n  return need;\n}\n\nfunction endWritable(stream, state, cb) {\n  state.ending = true;\n  finishMaybe(stream, state);\n  if (cb) {\n    if (state.finished)\n      process.nextTick(cb);\n    else\n      stream.once('finish', cb);\n  }\n  state.ended = true;\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// a duplex stream is just a stream that is both readable and writable.\n// Since JS doesn't have multiple prototypal inheritance, this class\n// prototypally inherits from Readable, and then parasitically from\n// Writable.\n\nmodule.exports = Duplex;\n\n/*<replacement>*/\nvar objectKeys = Object.keys || function (obj) {\n  var keys = [];\n  for (var key in obj) keys.push(key);\n  return keys;\n}\n/*</replacement>*/\n\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\nvar Readable = require('./_stream_readable');\nvar Writable = require('./_stream_writable');\n\nutil.inherits(Duplex, Readable);\n\nforEach(objectKeys(Writable.prototype), function(method) {\n  if (!Duplex.prototype[method])\n    Duplex.prototype[method] = Writable.prototype[method];\n});\n\nfunction Duplex(options) {\n  if (!(this instanceof Duplex))\n    return new Duplex(options);\n\n  Readable.call(this, options);\n  Writable.call(this, options);\n\n  if (options && options.readable === false)\n    this.readable = false;\n\n  if (options && options.writable === false)\n    this.writable = false;\n\n  this.allowHalfOpen = true;\n  if (options && options.allowHalfOpen === false)\n    this.allowHalfOpen = false;\n\n  this.once('end', onend);\n}\n\n// the no-half-open enforcer\nfunction onend() {\n  // if we allow half-open state, or if the writable side ended,\n  // then we're ok.\n  if (this.allowHalfOpen || this._writableState.ended)\n    return;\n\n  // no more data can be written.\n  // But allow more writes to happen in this tick.\n  process.nextTick(this.end.bind(this));\n}\n\nfunction forEach (xs, f) {\n  for (var i = 0, l = xs.length; i < l; i++) {\n    f(xs[i], i);\n  }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\n// a transform stream is a readable/writable stream where you do\n// something with the data.  Sometimes it's called a \"filter\",\n// but that's not a great name for it, since that implies a thing where\n// some bits pass through, and others are simply ignored.  (That would\n// be a valid example of a transform, of course.)\n//\n// While the output is causally related to the input, it's not a\n// necessarily symmetric or synchronous transformation.  For example,\n// a zlib stream might take multiple plain-text writes(), and then\n// emit a single compressed chunk some time in the future.\n//\n// Here's how this works:\n//\n// The Transform stream has all the aspects of the readable and writable\n// stream classes.  When you write(chunk), that calls _write(chunk,cb)\n// internally, and returns false if there's a lot of pending writes\n// buffered up.  When you call read(), that calls _read(n) until\n// there's enough pending readable data buffered up.\n//\n// In a transform stream, the written data is placed in a buffer.  When\n// _read(n) is called, it transforms the queued up data, calling the\n// buffered _write cb's as it consumes chunks.  If consuming a single\n// written chunk would result in multiple output chunks, then the first\n// outputted bit calls the readcb, and subsequent chunks just go into\n// the read buffer, and will cause it to emit 'readable' if necessary.\n//\n// This way, back-pressure is actually determined by the reading side,\n// since _read has to be called to start processing a new chunk.  However,\n// a pathological inflate type of transform can cause excessive buffering\n// here.  For example, imagine a stream where every byte of input is\n// interpreted as an integer from 0-255, and then results in that many\n// bytes of output.  Writing the 4 bytes {ff,ff,ff,ff} would result in\n// 1kb of data being output.  In this case, you could write a very small\n// amount of input, and end up with a very large amount of output.  In\n// such a pathological inflating mechanism, there'd be no way to tell\n// the system to stop doing the transform.  A single 4MB write could\n// cause the system to run out of memory.\n//\n// However, even in such a pathological case, only a single written chunk\n// would be consumed, and then the rest would wait (un-transformed) until\n// the results of the previous transformed chunk were consumed.\n\nmodule.exports = Transform;\n\nvar Duplex = require('./_stream_duplex');\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\nutil.inherits(Transform, Duplex);\n\n\nfunction TransformState(options, stream) {\n  this.afterTransform = function(er, data) {\n    return afterTransform(stream, er, data);\n  };\n\n  this.needTransform = false;\n  this.transforming = false;\n  this.writecb = null;\n  this.writechunk = null;\n}\n\nfunction afterTransform(stream, er, data) {\n  var ts = stream._transformState;\n  ts.transforming = false;\n\n  var cb = ts.writecb;\n\n  if (!cb)\n    return stream.emit('error', new Error('no writecb in Transform class'));\n\n  ts.writechunk = null;\n  ts.writecb = null;\n\n  if (data !== null && data !== undefined)\n    stream.push(data);\n\n  if (cb)\n    cb(er);\n\n  var rs = stream._readableState;\n  rs.reading = false;\n  if (rs.needReadable || rs.length < rs.highWaterMark) {\n    stream._read(rs.highWaterMark);\n  }\n}\n\n\nfunction Transform(options) {\n  if (!(this instanceof Transform))\n    return new Transform(options);\n\n  Duplex.call(this, options);\n\n  var ts = this._transformState = new TransformState(options, this);\n\n  // when the writable side finishes, then flush out anything remaining.\n  var stream = this;\n\n  // start out asking for a readable event once data is transformed.\n  this._readableState.needReadable = true;\n\n  // we have implemented the _read method, and done the other things\n  // that Readable wants before the first _read call, so unset the\n  // sync guard flag.\n  this._readableState.sync = false;\n\n  this.once('finish', function() {\n    if ('function' === typeof this._flush)\n      this._flush(function(er) {\n        done(stream, er);\n      });\n    else\n      done(stream);\n  });\n}\n\nTransform.prototype.push = function(chunk, encoding) {\n  this._transformState.needTransform = false;\n  return Duplex.prototype.push.call(this, chunk, encoding);\n};\n\n// This is the part where you do stuff!\n// override this function in implementation classes.\n// 'chunk' is an input chunk.\n//\n// Call `push(newChunk)` to pass along transformed output\n// to the readable side.  You may call 'push' zero or more times.\n//\n// Call `cb(err)` when you are done with this chunk.  If you pass\n// an error, then that'll put the hurt on the whole operation.  If you\n// never call cb(), then you'll never get another chunk.\nTransform.prototype._transform = function(chunk, encoding, cb) {\n  throw new Error('not implemented');\n};\n\nTransform.prototype._write = function(chunk, encoding, cb) {\n  var ts = this._transformState;\n  ts.writecb = cb;\n  ts.writechunk = chunk;\n  ts.writeencoding = encoding;\n  if (!ts.transforming) {\n    var rs = this._readableState;\n    if (ts.needTransform ||\n        rs.needReadable ||\n        rs.length < rs.highWaterMark)\n      this._read(rs.highWaterMark);\n  }\n};\n\n// Doesn't matter what the args are here.\n// _transform does all the work.\n// That we got here means that the readable side wants more data.\nTransform.prototype._read = function(n) {\n  var ts = this._transformState;\n\n  if (ts.writechunk !== null && ts.writecb && !ts.transforming) {\n    ts.transforming = true;\n    this._transform(ts.writechunk, ts.writeencoding, ts.afterTransform);\n  } else {\n    // mark that we need a transform, so that any data that comes in\n    // will get processed, now that we've asked for it.\n    ts.needTransform = true;\n  }\n};\n\n\nfunction done(stream, er) {\n  if (er)\n    return stream.emit('error', er);\n\n  // if there's nothing in the write buffer, then that means\n  // that nothing more will ever be provided\n  var ws = stream._writableState;\n  var rs = stream._readableState;\n  var ts = stream._transformState;\n\n  if (ws.length)\n    throw new Error('calling transform done when ws.length != 0');\n\n  if (ts.transforming)\n    throw new Error('calling transform done when still transforming');\n\n  return stream.push(null);\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// a passthrough stream.\n// basically just the most minimal sort of Transform stream.\n// Every written chunk gets output as-is.\n\nmodule.exports = PassThrough;\n\nvar Transform = require('./_stream_transform');\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\nutil.inherits(PassThrough, Transform);\n\nfunction PassThrough(options) {\n  if (!(this instanceof PassThrough))\n    return new PassThrough(options);\n\n  Transform.call(this, options);\n}\n\nPassThrough.prototype._transform = function(chunk, encoding, cb) {\n  cb(null, chunk);\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nvar schedule = require(\"./schedule.js\");\nvar Queue = require(\"./queue.js\");\nvar errorObj = require(\"./util.js\").errorObj;\nvar tryCatch1 = require(\"./util.js\").tryCatch1;\nvar _process = typeof process !== \"undefined\" ? process : void 0;\n\nfunction Async() {\n    this._isTickUsed = false;\n    this._schedule = schedule;\n    this._length = 0;\n    this._lateBuffer = new Queue(16);\n    this._functionBuffer = new Queue(65536);\n    var self = this;\n    this.consumeFunctionBuffer = function Async$consumeFunctionBuffer() {\n        self._consumeFunctionBuffer();\n    };\n}\n\nAsync.prototype.haveItemsQueued = function Async$haveItemsQueued() {\n    return this._length > 0;\n};\n\nAsync.prototype.invokeLater = function Async$invokeLater(fn, receiver, arg) {\n    if (_process !== void 0 &&\n        _process.domain != null &&\n        !fn.domain) {\n        fn = _process.domain.bind(fn);\n    }\n    this._lateBuffer.push(fn, receiver, arg);\n    this._queueTick();\n};\n\nAsync.prototype.invoke = function Async$invoke(fn, receiver, arg) {\n    if (_process !== void 0 &&\n        _process.domain != null &&\n        !fn.domain) {\n        fn = _process.domain.bind(fn);\n    }\n    var functionBuffer = this._functionBuffer;\n    functionBuffer.push(fn, receiver, arg);\n    this._length = functionBuffer.length();\n    this._queueTick();\n};\n\nAsync.prototype._consumeFunctionBuffer =\nfunction Async$_consumeFunctionBuffer() {\n    var functionBuffer = this._functionBuffer;\n    while (functionBuffer.length() > 0) {\n        var fn = functionBuffer.shift();\n        var receiver = functionBuffer.shift();\n        var arg = functionBuffer.shift();\n        fn.call(receiver, arg);\n    }\n    this._reset();\n    this._consumeLateBuffer();\n};\n\nAsync.prototype._consumeLateBuffer = function Async$_consumeLateBuffer() {\n    var buffer = this._lateBuffer;\n    while(buffer.length() > 0) {\n        var fn = buffer.shift();\n        var receiver = buffer.shift();\n        var arg = buffer.shift();\n        var res = tryCatch1(fn, receiver, arg);\n        if (res === errorObj) {\n            this._queueTick();\n            if (fn.domain != null) {\n                fn.domain.emit(\"error\", res.e);\n            } else {\n                throw res.e;\n            }\n        }\n    }\n};\n\nAsync.prototype._queueTick = function Async$_queue() {\n    if (!this._isTickUsed) {\n        this._schedule(this.consumeFunctionBuffer);\n        this._isTickUsed = true;\n    }\n};\n\nAsync.prototype._reset = function Async$_reset() {\n    this._isTickUsed = false;\n    this._length = 0;\n};\n\nmodule.exports = new Async();\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nvar es5 = require(\"./es5.js\");\nvar haveGetters = (function(){\n    try {\n        var o = {};\n        es5.defineProperty(o, \"f\", {\n            get: function () {\n                return 3;\n            }\n        });\n        return o.f === 3;\n    }\n    catch (e) {\n        return false;\n    }\n\n})();\nvar canEvaluate = typeof navigator == \"undefined\";\nvar errorObj = {e: {}};\nfunction tryCatch1(fn, receiver, arg) {\n    try { return fn.call(receiver, arg); }\n    catch (e) {\n        errorObj.e = e;\n        return errorObj;\n    }\n}\n\nfunction tryCatch2(fn, receiver, arg, arg2) {\n    try { return fn.call(receiver, arg, arg2); }\n    catch (e) {\n        errorObj.e = e;\n        return errorObj;\n    }\n}\n\nfunction tryCatch3(fn, receiver, arg, arg2, arg3) {\n    try { return fn.call(receiver, arg, arg2, arg3); }\n    catch (e) {\n        errorObj.e = e;\n        return errorObj;\n    }\n}\n\nfunction tryCatch4(fn, receiver, arg, arg2, arg3, arg4) {\n    try { return fn.call(receiver, arg, arg2, arg3, arg4); }\n    catch (e) {\n        errorObj.e = e;\n        return errorObj;\n    }\n}\n\nfunction tryCatchApply(fn, args, receiver) {\n    try { return fn.apply(receiver, args); }\n    catch (e) {\n        errorObj.e = e;\n        return errorObj;\n    }\n}\n\nvar inherits = function(Child, Parent) {\n    var hasProp = {}.hasOwnProperty;\n\n    function T() {\n        this.constructor = Child;\n        this.constructor$ = Parent;\n        for (var propertyName in Parent.prototype) {\n            if (hasProp.call(Parent.prototype, propertyName) &&\n                propertyName.charAt(propertyName.length-1) !== \"$\"\n           ) {\n                this[propertyName + \"$\"] = Parent.prototype[propertyName];\n            }\n        }\n    }\n    T.prototype = Parent.prototype;\n    Child.prototype = new T();\n    return Child.prototype;\n};\n\nfunction asString(val) {\n    return typeof val === \"string\" ? val : (\"\" + val);\n}\n\nfunction isPrimitive(val) {\n    return val == null || val === true || val === false ||\n        typeof val === \"string\" || typeof val === \"number\";\n\n}\n\nfunction isObject(value) {\n    return !isPrimitive(value);\n}\n\nfunction maybeWrapAsError(maybeError) {\n    if (!isPrimitive(maybeError)) return maybeError;\n\n    return new Error(asString(maybeError));\n}\n\nfunction withAppended(target, appendee) {\n    var len = target.length;\n    var ret = new Array(len + 1);\n    var i;\n    for (i = 0; i < len; ++i) {\n        ret[i] = target[i];\n    }\n    ret[i] = appendee;\n    return ret;\n}\n\nfunction getDataPropertyOrDefault(obj, key, defaultValue) {\n    if (es5.isES5) {\n        var desc = Object.getOwnPropertyDescriptor(obj, key);\n        if (desc != null) {\n            return desc.get == null && desc.set == null\n                    ? desc.value\n                    : defaultValue;\n        }\n    } else {\n        return {}.hasOwnProperty.call(obj, key) ? obj[key] : void 0;\n    }\n}\n\nfunction notEnumerableProp(obj, name, value) {\n    if (isPrimitive(obj)) return obj;\n    var descriptor = {\n        value: value,\n        configurable: true,\n        enumerable: false,\n        writable: true\n    };\n    es5.defineProperty(obj, name, descriptor);\n    return obj;\n}\n\n\nvar wrapsPrimitiveReceiver = (function() {\n    return this !== \"string\";\n}).call(\"string\");\n\nfunction thrower(r) {\n    throw r;\n}\n\nvar inheritedDataKeys = (function() {\n    if (es5.isES5) {\n        return function(obj, opts) {\n            var ret = [];\n            var visitedKeys = Object.create(null);\n            var getKeys = Object(opts).includeHidden\n                ? Object.getOwnPropertyNames\n                : Object.keys;\n            while (obj != null) {\n                var keys;\n                try {\n                    keys = getKeys(obj);\n                } catch (e) {\n                    return ret;\n                }\n                for (var i = 0; i < keys.length; ++i) {\n                    var key = keys[i];\n                    if (visitedKeys[key]) continue;\n                    visitedKeys[key] = true;\n                    var desc = Object.getOwnPropertyDescriptor(obj, key);\n                    if (desc != null && desc.get == null && desc.set == null) {\n                        ret.push(key);\n                    }\n                }\n                obj = es5.getPrototypeOf(obj);\n            }\n            return ret;\n        };\n    } else {\n        return function(obj) {\n            var ret = [];\n            /*jshint forin:false */\n            for (var key in obj) {\n                ret.push(key);\n            }\n            return ret;\n        };\n    }\n\n})();\n\nfunction isClass(fn) {\n    try {\n        if (typeof fn === \"function\") {\n            var keys = es5.keys(fn.prototype);\n            return keys.length > 0 &&\n                   !(keys.length === 1 && keys[0] === \"constructor\");\n        }\n        return false;\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction toFastProperties(obj) {\n    /*jshint -W027*/\n    function f() {}\n    f.prototype = obj;\n    return f;\n    eval(obj);\n}\n\nvar rident = /^[a-z$_][a-z$_0-9]*$/i;\nfunction isIdentifier(str) {\n    return rident.test(str);\n}\n\nfunction filledRange(count, prefix, suffix) {\n    var ret = new Array(count);\n    for(var i = 0; i < count; ++i) {\n        ret[i] = prefix + i + suffix;\n    }\n    return ret;\n}\n\nvar ret = {\n    isClass: isClass,\n    isIdentifier: isIdentifier,\n    inheritedDataKeys: inheritedDataKeys,\n    getDataPropertyOrDefault: getDataPropertyOrDefault,\n    thrower: thrower,\n    isArray: es5.isArray,\n    haveGetters: haveGetters,\n    notEnumerableProp: notEnumerableProp,\n    isPrimitive: isPrimitive,\n    isObject: isObject,\n    canEvaluate: canEvaluate,\n    errorObj: errorObj,\n    tryCatch1: tryCatch1,\n    tryCatch2: tryCatch2,\n    tryCatch3: tryCatch3,\n    tryCatch4: tryCatch4,\n    tryCatchApply: tryCatchApply,\n    inherits: inherits,\n    withAppended: withAppended,\n    asString: asString,\n    maybeWrapAsError: maybeWrapAsError,\n    wrapsPrimitiveReceiver: wrapsPrimitiveReceiver,\n    toFastProperties: toFastProperties,\n    filledRange: filledRange\n};\n\nmodule.exports = ret;\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nvar Objectfreeze = require(\"./es5.js\").freeze;\nvar util = require(\"./util.js\");\nvar inherits = util.inherits;\nvar notEnumerableProp = util.notEnumerableProp;\n\nfunction markAsOriginatingFromRejection(e) {\n    try {\n        notEnumerableProp(e, \"isOperational\", true);\n    }\n    catch(ignore) {}\n}\n\nfunction originatesFromRejection(e) {\n    if (e == null) return false;\n    return ((e instanceof OperationalError) ||\n        e[\"isOperational\"] === true);\n}\n\nfunction isError(obj) {\n    return obj instanceof Error;\n}\n\nfunction canAttach(obj) {\n    return isError(obj);\n}\n\nfunction subError(nameProperty, defaultMessage) {\n    function SubError(message) {\n        if (!(this instanceof SubError)) return new SubError(message);\n        this.message = typeof message === \"string\" ? message : defaultMessage;\n        this.name = nameProperty;\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, this.constructor);\n        }\n    }\n    inherits(SubError, Error);\n    return SubError;\n}\n\nvar _TypeError, _RangeError;\nvar CancellationError = subError(\"CancellationError\", \"cancellation error\");\nvar TimeoutError = subError(\"TimeoutError\", \"timeout error\");\nvar AggregateError = subError(\"AggregateError\", \"aggregate error\");\ntry {\n    _TypeError = TypeError;\n    _RangeError = RangeError;\n} catch(e) {\n    _TypeError = subError(\"TypeError\", \"type error\");\n    _RangeError = subError(\"RangeError\", \"range error\");\n}\n\nvar methods = (\"join pop push shift unshift slice filter forEach some \" +\n    \"every map indexOf lastIndexOf reduce reduceRight sort reverse\").split(\" \");\n\nfor (var i = 0; i < methods.length; ++i) {\n    if (typeof Array.prototype[methods[i]] === \"function\") {\n        AggregateError.prototype[methods[i]] = Array.prototype[methods[i]];\n    }\n}\n\nAggregateError.prototype.length = 0;\nAggregateError.prototype[\"isOperational\"] = true;\nvar level = 0;\nAggregateError.prototype.toString = function() {\n    var indent = Array(level * 4 + 1).join(\" \");\n    var ret = \"\\n\" + indent + \"AggregateError of:\" + \"\\n\";\n    level++;\n    indent = Array(level * 4 + 1).join(\" \");\n    for (var i = 0; i < this.length; ++i) {\n        var str = this[i] === this ? \"[Circular AggregateError]\" : this[i] + \"\";\n        var lines = str.split(\"\\n\");\n        for (var j = 0; j < lines.length; ++j) {\n            lines[j] = indent + lines[j];\n        }\n        str = lines.join(\"\\n\");\n        ret += str + \"\\n\";\n    }\n    level--;\n    return ret;\n};\n\nfunction OperationalError(message) {\n    this.name = \"OperationalError\";\n    this.message = message;\n    this.cause = message;\n    this[\"isOperational\"] = true;\n\n    if (message instanceof Error) {\n        this.message = message.message;\n        this.stack = message.stack;\n    } else if (Error.captureStackTrace) {\n        Error.captureStackTrace(this, this.constructor);\n    }\n\n}\ninherits(OperationalError, Error);\n\nvar key = \"__BluebirdErrorTypes__\";\nvar errorTypes = Error[key];\nif (!errorTypes) {\n    errorTypes = Objectfreeze({\n        CancellationError: CancellationError,\n        TimeoutError: TimeoutError,\n        OperationalError: OperationalError,\n        RejectionError: OperationalError,\n        AggregateError: AggregateError\n    });\n    notEnumerableProp(Error, key, errorTypes);\n}\n\nmodule.exports = {\n    Error: Error,\n    TypeError: _TypeError,\n    RangeError: _RangeError,\n    CancellationError: errorTypes.CancellationError,\n    OperationalError: errorTypes.OperationalError,\n    TimeoutError: errorTypes.TimeoutError,\n    AggregateError: errorTypes.AggregateError,\n    originatesFromRejection: originatesFromRejection,\n    markAsOriginatingFromRejection: markAsOriginatingFromRejection,\n    canAttach: canAttach\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar util = require(\"./util.js\");\nvar canAttach = require(\"./errors.js\").canAttach;\nvar errorObj = util.errorObj;\nvar isObject = util.isObject;\n\nfunction getThen(obj) {\n    try {\n        return obj.then;\n    }\n    catch(e) {\n        errorObj.e = e;\n        return errorObj;\n    }\n}\n\nfunction Promise$_Cast(obj, originalPromise) {\n    if (isObject(obj)) {\n        if (obj instanceof Promise) {\n            return obj;\n        }\n        else if (isAnyBluebirdPromise(obj)) {\n            var ret = new Promise(INTERNAL);\n            ret._setTrace(void 0);\n            obj._then(\n                ret._fulfillUnchecked,\n                ret._rejectUncheckedCheckError,\n                ret._progressUnchecked,\n                ret,\n                null\n            );\n            ret._setFollowing();\n            return ret;\n        }\n        var then = getThen(obj);\n        if (then === errorObj) {\n            if (originalPromise !== void 0 && canAttach(then.e)) {\n                originalPromise._attachExtraTrace(then.e);\n            }\n            return Promise.reject(then.e);\n        } else if (typeof then === \"function\") {\n            return Promise$_doThenable(obj, then, originalPromise);\n        }\n    }\n    return obj;\n}\n\nvar hasProp = {}.hasOwnProperty;\nfunction isAnyBluebirdPromise(obj) {\n    return hasProp.call(obj, \"_promise0\");\n}\n\nfunction Promise$_doThenable(x, then, originalPromise) {\n    var resolver = Promise.defer();\n    var called = false;\n    try {\n        then.call(\n            x,\n            Promise$_resolveFromThenable,\n            Promise$_rejectFromThenable,\n            Promise$_progressFromThenable\n        );\n    } catch(e) {\n        if (!called) {\n            called = true;\n            var trace = canAttach(e) ? e : new Error(e + \"\");\n            if (originalPromise !== void 0) {\n                originalPromise._attachExtraTrace(trace);\n            }\n            resolver.promise._reject(e, trace);\n        }\n    }\n    return resolver.promise;\n\n    function Promise$_resolveFromThenable(y) {\n        if (called) return;\n        called = true;\n\n        if (x === y) {\n            var e = Promise._makeSelfResolutionError();\n            if (originalPromise !== void 0) {\n                originalPromise._attachExtraTrace(e);\n            }\n            resolver.promise._reject(e, void 0);\n            return;\n        }\n        resolver.resolve(y);\n    }\n\n    function Promise$_rejectFromThenable(r) {\n        if (called) return;\n        called = true;\n        var trace = canAttach(r) ? r : new Error(r + \"\");\n        if (originalPromise !== void 0) {\n            originalPromise._attachExtraTrace(trace);\n        }\n        resolver.promise._reject(r, trace);\n    }\n\n    function Promise$_progressFromThenable(v) {\n        if (called) return;\n        var promise = resolver.promise;\n        if (typeof promise._progress === \"function\") {\n            promise._progress(v);\n        }\n    }\n}\n\nreturn Promise$_Cast;\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL, cast) {\nvar canAttach = require(\"./errors.js\").canAttach;\nvar util = require(\"./util.js\");\nvar isArray = util.isArray;\n\nfunction toResolutionValue(val) {\n    switch(val) {\n    case -1: return void 0;\n    case -2: return [];\n    case -3: return {};\n    }\n}\n\nfunction PromiseArray(values) {\n    var promise = this._promise = new Promise(INTERNAL);\n    var parent = void 0;\n    if (values instanceof Promise) {\n        parent = values;\n        promise._propagateFrom(parent, 1 | 4);\n    }\n    promise._setTrace(parent);\n    this._values = values;\n    this._length = 0;\n    this._totalResolved = 0;\n    this._init(void 0, -2);\n}\nPromiseArray.prototype.length = function PromiseArray$length() {\n    return this._length;\n};\n\nPromiseArray.prototype.promise = function PromiseArray$promise() {\n    return this._promise;\n};\n\nPromiseArray.prototype._init =\nfunction PromiseArray$_init(_, resolveValueIfEmpty) {\n    var values = cast(this._values, void 0);\n    if (values instanceof Promise) {\n        this._values = values;\n        values._setBoundTo(this._promise._boundTo);\n        if (values.isFulfilled()) {\n            values = values._settledValue;\n            if (!isArray(values)) {\n                var err = new Promise.TypeError(\"expecting an array, a promise or a thenable\");\n                this.__hardReject__(err);\n                return;\n            }\n        } else if (values.isPending()) {\n            values._then(\n                PromiseArray$_init,\n                this._reject,\n                void 0,\n                this,\n                resolveValueIfEmpty\n           );\n            return;\n        } else {\n            values._unsetRejectionIsUnhandled();\n            this._reject(values._settledValue);\n            return;\n        }\n    } else if (!isArray(values)) {\n        var err = new Promise.TypeError(\"expecting an array, a promise or a thenable\");\n        this.__hardReject__(err);\n        return;\n    }\n\n    if (values.length === 0) {\n        if (resolveValueIfEmpty === -5) {\n            this._resolveEmptyArray();\n        }\n        else {\n            this._resolve(toResolutionValue(resolveValueIfEmpty));\n        }\n        return;\n    }\n    var len = this.getActualLength(values.length);\n    var newLen = len;\n    var newValues = this.shouldCopyValues() ? new Array(len) : this._values;\n    var isDirectScanNeeded = false;\n    for (var i = 0; i < len; ++i) {\n        var maybePromise = cast(values[i], void 0);\n        if (maybePromise instanceof Promise) {\n            if (maybePromise.isPending()) {\n                maybePromise._proxyPromiseArray(this, i);\n            } else {\n                maybePromise._unsetRejectionIsUnhandled();\n                isDirectScanNeeded = true;\n            }\n        } else {\n            isDirectScanNeeded = true;\n        }\n        newValues[i] = maybePromise;\n    }\n    this._values = newValues;\n    this._length = newLen;\n    if (isDirectScanNeeded) {\n        this._scanDirectValues(len);\n    }\n};\n\nPromiseArray.prototype._settlePromiseAt =\nfunction PromiseArray$_settlePromiseAt(index) {\n    var value = this._values[index];\n    if (!(value instanceof Promise)) {\n        this._promiseFulfilled(value, index);\n    } else if (value.isFulfilled()) {\n        this._promiseFulfilled(value._settledValue, index);\n    } else if (value.isRejected()) {\n        this._promiseRejected(value._settledValue, index);\n    }\n};\n\nPromiseArray.prototype._scanDirectValues =\nfunction PromiseArray$_scanDirectValues(len) {\n    for (var i = 0; i < len; ++i) {\n        if (this._isResolved()) {\n            break;\n        }\n        this._settlePromiseAt(i);\n    }\n};\n\nPromiseArray.prototype._isResolved = function PromiseArray$_isResolved() {\n    return this._values === null;\n};\n\nPromiseArray.prototype._resolve = function PromiseArray$_resolve(value) {\n    this._values = null;\n    this._promise._fulfill(value);\n};\n\nPromiseArray.prototype.__hardReject__ =\nPromiseArray.prototype._reject = function PromiseArray$_reject(reason) {\n    this._values = null;\n    var trace = canAttach(reason) ? reason : new Error(reason + \"\");\n    this._promise._attachExtraTrace(trace);\n    this._promise._reject(reason, trace);\n};\n\nPromiseArray.prototype._promiseProgressed =\nfunction PromiseArray$_promiseProgressed(progressValue, index) {\n    if (this._isResolved()) return;\n    this._promise._progress({\n        index: index,\n        value: progressValue\n    });\n};\n\n\nPromiseArray.prototype._promiseFulfilled =\nfunction PromiseArray$_promiseFulfilled(value, index) {\n    if (this._isResolved()) return;\n    this._values[index] = value;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        this._resolve(this._values);\n    }\n};\n\nPromiseArray.prototype._promiseRejected =\nfunction PromiseArray$_promiseRejected(reason, index) {\n    if (this._isResolved()) return;\n    this._totalResolved++;\n    this._reject(reason);\n};\n\nPromiseArray.prototype.shouldCopyValues =\nfunction PromiseArray$_shouldCopyValues() {\n    return true;\n};\n\nPromiseArray.prototype.getActualLength =\nfunction PromiseArray$getActualLength(len) {\n    return len;\n};\n\nreturn PromiseArray;\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function() {\nvar inherits = require(\"./util.js\").inherits;\nvar defineProperty = require(\"./es5.js\").defineProperty;\n\nvar rignore = new RegExp(\n    \"\\\\b(?:[a-zA-Z0-9.]+\\\\$_\\\\w+|\" +\n    \"tryCatch(?:1|2|3|4|Apply)|new \\\\w*PromiseArray|\" +\n    \"\\\\w*PromiseArray\\\\.\\\\w*PromiseArray|\" +\n    \"setTimeout|CatchFilter\\\\$_\\\\w+|makeNodePromisified|processImmediate|\" +\n    \"process._tickCallback|nextTick|Async\\\\$\\\\w+)\\\\b\"\n);\n\nvar rtraceline = null;\nvar formatStack = null;\n\nfunction formatNonError(obj) {\n    var str;\n    if (typeof obj === \"function\") {\n        str = \"[function \" +\n            (obj.name || \"anonymous\") +\n            \"]\";\n    } else {\n        str = obj.toString();\n        var ruselessToString = /\\[object [a-zA-Z0-9$_]+\\]/;\n        if (ruselessToString.test(str)) {\n            try {\n                var newStr = JSON.stringify(obj);\n                str = newStr;\n            }\n            catch(e) {\n\n            }\n        }\n        if (str.length === 0) {\n            str = \"(empty array)\";\n        }\n    }\n    return (\"(<\" + snip(str) + \">, no stack trace)\");\n}\n\nfunction snip(str) {\n    var maxChars = 41;\n    if (str.length < maxChars) {\n        return str;\n    }\n    return str.substr(0, maxChars - 3) + \"...\";\n}\n\nfunction CapturedTrace(ignoreUntil, isTopLevel) {\n    this.captureStackTrace(CapturedTrace, isTopLevel);\n\n}\ninherits(CapturedTrace, Error);\n\nCapturedTrace.prototype.captureStackTrace =\nfunction CapturedTrace$captureStackTrace(ignoreUntil, isTopLevel) {\n    captureStackTrace(this, ignoreUntil, isTopLevel);\n};\n\nCapturedTrace.possiblyUnhandledRejection =\nfunction CapturedTrace$PossiblyUnhandledRejection(reason) {\n    if (typeof console === \"object\") {\n        var message;\n        if (typeof reason === \"object\" || typeof reason === \"function\") {\n            var stack = reason.stack;\n            message = \"Possibly unhandled \" + formatStack(stack, reason);\n        } else {\n            message = \"Possibly unhandled \" + String(reason);\n        }\n        if (typeof console.error === \"function\" ||\n            typeof console.error === \"object\") {\n            console.error(message);\n        } else if (typeof console.log === \"function\" ||\n            typeof console.log === \"object\") {\n            console.log(message);\n        }\n    }\n};\n\nCapturedTrace.combine = function CapturedTrace$Combine(current, prev) {\n    var curLast = current.length - 1;\n    for (var i = prev.length - 1; i >= 0; --i) {\n        var line = prev[i];\n        if (current[curLast] === line) {\n            current.pop();\n            curLast--;\n        } else {\n            break;\n        }\n    }\n\n    current.push(\"From previous event:\");\n    var lines = current.concat(prev);\n\n    var ret = [];\n\n    for (var i = 0, len = lines.length; i < len; ++i) {\n\n        if (((rignore.test(lines[i]) && rtraceline.test(lines[i])) ||\n            (i > 0 && !rtraceline.test(lines[i])) &&\n            lines[i] !== \"From previous event:\")\n       ) {\n            continue;\n        }\n        ret.push(lines[i]);\n    }\n    return ret;\n};\n\nCapturedTrace.protectErrorMessageNewlines = function(stack) {\n    for (var i = 0; i < stack.length; ++i) {\n        if (rtraceline.test(stack[i])) {\n            break;\n        }\n    }\n\n    if (i <= 1) return;\n\n    var errorMessageLines = [];\n    for (var j = 0; j < i; ++j) {\n        errorMessageLines.push(stack.shift());\n    }\n    stack.unshift(errorMessageLines.join(\"\\u0002\\u0000\\u0001\"));\n};\n\nCapturedTrace.isSupported = function CapturedTrace$IsSupported() {\n    return typeof captureStackTrace === \"function\";\n};\n\nvar captureStackTrace = (function stackDetection() {\n    if (typeof Error.stackTraceLimit === \"number\" &&\n        typeof Error.captureStackTrace === \"function\") {\n        rtraceline = /^\\s*at\\s*/;\n        formatStack = function(stack, error) {\n            if (typeof stack === \"string\") return stack;\n\n            if (error.name !== void 0 &&\n                error.message !== void 0) {\n                return error.name + \". \" + error.message;\n            }\n            return formatNonError(error);\n\n\n        };\n        var captureStackTrace = Error.captureStackTrace;\n        return function CapturedTrace$_captureStackTrace(\n            receiver, ignoreUntil) {\n            captureStackTrace(receiver, ignoreUntil);\n        };\n    }\n    var err = new Error();\n\n    if (typeof err.stack === \"string\" &&\n        typeof \"\".startsWith === \"function\" &&\n        (err.stack.startsWith(\"stackDetection@\")) &&\n        stackDetection.name === \"stackDetection\") {\n\n        defineProperty(Error, \"stackTraceLimit\", {\n            writable: true,\n            enumerable: false,\n            configurable: false,\n            value: 25\n        });\n        rtraceline = /@/;\n        var rline = /[@\\n]/;\n\n        formatStack = function(stack, error) {\n            if (typeof stack === \"string\") {\n                return (error.name + \". \" + error.message + \"\\n\" + stack);\n            }\n\n            if (error.name !== void 0 &&\n                error.message !== void 0) {\n                return error.name + \". \" + error.message;\n            }\n            return formatNonError(error);\n        };\n\n        return function captureStackTrace(o) {\n            var stack = new Error().stack;\n            var split = stack.split(rline);\n            var len = split.length;\n            var ret = \"\";\n            for (var i = 0; i < len; i += 2) {\n                ret += split[i];\n                ret += \"@\";\n                ret += split[i + 1];\n                ret += \"\\n\";\n            }\n            o.stack = ret;\n        };\n    } else {\n        formatStack = function(stack, error) {\n            if (typeof stack === \"string\") return stack;\n\n            if ((typeof error === \"object\" ||\n                typeof error === \"function\") &&\n                error.name !== void 0 &&\n                error.message !== void 0) {\n                return error.name + \". \" + error.message;\n            }\n            return formatNonError(error);\n        };\n\n        return null;\n    }\n})();\n\nreturn CapturedTrace;\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(NEXT_FILTER) {\nvar util = require(\"./util.js\");\nvar errors = require(\"./errors.js\");\nvar tryCatch1 = util.tryCatch1;\nvar errorObj = util.errorObj;\nvar keys = require(\"./es5.js\").keys;\nvar TypeError = errors.TypeError;\n\nfunction CatchFilter(instances, callback, promise) {\n    this._instances = instances;\n    this._callback = callback;\n    this._promise = promise;\n}\n\nfunction CatchFilter$_safePredicate(predicate, e) {\n    var safeObject = {};\n    var retfilter = tryCatch1(predicate, safeObject, e);\n\n    if (retfilter === errorObj) return retfilter;\n\n    var safeKeys = keys(safeObject);\n    if (safeKeys.length) {\n        errorObj.e = new TypeError(\n            \"Catch filter must inherit from Error \"\n          + \"or be a simple predicate function\");\n        return errorObj;\n    }\n    return retfilter;\n}\n\nCatchFilter.prototype.doFilter = function CatchFilter$_doFilter(e) {\n    var cb = this._callback;\n    var promise = this._promise;\n    var boundTo = promise._boundTo;\n    for (var i = 0, len = this._instances.length; i < len; ++i) {\n        var item = this._instances[i];\n        var itemIsErrorType = item === Error ||\n            (item != null && item.prototype instanceof Error);\n\n        if (itemIsErrorType && e instanceof item) {\n            var ret = tryCatch1(cb, boundTo, e);\n            if (ret === errorObj) {\n                NEXT_FILTER.e = ret.e;\n                return NEXT_FILTER;\n            }\n            return ret;\n        } else if (typeof item === \"function\" && !itemIsErrorType) {\n            var shouldHandle = CatchFilter$_safePredicate(item, e);\n            if (shouldHandle === errorObj) {\n                var trace = errors.canAttach(errorObj.e)\n                    ? errorObj.e\n                    : new Error(errorObj.e + \"\");\n                this._promise._attachExtraTrace(trace);\n                e = errorObj.e;\n                break;\n            } else if (shouldHandle) {\n                var ret = tryCatch1(cb, boundTo, e);\n                if (ret === errorObj) {\n                    NEXT_FILTER.e = ret.e;\n                    return NEXT_FILTER;\n                }\n                return ret;\n            }\n        }\n    }\n    NEXT_FILTER.e = e;\n    return NEXT_FILTER;\n};\n\nreturn CatchFilter;\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nvar util = require(\"./util.js\");\nvar maybeWrapAsError = util.maybeWrapAsError;\nvar errors = require(\"./errors.js\");\nvar TimeoutError = errors.TimeoutError;\nvar OperationalError = errors.OperationalError;\nvar async = require(\"./async.js\");\nvar haveGetters = util.haveGetters;\nvar es5 = require(\"./es5.js\");\n\nfunction isUntypedError(obj) {\n    return obj instanceof Error &&\n        es5.getPrototypeOf(obj) === Error.prototype;\n}\n\nfunction wrapAsOperationalError(obj) {\n    var ret;\n    if (isUntypedError(obj)) {\n        ret = new OperationalError(obj);\n    } else {\n        ret = obj;\n    }\n    errors.markAsOriginatingFromRejection(ret);\n    return ret;\n}\n\nfunction nodebackForPromise(promise) {\n    function PromiseResolver$_callback(err, value) {\n        if (promise === null) return;\n\n        if (err) {\n            var wrapped = wrapAsOperationalError(maybeWrapAsError(err));\n            promise._attachExtraTrace(wrapped);\n            promise._reject(wrapped);\n        } else if (arguments.length > 2) {\n            var $_len = arguments.length;var args = new Array($_len - 1); for(var $_i = 1; $_i < $_len; ++$_i) {args[$_i - 1] = arguments[$_i];}\n            promise._fulfill(args);\n        } else {\n            promise._fulfill(value);\n        }\n\n        promise = null;\n    }\n    return PromiseResolver$_callback;\n}\n\n\nvar PromiseResolver;\nif (!haveGetters) {\n    PromiseResolver = function PromiseResolver(promise) {\n        this.promise = promise;\n        this.asCallback = nodebackForPromise(promise);\n        this.callback = this.asCallback;\n    };\n}\nelse {\n    PromiseResolver = function PromiseResolver(promise) {\n        this.promise = promise;\n    };\n}\nif (haveGetters) {\n    var prop = {\n        get: function() {\n            return nodebackForPromise(this.promise);\n        }\n    };\n    es5.defineProperty(PromiseResolver.prototype, \"asCallback\", prop);\n    es5.defineProperty(PromiseResolver.prototype, \"callback\", prop);\n}\n\nPromiseResolver._nodebackForPromise = nodebackForPromise;\n\nPromiseResolver.prototype.toString = function PromiseResolver$toString() {\n    return \"[object PromiseResolver]\";\n};\n\nPromiseResolver.prototype.resolve =\nPromiseResolver.prototype.fulfill = function PromiseResolver$resolve(value) {\n    if (!(this instanceof PromiseResolver)) {\n        throw new TypeError(\"Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\");\n    }\n\n    var promise = this.promise;\n    if (promise._tryFollow(value)) {\n        return;\n    }\n    async.invoke(promise._fulfill, promise, value);\n};\n\nPromiseResolver.prototype.reject = function PromiseResolver$reject(reason) {\n    if (!(this instanceof PromiseResolver)) {\n        throw new TypeError(\"Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\");\n    }\n\n    var promise = this.promise;\n    errors.markAsOriginatingFromRejection(reason);\n    var trace = errors.canAttach(reason) ? reason : new Error(reason + \"\");\n    promise._attachExtraTrace(trace);\n    async.invoke(promise._reject, promise, reason);\n    if (trace !== reason) {\n        async.invoke(this._setCarriedStackTrace, this, trace);\n    }\n};\n\nPromiseResolver.prototype.progress =\nfunction PromiseResolver$progress(value) {\n    if (!(this instanceof PromiseResolver)) {\n        throw new TypeError(\"Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\");\n    }\n    async.invoke(this.promise._progress, this.promise, value);\n};\n\nPromiseResolver.prototype.cancel = function PromiseResolver$cancel() {\n    async.invoke(this.promise.cancel, this.promise, void 0);\n};\n\nPromiseResolver.prototype.timeout = function PromiseResolver$timeout() {\n    this.reject(new TimeoutError(\"timeout\"));\n};\n\nPromiseResolver.prototype.isResolved = function PromiseResolver$isResolved() {\n    return this.promise.isResolved();\n};\n\nPromiseResolver.prototype.toJSON = function PromiseResolver$toJSON() {\n    return this.promise.toJSON();\n};\n\nPromiseResolver.prototype._setCarriedStackTrace =\nfunction PromiseResolver$_setCarriedStackTrace(trace) {\n    if (this.promise.isRejected()) {\n        this.promise._setCarriedStackTrace(trace);\n    }\n};\n\nmodule.exports = PromiseResolver;\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise, NEXT_FILTER, cast) {\nvar util = require(\"./util.js\");\nvar wrapsPrimitiveReceiver = util.wrapsPrimitiveReceiver;\nvar isPrimitive = util.isPrimitive;\nvar thrower = util.thrower;\n\nfunction returnThis() {\n    return this;\n}\nfunction throwThis() {\n    throw this;\n}\nfunction return$(r) {\n    return function Promise$_returner() {\n        return r;\n    };\n}\nfunction throw$(r) {\n    return function Promise$_thrower() {\n        throw r;\n    };\n}\nfunction promisedFinally(ret, reasonOrValue, isFulfilled) {\n    var then;\n    if (wrapsPrimitiveReceiver && isPrimitive(reasonOrValue)) {\n        then = isFulfilled ? return$(reasonOrValue) : throw$(reasonOrValue);\n    } else {\n        then = isFulfilled ? returnThis : throwThis;\n    }\n    return ret._then(then, thrower, void 0, reasonOrValue, void 0);\n}\n\nfunction finallyHandler(reasonOrValue) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    var ret = promise._isBound()\n                    ? handler.call(promise._boundTo)\n                    : handler();\n\n    if (ret !== void 0) {\n        var maybePromise = cast(ret, void 0);\n        if (maybePromise instanceof Promise) {\n            return promisedFinally(maybePromise, reasonOrValue,\n                                    promise.isFulfilled());\n        }\n    }\n\n    if (promise.isRejected()) {\n        NEXT_FILTER.e = reasonOrValue;\n        return NEXT_FILTER;\n    } else {\n        return reasonOrValue;\n    }\n}\n\nfunction tapHandler(value) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    var ret = promise._isBound()\n                    ? handler.call(promise._boundTo, value)\n                    : handler(value);\n\n    if (ret !== void 0) {\n        var maybePromise = cast(ret, void 0);\n        if (maybePromise instanceof Promise) {\n            return promisedFinally(maybePromise, value, true);\n        }\n    }\n    return value;\n}\n\nPromise.prototype._passThroughHandler =\nfunction Promise$_passThroughHandler(handler, isFinally) {\n    if (typeof handler !== \"function\") return this.then();\n\n    var promiseAndHandler = {\n        promise: this,\n        handler: handler\n    };\n\n    return this._then(\n            isFinally ? finallyHandler : tapHandler,\n            isFinally ? finallyHandler : void 0, void 0,\n            promiseAndHandler, void 0);\n};\n\nPromise.prototype.lastly =\nPromise.prototype[\"finally\"] = function Promise$finally(handler) {\n    return this._passThroughHandler(handler, true);\n};\n\nPromise.prototype.tap = function Promise$tap(handler) {\n    return this._passThroughHandler(handler, false);\n};\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nvar util = require(\"./util.js\");\nvar isPrimitive = util.isPrimitive;\nvar wrapsPrimitiveReceiver = util.wrapsPrimitiveReceiver;\n\nmodule.exports = function(Promise) {\nvar returner = function Promise$_returner() {\n    return this;\n};\nvar thrower = function Promise$_thrower() {\n    throw this;\n};\n\nvar wrapper = function Promise$_wrapper(value, action) {\n    if (action === 1) {\n        return function Promise$_thrower() {\n            throw value;\n        };\n    } else if (action === 2) {\n        return function Promise$_returner() {\n            return value;\n        };\n    }\n};\n\n\nPromise.prototype[\"return\"] =\nPromise.prototype.thenReturn =\nfunction Promise$thenReturn(value) {\n    if (wrapsPrimitiveReceiver && isPrimitive(value)) {\n        return this._then(\n            wrapper(value, 2),\n            void 0,\n            void 0,\n            void 0,\n            void 0\n       );\n    }\n    return this._then(returner, void 0, void 0, value, void 0);\n};\n\nPromise.prototype[\"throw\"] =\nPromise.prototype.thenThrow =\nfunction Promise$thenThrow(reason) {\n    if (wrapsPrimitiveReceiver && isPrimitive(reason)) {\n        return this._then(\n            wrapper(reason, 1),\n            void 0,\n            void 0,\n            void 0,\n            void 0\n       );\n    }\n    return this._then(thrower, void 0, void 0, reason, void 0);\n};\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise) {\nfunction PromiseInspection(promise) {\n    if (promise !== void 0) {\n        this._bitField = promise._bitField;\n        this._settledValue = promise.isResolved()\n            ? promise._settledValue\n            : void 0;\n    }\n    else {\n        this._bitField = 0;\n        this._settledValue = void 0;\n    }\n}\n\nPromiseInspection.prototype.isFulfilled =\nPromise.prototype.isFulfilled = function Promise$isFulfilled() {\n    return (this._bitField & 268435456) > 0;\n};\n\nPromiseInspection.prototype.isRejected =\nPromise.prototype.isRejected = function Promise$isRejected() {\n    return (this._bitField & 134217728) > 0;\n};\n\nPromiseInspection.prototype.isPending =\nPromise.prototype.isPending = function Promise$isPending() {\n    return (this._bitField & 402653184) === 0;\n};\n\nPromiseInspection.prototype.value =\nPromise.prototype.value = function Promise$value() {\n    if (!this.isFulfilled()) {\n        throw new TypeError(\"cannot get fulfillment value of a non-fulfilled promise\");\n    }\n    return this._settledValue;\n};\n\nPromiseInspection.prototype.error =\nPromiseInspection.prototype.reason =\nPromise.prototype.reason = function Promise$reason() {\n    if (!this.isRejected()) {\n        throw new TypeError(\"cannot get rejection reason of a non-rejected promise\");\n    }\n    return this._settledValue;\n};\n\nPromiseInspection.prototype.isResolved =\nPromise.prototype.isResolved = function Promise$isResolved() {\n    return (this._bitField & 402653184) > 0;\n};\n\nPromise.PromiseInspection = PromiseInspection;\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports =\nfunction(Promise, PromiseArray, cast, INTERNAL) {\nvar util = require(\"./util.js\");\nvar canEvaluate = util.canEvaluate;\nvar tryCatch1 = util.tryCatch1;\nvar errorObj = util.errorObj;\n\n\nif (canEvaluate) {\n    var thenCallback = function(i) {\n        return new Function(\"value\", \"holder\", \"                             \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = value;                                           \\n\\\n            holder.checkFulfillment(this);                                   \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var caller = function(count) {\n        var values = [];\n        for (var i = 1; i <= count; ++i) values.push(\"holder.p\" + i);\n        return new Function(\"holder\", \"                                      \\n\\\n            'use strict';                                                    \\n\\\n            var callback = holder.fn;                                        \\n\\\n            return callback(values);                                         \\n\\\n            \".replace(/values/g, values.join(\", \")));\n    };\n    var thenCallbacks = [];\n    var callers = [void 0];\n    for (var i = 1; i <= 5; ++i) {\n        thenCallbacks.push(thenCallback(i));\n        callers.push(caller(i));\n    }\n\n    var Holder = function(total, fn) {\n        this.p1 = this.p2 = this.p3 = this.p4 = this.p5 = null;\n        this.fn = fn;\n        this.total = total;\n        this.now = 0;\n    };\n\n    Holder.prototype.callers = callers;\n    Holder.prototype.checkFulfillment = function(promise) {\n        var now = this.now;\n        now++;\n        var total = this.total;\n        if (now >= total) {\n            var handler = this.callers[total];\n            var ret = tryCatch1(handler, void 0, this);\n            if (ret === errorObj) {\n                promise._rejectUnchecked(ret.e);\n            } else if (!promise._tryFollow(ret)) {\n                promise._fulfillUnchecked(ret);\n            }\n        } else {\n            this.now = now;\n        }\n    };\n}\n\n\n\n\nPromise.join = function Promise$Join() {\n    var last = arguments.length - 1;\n    var fn;\n    if (last > 0 && typeof arguments[last] === \"function\") {\n        fn = arguments[last];\n        if (last < 6 && canEvaluate) {\n            var ret = new Promise(INTERNAL);\n            ret._setTrace(void 0);\n            var holder = new Holder(last, fn);\n            var reject = ret._reject;\n            var callbacks = thenCallbacks;\n            for (var i = 0; i < last; ++i) {\n                var maybePromise = cast(arguments[i], void 0);\n                if (maybePromise instanceof Promise) {\n                    if (maybePromise.isPending()) {\n                        maybePromise._then(callbacks[i], reject,\n                                           void 0, ret, holder);\n                    } else if (maybePromise.isFulfilled()) {\n                        callbacks[i].call(ret,\n                                          maybePromise._settledValue, holder);\n                    } else {\n                        ret._reject(maybePromise._settledValue);\n                        maybePromise._unsetRejectionIsUnhandled();\n                    }\n                } else {\n                    callbacks[i].call(ret, maybePromise, holder);\n                }\n            }\n            return ret;\n        }\n    }\n    var $_len = arguments.length;var args = new Array($_len); for(var $_i = 0; $_i < $_len; ++$_i) {args[$_i] = arguments[$_i];}\n    var ret = new PromiseArray(args).promise();\n    return fn !== void 0 ? ret.spread(fn) : ret;\n};\n\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nvar _setTimeout = function(fn, ms) {\n    var len = arguments.length;\n    var arg0 = arguments[2];\n    var arg1 = arguments[3];\n    var arg2 = len >= 5 ? arguments[4] : void 0;\n    setTimeout(function() {\n        fn(arg0, arg1, arg2);\n    }, ms|0);\n};\n\nmodule.exports = function(Promise, INTERNAL, cast) {\nvar util = require(\"./util.js\");\nvar errors = require(\"./errors.js\");\nvar apiRejection = require(\"./errors_api_rejection\")(Promise);\nvar TimeoutError = Promise.TimeoutError;\n\nvar afterTimeout = function Promise$_afterTimeout(promise, message, ms) {\n    if (!promise.isPending()) return;\n    if (typeof message !== \"string\") {\n        message = \"operation timed out after\" + \" \" + ms + \" ms\"\n    }\n    var err = new TimeoutError(message);\n    errors.markAsOriginatingFromRejection(err);\n    promise._attachExtraTrace(err);\n    promise._cancel(err);\n};\n\nvar afterDelay = function Promise$_afterDelay(value, promise) {\n    promise._fulfill(value);\n};\n\nvar delay = Promise.delay = function Promise$Delay(value, ms) {\n    if (ms === void 0) {\n        ms = value;\n        value = void 0;\n    }\n    ms = +ms;\n    var maybePromise = cast(value, void 0);\n    var promise = new Promise(INTERNAL);\n\n    if (maybePromise instanceof Promise) {\n        promise._propagateFrom(maybePromise, 7);\n        promise._follow(maybePromise);\n        return promise.then(function(value) {\n            return Promise.delay(value, ms);\n        });\n    } else {\n        promise._setTrace(void 0);\n        _setTimeout(afterDelay, ms, value, promise);\n    }\n    return promise;\n};\n\nPromise.prototype.delay = function Promise$delay(ms) {\n    return delay(this, ms);\n};\n\nPromise.prototype.timeout = function Promise$timeout(ms, message) {\n    ms = +ms;\n\n    var ret = new Promise(INTERNAL);\n    ret._propagateFrom(this, 7);\n    ret._follow(this);\n    _setTimeout(afterTimeout, ms, ret, message, ms);\n    return ret.cancellable();\n};\n\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL, cast) {\nvar apiRejection = require(\"./errors_api_rejection.js\")(Promise);\nvar isArray = require(\"./util.js\").isArray;\n\nvar raceLater = function Promise$_raceLater(promise) {\n    return promise.then(function(array) {\n        return Promise$_Race(array, promise);\n    });\n};\n\nvar hasOwn = {}.hasOwnProperty;\nfunction Promise$_Race(promises, parent) {\n    var maybePromise = cast(promises, void 0);\n\n    if (maybePromise instanceof Promise) {\n        return raceLater(maybePromise);\n    } else if (!isArray(promises)) {\n        return apiRejection(\"expecting an array, a promise or a thenable\");\n    }\n\n    var ret = new Promise(INTERNAL);\n    if (parent !== void 0) {\n        ret._propagateFrom(parent, 7);\n    } else {\n        ret._setTrace(void 0);\n    }\n    var fulfill = ret._fulfill;\n    var reject = ret._reject;\n    for (var i = 0, len = promises.length; i < len; ++i) {\n        var val = promises[i];\n\n        if (val === void 0 && !(hasOwn.call(promises, i))) {\n            continue;\n        }\n\n        Promise.cast(val)._then(fulfill, reject, void 0, ret, null);\n    }\n    return ret;\n}\n\nPromise.race = function Promise$Race(promises) {\n    return Promise$_Race(promises, void 0);\n};\n\nPromise.prototype.race = function Promise$race() {\n    return Promise$_Race(this, void 0);\n};\n\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nvar cr = Object.create;\nif (cr) {\n    var callerCache = cr(null);\n    var getterCache = cr(null);\n    callerCache[\" size\"] = getterCache[\" size\"] = 0;\n}\n\nmodule.exports = function(Promise) {\nvar util = require(\"./util.js\");\nvar canEvaluate = util.canEvaluate;\nvar isIdentifier = util.isIdentifier;\n\nfunction makeMethodCaller (methodName) {\n    return new Function(\"obj\", \"                                             \\n\\\n        'use strict'                                                         \\n\\\n        var len = this.length;                                               \\n\\\n        switch(len) {                                                        \\n\\\n            case 1: return obj.methodName(this[0]);                          \\n\\\n            case 2: return obj.methodName(this[0], this[1]);                 \\n\\\n            case 3: return obj.methodName(this[0], this[1], this[2]);        \\n\\\n            case 0: return obj.methodName();                                 \\n\\\n            default: return obj.methodName.apply(obj, this);                 \\n\\\n        }                                                                    \\n\\\n        \".replace(/methodName/g, methodName));\n}\n\nfunction makeGetter (propertyName) {\n    return new Function(\"obj\", \"                                             \\n\\\n        'use strict';                                                        \\n\\\n        return obj.propertyName;                                             \\n\\\n        \".replace(\"propertyName\", propertyName));\n}\n\nfunction getCompiled(name, compiler, cache) {\n    var ret = cache[name];\n    if (typeof ret !== \"function\") {\n        if (!isIdentifier(name)) {\n            return null;\n        }\n        ret = compiler(name);\n        cache[name] = ret;\n        cache[\" size\"]++;\n        if (cache[\" size\"] > 512) {\n            var keys = Object.keys(cache);\n            for (var i = 0; i < 256; ++i) delete cache[keys[i]];\n            cache[\" size\"] = keys.length - 256;\n        }\n    }\n    return ret;\n}\n\nfunction getMethodCaller(name) {\n    return getCompiled(name, makeMethodCaller, callerCache);\n}\n\nfunction getGetter(name) {\n    return getCompiled(name, makeGetter, getterCache);\n}\n\nfunction caller(obj) {\n    return obj[this.pop()].apply(obj, this);\n}\nPromise.prototype.call = function Promise$call(methodName) {\n    var $_len = arguments.length;var args = new Array($_len - 1); for(var $_i = 1; $_i < $_len; ++$_i) {args[$_i - 1] = arguments[$_i];}\n    if (canEvaluate) {\n        var maybeCaller = getMethodCaller(methodName);\n        if (maybeCaller !== null) {\n            return this._then(maybeCaller, void 0, void 0, args, void 0);\n        }\n    }\n    args.push(methodName);\n    return this._then(caller, void 0, void 0, args, void 0);\n};\n\nfunction namedGetter(obj) {\n    return obj[this];\n}\nfunction indexedGetter(obj) {\n    return obj[this];\n}\nPromise.prototype.get = function Promise$get(propertyName) {\n    var isIndex = (typeof propertyName === \"number\");\n    var getter;\n    if (!isIndex) {\n        if (canEvaluate) {\n            var maybeGetter = getGetter(propertyName);\n            getter = maybeGetter !== null ? maybeGetter : namedGetter;\n        } else {\n            getter = namedGetter;\n        }\n    } else {\n        getter = indexedGetter;\n    }\n    return this._then(getter, void 0, void 0, propertyName, void 0);\n};\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise, apiRejection, INTERNAL, cast) {\nvar errors = require(\"./errors.js\");\nvar TypeError = errors.TypeError;\nvar deprecated = require(\"./util.js\").deprecated;\nvar util = require(\"./util.js\");\nvar errorObj = util.errorObj;\nvar tryCatch1 = util.tryCatch1;\nvar yieldHandlers = [];\n\nfunction promiseFromYieldHandler(value, yieldHandlers) {\n    var _errorObj = errorObj;\n    var _Promise = Promise;\n    var len = yieldHandlers.length;\n    for (var i = 0; i < len; ++i) {\n        var result = tryCatch1(yieldHandlers[i], void 0, value);\n        if (result === _errorObj) {\n            return _Promise.reject(_errorObj.e);\n        }\n        var maybePromise = cast(result, promiseFromYieldHandler);\n        if (maybePromise instanceof _Promise) return maybePromise;\n    }\n    return null;\n}\n\nfunction PromiseSpawn(generatorFunction, receiver, yieldHandler) {\n    var promise = this._promise = new Promise(INTERNAL);\n    promise._setTrace(void 0);\n    this._generatorFunction = generatorFunction;\n    this._receiver = receiver;\n    this._generator = void 0;\n    this._yieldHandlers = typeof yieldHandler === \"function\"\n        ? [yieldHandler].concat(yieldHandlers)\n        : yieldHandlers;\n}\n\nPromiseSpawn.prototype.promise = function PromiseSpawn$promise() {\n    return this._promise;\n};\n\nPromiseSpawn.prototype._run = function PromiseSpawn$_run() {\n    this._generator = this._generatorFunction.call(this._receiver);\n    this._receiver =\n        this._generatorFunction = void 0;\n    this._next(void 0);\n};\n\nPromiseSpawn.prototype._continue = function PromiseSpawn$_continue(result) {\n    if (result === errorObj) {\n        this._generator = void 0;\n        var trace = errors.canAttach(result.e)\n            ? result.e : new Error(result.e + \"\");\n        this._promise._attachExtraTrace(trace);\n        this._promise._reject(result.e, trace);\n        return;\n    }\n\n    var value = result.value;\n    if (result.done === true) {\n        this._generator = void 0;\n        if (!this._promise._tryFollow(value)) {\n            this._promise._fulfill(value);\n        }\n    } else {\n        var maybePromise = cast(value, void 0);\n        if (!(maybePromise instanceof Promise)) {\n            maybePromise =\n                promiseFromYieldHandler(maybePromise, this._yieldHandlers);\n            if (maybePromise === null) {\n                this._throw(new TypeError(\"A value was yielded that could not be treated as a promise\"));\n                return;\n            }\n        }\n        maybePromise._then(\n            this._next,\n            this._throw,\n            void 0,\n            this,\n            null\n       );\n    }\n};\n\nPromiseSpawn.prototype._throw = function PromiseSpawn$_throw(reason) {\n    if (errors.canAttach(reason))\n        this._promise._attachExtraTrace(reason);\n    this._continue(\n        tryCatch1(this._generator[\"throw\"], this._generator, reason)\n   );\n};\n\nPromiseSpawn.prototype._next = function PromiseSpawn$_next(value) {\n    this._continue(\n        tryCatch1(this._generator.next, this._generator, value)\n   );\n};\n\nPromise.coroutine =\nfunction Promise$Coroutine(generatorFunction, options) {\n    if (typeof generatorFunction !== \"function\") {\n        throw new TypeError(\"generatorFunction must be a function\");\n    }\n    var yieldHandler = Object(options).yieldHandler;\n    var PromiseSpawn$ = PromiseSpawn;\n    return function () {\n        var generator = generatorFunction.apply(this, arguments);\n        var spawn = new PromiseSpawn$(void 0, void 0, yieldHandler);\n        spawn._generator = generator;\n        spawn._next(void 0);\n        return spawn.promise();\n    };\n};\n\nPromise.coroutine.addYieldHandler = function(fn) {\n    if (typeof fn !== \"function\") throw new TypeError(\"fn must be a function\");\n    yieldHandlers.push(fn);\n};\n\nPromise.spawn = function Promise$Spawn(generatorFunction) {\n    deprecated(\"Promise.spawn is deprecated. Use Promise.coroutine instead.\");\n    if (typeof generatorFunction !== \"function\") {\n        return apiRejection(\"generatorFunction must be a function\");\n    }\n    var spawn = new PromiseSpawn(generatorFunction, this);\n    var ret = spawn.promise();\n    spawn._run(Promise.spawn);\n    return ret;\n};\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise, PromiseArray, apiRejection, cast, INTERNAL) {\nvar util = require(\"./util.js\");\nvar tryCatch3 = util.tryCatch3;\nvar errorObj = util.errorObj;\nvar PENDING = {};\nvar EMPTY_ARRAY = [];\n\nfunction MappingPromiseArray(promises, fn, limit, _filter) {\n    this.constructor$(promises);\n    this._callback = fn;\n    this._preservedValues = _filter === INTERNAL\n        ? new Array(this.length())\n        : null;\n    this._limit = limit;\n    this._inFlight = 0;\n    this._queue = limit >= 1 ? [] : EMPTY_ARRAY;\n    this._init$(void 0, -2);\n}\nutil.inherits(MappingPromiseArray, PromiseArray);\n\nMappingPromiseArray.prototype._init = function MappingPromiseArray$_init() {};\n\nMappingPromiseArray.prototype._promiseFulfilled =\nfunction MappingPromiseArray$_promiseFulfilled(value, index) {\n    var values = this._values;\n    if (values === null) return;\n\n    var length = this.length();\n    var preservedValues = this._preservedValues;\n    var limit = this._limit;\n    if (values[index] === PENDING) {\n        values[index] = value;\n        if (limit >= 1) {\n            this._inFlight--;\n            this._drainQueue();\n            if (this._isResolved()) return;\n        }\n    } else {\n        if (limit >= 1 && this._inFlight >= limit) {\n            values[index] = value;\n            this._queue.push(index);\n            return;\n        }\n        if (preservedValues !== null) preservedValues[index] = value;\n\n        var callback = this._callback;\n        var receiver = this._promise._boundTo;\n        var ret = tryCatch3(callback, receiver, value, index, length);\n        if (ret === errorObj) return this._reject(ret.e);\n\n        var maybePromise = cast(ret, void 0);\n        if (maybePromise instanceof Promise) {\n            if (maybePromise.isPending()) {\n                if (limit >= 1) this._inFlight++;\n                values[index] = PENDING;\n                return maybePromise._proxyPromiseArray(this, index);\n            } else if (maybePromise.isFulfilled()) {\n                ret = maybePromise.value();\n            } else {\n                maybePromise._unsetRejectionIsUnhandled();\n                return this._reject(maybePromise.reason());\n            }\n        }\n        values[index] = ret;\n    }\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= length) {\n        if (preservedValues !== null) {\n            this._filter(values, preservedValues);\n        } else {\n            this._resolve(values);\n        }\n\n    }\n};\n\nMappingPromiseArray.prototype._drainQueue =\nfunction MappingPromiseArray$_drainQueue() {\n    var queue = this._queue;\n    var limit = this._limit;\n    var values = this._values;\n    while (queue.length > 0 && this._inFlight < limit) {\n        var index = queue.pop();\n        this._promiseFulfilled(values[index], index);\n    }\n};\n\nMappingPromiseArray.prototype._filter =\nfunction MappingPromiseArray$_filter(booleans, values) {\n    var len = values.length;\n    var ret = new Array(len);\n    var j = 0;\n    for (var i = 0; i < len; ++i) {\n        if (booleans[i]) ret[j++] = values[i];\n    }\n    ret.length = j;\n    this._resolve(ret);\n};\n\nMappingPromiseArray.prototype.preservedValues =\nfunction MappingPromiseArray$preserveValues() {\n    return this._preservedValues;\n};\n\nfunction map(promises, fn, options, _filter) {\n    var limit = typeof options === \"object\" && options !== null\n        ? options.concurrency\n        : 0;\n    limit = typeof limit === \"number\" &&\n        isFinite(limit) && limit >= 1 ? limit : 0;\n    return new MappingPromiseArray(promises, fn, limit, _filter);\n}\n\nPromise.prototype.map = function Promise$map(fn, options) {\n    if (typeof fn !== \"function\") return apiRejection(\"fn must be a function\");\n\n    return map(this, fn, options, null).promise();\n};\n\nPromise.map = function Promise$Map(promises, fn, options, _filter) {\n    if (typeof fn !== \"function\") return apiRejection(\"fn must be a function\");\n    return map(promises, fn, options, _filter).promise();\n};\n\n\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise) {\nvar util = require(\"./util.js\");\nvar async = require(\"./async.js\");\nvar tryCatch2 = util.tryCatch2;\nvar tryCatch1 = util.tryCatch1;\nvar errorObj = util.errorObj;\n\nfunction thrower(r) {\n    throw r;\n}\n\nfunction Promise$_spreadAdapter(val, receiver) {\n    if (!util.isArray(val)) return Promise$_successAdapter(val, receiver);\n    var ret = util.tryCatchApply(this, [null].concat(val), receiver);\n    if (ret === errorObj) {\n        async.invokeLater(thrower, void 0, ret.e);\n    }\n}\n\nfunction Promise$_successAdapter(val, receiver) {\n    var nodeback = this;\n    var ret = val === void 0\n        ? tryCatch1(nodeback, receiver, null)\n        : tryCatch2(nodeback, receiver, null, val);\n    if (ret === errorObj) {\n        async.invokeLater(thrower, void 0, ret.e);\n    }\n}\nfunction Promise$_errorAdapter(reason, receiver) {\n    var nodeback = this;\n    var ret = tryCatch1(nodeback, receiver, reason);\n    if (ret === errorObj) {\n        async.invokeLater(thrower, void 0, ret.e);\n    }\n}\n\nPromise.prototype.nodeify = function Promise$nodeify(nodeback, options) {\n    if (typeof nodeback == \"function\") {\n        var adapter = Promise$_successAdapter;\n        if (options !== void 0 && Object(options).spread) {\n            adapter = Promise$_spreadAdapter;\n        }\n        this._then(\n            adapter,\n            Promise$_errorAdapter,\n            void 0,\n            nodeback,\n            this._boundTo\n        );\n    }\n    return this;\n};\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar THIS = {};\nvar util = require(\"./util.js\");\nvar nodebackForPromise = require(\"./promise_resolver.js\")\n    ._nodebackForPromise;\nvar withAppended = util.withAppended;\nvar maybeWrapAsError = util.maybeWrapAsError;\nvar canEvaluate = util.canEvaluate;\nvar TypeError = require(\"./errors\").TypeError;\nvar defaultSuffix = \"Async\";\nvar defaultFilter = function(name, func) {\n    return util.isIdentifier(name) &&\n        name.charAt(0) !== \"_\" &&\n        !util.isClass(func);\n};\nvar defaultPromisified = {__isPromisified__: true};\n\n\nfunction escapeIdentRegex(str) {\n    return str.replace(/([$])/, \"\\\\$\");\n}\n\nfunction isPromisified(fn) {\n    try {\n        return fn.__isPromisified__ === true;\n    }\n    catch (e) {\n        return false;\n    }\n}\n\nfunction hasPromisified(obj, key, suffix) {\n    var val = util.getDataPropertyOrDefault(obj, key + suffix,\n                                            defaultPromisified);\n    return val ? isPromisified(val) : false;\n}\nfunction checkValid(ret, suffix, suffixRegexp) {\n    for (var i = 0; i < ret.length; i += 2) {\n        var key = ret[i];\n        if (suffixRegexp.test(key)) {\n            var keyWithoutAsyncSuffix = key.replace(suffixRegexp, \"\");\n            for (var j = 0; j < ret.length; j += 2) {\n                if (ret[j] === keyWithoutAsyncSuffix) {\n                    throw new TypeError(\"Cannot promisify an API \" +\n                        \"that has normal methods with '\"+suffix+\"'-suffix\");\n                }\n            }\n        }\n    }\n}\n\nfunction promisifiableMethods(obj, suffix, suffixRegexp, filter) {\n    var keys = util.inheritedDataKeys(obj);\n    var ret = [];\n    for (var i = 0; i < keys.length; ++i) {\n        var key = keys[i];\n        var value = obj[key];\n        if (typeof value === \"function\" &&\n            !isPromisified(value) &&\n            !hasPromisified(obj, key, suffix) &&\n            filter(key, value, obj)) {\n            ret.push(key, value);\n        }\n    }\n    checkValid(ret, suffix, suffixRegexp);\n    return ret;\n}\n\nfunction switchCaseArgumentOrder(likelyArgumentCount) {\n    var ret = [likelyArgumentCount];\n    var min = Math.max(0, likelyArgumentCount - 1 - 5);\n    for(var i = likelyArgumentCount - 1; i >= min; --i) {\n        if (i === likelyArgumentCount) continue;\n        ret.push(i);\n    }\n    for(var i = likelyArgumentCount + 1; i <= 5; ++i) {\n        ret.push(i);\n    }\n    return ret;\n}\n\nfunction argumentSequence(argumentCount) {\n    return util.filledRange(argumentCount, \"arguments[\", \"]\");\n}\n\nfunction parameterDeclaration(parameterCount) {\n    return util.filledRange(parameterCount, \"_arg\", \"\");\n}\n\nfunction parameterCount(fn) {\n    if (typeof fn.length === \"number\") {\n        return Math.max(Math.min(fn.length, 1023 + 1), 0);\n    }\n    return 0;\n}\n\nfunction generatePropertyAccess(key) {\n    if (util.isIdentifier(key)) {\n        return \".\" + key;\n    }\n    else return \"['\" + key.replace(/(['\\\\])/g, \"\\\\$1\") + \"']\";\n}\n\nfunction makeNodePromisifiedEval(callback, receiver, originalName, fn, suffix) {\n    var newParameterCount = Math.max(0, parameterCount(fn) - 1);\n    var argumentOrder = switchCaseArgumentOrder(newParameterCount);\n    var callbackName =\n        (typeof originalName === \"string\" && util.isIdentifier(originalName)\n            ? originalName + suffix\n            : \"promisified\");\n\n    function generateCallForArgumentCount(count) {\n        var args = argumentSequence(count).join(\", \");\n        var comma = count > 0 ? \", \" : \"\";\n        var ret;\n        if (typeof callback === \"string\") {\n            ret = \"                                                          \\n\\\n                this.method(args, fn);                                       \\n\\\n                break;                                                       \\n\\\n            \".replace(\".method\", generatePropertyAccess(callback));\n        } else if (receiver === THIS) {\n            ret =  \"                                                         \\n\\\n                callback.call(this, args, fn);                               \\n\\\n                break;                                                       \\n\\\n            \";\n        } else if (receiver !== void 0) {\n            ret =  \"                                                         \\n\\\n                callback.call(receiver, args, fn);                           \\n\\\n                break;                                                       \\n\\\n            \";\n        } else {\n            ret =  \"                                                         \\n\\\n                callback(args, fn);                                          \\n\\\n                break;                                                       \\n\\\n            \";\n        }\n        return ret.replace(\"args\", args).replace(\", \", comma);\n    }\n\n    function generateArgumentSwitchCase() {\n        var ret = \"\";\n        for(var i = 0; i < argumentOrder.length; ++i) {\n            ret += \"case \" + argumentOrder[i] +\":\" +\n                generateCallForArgumentCount(argumentOrder[i]);\n        }\n        var codeForCall;\n        if (typeof callback === \"string\") {\n            codeForCall = \"                                                  \\n\\\n                this.property.apply(this, args);                             \\n\\\n            \"\n                .replace(\".property\", generatePropertyAccess(callback));\n        } else if (receiver === THIS) {\n            codeForCall = \"                                                  \\n\\\n                callback.apply(this, args);                                  \\n\\\n            \";\n        } else {\n            codeForCall = \"                                                  \\n\\\n                callback.apply(receiver, args);                              \\n\\\n            \";\n        }\n\n        ret += \"                                                             \\n\\\n        default:                                                             \\n\\\n            var args = new Array(len + 1);                                   \\n\\\n            var i = 0;                                                       \\n\\\n            for (var i = 0; i < len; ++i) {                                  \\n\\\n               args[i] = arguments[i];                                       \\n\\\n            }                                                                \\n\\\n            args[i] = fn;                                                    \\n\\\n            [CodeForCall]                                                    \\n\\\n            break;                                                           \\n\\\n        \".replace(\"[CodeForCall]\", codeForCall);\n        return ret;\n    }\n\n    return new Function(\"Promise\",\n                        \"callback\",\n                        \"receiver\",\n                        \"withAppended\",\n                        \"maybeWrapAsError\",\n                        \"nodebackForPromise\",\n                        \"INTERNAL\",\"                                         \\n\\\n        var ret = function FunctionName(Parameters) {                        \\n\\\n            'use strict';                                                    \\n\\\n            var len = arguments.length;                                      \\n\\\n            var promise = new Promise(INTERNAL);                             \\n\\\n            promise._setTrace(void 0);                                       \\n\\\n            var fn = nodebackForPromise(promise);                            \\n\\\n            try {                                                            \\n\\\n                switch(len) {                                                \\n\\\n                    [CodeForSwitchCase]                                      \\n\\\n                }                                                            \\n\\\n            } catch (e) {                                                    \\n\\\n                var wrapped = maybeWrapAsError(e);                           \\n\\\n                promise._attachExtraTrace(wrapped);                          \\n\\\n                promise._reject(wrapped);                                    \\n\\\n            }                                                                \\n\\\n            return promise;                                                  \\n\\\n        };                                                                   \\n\\\n        ret.__isPromisified__ = true;                                        \\n\\\n        return ret;                                                          \\n\\\n        \"\n        .replace(\"FunctionName\", callbackName)\n        .replace(\"Parameters\", parameterDeclaration(newParameterCount))\n        .replace(\"[CodeForSwitchCase]\", generateArgumentSwitchCase()))(\n            Promise,\n            callback,\n            receiver,\n            withAppended,\n            maybeWrapAsError,\n            nodebackForPromise,\n            INTERNAL\n        );\n}\n\nfunction makeNodePromisifiedClosure(callback, receiver) {\n    function promisified() {\n        var _receiver = receiver;\n        if (receiver === THIS) _receiver = this;\n        if (typeof callback === \"string\") {\n            callback = _receiver[callback];\n        }\n        var promise = new Promise(INTERNAL);\n        promise._setTrace(void 0);\n        var fn = nodebackForPromise(promise);\n        try {\n            callback.apply(_receiver, withAppended(arguments, fn));\n        } catch(e) {\n            var wrapped = maybeWrapAsError(e);\n            promise._attachExtraTrace(wrapped);\n            promise._reject(wrapped);\n        }\n        return promise;\n    }\n    promisified.__isPromisified__ = true;\n    return promisified;\n}\n\nvar makeNodePromisified = canEvaluate\n    ? makeNodePromisifiedEval\n    : makeNodePromisifiedClosure;\n\nfunction promisifyAll(obj, suffix, filter, promisifier) {\n    var suffixRegexp = new RegExp(escapeIdentRegex(suffix) + \"$\");\n    var methods =\n        promisifiableMethods(obj, suffix, suffixRegexp, filter);\n\n    for (var i = 0, len = methods.length; i < len; i+= 2) {\n        var key = methods[i];\n        var fn = methods[i+1];\n        var promisifiedKey = key + suffix;\n        obj[promisifiedKey] = promisifier === makeNodePromisified\n                ? makeNodePromisified(key, THIS, key, fn, suffix)\n                : promisifier(fn);\n    }\n    util.toFastProperties(obj);\n    return obj;\n}\n\nfunction promisify(callback, receiver) {\n    return makeNodePromisified(callback, receiver, void 0, callback);\n}\n\nPromise.promisify = function Promise$Promisify(fn, receiver) {\n    if (typeof fn !== \"function\") {\n        throw new TypeError(\"fn must be a function\");\n    }\n    if (isPromisified(fn)) {\n        return fn;\n    }\n    return promisify(fn, arguments.length < 2 ? THIS : receiver);\n};\n\nPromise.promisifyAll = function Promise$PromisifyAll(target, options) {\n    if (typeof target !== \"function\" && typeof target !== \"object\") {\n        throw new TypeError(\"the target of promisifyAll must be an object or a function\");\n    }\n    options = Object(options);\n    var suffix = options.suffix;\n    if (typeof suffix !== \"string\") suffix = defaultSuffix;\n    var filter = options.filter;\n    if (typeof filter !== \"function\") filter = defaultFilter;\n    var promisifier = options.promisifier;\n    if (typeof promisifier !== \"function\") promisifier = makeNodePromisified;\n\n    if (!util.isIdentifier(suffix)) {\n        throw new RangeError(\"suffix must be a valid identifier\");\n    }\n\n    var keys = util.inheritedDataKeys(target, {includeHidden: true});\n    for (var i = 0; i < keys.length; ++i) {\n        var value = target[keys[i]];\n        if (keys[i] !== \"constructor\" &&\n            util.isClass(value)) {\n            promisifyAll(value.prototype, suffix, filter, promisifier);\n            promisifyAll(value, suffix, filter, promisifier);\n        }\n    }\n\n    return promisifyAll(target, suffix, filter, promisifier);\n};\n};\n\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise, PromiseArray, cast) {\nvar util = require(\"./util.js\");\nvar apiRejection = require(\"./errors_api_rejection\")(Promise);\nvar isObject = util.isObject;\nvar es5 = require(\"./es5.js\");\n\nfunction PropertiesPromiseArray(obj) {\n    var keys = es5.keys(obj);\n    var len = keys.length;\n    var values = new Array(len * 2);\n    for (var i = 0; i < len; ++i) {\n        var key = keys[i];\n        values[i] = obj[key];\n        values[i + len] = key;\n    }\n    this.constructor$(values);\n}\nutil.inherits(PropertiesPromiseArray, PromiseArray);\n\nPropertiesPromiseArray.prototype._init =\nfunction PropertiesPromiseArray$_init() {\n    this._init$(void 0, -3) ;\n};\n\nPropertiesPromiseArray.prototype._promiseFulfilled =\nfunction PropertiesPromiseArray$_promiseFulfilled(value, index) {\n    if (this._isResolved()) return;\n    this._values[index] = value;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        var val = {};\n        var keyOffset = this.length();\n        for (var i = 0, len = this.length(); i < len; ++i) {\n            val[this._values[i + keyOffset]] = this._values[i];\n        }\n        this._resolve(val);\n    }\n};\n\nPropertiesPromiseArray.prototype._promiseProgressed =\nfunction PropertiesPromiseArray$_promiseProgressed(value, index) {\n    if (this._isResolved()) return;\n\n    this._promise._progress({\n        key: this._values[index + this.length()],\n        value: value\n    });\n};\n\nPropertiesPromiseArray.prototype.shouldCopyValues =\nfunction PropertiesPromiseArray$_shouldCopyValues() {\n    return false;\n};\n\nPropertiesPromiseArray.prototype.getActualLength =\nfunction PropertiesPromiseArray$getActualLength(len) {\n    return len >> 1;\n};\n\nfunction Promise$_Props(promises) {\n    var ret;\n    var castValue = cast(promises, void 0);\n\n    if (!isObject(castValue)) {\n        return apiRejection(\"cannot await properties of a non-object\");\n    } else if (castValue instanceof Promise) {\n        ret = castValue._then(Promise.props, void 0, void 0, void 0, void 0);\n    } else {\n        ret = new PropertiesPromiseArray(castValue).promise();\n    }\n\n    if (castValue instanceof Promise) {\n        ret._propagateFrom(castValue, 4);\n    }\n    return ret;\n}\n\nPromise.prototype.props = function Promise$props() {\n    return Promise$_Props(this);\n};\n\nPromise.props = function Promise$Props(promises) {\n    return Promise$_Props(promises);\n};\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise, PromiseArray, apiRejection, cast, INTERNAL) {\nvar util = require(\"./util.js\");\nvar tryCatch4 = util.tryCatch4;\nvar tryCatch3 = util.tryCatch3;\nvar errorObj = util.errorObj;\nfunction ReductionPromiseArray(promises, fn, accum, _each) {\n    this.constructor$(promises);\n    this._preservedValues = _each === INTERNAL ? [] : null;\n    this._zerothIsAccum = (accum === void 0);\n    this._gotAccum = false;\n    this._reducingIndex = (this._zerothIsAccum ? 1 : 0);\n    this._valuesPhase = undefined;\n\n    var maybePromise = cast(accum, void 0);\n    var rejected = false;\n    var isPromise = maybePromise instanceof Promise;\n    if (isPromise) {\n        if (maybePromise.isPending()) {\n            maybePromise._proxyPromiseArray(this, -1);\n        } else if (maybePromise.isFulfilled()) {\n            accum = maybePromise.value();\n            this._gotAccum = true;\n        } else {\n            maybePromise._unsetRejectionIsUnhandled();\n            this._reject(maybePromise.reason());\n            rejected = true;\n        }\n    }\n    if (!(isPromise || this._zerothIsAccum)) this._gotAccum = true;\n    this._callback = fn;\n    this._accum = accum;\n    if (!rejected) this._init$(void 0, -5);\n}\nutil.inherits(ReductionPromiseArray, PromiseArray);\n\nReductionPromiseArray.prototype._init =\nfunction ReductionPromiseArray$_init() {};\n\nReductionPromiseArray.prototype._resolveEmptyArray =\nfunction ReductionPromiseArray$_resolveEmptyArray() {\n    if (this._gotAccum || this._zerothIsAccum) {\n        this._resolve(this._preservedValues !== null\n                        ? [] : this._accum);\n    }\n};\n\nReductionPromiseArray.prototype._promiseFulfilled =\nfunction ReductionPromiseArray$_promiseFulfilled(value, index) {\n    var values = this._values;\n    if (values === null) return;\n    var length = this.length();\n    var preservedValues = this._preservedValues;\n    var isEach = preservedValues !== null;\n    var gotAccum = this._gotAccum;\n    var valuesPhase = this._valuesPhase;\n    var valuesPhaseIndex;\n    if (!valuesPhase) {\n        valuesPhase = this._valuesPhase = Array(length);\n        for (valuesPhaseIndex=0; valuesPhaseIndex<length; ++valuesPhaseIndex) {\n            valuesPhase[valuesPhaseIndex] = 0;\n        }\n    }\n    valuesPhaseIndex = valuesPhase[index];\n\n    if (index === 0 && this._zerothIsAccum) {\n        if (!gotAccum) {\n            this._accum = value;\n            this._gotAccum = gotAccum = true;\n        }\n        valuesPhase[index] = ((valuesPhaseIndex === 0)\n            ? 1 : 2);\n    } else if (index === -1) {\n        if (!gotAccum) {\n            this._accum = value;\n            this._gotAccum = gotAccum = true;\n        }\n    } else {\n        if (valuesPhaseIndex === 0) {\n            valuesPhase[index] = 1;\n        }\n        else {\n            valuesPhase[index] = 2;\n            if (gotAccum) {\n                this._accum = value;\n            }\n        }\n    }\n    if (!gotAccum) return;\n\n    var callback = this._callback;\n    var receiver = this._promise._boundTo;\n    var ret;\n\n    for (var i = this._reducingIndex; i < length; ++i) {\n        valuesPhaseIndex = valuesPhase[i];\n        if (valuesPhaseIndex === 2) {\n            this._reducingIndex = i + 1;\n            continue;\n        }\n        if (valuesPhaseIndex !== 1) return;\n\n        value = values[i];\n        if (value instanceof Promise) {\n            if (value.isFulfilled()) {\n                value = value._settledValue;\n            } else if (value.isPending()) {\n                return;\n            } else {\n                value._unsetRejectionIsUnhandled();\n                return this._reject(value.reason());\n            }\n        }\n\n        if (isEach) {\n            preservedValues.push(value);\n            ret = tryCatch3(callback, receiver, value, i, length);\n        }\n        else {\n            ret = tryCatch4(callback, receiver, this._accum, value, i, length);\n        }\n\n        if (ret === errorObj) return this._reject(ret.e);\n\n        var maybePromise = cast(ret, void 0);\n        if (maybePromise instanceof Promise) {\n            if (maybePromise.isPending()) {\n                valuesPhase[i] = 4;\n                return maybePromise._proxyPromiseArray(this, i);\n            } else if (maybePromise.isFulfilled()) {\n                ret = maybePromise.value();\n            } else {\n                maybePromise._unsetRejectionIsUnhandled();\n                return this._reject(maybePromise.reason());\n            }\n        }\n\n        this._reducingIndex = i + 1;\n        this._accum = ret;\n    }\n\n    if (this._reducingIndex < length) return;\n    this._resolve(isEach ? preservedValues : this._accum);\n};\n\nfunction reduce(promises, fn, initialValue, _each) {\n    if (typeof fn !== \"function\") return apiRejection(\"fn must be a function\");\n    var array = new ReductionPromiseArray(promises, fn, initialValue, _each);\n    return array.promise();\n}\n\nPromise.prototype.reduce = function Promise$reduce(fn, initialValue) {\n    return reduce(this, fn, initialValue, null);\n};\n\nPromise.reduce = function Promise$Reduce(promises, fn, initialValue, _each) {\n    return reduce(promises, fn, initialValue, _each);\n};\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports =\n    function(Promise, PromiseArray) {\nvar PromiseInspection = Promise.PromiseInspection;\nvar util = require(\"./util.js\");\n\nfunction SettledPromiseArray(values) {\n    this.constructor$(values);\n}\nutil.inherits(SettledPromiseArray, PromiseArray);\n\nSettledPromiseArray.prototype._promiseResolved =\nfunction SettledPromiseArray$_promiseResolved(index, inspection) {\n    this._values[index] = inspection;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        this._resolve(this._values);\n    }\n};\n\nSettledPromiseArray.prototype._promiseFulfilled =\nfunction SettledPromiseArray$_promiseFulfilled(value, index) {\n    if (this._isResolved()) return;\n    var ret = new PromiseInspection();\n    ret._bitField = 268435456;\n    ret._settledValue = value;\n    this._promiseResolved(index, ret);\n};\nSettledPromiseArray.prototype._promiseRejected =\nfunction SettledPromiseArray$_promiseRejected(reason, index) {\n    if (this._isResolved()) return;\n    var ret = new PromiseInspection();\n    ret._bitField = 134217728;\n    ret._settledValue = reason;\n    this._promiseResolved(index, ret);\n};\n\nPromise.settle = function Promise$Settle(promises) {\n    return new SettledPromiseArray(promises).promise();\n};\n\nPromise.prototype.settle = function Promise$settle() {\n    return new SettledPromiseArray(this).promise();\n};\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports =\nfunction(Promise, PromiseArray, apiRejection) {\nvar util = require(\"./util.js\");\nvar RangeError = require(\"./errors.js\").RangeError;\nvar AggregateError = require(\"./errors.js\").AggregateError;\nvar isArray = util.isArray;\n\n\nfunction SomePromiseArray(values) {\n    this.constructor$(values);\n    this._howMany = 0;\n    this._unwrap = false;\n    this._initialized = false;\n}\nutil.inherits(SomePromiseArray, PromiseArray);\n\nSomePromiseArray.prototype._init = function SomePromiseArray$_init() {\n    if (!this._initialized) {\n        return;\n    }\n    if (this._howMany === 0) {\n        this._resolve([]);\n        return;\n    }\n    this._init$(void 0, -5);\n    var isArrayResolved = isArray(this._values);\n    if (!this._isResolved() &&\n        isArrayResolved &&\n        this._howMany > this._canPossiblyFulfill()) {\n        this._reject(this._getRangeError(this.length()));\n    }\n};\n\nSomePromiseArray.prototype.init = function SomePromiseArray$init() {\n    this._initialized = true;\n    this._init();\n};\n\nSomePromiseArray.prototype.setUnwrap = function SomePromiseArray$setUnwrap() {\n    this._unwrap = true;\n};\n\nSomePromiseArray.prototype.howMany = function SomePromiseArray$howMany() {\n    return this._howMany;\n};\n\nSomePromiseArray.prototype.setHowMany =\nfunction SomePromiseArray$setHowMany(count) {\n    if (this._isResolved()) return;\n    this._howMany = count;\n};\n\nSomePromiseArray.prototype._promiseFulfilled =\nfunction SomePromiseArray$_promiseFulfilled(value) {\n    if (this._isResolved()) return;\n    this._addFulfilled(value);\n    if (this._fulfilled() === this.howMany()) {\n        this._values.length = this.howMany();\n        if (this.howMany() === 1 && this._unwrap) {\n            this._resolve(this._values[0]);\n        } else {\n            this._resolve(this._values);\n        }\n    }\n\n};\nSomePromiseArray.prototype._promiseRejected =\nfunction SomePromiseArray$_promiseRejected(reason) {\n    if (this._isResolved()) return;\n    this._addRejected(reason);\n    if (this.howMany() > this._canPossiblyFulfill()) {\n        var e = new AggregateError();\n        for (var i = this.length(); i < this._values.length; ++i) {\n            e.push(this._values[i]);\n        }\n        this._reject(e);\n    }\n};\n\nSomePromiseArray.prototype._fulfilled = function SomePromiseArray$_fulfilled() {\n    return this._totalResolved;\n};\n\nSomePromiseArray.prototype._rejected = function SomePromiseArray$_rejected() {\n    return this._values.length - this.length();\n};\n\nSomePromiseArray.prototype._addRejected =\nfunction SomePromiseArray$_addRejected(reason) {\n    this._values.push(reason);\n};\n\nSomePromiseArray.prototype._addFulfilled =\nfunction SomePromiseArray$_addFulfilled(value) {\n    this._values[this._totalResolved++] = value;\n};\n\nSomePromiseArray.prototype._canPossiblyFulfill =\nfunction SomePromiseArray$_canPossiblyFulfill() {\n    return this.length() - this._rejected();\n};\n\nSomePromiseArray.prototype._getRangeError =\nfunction SomePromiseArray$_getRangeError(count) {\n    var message = \"Input array must contain at least \" +\n            this._howMany + \" items but contains only \" + count + \" items\";\n    return new RangeError(message);\n};\n\nSomePromiseArray.prototype._resolveEmptyArray =\nfunction SomePromiseArray$_resolveEmptyArray() {\n    this._reject(this._getRangeError(0));\n};\n\nfunction Promise$_Some(promises, howMany) {\n    if ((howMany | 0) !== howMany || howMany < 0) {\n        return apiRejection(\"expecting a positive integer\");\n    }\n    var ret = new SomePromiseArray(promises);\n    var promise = ret.promise();\n    if (promise.isRejected()) {\n        return promise;\n    }\n    ret.setHowMany(howMany);\n    ret.init();\n    return promise;\n}\n\nPromise.some = function Promise$Some(promises, howMany) {\n    return Promise$_Some(promises, howMany);\n};\n\nPromise.prototype.some = function Promise$some(howMany) {\n    return Promise$_Some(this, howMany);\n};\n\nPromise._SomePromiseArray = SomePromiseArray;\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise, PromiseArray) {\nvar util = require(\"./util.js\");\nvar async = require(\"./async.js\");\nvar errors = require(\"./errors.js\");\nvar tryCatch1 = util.tryCatch1;\nvar errorObj = util.errorObj;\n\nPromise.prototype.progressed = function Promise$progressed(handler) {\n    return this._then(void 0, void 0, handler, void 0, void 0);\n};\n\nPromise.prototype._progress = function Promise$_progress(progressValue) {\n    if (this._isFollowingOrFulfilledOrRejected()) return;\n    this._progressUnchecked(progressValue);\n\n};\n\nPromise.prototype._clearFirstHandlerData$Base =\nPromise.prototype._clearFirstHandlerData;\nPromise.prototype._clearFirstHandlerData =\nfunction Promise$_clearFirstHandlerData() {\n    this._clearFirstHandlerData$Base();\n    this._progressHandler0 = void 0;\n};\n\nPromise.prototype._progressHandlerAt =\nfunction Promise$_progressHandlerAt(index) {\n    return index === 0\n        ? this._progressHandler0\n        : this[(index << 2) + index - 5 + 2];\n};\n\nPromise.prototype._doProgressWith =\nfunction Promise$_doProgressWith(progression) {\n    var progressValue = progression.value;\n    var handler = progression.handler;\n    var promise = progression.promise;\n    var receiver = progression.receiver;\n\n    var ret = tryCatch1(handler, receiver, progressValue);\n    if (ret === errorObj) {\n        if (ret.e != null &&\n            ret.e.name !== \"StopProgressPropagation\") {\n            var trace = errors.canAttach(ret.e)\n                ? ret.e : new Error(ret.e + \"\");\n            promise._attachExtraTrace(trace);\n            promise._progress(ret.e);\n        }\n    } else if (ret instanceof Promise) {\n        ret._then(promise._progress, null, null, promise, void 0);\n    } else {\n        promise._progress(ret);\n    }\n};\n\n\nPromise.prototype._progressUnchecked =\nfunction Promise$_progressUnchecked(progressValue) {\n    if (!this.isPending()) return;\n    var len = this._length();\n    var progress = this._progress;\n    for (var i = 0; i < len; i++) {\n        var handler = this._progressHandlerAt(i);\n        var promise = this._promiseAt(i);\n        if (!(promise instanceof Promise)) {\n            var receiver = this._receiverAt(i);\n            if (typeof handler === \"function\") {\n                handler.call(receiver, progressValue, promise);\n            } else if (receiver instanceof Promise && receiver._isProxied()) {\n                receiver._progressUnchecked(progressValue);\n            } else if (receiver instanceof PromiseArray) {\n                receiver._promiseProgressed(progressValue, promise);\n            }\n            continue;\n        }\n\n        if (typeof handler === \"function\") {\n            async.invoke(this._doProgressWith, this, {\n                handler: handler,\n                promise: promise,\n                receiver: this._receiverAt(i),\n                value: progressValue\n            });\n        } else {\n            async.invoke(progress, promise, progressValue);\n        }\n    }\n};\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar errors = require(\"./errors.js\");\nvar canAttach = errors.canAttach;\nvar async = require(\"./async.js\");\nvar CancellationError = errors.CancellationError;\n\nPromise.prototype._cancel = function Promise$_cancel(reason) {\n    if (!this.isCancellable()) return this;\n    var parent;\n    var promiseToReject = this;\n    while ((parent = promiseToReject._cancellationParent) !== void 0 &&\n        parent.isCancellable()) {\n        promiseToReject = parent;\n    }\n    promiseToReject._attachExtraTrace(reason);\n    promiseToReject._rejectUnchecked(reason);\n};\n\nPromise.prototype.cancel = function Promise$cancel(reason) {\n    if (!this.isCancellable()) return this;\n    reason = reason !== void 0\n        ? (canAttach(reason) ? reason : new Error(reason + \"\"))\n        : new CancellationError();\n    async.invokeLater(this._cancel, this, reason);\n    return this;\n};\n\nPromise.prototype.cancellable = function Promise$cancellable() {\n    if (this._cancellable()) return this;\n    this._setCancellable();\n    this._cancellationParent = void 0;\n    return this;\n};\n\nPromise.prototype.uncancellable = function Promise$uncancellable() {\n    var ret = new Promise(INTERNAL);\n    ret._propagateFrom(this, 2 | 4);\n    ret._follow(this);\n    ret._unsetCancellable();\n    return ret;\n};\n\nPromise.prototype.fork =\nfunction Promise$fork(didFulfill, didReject, didProgress) {\n    var ret = this._then(didFulfill, didReject, didProgress,\n                         void 0, void 0);\n\n    ret._setCancellable();\n    ret._cancellationParent = void 0;\n    return ret;\n};\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar PromiseMap = Promise.map;\n\nPromise.prototype.filter = function Promise$filter(fn, options) {\n    return PromiseMap(this, fn, options, INTERNAL);\n};\n\nPromise.filter = function Promise$Filter(promises, fn, options) {\n    return PromiseMap(promises, fn, options, INTERNAL);\n};\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise) {\nvar SomePromiseArray = Promise._SomePromiseArray;\nfunction Promise$_Any(promises) {\n    var ret = new SomePromiseArray(promises);\n    var promise = ret.promise();\n    if (promise.isRejected()) {\n        return promise;\n    }\n    ret.setHowMany(1);\n    ret.setUnwrap();\n    ret.init();\n    return promise;\n}\n\nPromise.any = function Promise$Any(promises) {\n    return Promise$_Any(promises);\n};\n\nPromise.prototype.any = function Promise$any() {\n    return Promise$_Any(this);\n};\n\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar PromiseReduce = Promise.reduce;\n\nPromise.prototype.each = function Promise$each(fn) {\n    return PromiseReduce(this, fn, null, INTERNAL);\n};\n\nPromise.each = function Promise$Each(promises, fn) {\n    return PromiseReduce(promises, fn, null, INTERNAL);\n};\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function (Promise, apiRejection, cast) {\n    var TypeError = require(\"./errors.js\").TypeError;\n    var inherits = require(\"./util.js\").inherits;\n    var PromiseInspection = Promise.PromiseInspection;\n\n    function inspectionMapper(inspections) {\n        var len = inspections.length;\n        for (var i = 0; i < len; ++i) {\n            var inspection = inspections[i];\n            if (inspection.isRejected()) {\n                return Promise.reject(inspection.error());\n            }\n            inspections[i] = inspection.value();\n        }\n        return inspections;\n    }\n\n    function thrower(e) {\n        setTimeout(function(){throw e;}, 0);\n    }\n\n    function castPreservingDisposable(thenable) {\n        var maybePromise = cast(thenable, void 0);\n        if (maybePromise !== thenable &&\n            typeof thenable._isDisposable === \"function\" &&\n            typeof thenable._getDisposer === \"function\" &&\n            thenable._isDisposable()) {\n            maybePromise._setDisposable(thenable._getDisposer());\n        }\n        return maybePromise;\n    }\n    function dispose(resources, inspection) {\n        var i = 0;\n        var len = resources.length;\n        var ret = Promise.defer();\n        function iterator() {\n            if (i >= len) return ret.resolve();\n            var maybePromise = castPreservingDisposable(resources[i++]);\n            if (maybePromise instanceof Promise &&\n                maybePromise._isDisposable()) {\n                try {\n                    maybePromise = cast(maybePromise._getDisposer()\n                                        .tryDispose(inspection), void 0);\n                } catch (e) {\n                    return thrower(e);\n                }\n                if (maybePromise instanceof Promise) {\n                    return maybePromise._then(iterator, thrower,\n                                              null, null, null);\n                }\n            }\n            iterator();\n        }\n        iterator();\n        return ret.promise;\n    }\n\n    function disposerSuccess(value) {\n        var inspection = new PromiseInspection();\n        inspection._settledValue = value;\n        inspection._bitField = 268435456;\n        return dispose(this, inspection).thenReturn(value);\n    }\n\n    function disposerFail(reason) {\n        var inspection = new PromiseInspection();\n        inspection._settledValue = reason;\n        inspection._bitField = 134217728;\n        return dispose(this, inspection).thenThrow(reason);\n    }\n\n    function Disposer(data, promise) {\n        this._data = data;\n        this._promise = promise;\n    }\n\n    Disposer.prototype.data = function Disposer$data() {\n        return this._data;\n    };\n\n    Disposer.prototype.promise = function Disposer$promise() {\n        return this._promise;\n    };\n\n    Disposer.prototype.resource = function Disposer$resource() {\n        if (this.promise().isFulfilled()) {\n            return this.promise().value();\n        }\n        return null;\n    };\n\n    Disposer.prototype.tryDispose = function(inspection) {\n        var resource = this.resource();\n        var ret = resource !== null\n            ? this.doDispose(resource, inspection) : null;\n        this._promise._unsetDisposable();\n        this._data = this._promise = null;\n        return ret;\n    };\n\n    Disposer.isDisposer = function Disposer$isDisposer(d) {\n        return (d != null &&\n                typeof d.resource === \"function\" &&\n                typeof d.tryDispose === \"function\");\n    };\n\n    function FunctionDisposer(fn, promise) {\n        this.constructor$(fn, promise);\n    }\n    inherits(FunctionDisposer, Disposer);\n\n    FunctionDisposer.prototype.doDispose = function (resource, inspection) {\n        var fn = this.data();\n        return fn.call(resource, resource, inspection);\n    };\n\n    Promise.using = function Promise$using() {\n        var len = arguments.length;\n        if (len < 2) return apiRejection(\n                        \"you must pass at least 2 arguments to Promise.using\");\n        var fn = arguments[len - 1];\n        if (typeof fn !== \"function\") return apiRejection(\"fn must be a function\");\n        len--;\n        var resources = new Array(len);\n        for (var i = 0; i < len; ++i) {\n            var resource = arguments[i];\n            if (Disposer.isDisposer(resource)) {\n                var disposer = resource;\n                resource = resource.promise();\n                resource._setDisposable(disposer);\n            }\n            resources[i] = resource;\n        }\n\n        return Promise.settle(resources)\n            .then(inspectionMapper)\n            .spread(fn)\n            ._then(disposerSuccess, disposerFail, void 0, resources, void 0);\n    };\n\n    Promise.prototype._setDisposable =\n    function Promise$_setDisposable(disposer) {\n        this._bitField = this._bitField | 262144;\n        this._disposer = disposer;\n    };\n\n    Promise.prototype._isDisposable = function Promise$_isDisposable() {\n        return (this._bitField & 262144) > 0;\n    };\n\n    Promise.prototype._getDisposer = function Promise$_getDisposer() {\n        return this._disposer;\n    };\n\n    Promise.prototype._unsetDisposable = function Promise$_unsetDisposable() {\n        this._bitField = this._bitField & (~262144);\n        this._disposer = void 0;\n    };\n\n    Promise.prototype.disposer = function Promise$disposer(fn) {\n        if (typeof fn === \"function\") {\n            return new FunctionDisposer(fn, this);\n        }\n        throw new TypeError();\n    };\n\n};\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nmodule.exports = function(Promise) {\nvar TypeError = require('./errors.js').TypeError;\n\nfunction apiRejection(msg) {\n    var error = new TypeError(msg);\n    var ret = Promise.rejected(error);\n    var parent = ret._peekContext();\n    if (parent != null) {\n        parent._attachExtraTrace(error);\n    }\n    return ret;\n}\n\nreturn apiRejection;\n};\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('is-array')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = Buffer\nexports.INSPECT_MAX_BYTES = 50\nBuffer.poolSize = 8192 // not used by this implementation\n\nvar kMaxLength = 0x3fffffff\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Note:\n *\n * - Implementation must support adding new properties to `Uint8Array` instances.\n *   Firefox 4-29 lacked support, fixed in Firefox 30+.\n *   See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *  - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *  - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *    incorrect length in some situations.\n *\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they will\n * get the Object implementation, which is slower but will work correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = (function () {\n  try {\n    var buf = new ArrayBuffer(0)\n    var arr = new Uint8Array(buf)\n    arr.foo = function () { return 42 }\n    return 42 === arr.foo() && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        new Uint8Array(1).subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n})()\n\n/**\n * Class: Buffer\n * =============\n *\n * The Buffer constructor returns instances of `Uint8Array` that are augmented\n * with function properties for all the node `Buffer` API functions. We use\n * `Uint8Array` so that square bracket notation works as expected -- it returns\n * a single octet.\n *\n * By augmenting the instances, we can avoid modifying the `Uint8Array`\n * prototype.\n */\nfunction Buffer (subject, encoding, noZero) {\n  if (!(this instanceof Buffer))\n    return new Buffer(subject, encoding, noZero)\n\n  var type = typeof subject\n\n  // Find the length\n  var length\n  if (type === 'number')\n    length = subject > 0 ? subject >>> 0 : 0\n  else if (type === 'string') {\n    if (encoding === 'base64')\n      subject = base64clean(subject)\n    length = Buffer.byteLength(subject, encoding)\n  } else if (type === 'object' && subject !== null) { // assume object is array-like\n    if (subject.type === 'Buffer' && isArray(subject.data))\n      subject = subject.data\n    length = +subject.length > 0 ? Math.floor(+subject.length) : 0\n  } else\n    throw new TypeError('must start with number, buffer, array or string')\n\n  if (this.length > kMaxLength)\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n      'size: 0x' + kMaxLength.toString(16) + ' bytes')\n\n  var buf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Preferred: Return an augmented `Uint8Array` instance for best performance\n    buf = Buffer._augment(new Uint8Array(length))\n  } else {\n    // Fallback: Return THIS instance of Buffer (created by `new`)\n    buf = this\n    buf.length = length\n    buf._isBuffer = true\n  }\n\n  var i\n  if (Buffer.TYPED_ARRAY_SUPPORT && typeof subject.byteLength === 'number') {\n    // Speed optimization -- use set if we're copying from a typed array\n    buf._set(subject)\n  } else if (isArrayish(subject)) {\n    // Treat array-ish objects as a byte array\n    if (Buffer.isBuffer(subject)) {\n      for (i = 0; i < length; i++)\n        buf[i] = subject.readUInt8(i)\n    } else {\n      for (i = 0; i < length; i++)\n        buf[i] = ((subject[i] % 256) + 256) % 256\n    }\n  } else if (type === 'string') {\n    buf.write(subject, 0, encoding)\n  } else if (type === 'number' && !Buffer.TYPED_ARRAY_SUPPORT && !noZero) {\n    for (i = 0; i < length; i++) {\n      buf[i] = 0\n    }\n  }\n\n  return buf\n}\n\nBuffer.isBuffer = function (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b))\n    throw new TypeError('Arguments must be Buffers')\n\n  var x = a.length\n  var y = b.length\n  for (var i = 0, len = Math.min(x, y); i < len && a[i] === b[i]; i++) {}\n  if (i !== len) {\n    x = a[i]\n    y = b[i]\n  }\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'binary':\n    case 'base64':\n    case 'raw':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function (list, totalLength) {\n  if (!isArray(list)) throw new TypeError('Usage: Buffer.concat(list[, length])')\n\n  if (list.length === 0) {\n    return new Buffer(0)\n  } else if (list.length === 1) {\n    return list[0]\n  }\n\n  var i\n  if (totalLength === undefined) {\n    totalLength = 0\n    for (i = 0; i < list.length; i++) {\n      totalLength += list[i].length\n    }\n  }\n\n  var buf = new Buffer(totalLength)\n  var pos = 0\n  for (i = 0; i < list.length; i++) {\n    var item = list[i]\n    item.copy(buf, pos)\n    pos += item.length\n  }\n  return buf\n}\n\nBuffer.byteLength = function (str, encoding) {\n  var ret\n  str = str + ''\n  switch (encoding || 'utf8') {\n    case 'ascii':\n    case 'binary':\n    case 'raw':\n      ret = str.length\n      break\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      ret = str.length * 2\n      break\n    case 'hex':\n      ret = str.length >>> 1\n      break\n    case 'utf8':\n    case 'utf-8':\n      ret = utf8ToBytes(str).length\n      break\n    case 'base64':\n      ret = base64ToBytes(str).length\n      break\n    default:\n      ret = str.length\n  }\n  return ret\n}\n\n// pre-set for values that may exist in the future\nBuffer.prototype.length = undefined\nBuffer.prototype.parent = undefined\n\n// toString(encoding, start=0, end=buffer.length)\nBuffer.prototype.toString = function (encoding, start, end) {\n  var loweredCase = false\n\n  start = start >>> 0\n  end = end === undefined || end === Infinity ? this.length : end >>> 0\n\n  if (!encoding) encoding = 'utf8'\n  if (start < 0) start = 0\n  if (end > this.length) end = this.length\n  if (end <= start) return ''\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'binary':\n        return binarySlice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase)\n          throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.equals = function (b) {\n  if(!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max)\n      str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  return Buffer.compare(this, b)\n}\n\n// `get` will be removed in Node 0.13+\nBuffer.prototype.get = function (offset) {\n  console.log('.get() is deprecated. Access using array indexes instead.')\n  return this.readUInt8(offset)\n}\n\n// `set` will be removed in Node 0.13+\nBuffer.prototype.set = function (v, offset) {\n  console.log('.set() is deprecated. Access using array indexes instead.')\n  return this.writeUInt8(v, offset)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new Error('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; i++) {\n    var byte = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(byte)) throw new Error('Invalid hex string')\n    buf[offset + i] = byte\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  var charsWritten = blitBuffer(utf8ToBytes(string), buf, offset, length)\n  return charsWritten\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  var charsWritten = blitBuffer(asciiToBytes(string), buf, offset, length)\n  return charsWritten\n}\n\nfunction binaryWrite (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  var charsWritten = blitBuffer(base64ToBytes(string), buf, offset, length)\n  return charsWritten\n}\n\nfunction utf16leWrite (buf, string, offset, length) {\n  var charsWritten = blitBuffer(utf16leToBytes(string), buf, offset, length)\n  return charsWritten\n}\n\nBuffer.prototype.write = function (string, offset, length, encoding) {\n  // Support both (string, offset, length, encoding)\n  // and the legacy (string, encoding, offset, length)\n  if (isFinite(offset)) {\n    if (!isFinite(length)) {\n      encoding = length\n      length = undefined\n    }\n  } else {  // legacy\n    var swap = encoding\n    encoding = offset\n    offset = length\n    length = swap\n  }\n\n  offset = Number(offset) || 0\n  var remaining = this.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n  encoding = String(encoding || 'utf8').toLowerCase()\n\n  var ret\n  switch (encoding) {\n    case 'hex':\n      ret = hexWrite(this, string, offset, length)\n      break\n    case 'utf8':\n    case 'utf-8':\n      ret = utf8Write(this, string, offset, length)\n      break\n    case 'ascii':\n      ret = asciiWrite(this, string, offset, length)\n      break\n    case 'binary':\n      ret = binaryWrite(this, string, offset, length)\n      break\n    case 'base64':\n      ret = base64Write(this, string, offset, length)\n      break\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      ret = utf16leWrite(this, string, offset, length)\n      break\n    default:\n      throw new TypeError('Unknown encoding: ' + encoding)\n  }\n  return ret\n}\n\nBuffer.prototype.toJSON = function () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  var res = ''\n  var tmp = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    if (buf[i] <= 0x7F) {\n      res += decodeUtf8Char(tmp) + String.fromCharCode(buf[i])\n      tmp = ''\n    } else {\n      tmp += '%' + buf[i].toString(16)\n    }\n  }\n\n  return res + decodeUtf8Char(tmp)\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction binarySlice (buf, start, end) {\n  return asciiSlice(buf, start, end)\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; i++) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len;\n    if (start < 0)\n      start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0)\n      end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start)\n    end = start\n\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    return Buffer._augment(this.subarray(start, end))\n  } else {\n    var sliceLen = end - start\n    var newBuf = new Buffer(sliceLen, undefined, true)\n    for (var i = 0; i < sliceLen; i++) {\n      newBuf[i] = this[i + start]\n    }\n    return newBuf\n  }\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0)\n    throw new RangeError('offset is not uint')\n  if (offset + ext > length)\n    throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUInt8 = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n      ((this[offset + 1] << 16) |\n      (this[offset + 2] << 8) |\n      this[offset + 3])\n}\n\nBuffer.prototype.readInt8 = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80))\n    return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16) |\n      (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n      (this[offset + 1] << 16) |\n      (this[offset + 2] << 8) |\n      (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('buffer must be a Buffer instance')\n  if (value > max || value < min) throw new TypeError('value is out of bounds')\n  if (offset + ext > buf.length) throw new TypeError('index out of range')\n}\n\nBuffer.prototype.writeUInt8 = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = value\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; i++) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = value\n    this[offset + 1] = (value >>> 8)\n  } else objectWriteUInt16(this, value, offset, true)\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = value\n  } else objectWriteUInt16(this, value, offset, false)\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; i++) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = value\n  } else objectWriteUInt32(this, value, offset, true)\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = value\n  } else objectWriteUInt32(this, value, offset, false)\n  return offset + 4\n}\n\nBuffer.prototype.writeInt8 = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = value\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = value\n    this[offset + 1] = (value >>> 8)\n  } else objectWriteUInt16(this, value, offset, true)\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = value\n  } else objectWriteUInt16(this, value, offset, false)\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = value\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else objectWriteUInt32(this, value, offset, true)\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = value\n  } else objectWriteUInt32(this, value, offset, false)\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (value > max || value < min) throw new TypeError('value is out of bounds')\n  if (offset + ext > buf.length) throw new TypeError('index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert)\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert)\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function (target, target_start, start, end) {\n  var source = this\n\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (!target_start) target_start = 0\n\n  // Copy 0 bytes; we're done\n  if (end === start) return\n  if (target.length === 0 || source.length === 0) return\n\n  // Fatal error conditions\n  if (end < start) throw new TypeError('sourceEnd < sourceStart')\n  if (target_start < 0 || target_start >= target.length)\n    throw new TypeError('targetStart out of bounds')\n  if (start < 0 || start >= source.length) throw new TypeError('sourceStart out of bounds')\n  if (end < 0 || end > source.length) throw new TypeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length)\n    end = this.length\n  if (target.length - target_start < end - start)\n    end = target.length - target_start + start\n\n  var len = end - start\n\n  if (len < 100 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < len; i++) {\n      target[i + target_start] = this[i + start]\n    }\n  } else {\n    target._set(this.subarray(start, start + len), target_start)\n  }\n}\n\n// fill(value, start=0, end=buffer.length)\nBuffer.prototype.fill = function (value, start, end) {\n  if (!value) value = 0\n  if (!start) start = 0\n  if (!end) end = this.length\n\n  if (end < start) throw new TypeError('end < start')\n\n  // Fill 0 bytes; we're done\n  if (end === start) return\n  if (this.length === 0) return\n\n  if (start < 0 || start >= this.length) throw new TypeError('start out of bounds')\n  if (end < 0 || end > this.length) throw new TypeError('end out of bounds')\n\n  var i\n  if (typeof value === 'number') {\n    for (i = start; i < end; i++) {\n      this[i] = value\n    }\n  } else {\n    var bytes = utf8ToBytes(value.toString())\n    var len = bytes.length\n    for (i = start; i < end; i++) {\n      this[i] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n/**\n * Creates a new `ArrayBuffer` with the *copied* memory of the buffer instance.\n * Added in Node 0.12. Only available in browsers that support ArrayBuffer.\n */\nBuffer.prototype.toArrayBuffer = function () {\n  if (typeof Uint8Array !== 'undefined') {\n    if (Buffer.TYPED_ARRAY_SUPPORT) {\n      return (new Buffer(this)).buffer\n    } else {\n      var buf = new Uint8Array(this.length)\n      for (var i = 0, len = buf.length; i < len; i += 1) {\n        buf[i] = this[i]\n      }\n      return buf.buffer\n    }\n  } else {\n    throw new TypeError('Buffer.toArrayBuffer not supported in this browser')\n  }\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar BP = Buffer.prototype\n\n/**\n * Augment a Uint8Array *instance* (not the Uint8Array class!) with Buffer methods\n */\nBuffer._augment = function (arr) {\n  arr._isBuffer = true\n\n  // save reference to original Uint8Array get/set methods before overwriting\n  arr._get = arr.get\n  arr._set = arr.set\n\n  // deprecated, will be removed in node 0.13+\n  arr.get = BP.get\n  arr.set = BP.set\n\n  arr.write = BP.write\n  arr.toString = BP.toString\n  arr.toLocaleString = BP.toString\n  arr.toJSON = BP.toJSON\n  arr.equals = BP.equals\n  arr.compare = BP.compare\n  arr.copy = BP.copy\n  arr.slice = BP.slice\n  arr.readUInt8 = BP.readUInt8\n  arr.readUInt16LE = BP.readUInt16LE\n  arr.readUInt16BE = BP.readUInt16BE\n  arr.readUInt32LE = BP.readUInt32LE\n  arr.readUInt32BE = BP.readUInt32BE\n  arr.readInt8 = BP.readInt8\n  arr.readInt16LE = BP.readInt16LE\n  arr.readInt16BE = BP.readInt16BE\n  arr.readInt32LE = BP.readInt32LE\n  arr.readInt32BE = BP.readInt32BE\n  arr.readFloatLE = BP.readFloatLE\n  arr.readFloatBE = BP.readFloatBE\n  arr.readDoubleLE = BP.readDoubleLE\n  arr.readDoubleBE = BP.readDoubleBE\n  arr.writeUInt8 = BP.writeUInt8\n  arr.writeUInt16LE = BP.writeUInt16LE\n  arr.writeUInt16BE = BP.writeUInt16BE\n  arr.writeUInt32LE = BP.writeUInt32LE\n  arr.writeUInt32BE = BP.writeUInt32BE\n  arr.writeInt8 = BP.writeInt8\n  arr.writeInt16LE = BP.writeInt16LE\n  arr.writeInt16BE = BP.writeInt16BE\n  arr.writeInt32LE = BP.writeInt32LE\n  arr.writeInt32BE = BP.writeInt32BE\n  arr.writeFloatLE = BP.writeFloatLE\n  arr.writeFloatBE = BP.writeFloatBE\n  arr.writeDoubleLE = BP.writeDoubleLE\n  arr.writeDoubleBE = BP.writeDoubleBE\n  arr.fill = BP.fill\n  arr.inspect = BP.inspect\n  arr.toArrayBuffer = BP.toArrayBuffer\n\n  return arr\n}\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-z]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction isArrayish (subject) {\n  return isArray(subject) || Buffer.isBuffer(subject) ||\n      subject && typeof subject === 'object' &&\n      typeof subject.length === 'number'\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    var b = str.charCodeAt(i)\n    if (b <= 0x7F) {\n      byteArray.push(b)\n    } else {\n      var start = i\n      if (b >= 0xD800 && b <= 0xDFFF) i++\n      var h = encodeURIComponent(str.slice(start, i+1)).substr(1).split('%')\n      for (var j = 0; j < h.length; j++) {\n        byteArray.push(parseInt(h[j], 16))\n      }\n    }\n  }\n  return byteArray\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(str)\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; i++) {\n    if ((i + offset >= dst.length) || (i >= src.length))\n      break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction decodeUtf8Char (str) {\n  try {\n    return decodeURIComponent(str)\n  } catch (err) {\n    return String.fromCharCode(0xFFFD) // UTF 8 invalid char\n  }\n}\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nvar schedule;\nvar _MutationObserver;\nif (typeof process === \"object\" && typeof process.version === \"string\") {\n    schedule = function Promise$_Scheduler(fn) {\n        process.nextTick(fn);\n    };\n}\nelse if ((typeof MutationObserver !== \"undefined\" &&\n         (_MutationObserver = MutationObserver)) ||\n         (typeof WebKitMutationObserver !== \"undefined\" &&\n         (_MutationObserver = WebKitMutationObserver))) {\n    schedule = (function() {\n        var div = document.createElement(\"div\");\n        var queuedFn = void 0;\n        var observer = new _MutationObserver(\n            function Promise$_Scheduler() {\n                var fn = queuedFn;\n                queuedFn = void 0;\n                fn();\n            }\n       );\n        observer.observe(div, {\n            attributes: true\n        });\n        return function Promise$_Scheduler(fn) {\n            queuedFn = fn;\n            div.classList.toggle(\"foo\");\n        };\n\n    })();\n}\nelse if (typeof setTimeout !== \"undefined\") {\n    schedule = function Promise$_Scheduler(fn) {\n        setTimeout(fn, 0);\n    };\n}\nelse throw new Error(\"no async scheduler available\");\nmodule.exports = schedule;\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n\"use strict\";\nfunction arrayCopy(src, srcIndex, dst, dstIndex, len) {\n    for (var j = 0; j < len; ++j) {\n        dst[j + dstIndex] = src[j + srcIndex];\n    }\n}\n\nfunction Queue(capacity) {\n    this._capacity = capacity;\n    this._length = 0;\n    this._front = 0;\n    this._makeCapacity();\n}\n\nQueue.prototype._willBeOverCapacity =\nfunction Queue$_willBeOverCapacity(size) {\n    return this._capacity < size;\n};\n\nQueue.prototype._pushOne = function Queue$_pushOne(arg) {\n    var length = this.length();\n    this._checkCapacity(length + 1);\n    var i = (this._front + length) & (this._capacity - 1);\n    this[i] = arg;\n    this._length = length + 1;\n};\n\nQueue.prototype.push = function Queue$push(fn, receiver, arg) {\n    var length = this.length() + 3;\n    if (this._willBeOverCapacity(length)) {\n        this._pushOne(fn);\n        this._pushOne(receiver);\n        this._pushOne(arg);\n        return;\n    }\n    var j = this._front + length - 3;\n    this._checkCapacity(length);\n    var wrapMask = this._capacity - 1;\n    this[(j + 0) & wrapMask] = fn;\n    this[(j + 1) & wrapMask] = receiver;\n    this[(j + 2) & wrapMask] = arg;\n    this._length = length;\n};\n\nQueue.prototype.shift = function Queue$shift() {\n    var front = this._front,\n        ret = this[front];\n\n    this[front] = void 0;\n    this._front = (front + 1) & (this._capacity - 1);\n    this._length--;\n    return ret;\n};\n\nQueue.prototype.length = function Queue$length() {\n    return this._length;\n};\n\nQueue.prototype._makeCapacity = function Queue$_makeCapacity() {\n    var len = this._capacity;\n    for (var i = 0; i < len; ++i) {\n        this[i] = void 0;\n    }\n};\n\nQueue.prototype._checkCapacity = function Queue$_checkCapacity(size) {\n    if (this._capacity < size) {\n        this._resizeTo(this._capacity << 3);\n    }\n};\n\nQueue.prototype._resizeTo = function Queue$_resizeTo(capacity) {\n    var oldFront = this._front;\n    var oldCapacity = this._capacity;\n    var oldQueue = new Array(oldCapacity);\n    var length = this.length();\n\n    arrayCopy(this, 0, oldQueue, 0, oldCapacity);\n    this._capacity = capacity;\n    this._makeCapacity();\n    this._front = 0;\n    if (oldFront + length <= oldCapacity) {\n        arrayCopy(oldQueue, oldFront, this, 0, length);\n    } else {        var lengthBeforeWrapping =\n            length - ((oldFront + length) & (oldCapacity - 1));\n\n        arrayCopy(oldQueue, oldFront, this, 0, lengthBeforeWrapping);\n        arrayCopy(oldQueue, 0, this, lengthBeforeWrapping,\n                    length - lengthBeforeWrapping);\n    }\n};\n\nmodule.exports = Queue;\n","/**\n * Copyright (c) 2014 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\nvar isES5 = (function(){\n    \"use strict\";\n    return this === void 0;\n})();\n\nif (isES5) {\n    module.exports = {\n        freeze: Object.freeze,\n        defineProperty: Object.defineProperty,\n        keys: Object.keys,\n        getPrototypeOf: Object.getPrototypeOf,\n        isArray: Array.isArray,\n        isES5: isES5\n    };\n} else {\n    var has = {}.hasOwnProperty;\n    var str = {}.toString;\n    var proto = {}.constructor.prototype;\n\n    var ObjectKeys = function ObjectKeys(o) {\n        var ret = [];\n        for (var key in o) {\n            if (has.call(o, key)) {\n                ret.push(key);\n            }\n        }\n        return ret;\n    }\n\n    var ObjectDefineProperty = function ObjectDefineProperty(o, key, desc) {\n        o[key] = desc.value;\n        return o;\n    }\n\n    var ObjectFreeze = function ObjectFreeze(obj) {\n        return obj;\n    }\n\n    var ObjectGetPrototypeOf = function ObjectGetPrototypeOf(obj) {\n        try {\n            return Object(obj).constructor.prototype;\n        }\n        catch (e) {\n            return proto;\n        }\n    }\n\n    var ArrayIsArray = function ArrayIsArray(obj) {\n        try {\n            return str.call(obj) === \"[object Array]\";\n        }\n        catch(e) {\n            return false;\n        }\n    }\n\n    module.exports = {\n        isArray: ArrayIsArray,\n        keys: ObjectKeys,\n        defineProperty: ObjectDefineProperty,\n        freeze: ObjectFreeze,\n        getPrototypeOf: ObjectGetPrototypeOf,\n        isES5: isES5\n    };\n}\n","module.exports = Array.isArray || function (arr) {\n  return Object.prototype.toString.call(arr) == '[object Array]';\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar Buffer = require('buffer').Buffer;\n\nvar isBufferEncoding = Buffer.isEncoding\n  || function(encoding) {\n       switch (encoding && encoding.toLowerCase()) {\n         case 'hex': case 'utf8': case 'utf-8': case 'ascii': case 'binary': case 'base64': case 'ucs2': case 'ucs-2': case 'utf16le': case 'utf-16le': case 'raw': return true;\n         default: return false;\n       }\n     }\n\n\nfunction assertEncoding(encoding) {\n  if (encoding && !isBufferEncoding(encoding)) {\n    throw new Error('Unknown encoding: ' + encoding);\n  }\n}\n\n// StringDecoder provides an interface for efficiently splitting a series of\n// buffers into a series of JS strings without breaking apart multi-byte\n// characters. CESU-8 is handled as part of the UTF-8 encoding.\n//\n// @TODO Handling all encodings inside a single object makes it very difficult\n// to reason about this code, so it should be split up in the future.\n// @TODO There should be a utf8-strict encoding that rejects invalid UTF-8 code\n// points as used by CESU-8.\nvar StringDecoder = exports.StringDecoder = function(encoding) {\n  this.encoding = (encoding || 'utf8').toLowerCase().replace(/[-_]/, '');\n  assertEncoding(encoding);\n  switch (this.encoding) {\n    case 'utf8':\n      // CESU-8 represents each of Surrogate Pair by 3-bytes\n      this.surrogateSize = 3;\n      break;\n    case 'ucs2':\n    case 'utf16le':\n      // UTF-16 represents each of Surrogate Pair by 2-bytes\n      this.surrogateSize = 2;\n      this.detectIncompleteChar = utf16DetectIncompleteChar;\n      break;\n    case 'base64':\n      // Base-64 stores 3 bytes in 4 chars, and pads the remainder.\n      this.surrogateSize = 3;\n      this.detectIncompleteChar = base64DetectIncompleteChar;\n      break;\n    default:\n      this.write = passThroughWrite;\n      return;\n  }\n\n  // Enough space to store all bytes of a single character. UTF-8 needs 4\n  // bytes, but CESU-8 may require up to 6 (3 bytes per surrogate).\n  this.charBuffer = new Buffer(6);\n  // Number of bytes received for the current incomplete multi-byte character.\n  this.charReceived = 0;\n  // Number of bytes expected for the current incomplete multi-byte character.\n  this.charLength = 0;\n};\n\n\n// write decodes the given buffer and returns it as JS string that is\n// guaranteed to not contain any partial multi-byte characters. Any partial\n// character found at the end of the buffer is buffered up, and will be\n// returned when calling write again with the remaining bytes.\n//\n// Note: Converting a Buffer containing an orphan surrogate to a String\n// currently works, but converting a String to a Buffer (via `new Buffer`, or\n// Buffer#write) will replace incomplete surrogates with the unicode\n// replacement character. See https://codereview.chromium.org/121173009/ .\nStringDecoder.prototype.write = function(buffer) {\n  var charStr = '';\n  // if our last write ended with an incomplete multibyte character\n  while (this.charLength) {\n    // determine how many remaining bytes this buffer has to offer for this char\n    var available = (buffer.length >= this.charLength - this.charReceived) ?\n        this.charLength - this.charReceived :\n        buffer.length;\n\n    // add the new bytes to the char buffer\n    buffer.copy(this.charBuffer, this.charReceived, 0, available);\n    this.charReceived += available;\n\n    if (this.charReceived < this.charLength) {\n      // still not enough chars in this buffer? wait for more ...\n      return '';\n    }\n\n    // remove bytes belonging to the current character from the buffer\n    buffer = buffer.slice(available, buffer.length);\n\n    // get the character that was split\n    charStr = this.charBuffer.slice(0, this.charLength).toString(this.encoding);\n\n    // CESU-8: lead surrogate (D800-DBFF) is also the incomplete character\n    var charCode = charStr.charCodeAt(charStr.length - 1);\n    if (charCode >= 0xD800 && charCode <= 0xDBFF) {\n      this.charLength += this.surrogateSize;\n      charStr = '';\n      continue;\n    }\n    this.charReceived = this.charLength = 0;\n\n    // if there are no more bytes in this buffer, just emit our char\n    if (buffer.length === 0) {\n      return charStr;\n    }\n    break;\n  }\n\n  // determine and set charLength / charReceived\n  this.detectIncompleteChar(buffer);\n\n  var end = buffer.length;\n  if (this.charLength) {\n    // buffer the incomplete character bytes we got\n    buffer.copy(this.charBuffer, 0, buffer.length - this.charReceived, end);\n    end -= this.charReceived;\n  }\n\n  charStr += buffer.toString(this.encoding, 0, end);\n\n  var end = charStr.length - 1;\n  var charCode = charStr.charCodeAt(end);\n  // CESU-8: lead surrogate (D800-DBFF) is also the incomplete character\n  if (charCode >= 0xD800 && charCode <= 0xDBFF) {\n    var size = this.surrogateSize;\n    this.charLength += size;\n    this.charReceived += size;\n    this.charBuffer.copy(this.charBuffer, size, 0, size);\n    buffer.copy(this.charBuffer, 0, 0, size);\n    return charStr.substring(0, end);\n  }\n\n  // or just emit the charStr\n  return charStr;\n};\n\n// detectIncompleteChar determines if there is an incomplete UTF-8 character at\n// the end of the given buffer. If so, it sets this.charLength to the byte\n// length that character, and sets this.charReceived to the number of bytes\n// that are available for this character.\nStringDecoder.prototype.detectIncompleteChar = function(buffer) {\n  // determine how many bytes we have to check at the end of this buffer\n  var i = (buffer.length >= 3) ? 3 : buffer.length;\n\n  // Figure out if one of the last i bytes of our buffer announces an\n  // incomplete char.\n  for (; i > 0; i--) {\n    var c = buffer[buffer.length - i];\n\n    // See http://en.wikipedia.org/wiki/UTF-8#Description\n\n    // 110XXXXX\n    if (i == 1 && c >> 5 == 0x06) {\n      this.charLength = 2;\n      break;\n    }\n\n    // 1110XXXX\n    if (i <= 2 && c >> 4 == 0x0E) {\n      this.charLength = 3;\n      break;\n    }\n\n    // 11110XXX\n    if (i <= 3 && c >> 3 == 0x1E) {\n      this.charLength = 4;\n      break;\n    }\n  }\n  this.charReceived = i;\n};\n\nStringDecoder.prototype.end = function(buffer) {\n  var res = '';\n  if (buffer && buffer.length)\n    res = this.write(buffer);\n\n  if (this.charReceived) {\n    var cr = this.charReceived;\n    var buf = this.charBuffer;\n    var enc = this.encoding;\n    res += buf.slice(0, cr).toString(enc);\n  }\n\n  return res;\n};\n\nfunction passThroughWrite(buffer) {\n  return buffer.toString(this.encoding);\n}\n\nfunction utf16DetectIncompleteChar(buffer) {\n  this.charReceived = buffer.length % 2;\n  this.charLength = this.charReceived ? 2 : 0;\n}\n\nfunction base64DetectIncompleteChar(buffer) {\n  this.charReceived = buffer.length % 3;\n  this.charLength = this.charReceived ? 3 : 0;\n}\n","\n/**\n * isArray\n */\n\nvar isArray = Array.isArray;\n\n/**\n * toString\n */\n\nvar str = Object.prototype.toString;\n\n/**\n * Whether or not the given `val`\n * is an array.\n *\n * example:\n *\n *        isArray([]);\n *        // > true\n *        isArray(arguments);\n *        // > false\n *        isArray('');\n *        // > false\n *\n * @param {mixed} val\n * @return {bool}\n */\n\nmodule.exports = isArray || function (val) {\n  return !! val && '[object Array]' == str.call(val);\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nfunction isBuffer(arg) {\n  return Buffer.isBuffer(arg);\n}\nexports.isBuffer = isBuffer;\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}","exports.read = function(buffer, offset, isLE, mLen, nBytes) {\n  var e, m,\n      eLen = nBytes * 8 - mLen - 1,\n      eMax = (1 << eLen) - 1,\n      eBias = eMax >> 1,\n      nBits = -7,\n      i = isLE ? (nBytes - 1) : 0,\n      d = isLE ? -1 : 1,\n      s = buffer[offset + i];\n\n  i += d;\n\n  e = s & ((1 << (-nBits)) - 1);\n  s >>= (-nBits);\n  nBits += eLen;\n  for (; nBits > 0; e = e * 256 + buffer[offset + i], i += d, nBits -= 8);\n\n  m = e & ((1 << (-nBits)) - 1);\n  e >>= (-nBits);\n  nBits += mLen;\n  for (; nBits > 0; m = m * 256 + buffer[offset + i], i += d, nBits -= 8);\n\n  if (e === 0) {\n    e = 1 - eBias;\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity);\n  } else {\n    m = m + Math.pow(2, mLen);\n    e = e - eBias;\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen);\n};\n\nexports.write = function(buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c,\n      eLen = nBytes * 8 - mLen - 1,\n      eMax = (1 << eLen) - 1,\n      eBias = eMax >> 1,\n      rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0),\n      i = isLE ? 0 : (nBytes - 1),\n      d = isLE ? 1 : -1,\n      s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0;\n\n  value = Math.abs(value);\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0;\n    e = eMax;\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2);\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--;\n      c *= 2;\n    }\n    if (e + eBias >= 1) {\n      value += rt / c;\n    } else {\n      value += rt * Math.pow(2, 1 - eBias);\n    }\n    if (value * c >= 2) {\n      e++;\n      c /= 2;\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0;\n      e = eMax;\n    } else if (e + eBias >= 1) {\n      m = (value * c - 1) * Math.pow(2, mLen);\n      e = e + eBias;\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen);\n      e = 0;\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8);\n\n  e = (e << mLen) | m;\n  eLen += mLen;\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8);\n\n  buffer[offset + i - d] |= s * 128;\n};\n","var lookup = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\n;(function (exports) {\n\t'use strict';\n\n  var Arr = (typeof Uint8Array !== 'undefined')\n    ? Uint8Array\n    : Array\n\n\tvar PLUS   = '+'.charCodeAt(0)\n\tvar SLASH  = '/'.charCodeAt(0)\n\tvar NUMBER = '0'.charCodeAt(0)\n\tvar LOWER  = 'a'.charCodeAt(0)\n\tvar UPPER  = 'A'.charCodeAt(0)\n\n\tfunction decode (elt) {\n\t\tvar code = elt.charCodeAt(0)\n\t\tif (code === PLUS)\n\t\t\treturn 62 // '+'\n\t\tif (code === SLASH)\n\t\t\treturn 63 // '/'\n\t\tif (code < NUMBER)\n\t\t\treturn -1 //no match\n\t\tif (code < NUMBER + 10)\n\t\t\treturn code - NUMBER + 26 + 26\n\t\tif (code < UPPER + 26)\n\t\t\treturn code - UPPER\n\t\tif (code < LOWER + 26)\n\t\t\treturn code - LOWER + 26\n\t}\n\n\tfunction b64ToByteArray (b64) {\n\t\tvar i, j, l, tmp, placeHolders, arr\n\n\t\tif (b64.length % 4 > 0) {\n\t\t\tthrow new Error('Invalid string. Length must be a multiple of 4')\n\t\t}\n\n\t\t// the number of equal signs (place holders)\n\t\t// if there are two placeholders, than the two characters before it\n\t\t// represent one byte\n\t\t// if there is only one, then the three characters before it represent 2 bytes\n\t\t// this is just a cheap hack to not do indexOf twice\n\t\tvar len = b64.length\n\t\tplaceHolders = '=' === b64.charAt(len - 2) ? 2 : '=' === b64.charAt(len - 1) ? 1 : 0\n\n\t\t// base64 is 4/3 + up to two characters of the original data\n\t\tarr = new Arr(b64.length * 3 / 4 - placeHolders)\n\n\t\t// if there are placeholders, only get up to the last complete 4 chars\n\t\tl = placeHolders > 0 ? b64.length - 4 : b64.length\n\n\t\tvar L = 0\n\n\t\tfunction push (v) {\n\t\t\tarr[L++] = v\n\t\t}\n\n\t\tfor (i = 0, j = 0; i < l; i += 4, j += 3) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 18) | (decode(b64.charAt(i + 1)) << 12) | (decode(b64.charAt(i + 2)) << 6) | decode(b64.charAt(i + 3))\n\t\t\tpush((tmp & 0xFF0000) >> 16)\n\t\t\tpush((tmp & 0xFF00) >> 8)\n\t\t\tpush(tmp & 0xFF)\n\t\t}\n\n\t\tif (placeHolders === 2) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 2) | (decode(b64.charAt(i + 1)) >> 4)\n\t\t\tpush(tmp & 0xFF)\n\t\t} else if (placeHolders === 1) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 10) | (decode(b64.charAt(i + 1)) << 4) | (decode(b64.charAt(i + 2)) >> 2)\n\t\t\tpush((tmp >> 8) & 0xFF)\n\t\t\tpush(tmp & 0xFF)\n\t\t}\n\n\t\treturn arr\n\t}\n\n\tfunction uint8ToBase64 (uint8) {\n\t\tvar i,\n\t\t\textraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes\n\t\t\toutput = \"\",\n\t\t\ttemp, length\n\n\t\tfunction encode (num) {\n\t\t\treturn lookup.charAt(num)\n\t\t}\n\n\t\tfunction tripletToBase64 (num) {\n\t\t\treturn encode(num >> 18 & 0x3F) + encode(num >> 12 & 0x3F) + encode(num >> 6 & 0x3F) + encode(num & 0x3F)\n\t\t}\n\n\t\t// go through the array every three bytes, we'll deal with trailing stuff later\n\t\tfor (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {\n\t\t\ttemp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2])\n\t\t\toutput += tripletToBase64(temp)\n\t\t}\n\n\t\t// pad the end with zeros, but make sure to not forget the extra bytes\n\t\tswitch (extraBytes) {\n\t\t\tcase 1:\n\t\t\t\ttemp = uint8[uint8.length - 1]\n\t\t\t\toutput += encode(temp >> 2)\n\t\t\t\toutput += encode((temp << 4) & 0x3F)\n\t\t\t\toutput += '=='\n\t\t\t\tbreak\n\t\t\tcase 2:\n\t\t\t\ttemp = (uint8[uint8.length - 2] << 8) + (uint8[uint8.length - 1])\n\t\t\t\toutput += encode(temp >> 10)\n\t\t\t\toutput += encode((temp >> 4) & 0x3F)\n\t\t\t\toutput += encode((temp << 2) & 0x3F)\n\t\t\t\toutput += '='\n\t\t\t\tbreak\n\t\t}\n\n\t\treturn output\n\t}\n\n\texports.toByteArray = b64ToByteArray\n\texports.fromByteArray = uint8ToBase64\n}(typeof exports === 'undefined' ? (this.base64js = {}) : exports))\n"]}