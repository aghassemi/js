{"version":3,"file":"bundle.js","sources":["/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/browser-pack/_prelude.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/veyron.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/process/browser.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/runtime/runtime.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/lib/deferred.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/lib/vlog.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/lib/verror.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/ipc/server.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/ipc/server_router.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/ipc/client.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/proxy/websocket.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/lib/promise.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/namespace/namespace.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/namespace/util.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/storage/store.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/watch/watch.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/util/util.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/postie/index.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/idl/idl.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/proxy/stream.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/proxy/message_type.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/proxy/incoming_payload_type.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/proxy/error_conversion.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/proxy/simple_handler.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/security/public.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/lib/websocket.js","/usr/local/google/home/nlacasse/code/v/veyron.js/src/proxy/proxy.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/util/support/isBufferBrowser.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/events/events.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/stream-browserify/index.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/inherits/inherits_browser.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/es6-promise/dist/commonjs/main.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/readable.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/writable.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/duplex.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/transform.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/passthrough.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/ws/lib/browser.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/es6-promise/dist/commonjs/promise/promise.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/es6-promise/dist/commonjs/promise/polyfill.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/lib/_stream_readable.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/lib/_stream_writable.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/lib/_stream_duplex.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/lib/_stream_transform.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/lib/_stream_passthrough.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/es6-promise/dist/commonjs/promise/config.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/es6-promise/dist/commonjs/promise/utils.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/es6-promise/dist/commonjs/promise/all.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/es6-promise/dist/commonjs/promise/race.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/es6-promise/dist/commonjs/promise/resolve.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/es6-promise/dist/commonjs/promise/reject.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/es6-promise/dist/commonjs/promise/asap.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/buffer/index.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/node_modules/string_decoder/index.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/node_modules/isarray/index.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/buffer/node_modules/ieee754/index.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/readable-stream/node_modules/core-util-is/lib/util.js","/usr/local/google/home/nlacasse/code/v/veyron.js/node_modules/browserify/node_modules/buffer/node_modules/base64-js/lib/b64.js"],"names":["init","options","callback","def","Deferred","getIdentity","err","name","reject","identityName","resolve","Runtime","promise","handleAuthSuccess","data","removeListeners","handleAuthError","handleAuthReceived","window","clearInterval","authRequestInterval","contentScript","removeListener","isBrowser","process","nextTick","bind","Postie","require","on","setInterval","post","logLevels","levels","errors","module","exports","noop","canSetImmediate","setImmediate","canPost","postMessage","addEventListener","f","queue","ev","source","stopPropagation","length","fn","shift","push","setTimeout","title","browser","env","argv","addListener","once","off","removeAllListeners","emit","binding","Error","cwd","chdir","this","proxy","logLevel","vLog","DEBUG","_options","level","Server","ServerRouter","Client","ProxyConnection","Promise","Namespace","namespaceUtil","store","watch","prototype","bindTo","optServiceSignature","client","_getClient","serve","serviceObject","serviceMetadata","server","_getServer","addIDL","updates","_getProxyConnection","_proxyConnection","_getRouter","_router","_client","_server","newStore","Store","newNamespace","roots","rt","getWebSocket","config","then","mounttableRoot","Transaction","Watch","cb","self","v","e","vlog","NOLOG","ERROR","WARN","INFO","error","_log","arguments","warn","debug","info","args","_write","c","_getConsole","consoleFunc","log","apply","console","vlogInstance","inherits","vError","Ids","Aborted","BadArg","BadProtocol","Exists","Internal","NotAuthorized","NotFound","VeyronError","message","id","call","captureStackTrace","stack","equals","a","b","ais","bis","AbortedError","BadArgError","BadProtocolError","ExistsError","InternalError","NotAuthorizedError","NotFoundError","router","nextServerID","_knownServiceDefinitions","IdlHelper","ServiceWrapper","prefix","package","key","toUpperCase","hasOwnProperty","_getAndValidateMetadata","shouldCheckDefinition","Array","isArray","serviceDefinitions","i","object","k","wrapper","err2","validate","stop","stopServer","generateIdlWireDescription","Stream","MessageType","IncomingPayloadType","ErrorConversion","SimpleHandler","PublicId","ServerStream","stream","_stream","handleResponse","type","STREAM_RESPONSE","_queueRead","STREAM_CLOSE","ERROR_RESPONSE","toJSerror","Router","_servers","_proxy","_streamMap","addIncomingHandler","INVOKE_REQUEST","inject","injectionPositions","injections","keys","Object","invertedMap","forEach","values","map","filter","value","undefined","sort","keysInserted","pos","splice","invokeMethod","receiver","method","handleRequest","messageId","request","serverId","sendResult","serviceWrapper","sendResulttResult","serviceMethod","metadata","sendInvocationError","stackTrace","result","numOutArgs","finished","context","suffix","remoteId","remoteID","names","$stream","senderPromise","$callback","$context","$suffix","$name","$remoteId","variables","indexOf","rpc","addIncomingStreamHandler","resultPromise","results","errorStruct","toStandardErrorStruct","serverClose","dequeue","responseData","responseDataJSON","JSON","stringify","sendRequest","RESPONSE","messageJSON","service","handler","SERVE","toString","STOP","proxyConnection","OutstandingRPC","_id","_name","_methodName","methodName","_args","_numOutParams","numOutParams","_isStreaming","isStreaming","_cb","_def","start","nextId","streamingDeferred","constructMessage","REQUEST","ws","FINAL_RESPONSE","handleCompletion","handleStreamData","handleError","handleStreamClose","queueRead","jsonMessage","inArgs","serviceSignaturePromise","getServiceSignature","serviceSignature","boundObject","bindMethod","methodInfo","slice","signature","catch","url","replace","currentWebSocketPromise","Proxy","WebSocket","create","constructor","websocket","deferred","onopen","configDeferred","_configDeferred","onerror","onmessage","frame","parse","convertServersToStrings","servers","out","nameUtil","join","makeAllTerminal","convertToTerminalName","allAreTerminal","every","isTerminal","_roots","errNotAMountTable","errNoSuchName","errNoSuchNameRoot","_maxDepth","_rootNames","isRooted","_resolveAgainstMountTable","resolveStep","_resolveLoop","curr","last","depth","handleErrors","resolveToMountTable","resolveMaximally","_numInitialSlashes","s","charAt","_numTailSlashes","_removeInitialSlashes","_removeTailSlashes","_joinNamePartsOnArray","parts","addedPart","numNameSlashes","numAddedPartSlashes","numInitialSlashes","nextSlashIndex","substr","nextDoubleSlashIndex","substring","_makeStreamWithErrors","rpcPromise","_createTransactionID","Math","floor","random","_getTrId","tr","_storageService","_updateTransaction","_transactionCreation","trid","srvc","createTransaction","commit","abort","StoreObject","path","_path","_bindPromise","_updateTransactionAndBind","exists","get","put","remove","setAttr","attrs","stat","query","watchGlob","pattern","resumeMarker","globRequest","Pattern","ResumeMarker","watchQuery","queryRequest","Query","glob","globT","wire","wireObservable","obj","State","DoesNotExist","InitialStateSkipped","ResumeMarkers","Now","inspect","opts","ctx","seen","stylize","stylizeNoColor","colors","isBoolean","showHidden","_extend","isUndefined","customInspect","stylizeWithColor","formatValue","str","styleType","style","styles","arrayToHash","array","hash","val","recurseTimes","isFunction","ret","isString","primitive","formatPrimitive","visibleKeys","getOwnPropertyNames","isError","formatError","isRegExp","RegExp","isDate","Date","base","braces","n","toUTCString","output","formatArray","formatProperty","pop","reduceToSingleString","simple","isNumber","isNull","l","String","match","desc","getOwnPropertyDescriptor","set","split","line","numLinesEst","reduce","prev","cur","ar","arg","isNullOrUndefined","isSymbol","re","isObject","objectToString","d","isPrimitive","o","pad","timestamp","time","getHours","getMinutes","getSeconds","getDate","months","getMonth","prop","formatRegExp","format","objects","len","x","Number","_","deprecate","msg","deprecated","warned","throwDeprecation","traceDeprecation","trace","global","noDeprecation","debugs","debugEnviron","debuglog","NODE_DEBUG","test","pid","bold","italic","underline","inverse","white","grey","black","blue","cyan","green","magenta","red","yellow","special","number","boolean","null","string","date","regexp","isBuffer","origin","add","EventEmitter","__bind","me","__hasProp","__extends","child","parent","ctor","__super__","__slice","_super","target","handleMessage","listen","channel","packed","pkg","pack","attachEvent","event","unpackaged","unpack","concat","_postie","_error","idlHelper","idlWire","methodMetadata","params","param","InArgs","NumOutArgs","IsStreaming","getParamNames","func","fnStr","extraMetadata","camelCaseName","toLowerCase","extra","definition","expected","inputArgs","numInArgs","hasStreaming","expectingStreaming","inputStreaming","outputStreaming","Duplex","flowId","webSocketPromise","isClient","objectMode","wsBuffer","shouldQueue","clientClose","write","_read","chunk","encoding","STREAM_VALUE","send","end","SIGNATURE","ec","_standard","iD","errId","errMessage","errIdConstrMap","verr","ErrIdConstr","Handler","caveats","_caveats","nameMatches","paths","expectedPaths","WS","sender","outstandingRequests","bindCache","_hasResolvedConfig","incomingRequestHandlers","BIND_CACHE_TTL","payload","isServerOriginatedMessage","cachedEntry","now","fetched","body","h","copy","fill","readUInt8","_events","_maxListeners","defaultMaxListeners","setMaxListeners","isNaN","TypeError","er","listeners","listener","m","newListener","g","fired","list","position","listenerCount","emitter","EE","Readable","Writable","Transform","PassThrough","pipe","dest","ondata","writable","pause","ondrain","readable","resume","onend","didOnEnd","onclose","destroy","cleanup","_isStdio","superCtor","super_","enumerable","configurable","TempCtor","polyfill","uri","protocols","instance","MozWebSocket","resolver","_subscribers","invokeResolver","resolvePromise","rejectPromise","reason","invokeCallback","settled","detail","succeeded","failed","hasCallback","handleThenable","FULFILLED","REJECTED","subscribe","onFulfillment","onRejection","subscribers","publish","_detail","resolved","objectOrFunction","fulfill","_state","PENDING","SEALED","async","publishFulfillment","publishRejection","configure","all","race","staticResolve","staticReject","asap","counter","thenPromise","callbacks","local","document","es6PromiseSupport","r","RSVPPromise","ReadableState","hwm","highWaterMark","buffer","pipes","pipesCount","flowing","ended","endEmitted","reading","calledRead","sync","needReadable","emittedReadable","readableListening","defaultEncoding","ranOut","awaitDrain","readingMore","decoder","StringDecoder","_readableState","readableAddChunk","state","addToFront","chunkInvalid","onEofChunk","unshift","emitReadable","maybeReadMore","needMoreData","roundUpToNextPowerOf2","MAX_HWM","p","howMuchToRead","Buffer","endReadable","emitReadable_","maybeReadMore_","read","pipeOnDrain","src","flow","written","emitDataEvents","pipeOnReadable","startPaused","paused","fromList","stringMode","buf","cpy","min","xs","util","setEncoding","enc","nOrig","doRead","pipeOpts","onunpipe","onfinish","_writableState","needDrain","unpipe","doEnd","stdout","stderr","endFn","dests","res","wrap","events","_fromList","WriteReq","WritableState","ending","noDecode","decodeStrings","writing","bufferProcessing","onwrite","writecb","writelen","errorEmitted","writeAfterEnd","validChunk","valid","decodeChunk","writeOrBuffer","doWrite","onwriteError","onwriteStateUpdate","needFinish","clearBuffer","afterWrite","onwriteDrain","finishMaybe","entry","need","endWritable","allowHalfOpen","objectKeys","TransformState","afterTransform","needTransform","transforming","writechunk","ts","_transformState","rs","_flush","done","_transform","writeencoding","instrument","getTime","promises","index","resolveAll","remaining","useNextTick","flush","useMutationObserver","iterations","observer","BrowserMutationObserver","node","createTextNode","observe","characterData","useSetTimeout","tuple","scheduleFlush","browserGlobal","MutationObserver","WebKitMutationObserver","subject","noZero","base64clean","byteLength","TYPED_ARRAY_SUPPORT","_augment","Uint8Array","_isBuffer","_set","isArrayish","hexWrite","offset","strLen","assert","byte","parseInt","utf8Write","charsWritten","blitBuffer","utf8ToBytes","asciiWrite","asciiToBytes","binaryWrite","base64Write","base64ToBytes","utf16leWrite","utf16leToBytes","base64Slice","base64","fromByteArray","utf8Slice","tmp","decodeUtf8Char","fromCharCode","asciiSlice","binarySlice","hexSlice","toHex","utf16leSlice","bytes","readUInt16","littleEndian","noAssert","readUInt32","readInt16","neg","readInt32","readFloat","ieee754","readDouble","writeUInt16","verifuint","j","writeUInt32","writeInt16","verifsint","writeInt32","writeFloat","verifIEEE754","writeDouble","stringtrim","INVALID_BASE64_RE","trim","byteArray","charCodeAt","encodeURIComponent","hi","lo","toByteArray","dst","decodeURIComponent","max","SlowBuffer","INSPECT_MAX_BYTES","poolSize","ArrayBuffer","arr","foo","subarray","isEncoding","totalLength","item","compare","y","isFinite","swap","toJSON","_arr","target_start","sliceLen","newBuf","writeUInt8","readUInt16LE","readUInt16BE","readUInt32LE","readUInt32BE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","toArrayBuffer","BP","_get","toLocaleString","assertEncoding","isBufferEncoding","passThroughWrite","utf16DetectIncompleteChar","incomplete","charReceived","charLength","base64DetectIncompleteChar","surrogateSize","detectIncompleteChar","charBuffer","charStr","charCode","lenIncomplete","size","cr","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","NaN","Infinity","pow","abs","LN2","lookup","decode","elt","code","PLUS","SLASH","NUMBER","UPPER","LOWER","b64ToByteArray","b64","L","placeHolders","Arr","uint8ToBase64","uint8","encode","num","tripletToBase64","temp","extraBytes","base64js"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\n *  @fileoverview Public API and entry point to the Veyron API\n */\n\nvar Runtime = require('./runtime/runtime');\nvar Deferred = require('./lib/deferred');\n\n/**\n * Create a Veyron Runtime\n * @param {Object} config Configuration Options\n */\nfunction init(options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  var def = new Deferred(callback);\n\n  getIdentity(function(err, name) {\n    if (err) {\n      def.reject(err);\n    }\n    options.identityName = name;\n    def.resolve(new Runtime(options));\n  });\n\n  return def.promise;\n}\n\nfunction getIdentity(callback) {\n  var isBrowser = (typeof window === 'object');\n\n  if (!isBrowser) {\n    return process.nextTick(callback.bind(null, null));\n  }\n\n  var Postie = require('postie');\n  var contentScript = new Postie(window);\n\n  // Runs when the auth request succeeds.\n  function handleAuthSuccess(data) {\n    removeListeners();\n    callback(null, data.name);\n  }\n\n  // Runs when the auth request fails.\n  function handleAuthError(err) {\n    removeListeners();\n    callback(err);\n  }\n\n  // Runs when the extension receives the auth request\n  function handleAuthReceived(){\n    // Stop asking for auth.\n    window.clearInterval(authRequestInterval);\n  }\n\n  function removeListeners(){\n    window.clearInterval(authRequestInterval);\n    contentScript.removeListener('auth:success', handleAuthSuccess);\n    contentScript.removeListener('auth:Error', handleAuthError);\n  }\n\n  contentScript.on('auth:success', handleAuthSuccess);\n  contentScript.on('auth:error', handleAuthError);\n  contentScript.on('auth:received', handleAuthReceived);\n\n  // Repeatedly ask the extension to auth.  The first time this runs, the\n  // extension might not be running yet, so we need to ask in a setInterval.\n  // TODO(nlacasse): timeout with an error after X seconds\n  var authRequestInterval = window.setInterval(function(){\n    contentScript.post('auth');\n  }, 200);\n}\n\n/**\n * Enum for different log levels:\n *   NOLOG //No logging\n *   ERROR //Only errors are written\n *   WARN  //Only errors and warnings are written\n *   DEBUG //Errors, warnings and debug messages are written\n *   INFO  //All logs are written,\n * @readonly\n * @enum {number}\n */\nvar logLevels = require('./lib/vlog').levels;\n\n/**\n * Errors exposes a group of constructor functions to easily make common\n * Error objects with predefined names.\n */\nvar errors = require('./lib/verror');\n\n/**\n * Exports\n */\nmodule.exports = {\n  init: init,\n  logLevels: logLevels,\n  errors: errors\n};\n","// shim for using process in browser\n\nvar process = module.exports = {};\n\nprocess.nextTick = (function () {\n    var canSetImmediate = typeof window !== 'undefined'\n    && window.setImmediate;\n    var canPost = typeof window !== 'undefined'\n    && window.postMessage && window.addEventListener\n    ;\n\n    if (canSetImmediate) {\n        return function (f) { return window.setImmediate(f) };\n    }\n\n    if (canPost) {\n        var queue = [];\n        window.addEventListener('message', function (ev) {\n            var source = ev.source;\n            if ((source === window || source === null) && ev.data === 'process-tick') {\n                ev.stopPropagation();\n                if (queue.length > 0) {\n                    var fn = queue.shift();\n                    fn();\n                }\n            }\n        }, true);\n\n        return function nextTick(fn) {\n            queue.push(fn);\n            window.postMessage('process-tick', '*');\n        };\n    }\n\n    return function nextTick(fn) {\n        setTimeout(fn, 0);\n    };\n})();\n\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n}\n\n// TODO(shtylman)\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\n","/**\n * @fileoverview Veyron Runtime\n */\n\nvar Server = require('../ipc/server');\nvar ServerRouter = require('../ipc/server_router');\nvar Client = require('../ipc/client');\nvar ProxyConnection = require('../proxy/websocket');\nvar Promise = require('../lib/promise');\nvar Namespace = require('../namespace/namespace');\nvar namespaceUtil = require('../namespace/util');\nvar store = require('../storage/store');\nvar vLog = require('../lib/vlog');\nvar watch = require('../watch/watch');\n\nmodule.exports = Runtime;\n\nfunction Runtime(options) {\n  if (!(this instanceof Runtime)) {\n    return new Runtime(options);\n  }\n\n  options.proxy = options.proxy || 'vonery.com:8125';\n\n  // TODO(aghassemi) change default to NOLOG before release\n  if (typeof options.logLevel === 'undefined' || options.logLevel === null) {\n    options.logLevel =  vLog.levels.DEBUG;\n  }\n  this._options = options;\n  vLog.level = options.logLevel;\n\n}\n\n/**\n * Performs client side binding of a remote service to a native javascript\n * stub object.\n *\n * Usage:\n * var service = runtime.bindTo('EndpointAddress', 'ServiceName')\n * var resultPromise = service.MethodName(arg);\n *\n * @param {string} name the veyron name of the service to bind to.\n * @param {object} optServiceSignature if set, javascript signature of methods\n * available in the remote service.\n * @param {function} [callback] if given, this function will be called on\n * completion of the bind.  The first argument will be an error if there is\n * one, and the second argument is an object with methods that perform rpcs to\n * service\n * methods.\n * @return {Promise} An object with methods that perform rpcs to service methods\n *\n */\nRuntime.prototype.bindTo = function(name, optServiceSignature, callback) {\n  var client = this._getClient();\n  return client.bindTo(name, optServiceSignature, callback);\n};\n\n/**\n * A Veyron server allows registration of services that can be\n * invoked remotely via RPCs.\n *\n * Usage:\n * var videoService = {\n *   play: function(videoName) {\n *     // Play video\n *   }\n * };\n *\n * var service = runtime.serve('mymedia/video', videoService)\n *\n * @param {string} name Name to serve under\n * @param {Object} serviceObject service object to serve\n * @param {*} serviceMetadata if provided a set of metadata for functions\n * in the service (such as number of return values).  It could either be\n * passed in as a properties object or a string that is the name of a\n * service that was defined in the idl files that the server knows about.\n * @param {function} callback if provided, the function will be called on\n * completion. The only argument is an error if there was one.\n * @return {Promise} Promise to be called when serve completes or fails\n * the endpoint address of the server will be returned as the value of promise\n */\nRuntime.prototype.serve = function(name, serviceObject, serviceMetadata,\n    callback) {\n  var server = this._getServer();\n  return server.serve(name, serviceObject, serviceMetadata, callback);\n};\n\n/**\n * addIDL adds an IDL file to the set of definitions known by the server.\n * Services defined in IDL files passed into this method can be used to\n * describe the interface exported by a serviceObject passed into register.\n * @param {object} updates the output of the vdl tool on an idl.\n */\nRuntime.prototype.addIDL = function(updates) {\n  var server = this._getServer();\n  return server.addIDL(updates);\n};\n\n/**\n * Get or creates a new proxy connection\n * @return {ProxyConnection} A proxy connection\n */\nRuntime.prototype._getProxyConnection = function() {\n  if (!this._proxyConnection) {\n    this._proxyConnection = new ProxyConnection(this._options.proxy);\n  }\n  return this._proxyConnection;\n};\n\n/**\n * Get or creates a router\n * @return {ServerRouter} A router\n */\nRuntime.prototype._getRouter = function() {\n  if (!this._router) {\n    this._router = new ServerRouter(\n        this._getProxyConnection());\n  }\n  return this._router;\n};\n\n\n/**\n * Get or creates a client\n * @return {Client} A client\n */\nRuntime.prototype._getClient = function() {\n  this._client = this._client || new Client(this._getProxyConnection());\n  return this._client;\n};\n\n/**\n * Get or creates a server\n * @return {Server} A server\n */\nRuntime.prototype._getServer = function() {\n  this._server = this._server || new Server(this._getRouter());\n  return this._server;\n};\n\n/**\n * Create a Veyron store client to access the store.\n * For usage, @see storage/store.js\n */\nRuntime.prototype.newStore = function() {\n  return new store.Store(this._getClient());\n};\n\n/**\n * Create a new Namespace\n * @return {Promise} A promise that resolves to a Namespace instance.\n */\nRuntime.prototype.newNamespace = function(roots) {\n  var rt = this;\n  var proxy = this._getProxyConnection();\n\n  if (roots) {\n    return Promise.resolve(new Namespace(this._getClient(), roots));\n  }\n\n  // We have to ask for the websocket now, otherwise the config\n  // wont arrive until the first time someone tries to make a call\n  // which is deadlock prone.\n  proxy.getWebSocket();\n  return proxy.config.then(function(config) {\n    return new Namespace(rt._getClient(), config.mounttableRoot);\n  });\n};\n\n/**\n * Utility functions to manipulate veyron names\n */\nRuntime.namespaceUtil = namespaceUtil;\n\n/**\n * Transaction is a constructor for a new store transaction.\n */\nRuntime.Transaction = store.Transaction;\n\n/**\n * Watch is a constructor for a new Watch.\n */\nRuntime.Watch = watch;\n","/**\n * @fileoverview A lightweight deferred implementation using ES6 Promise\n * Deferred are sometimes easier to use since they can be passed around\n * and rejected, resolved by other code whereas Promise API does not expose\n * reject and resolve publicly.\n */\n\nvar Promise = require('./promise');\n\nvar Deferred = function(cb) {\n  var self = this;\n\n  this.promise = new Promise(function(resolve, reject) {\n    self.resolve = resolve;\n    self.reject = reject;\n  });\n  if (cb) {\n    this.promise.then(function resolve(v) {\n      cb(null, v);\n    }, function error(e) {\n      cb(e);\n    });\n  }\n};\n\n/**\n * Export the module\n */\nmodule.exports = Deferred;\n","/**\n * @fileoverview A lightweight logging framework for JavaScript to be used\n * in place of console so that we can persist the logs if needed and turn\n * logging off at different levels.\n */\nvar vlog = function() {\n\n  // default level is nolog\n  this.level = this.levels.NOLOG;\n};\n\n/**\n * Enum for different log levels\n * @readonly\n * @enum {number}\n */\nvlog.prototype.levels = {\n  NOLOG: 0, // No logs are written\n  ERROR : 1, // Only errors are written\n  WARN: 2, // Only errors and warnings are written\n  DEBUG : 3, // Errors, warnings and debug messages are written\n  INFO : 4 // All logs are written,\n};\n\n/**\n * Logs arguments as errors to the console if log level is error or higher\n */\nvlog.prototype.error = function() {\n  this._log(this.levels.ERROR, arguments);\n};\n\n/**\n * Logs arguments as warnings to the console if log level is warning or higher\n */\nvlog.prototype.warn = function() {\n  this._log(this.levels.WARN, arguments);\n};\n\n/**\n * Logs arguments as logs to the console if log level is debug or higher\n */\nvlog.prototype.debug = function() {\n  this._log(this.levels.DEBUG, arguments);\n};\n\n/**\n * Logs arguments as info to the console if log level is info or higher\n */\nvlog.prototype.info = function() {\n  this._log(this.levels.INFO, arguments);\n};\n\nvlog.prototype._log = function(level, args) {\n  if (this.level >= level) {\n    this._write(level, args);\n  }\n};\n\nvlog.prototype._write = function(level, args) {\n  var c = this._getConsole();\n\n  if (!c) {\n    return;\n  }\n\n  var consoleFunc = c.log;\n  switch (level) {\n    case this.levels.ERROR:\n      consoleFunc = c.error;\n      break;\n    case this.levels.WARN:\n      consoleFunc = c.warn;\n      break;\n    case this.levels.DEBUG:\n      consoleFunc = c.log;\n      break;\n    case this.levels.INFO:\n      consoleFunc = c.info;\n      break;\n  }\n\n  consoleFunc.apply(c, args);\n};\n\nvlog.prototype._getConsole = function() {\n  if (typeof console !== 'undefined') {\n    return console;\n  }\n\n  return null;\n};\n\nvar vlogInstance = new vlog();\n/*\n * Export the module\n */\nmodule.exports = vlogInstance;\n","/**\n * @fileoverview built-in Veyron errors\n */\n\nvar inherits = require('util').inherits;\n\nvar vError = {};\n\n/*\n * List of predefined error ids. Matches veyron2/vError/common.idl\n */\nvError.Ids = {\n  Aborted: 'veyron2/verror.Aborted',\n  BadArg: 'veyron2/verror.BadArg',\n  BadProtocol: 'veyron2/verror.BadProtocol',\n  Exists: 'veyron2/verror.Exists',\n  Internal: 'veyron2/verror.Internal',\n  NotAuthorized: 'veyron2/verror.NotAuthorized',\n  NotFound: 'veyron2/verror.NotFound'\n};\n\n/*\n * Creates an error object given the ID as the name and a message\n * @constructor\n * @param {string} message message\n * @param {vError.Ids} id Error id\n */\nvError.VeyronError = function(message, id) {\n  if (!(this instanceof vError.VeyronError)) {\n    return new vError.VeyronError(message, id);\n  }\n  Error.call(this);\n  this.message = message;\n  if (id) {\n    this.name = id;\n  }\n  if (typeof Error.captureStackTrace === 'function') {\n    Error.captureStackTrace(this, vError.VeyronError);\n  } else {\n    this.stack = (new Error()).stack;\n  }\n};\ninherits(vError.VeyronError, Error);\n\n/*\n * Tests if two errors are equal.\n * If the errors are both VeyronErrors then this returns true\n * when their messange and names are equal.  Other cases return false.\n * @param {Error} a An error to compare\n * @param {Error} a An error to compare\n * @return {boolean} Returns true if the errors are equal.\n */\nvError.equals = function(a, b) {\n  var ais = a instanceof vError.VeyronError;\n  var bis = b instanceof vError.VeyronError;\n  if (ais && bis) {\n    return a.message === b.message && a.id === b.id;\n  }\n  return false;\n};\n\n/*\n * Creates an error object indicating operation aborted, e.g. connection closed.\n * @constructor\n * @param {string} message message\n */\nvError.AbortedError = function(message) {\n  if (!(this instanceof vError.AbortedError)) {\n    return new vError.AbortedError(message);\n  }\n  vError.VeyronError.call(this, message, vError.Ids.Aborted);\n};\ninherits(vError.AbortedError, vError.VeyronError);\n\n/*\n * Creates an error object indicating requester specified an invalid argument.\n * @constructor\n * @param {string} message message\n * @return {Error} Error object with name set to the badarg error id.\n */\nvError.BadArgError = function(message) {\n  if (!(this instanceof vError.BadArgError)) {\n    return new vError.BadArgError(message);\n  }\n  vError.VeyronError.call(this, message, vError.Ids.BadArg);\n};\ninherits(vError.BadArgError, vError.VeyronError);\n\n/*\n * Creates an error object indicating protocol mismatch,\n * including type or argument errors.\n * @param {string} message message\n * @return {Error} Error object with name set to the bad protocol error id.\n */\nvError.BadProtocolError = function(message) {\n  if (!(this instanceof vError.BadProtocolError)) {\n    return new vError.BadProtocolError(message);\n  }\n  vError.VeyronError.call(this, message, vError.Ids.BadProtocol);\n};\ninherits(vError.BadProtocolError, vError.VeyronError);\n\n/*\n * Creates an error object indicating requested entity already exists\n * @param {string} message message\n * @return {Error} Error object with name set to the exists error id.\n */\nvError.ExistsError = function(message) {\n  if (!(this instanceof vError.ExistsError)) {\n    return new vError.ExistsError(message);\n  }\n  vError.VeyronError.call(this, message, vError.Ids.Exists);\n};\ninherits(vError.ExistsError, vError.VeyronError);\n\n/*\n * Creates an error object indicating internal invariants broken;\n * something is very wrong\n * @param {string} message message\n * @return {Error} Error object with name set to the internal error id.\n */\nvError.InternalError = function(message) {\n  if (!(this instanceof vError.InternalError)) {\n    return new vError.InternalError(message);\n  }\n  vError.VeyronError.call(this, message, vError.Ids.Internal);\n};\ninherits(vError.InternalError, vError.VeyronError);\n\n/*\n * Creates an error object indicating requester isn't authorized\n * to access the entity.\n * @param {string} message message\n * @return {Error} Error object with name set to the not authorized error id.\n */\nvError.NotAuthorizedError = function(message) {\n  if (!(this instanceof vError.NotAuthorizedError)) {\n    return new vError.NotAuthorizedError(message);\n  }\n  vError.VeyronError.call(this, message, vError.Ids.NotAuthorized);\n};\ninherits(vError.NotAuthorizedError, vError.VeyronError);\n\n/*\n * Creates an Error object indicating requested entity (e.g. object, method)\n * not found\n * @param {string} message message\n * @return {Error} Error object with name set to the not found error id.\n */\nvError.NotFoundError = function(message) {\n  if (!(this instanceof vError.NotFoundError)) {\n    return new vError.NotFoundError(message);\n  }\n  vError.VeyronError.call(this, message, vError.Ids.NotFound);\n};\ninherits(vError.NotFoundError, vError.VeyronError);\n\nmodule.exports = vError;\n","/**\n *  @fileoverview Server allows creation of services that can be invoked\n *  remotely via RPCs.\n *\n *  Usage:\n *  var videoService = {\n *    play: {\n *      // Play video\n *    }\n *  };\n *\n *  var s = new server(proxyConnection);\n *  s.serve('mymedia/video', videoService);\n */\n\nvar Deferred = require('./../lib/deferred');\nvar IdlHelper = require('./../idl/idl');\nvar vError = require('./../lib/verror');\nvar ServiceWrapper = IdlHelper.ServiceWrapper;\n\nvar nextServerID = 1; // The ID for the next server.\n\n/**\n * represents a veyron server which allows registration of services that can be\n * invoked remotely via RPCs.\n * @constructor\n * @param {Object} router the server router.\n */\nfunction Server(router) {\n  if (!(this instanceof Server)) {\n    return new Server(router);\n  }\n\n  this._router = router;\n  this.id = nextServerID++;\n  this.serviceObject = null;\n  this._knownServiceDefinitions = {};\n}\n\n/**\n * addIDL adds an IDL file to the set of definitions known by the server.\n * Services defined in IDL files passed into this method can be used to\n * describe the interface exported by a serviceObject passed into register.\n * @param {object} updates the output of the vdl tool on an idl.\n */\nServer.prototype.addIDL = function(updates) {\n  var prefix = updates.package;\n  for (var key in updates) {\n    if (key[0] === key[0].toUpperCase() && updates.hasOwnProperty(key)) {\n      this._knownServiceDefinitions[prefix + '.' + key] = updates[key];\n    }\n  }\n};\n\n// Returns an error if the validation of metadata failed.\nServer.prototype._getAndValidateMetadata = function(serviceObject,\n    serviceMetadata) {\n  var shouldCheckDefinition = false;\n  if (typeof(serviceMetadata) === 'string') {\n    serviceMetadata = [serviceMetadata];\n  }\n\n  if (Array.isArray(serviceMetadata)) {\n    shouldCheckDefinition = true;\n    var serviceDefinitions = {};\n\n    for (var i = 0; i < serviceMetadata.length; i++) {\n      var key = serviceMetadata[i];\n      var object = this._knownServiceDefinitions[key];\n      if (!object) {\n        return new vError.NotFoundError('unknown service ' + key);\n      }\n      // Merge the results into the single definitions object.\n      for (var k in object) {\n        if (object.hasOwnProperty(k)) {\n          serviceDefinitions[k] = object[k];\n        }\n      }\n    }\n    serviceMetadata = serviceDefinitions;\n  }\n\n  var wrapper = new ServiceWrapper(serviceObject, serviceMetadata);\n\n  if (shouldCheckDefinition) {\n    var err2 = wrapper.validate(serviceMetadata);\n    if (err2) {\n      return err2;\n    }\n  }\n\n  this.serviceObject = wrapper;\n\n  return null;\n};\n\n/**\n * Serve serves the given service object under the given name.  It will\n * register them with the mount table and maintain that registration so long\n * as the stop() method has not been called.  The name determines where\n * in the mount table's name tree the new services will appear.\n *\n * To serve names of the form \"mymedia/*\" make the calls:\n * serve(\"mymedia\", myService);\n\n * serve may be called multiple times to serve the same service under\n * multiple names.  If different objects are given on the different calls\n * it is considered an error.\n *\n * @param {string} name Name to serve under\n * @param {Object} serviceObject service object to serve\n * @param {*} serviceMetadata if provided a set of metadata for functions\n * in the service (such as number of return values).  It could either be\n * passed in as a properties object or a string that is the name of a\n * service that was defined in the idl files that the server knows about.\n * @param {function} callback if provided, the function will be called on\n * completion. The only argument is an error if there was one.\n * @return {Promise} Promise to be called when serve completes or fails\n * the endpoint address of the server will be returned as the value of promise\n */\nServer.prototype.serve = function(name, serviceObject,\n    serviceMetadata, callback) {\n  if (!callback && typeof(serviceMetadata) === 'function') {\n    callback = serviceMetadata;\n    serviceMetadata = null;\n  }\n\n  var err = this._getAndValidateMetadata(serviceObject, serviceMetadata);\n  if (err) {\n    var def = new Deferred(callback);\n    def.reject(err);\n    return def.promise;\n  }\n\n  return this._router.serve(name, this, callback);\n};\n\n/**\n * Stop gracefully stops all services on this Server.\n * New calls are rejected, but any in-flight calls are allowed to complete.\n * All published named are unmounted.\n * @param {function} callback if provided, the function will be called on\n * completion. The only argument is an error if there was one.\n * @return {Promise} Promise to be called when stop service completes or fails\n */\nServer.prototype.stop = function(callback) {\n  return this._router.stopServer(this, callback);\n};\n\n/**\n * Generates an IDL wire description for all the registered services\n * @return {Object.<string, Object>} map from service name to idl wire\n * description\n */\nServer.prototype.generateIdlWireDescription = function() {\n  return IdlHelper.generateIdlWireDescription(this.serviceObject);\n};\n\n/**\n * Export the module\n */\nmodule.exports = Server;\n","/**\n * @fileoveriew A router that handles incoming server rpcs.\n */\n\nvar Stream = require('../proxy/stream');\nvar MessageType = require('../proxy/message_type');\nvar IncomingPayloadType = require('../proxy/incoming_payload_type');\nvar ErrorConversion = require('../proxy/error_conversion');\nvar Deferred = require('./../lib/deferred');\nvar Promise = require('./../lib/promise');\nvar vLog = require('./../lib/vlog');\nvar SimpleHandler = require('../proxy/simple_handler');\nvar PublicId = require('../security/public');\n\n\nvar ServerStream = function(stream) {\n  this._stream = stream;\n};\n\nServerStream.prototype.handleResponse = function(type, data) {\n  switch (type) {\n    case IncomingPayloadType.STREAM_RESPONSE:\n      this._stream._queueRead(data);\n      break;\n    case IncomingPayloadType.STREAM_CLOSE:\n      this._stream._queueRead(null);\n      break;\n    case IncomingPayloadType.ERROR_RESPONSE:\n      this._stream.emit('error', ErrorConversion.toJSerror(data));\n      break;\n  }\n};\n\n/**\n * A router that handles routing incoming requests to the right\n * server\n * @constructor\n */\nvar Router = function(proxy) {\n  this._servers = {};\n  this._proxy = proxy;\n  this._streamMap = {};\n  proxy.addIncomingHandler(IncomingPayloadType.INVOKE_REQUEST, this);\n};\n\n/**\n * Injects the injections into the eight positions in args and\n * returns what was injected.\n * @param {Array} args The arguments to inject into.\n * @param {Object} injectionPositions A map of injected variables to the\n * position to put in args.\n * @param {Object} injections A map of injected variables to values.\n * @return {Array} the array of variables that were injected.\n */\nvar inject = function(args, injectionPositions, injections) {\n  var keys = Object.keys(injectionPositions);\n  var invertedMap = {};\n  keys.forEach(function(key) {\n    invertedMap[injectionPositions[key]] = key;\n  });\n  var values = keys.map(function getValue(k) {\n    return injectionPositions[k];\n  });\n  values.filter(function removeUndefined(value) {\n    return value !== undefined;\n  });\n  values.sort();\n  var keysInserted = [];\n  values.forEach(function actuallyInject(pos) {\n    var key = invertedMap[pos];\n    args.splice(pos, 0, injections[key]);\n    keysInserted.push(key);\n  });\n  return keysInserted;\n};\n\n// Wraps the call to the method with a try block in the smallest\n// function possible, so that v8 de-optimizes as little as possible.\nRouter.prototype.invokeMethod = function (receiver, method, args) {\n  // Call the registered method on the requested service\n  try {\n    return method.apply(receiver, args);\n  } catch (e) {\n    if (e instanceof Error) {\n      return e;\n    }\n    return new Error(e);\n  }\n};\n\n/**\n * Handles incoming requests from the server to invoke methods on registered\n * services in JavaScript.\n * @param {string} messageId Message Id set by the server.\n * @param {Object} request Invocation request JSON. Request's structure is\n * {\n *   serverId: number // the server id\n *   method: string // Name of the method on the service to call\n *   args: [] // Array of positional arguments to be passed into the method\n * }\n */\n\nRouter.prototype.handleRequest = function(messageId, request) {\n  var err;\n  var server = this._servers[request.serverId];\n  if (!server) {\n    err = new Error('Request for unknown server ' + request.serverId);\n    this.sendResult(messageId, request.method, null, err);\n    return;\n  }\n\n  var serviceWrapper = server.serviceObject;\n  if (!serviceWrapper) {\n    err = new Error('No service found');\n    this.sendResulttResult(messageId, request.method, null, err);\n    return;\n  }\n\n  var serviceObject = serviceWrapper.object;\n\n  // Find the method\n  var serviceMethod = serviceObject[request.method];\n  if (serviceMethod === undefined) {\n    err = new Error('Requested method ' + request.method +\n        ' not found on');\n    this.sendResult(messageId, request.method, null, err);\n    return;\n  }\n  var metadata = serviceWrapper.metadata[request.method];\n\n  var self = this;\n  var sendInvocationError = function(e, metadata) {\n    var stackTrace;\n    if (e instanceof Error && e.stack !== undefined) {\n      stackTrace = e.stack;\n    }\n    vLog.debug('Requested method ' + request.method +\n        ' threw an exception on invoke: ', e, stackTrace);\n    var numOutArgs = metadata.numOutArgs;\n    var result;\n    switch (numOutArgs) {\n      case 0:\n        break;\n      case 1:\n        result = null;\n        break;\n      default:\n        result = new Array(numOutArgs);\n    }\n    self.sendResult(messageId, request.method, result, e,\n        metadata);\n  };\n  var args = request.args;\n\n  // Create callback to pass to the function, if it is requested.\n  var finished = false;\n  var cb = function callback(e, v) {\n    if (finished) {\n      return;\n    }\n    finished = true;\n    self.sendResult(messageId, request.method, v, e, metadata);\n  };\n\n  var context = {\n    suffix: request.context.suffix,\n    name: request.context.name,\n    remoteId: new PublicId(request.context.remoteID.names)\n  };\n\n  var injections = {\n    $stream: new Stream(messageId, this._proxy.senderPromise, false),\n    $callback: cb,\n    $context: context,\n    $suffix: context.suffix,\n    $name: context.name,\n    $remoteId: context.remoteId\n  };\n\n  var variables = inject(args, metadata.injections, injections);\n  if (variables.indexOf('$stream') !== -1) {\n    var stream = injections['$stream'];\n    this._streamMap[messageId] = stream;\n    var rpc = new ServerStream(stream);\n    this._proxy.addIncomingStreamHandler(messageId, rpc);\n  }\n\n  // Invoke the method\n  var result = this.invokeMethod(serviceObject, serviceMethod, args);\n\n  if (result instanceof Error) {\n    sendInvocationError(result, metadata);\n    return;\n  }\n\n  // Normalize result to be a promise\n  var resultPromise = Promise.resolve(result);\n\n  if (variables.indexOf('$callback') !== -1) {\n    // The callback takes care of sending the result, so we don't use the\n    // promises.\n    return;\n  }\n\n  // Send the result back to the server\n  resultPromise.then(function(value) {\n    if (finished) {\n      return;\n    }\n    finished = true;\n    self.sendResult(messageId, request.method, value,\n        null, metadata);\n  }, function(err) {\n    if (finished) {\n      return;\n    }\n    finished = true;\n    sendInvocationError(err, metadata);\n  });\n};\n\n/**\n * Sends the result of a requested invocation back to jspr\n * @param {string} messageId Message id of the original invocation request\n * @param {string} name Name of method\n * @param {Object} value Result of the call\n * @param {Object} err Error from the call\n * @param {Object} metadata Metadata about the function.\n */\nRouter.prototype.sendResult = function(messageId, name, value, err, metadata) {\n  var results = [];\n  if (metadata) {\n    switch (metadata.numOutArgs) {\n      case 0:\n        if (value !== undefined) {\n          vLog.error('Unexpected return value from ' + name + ': ' + value);\n        }\n        results = [];\n        break;\n      case 1:\n        results = [value];\n        break;\n      default:\n        if (Array.isArray(value)) {\n          if (value.length !== metadata.numOutArgs) {\n            vLog.error('Wrong number of arguments returned by ' + name +\n                '. expected: ' + metadata.numOutArgs + ', got:' +\n                value.length);\n          }\n          results = value;\n        } else {\n          vLog.error('Wrong number of arguments returned by ' + name +\n              '. expected: ' + metadata.numOutArgs + ', got: 1');\n          results = [value];\n        }\n    }\n  } else {\n    results = [value];\n  }\n\n  var errorStruct = null;\n  if (err !== undefined && err !== null) {\n    errorStruct = ErrorConversion.toStandardErrorStruct(err);\n  }\n\n  // If this is a streaming request, queue up the final response after all\n  // the other stream requests are done.\n  var stream = this._streamMap[messageId];\n  if (stream) {\n    // We should probably remove the stream from the dictionary, but it's\n    // not clear if there is still a reference being held elsewhere.  If there\n    // isn't, then GC might prevent this final message from being sent out.\n    stream.serverClose(value, errorStruct);\n    this._proxy.dequeue(messageId);\n  } else {\n    var responseData = {\n      results: results,\n      err: errorStruct\n    };\n\n    var responseDataJSON = JSON.stringify(responseData);\n    this._proxy.sendRequest(responseDataJSON, MessageType.RESPONSE, null,\n        messageId);\n  }\n};\n\n/**\n * Serves the server under the given name\n * @param {string} name Name to serve under\n * @param {Veyron.Server} The server who will handle the requests for this\n * name.\n * @param {function} [callback] If provided, the function will be called when\n * serve completes.  The first argument passed in is the error if there\n * was any and the second argument is the endpoint.\n * @return {Promise} Promise to be called when serve completes or fails\n * the endpoint string of the server will be returned as the value of promise\n */\nRouter.prototype.serve = function(name, server, callback) {\n  vLog.info('Serving under the name: ', name);\n\n  var messageJSON = {\n    name: name,\n    serverId: server.id,\n    service: server.generateIdlWireDescription()\n  };\n\n  this._servers[server.id] = server;\n\n  var def = new Deferred(callback);\n  var message = JSON.stringify(messageJSON);\n  var id = this._proxy.id;\n  this._proxy.id += 2;\n  var handler = new SimpleHandler(def, this._proxy, id);\n  // Send the serve request to the proxy\n  this._proxy.sendRequest(message, MessageType.SERVE, handler, id);\n\n  return def.promise;\n};\n\n/**\n * Sends a stop server request to jspr.\n * @param {Server} server Server object to stop.\n * @param {function} callback if provided, the function will be called on\n * completion. The only argument is an error if there was one.\n * @return {Promise} Promise to be called when stop service completes or fails\n */\nRouter.prototype.stopServer = function(server, callback) {\n  var self = this;\n\n  var def = new Deferred(callback);\n  var id = this._proxy.id;\n  this._proxy.id += 2;\n  var handler = new SimpleHandler(def, this._proxy, id);\n  // Send the stop request to jspr\n  this._proxy.sendRequest(server.id.toString(), MessageType.STOP, handler, id);\n\n  return def.promise.then(function(result) {\n    delete self._servers[server.id];\n    return result;\n  });\n};\n\n\nmodule.exports = Router;\n\n","/**\n *  @fileoverview Client for the veyron service.\n *\n *  Usage:\n *  var cl = new client(proxyConnection);\n *  var service = cl.bindTo('EndpointAddress', 'ServiceName');\n *  resultPromise = service.MethodName(arg);\n */\n\nvar Deferred = require('../lib/deferred');\nvar Promise = require('../lib/promise');\nvar vLog = require('../lib/vlog');\nvar ErrorConversion = require('../proxy/error_conversion');\nvar Stream = require('../proxy/stream');\nvar vError = require('../lib/verror');\nvar MessageType = require('../proxy/message_type');\nvar IncomingPayloadType = require('../proxy/incoming_payload_type');\n\nvar OutstandingRPC = function(options, cb) {\n  this._proxy = options.proxy;\n  this._id = -1;\n  this._name = options.name;\n  this._methodName = options.methodName,\n  this._args = options.args;\n  this._numOutParams = options.numOutParams;\n  this._isStreaming = options.isStreaming || false;\n  this._cb = cb;\n  this._def = null;\n};\n\nOutstandingRPC.prototype.start = function() {\n  this._id = this._proxy.nextId();\n  var def = new Deferred(this._cb);\n\n  var streamingDeferred = null;\n  if (this._isStreaming) {\n    streamingDeferred = new Deferred();\n    def.stream = new Stream(this._id, streamingDeferred.promise, true);\n    def.promise.stream = def.stream;\n  }\n\n  var message = this.constructMessage();\n\n  this._def = def;\n  this._proxy.sendRequest(message, MessageType.REQUEST, this, this._id);\n  if (streamingDeferred) {\n    this._proxy.senderPromise.then(function(ws) {\n      streamingDeferred.resolve(ws);\n    });\n  }\n\n  return def.promise;\n};\n\nOutstandingRPC.prototype.handleResponse = function(type, data) {\n  switch (type) {\n    case IncomingPayloadType.FINAL_RESPONSE:\n      this.handleCompletion(data);\n      break;\n    case IncomingPayloadType.STREAM_RESPONSE:\n      this.handleStreamData(data);\n      break;\n    case IncomingPayloadType.ERROR_RESPONSE:\n      this.handleError(data);\n      break;\n    case IncomingPayloadType.STREAM_CLOSE:\n      this.handleStreamClose();\n      break;\n    default:\n      this.handleError(\n          new vError.InternalError('Recieved unknown response type from wspr'));\n      break;\n  }\n};\n\nOutstandingRPC.prototype.handleCompletion = function(data) {\n  if (data.length === 1) {\n    data = data[0];\n  }\n  this._def.resolve(data);\n  if (this._def.stream) {\n    this._def.stream._queueRead(null);\n  }\n  this._proxy.dequeue(this._id);\n};\n\nOutstandingRPC.prototype.handleStreamData = function(data) {\n  if (this._def.stream) {\n    this._def.stream._queueRead(data);\n  } else {\n    vLog.warn('Ignoring streaming message for non-streaming flow : ' +\n        this._id);\n  }\n};\n\nOutstandingRPC.prototype.handleStreamClose = function() {\n  if (this._def.stream) {\n    this._def.stream._queueRead(null);\n  }\n};\n\nOutstandingRPC.prototype.handleError = function(data) {\n  var err;\n  if (data instanceof vError.VeyronError) {\n    err = data;\n  } else {\n    err = ErrorConversion.toJSerror(data);\n  }\n\n  if (this._def.stream) {\n    this._def.stream.emit('error', err);\n    this._def.stream.queueRead(null);\n  }\n  this._def.reject(err);\n  this._proxy.dequeue(this._id);\n};\n\n\n/**\n * Construct a message to send to the veyron native code\n * @return {string} json string to send to jspr\n */\nOutstandingRPC.prototype.constructMessage = function() {\n  var jsonMessage = {\n    name: this._name,\n    method: this._methodName,\n    inArgs: this._args || [],\n    numOutArgs: this._numOutParams || 1,\n    isStreaming: this._isStreaming\n  };\n  return JSON.stringify(jsonMessage);\n};\n\n/**\n * Client for the veyron service.\n * @constructor\n * @param {Object} proxyConnection Veyron proxy client\n */\nfunction Client(proxyConnection) {\n  if (!(this instanceof Client)) {\n    return new Client(proxyConnection);\n  }\n\n  this._proxyConnection = proxyConnection;\n}\n\n/**\n * Performs client side binding of a remote service to a native javascript\n * stub object.\n * @param {string} name the veyron name of the service to bind to.\n * @param {object} optServiceSignature if set, javascript signature of methods\n * available in the remote service.\n * @param {function} [callback] if given, this function will be called on\n * completion of the bind.  The first argument will be an error if there is\n * one, and the second argument is an object with methods that perform rpcs to\n * service\n * methods.\n * @return {Promise} An object with methods that perform rpcs to service methods\n */\nClient.prototype.bindTo = function(name, optServiceSignature, callback) {\n  var self = this;\n  if (typeof(optServiceSignature) === 'function') {\n    callback = optServiceSignature;\n    optServiceSignature = undefined;\n  }\n\n  var def = new Deferred(callback);\n  var serviceSignaturePromise;\n\n  if (optServiceSignature !== undefined) {\n    serviceSignaturePromise = Promise.resolve(optServiceSignature);\n  } else {\n    vLog.debug('Requesting service signature for:', name);\n    serviceSignaturePromise = self._proxyConnection.getServiceSignature(name);\n  }\n\n  var promise = def.promise;\n  serviceSignaturePromise.then(function(serviceSignature) {\n    vLog.debug('Received signature for:', name, serviceSignature);\n    var boundObject = {};\n    var bindMethod = function(methodName) {\n      var methodInfo = serviceSignature[methodName];\n      var numOutParams = methodInfo.numOutArgs;\n      boundObject[methodName] = function() {\n        var args = Array.prototype.slice.call(arguments, 0);\n        var cb = null;\n        if (args.length === methodInfo.inArgs.length + 1) {\n          cb = args[args.length - 1];\n          args = args.slice(0, methodInfo.inArgs.length);\n        }\n        if (args.length !== methodInfo.inArgs.length) {\n          throw new Error('Invalid number of arguments to \"' +\n            methodName + '\". Expected ' + methodInfo.inArgs.length +\n            ' but there were ' + args.length);\n        }\n        var rpc = new OutstandingRPC({\n           proxy: self._proxyConnection,\n           name: name,\n           methodName: methodName,\n           args: args,\n           numOutParams: numOutParams,\n           isStreaming: methodInfo.isStreaming\n        }, cb);\n        return rpc.start();\n      };\n    };\n\n    for (var methodName in serviceSignature) {\n      if (serviceSignature.hasOwnProperty(methodName)) {\n        bindMethod(methodName);\n      }\n    }\n\n    //Also stub out signature() on the bound object.\n    boundObject.signature = function() {\n      return Promise.resolve(serviceSignature);\n    };\n\n    def.resolve(boundObject);\n  }).catch (def.reject);\n\n  return promise;\n};\n\n/**\n * Export the module\n */\nmodule.exports = Client;\n","/**\n * @fileoverview WebSocket client implementation\n */\n\nvar WebSocket = require('./../lib/websocket');\nvar Deferred = require('./../lib/deferred');\nvar vLog = require('./../lib/vlog');\nvar Proxy = require('./proxy');\n\n/**\n * A client for the veyron service using websockets. Connects to the veyron wspr\n * and performs RPCs.\n * @constructor\n * @param {string} url of wspr that connects to the veyron network\n * identity\n */\nfunction ProxyConnection(url) {\n  this.url = url.replace(/^(http|https)/, 'ws') + '/ws';\n  this.currentWebSocketPromise = null;\n  // Since we haven't finished constructing the Proxy object,\n  // we can't call this.getWebsocket() to return the sender promise.\n  // Instead, we create a new promise that will eventually call\n  // getWebsocket and only resolve the promise after Proxy.call\n  // has completed.\n  var def = new Deferred();\n  Proxy.call(this, def.promise);\n  def.resolve(this.getWebSocket());\n}\n\nProxyConnection.prototype = Object.create(Proxy.prototype);\n\nProxyConnection.prototype.constructor = ProxyConnection;\n\n/**\n * Connects to the server and returns an open web socket connection\n * @return {promise} a promise that will be fulfilled with a websocket object\n * when the connection is established.\n */\nProxyConnection.prototype.getWebSocket = function() {\n  // We are either connecting or already connected, return the same promise\n  if (this.currentWebSocketPromise) {\n    return this.currentWebSocketPromise;\n  }\n\n  // TODO(bjornick): Implement a timeout mechanism.\n  var websocket = new WebSocket(this.url);\n  var self = this;\n  var deferred = new Deferred();\n  this.currentWebSocketPromise = deferred.promise;\n  websocket.onopen = function() {\n    vLog.info('Connected to proxy at', self.url);\n    deferred.resolve(websocket);\n  };\n  var configDeferred = this._configDeferred;\n  websocket.onerror = function(e) {\n    vLog.error('Failed to connect to proxy at url:', self.url);\n    deferred.reject(e);\n    configDeferred.reject(\n      'Proxy connection closed, failed to get config ' + e);\n  };\n\n  websocket.onmessage = function(frame) {\n    var message;\n    try {\n      message = JSON.parse(frame.data);\n    } catch (e) {\n      vLog.warn('Failed to parse ' + frame.data);\n      return;\n    }\n\n    self.process(message);\n  };\n\n  return deferred.promise;\n};\n\n/**\n * Export the module\n */\nmodule.exports = ProxyConnection;\n","/**\n * @fileoverview Just a wrapper for ES6 third-party Promise\n */\n\n/**\n * Export the module\n */\nmodule.exports = require('es6-promise').Promise;\n","/**\n *  @fileoverview Client library for the Namespace.\n */\n\nvar nameUtil = require('./util.js');\nvar Deferred = require('../lib/deferred');\nvar Promise = require('../lib/promise');\nvar vError = require('../lib/verror');\n\n/**\n * Namespace handles manipulating and querying from the mount table.\n * @param {object} client A veyron client.\n * @param {...string} roots root addresses to use as the root mount tables.\n * @constructor\n */\nvar Namespace = function(client, roots) {\n  this._client = client;\n  this._roots = roots;\n};\n\n/*\n * Error returned when resolution hits a non-mount table.\n */\nNamespace.errNotAMountTable = function() {\n  return new vError.VeyronError(\n    'Resolution target is not a mount table', vError.Ids.Aborted);\n};\n\n/*\n * Error returned from the mount table server when reading a non-existant name.\n */\nNamespace.errNoSuchName = function() {\n  return new vError.VeyronError(\n    'Name doesn\\'t exist', vError.Ids.NotFound);\n};\n\n/*\n * Error returned from the mount table server when reading a non-existant name.\n */\nNamespace.errNoSuchNameRoot = function() {\n  return new vError.VeyronError(\n    'Name doesn\\'t exist: root of namespace', vError.NotFound);\n};\n\n/*\n * Maximum number of hops between servers we will make to resolve a name.\n */\nNamespace._maxDepth = 32;\n\n/*\n * Make a name relative to the roots of this namespace.\n * @param {string} name A name.\n * @return {Array} A list of rooted names.\n */\nNamespace.prototype._rootNames = function(name) {\n  if (nameUtil.isRooted(name) && name !== '/') {\n    return [name];\n  }\n  var out = [];\n  for (var i = 0; i < this._roots.length; i++) {\n    out.push(nameUtil.join(this._roots[i], name));\n  }\n  return out;\n};\n\n/*\n * Utility function to join a suffix to a list of servers.\n * @param {Array} results An array of return values from a\n * resolveStep call.  The first element of the array is a list of servers.\n * The second element should be a string suffix.\n * @return {Array} list of servers with suffix appended.\n */\nfunction convertServersToStrings(results) {\n  var servers = results[0];\n  var suffix = results[1];\n  var out = [];\n  for (var i = 0; i < servers.length; i++) {\n    var name = servers[i].server;\n    if (suffix !== '') {\n      name = nameUtil.join(name, suffix);\n    }\n    out.push(name);\n  }\n  return out;\n}\n\n/*\n * Utility function to make an array of names terminal.\n * @param {Array} names List of names.\n * @return {Array} list of terminal names.\n */\nfunction makeAllTerminal(names) {\n  return names.map(nameUtil.convertToTerminalName);\n}\n\n/*\n * Utility function to check if every name in an array is terminal.\n * @param {Array} names List of names.\n * @return {boolean} true if every name in the input was terminal.\n */\nfunction allAreTerminal(names) {\n  return names.every(nameUtil.isTerminal);\n}\n\n/*\n * Utility method to try a single resolve step against a list of\n * mirrored MountTable servers.\n * @param {Array} names List of names representing mirrored MountTable servers.\n * @return {Promise} a promise that will be fulfilled with a list of further\n * resolved names.\n */\nNamespace.prototype._resolveAgainstMountTable = function(names) {\n  if (names.length === 0) {\n    return Promise.reject(\n      new vError.BadArgError('No servers to resolve query.'));\n  }\n\n  // TODO(mattr): Maybe make this take a service signature.\n  // That would be more efficient, but we would need to do error handling\n  // differently.\n  var self = this;\n  var name = nameUtil.convertToTerminalName(names[0]);\n  return this._client.bindTo(name).then(function onBind(service) {\n    if (service.resolveStep === undefined) {\n      throw Namespace.errNotAMountTable();\n    }\n    return service.resolveStep().then(convertServersToStrings);\n  }).catch(function onError(err) {\n    if (vError.equals(err, Namespace.errNoSuchName()) ||\n        vError.equals(err, Namespace.errNoSuchNameRoot()) ||\n        names.length <= 1) {\n      throw err;\n    } else {\n      return self._resolveAgainstMountTable(names.slice(1));\n    }\n  });\n};\n\n/*\n * Utility method to try a sequence of resolves until the resulting names are\n * entirely terminal.\n * @param {Array} curr List of equivalent names to try on this step.\n * @param {Array} last List of names that were tried on the previous step.\n * @param {number} depth The current depth of the recursive traversal.\n * @param {function} handleErrors A function that errors will be passed to\n * for special handling depending on the caller.\n * @return {Promise} a promise that will be fulfilled with a list of terminal\n * names.\n */\nNamespace.prototype._resolveLoop = function(curr, last, depth, handleErrors) {\n  var self = this;\n  return self._resolveAgainstMountTable(curr).then(function onResolve(names) {\n    if (allAreTerminal(names)) {\n      return names;\n    }\n    depth++;\n    if (depth > Namespace._maxDepth) {\n      throw new vError.InternalError('Maxiumum resolution depth exceeded.');\n    }\n    return self._resolveLoop(names, curr, depth, handleErrors);\n  }, function onError(err) {\n    return handleErrors(err, curr, last);\n  });\n};\n\n/**\n * resolveToMountTable resolves a veyron name to the terminal name of the\n * innermost mountable that owns the name.\n * @param {string} name The name to resolve.\n * @param {function} [callback] if given, this fuction will be called on\n * completion of the resolve.  The first argument will be an error if there\n * is one, and the second argument is a list of terminal names.\n * @return {Promise} A promise to a list of terminal names.\n */\nNamespace.prototype.resolveToMountTable = function(name, callback) {\n  var names = this._rootNames(name);\n  var deferred = new Deferred(callback);\n  var handleErrors = function(err, curr, last) {\n    if (vError.equals(err, Namespace.errNoSuchNameRoot()) ||\n        vError.equals(err, Namespace.errNotAMountTable())) {\n      return makeAllTerminal(last);\n    }\n    if (vError.equals(err, Namespace.errNoSuchName())) {\n      return makeAllTerminal(curr);\n    }\n    throw err;\n  };\n\n  deferred.resolve(this._resolveLoop(names, names, 0, handleErrors));\n\n  return deferred.promise;\n};\n\n/**\n * resolveMaximally resolves a veyron name as far as it can, whether the\n * target is a mount table or not.\n * @param {string} name The name to resolve.\n * @param {function} [callback] if given, this fuction will be called on\n * completion of the resolve.  The first argument will be an error if there\n * is one, and the second argument is a list of terminal names.\n * @return {Promise} A promise to a list of terminal names.\n */\nNamespace.prototype.resolveMaximally = function(name, callback) {\n  var names = this._rootNames(name);\n  var deferred = new Deferred(callback);\n  var handleErrors = function(err, curr, last){\n    if (vError.equals(err, Namespace.errNoSuchNameRoot()) ||\n        vError.equals(err, Namespace.errNoSuchName()) ||\n        vError.equals(err, Namespace.errNotAMountTable())) {\n      return makeAllTerminal(curr);\n    }\n    throw err;\n  };\n\n  deferred.resolve(this._resolveLoop(names, names, 0, handleErrors));\n\n  return deferred.promise;\n};\n\nmodule.exports = Namespace;\n","/**\n * @fileoverview Helpers for manipulating veyron names.\n */\n\nvar _numInitialSlashes = function(s) {\n  for (var i = 0; i < s.length; i++) {\n    if (s.charAt(i) !== '/') {\n      return i;\n    }\n  }\n  return s.length;\n};\nvar _numTailSlashes = function(s) {\n  for (var i = s.length - 1; i >= 0; i--) {\n    if (s.charAt(i) !== '/') {\n      return s.length - 1 - i;\n    }\n  }\n  return s.length;\n};\n\n\nvar _removeInitialSlashes = function(s) {\n  return s.replace(/^\\/*/g, '');\n};\nvar _removeTailSlashes = function(s) {\n  return s.replace(/\\/*$/g, '');\n};\n\nvar _joinNamePartsOnArray = function(parts) {\n  if (parts.length === 0) {\n    return '';\n  }\n\n  var name = parts[0];\n  for (var i = 1; i < parts.length; i++) {\n    var addedPart = parts[i];\n\n    var numNameSlashes = _numTailSlashes(name);\n    var numAddedPartSlashes = _numInitialSlashes(addedPart);\n\n    if (numNameSlashes === 0 && numAddedPartSlashes === 0) {\n      name += '/' + addedPart;\n      continue;\n    }\n\n    if (numAddedPartSlashes > numNameSlashes) {\n      name = _removeTailSlashes(name);\n      name += addedPart;\n    } else {\n      name += _removeInitialSlashes(addedPart);\n    }\n  }\n\n  return name;\n};\n\n/**\n * Joins parts of a name into a whole.\n * It preserves the rootedness and terminality of the name components.\n * Examples:\n * join(['a, b']) -> 'a/b'\n * join('/a/b/', '//d') -> '/a/b//d'\n * join('//a/b', 'c/') -> '//a/b/c/'\n * @param {array | varargs} Either a single array that contains the strings\n * to join or a variable number of string arguments that will be joined.\n * @return {string} A joined string\n */\nvar join = function(parts) {\n  if (Array.isArray(parts)) {\n    return _joinNamePartsOnArray(parts);\n  }\n  return _joinNamePartsOnArray(Array.prototype.slice.call(arguments));\n};\n\n/**\n  * Determines if a name is rooted, that is beginning with a single '/'.\n  * @param {string} The veyron name.\n  * @return {boolean} True if the name is rooted, false otherwise.\n  */\nvar isRooted = function(name) {\n  return _numInitialSlashes(name) === 1;\n};\n\n/**\n  * Determines if a name is terminal, meaning that it corresponds to a final\n  * endpoint and name and does not need to be resolved further.\n  * @param {string} The veyron name.\n  * @return {boolean} True if the name is a terminal name, false otherwise.\n  */\nvar isTerminal = function(name) {\n  var numInitialSlashes = _numInitialSlashes(name);\n  if (numInitialSlashes >= 2) {\n    // If the name begins with '//', it is terminal.\n    return true;\n  } else if (numInitialSlashes === 1) {\n    // If the name begins with a single slash, it is terminal if there are no\n    // more slashes (indexOf === -1) or if the next slash is a double slash.\n    var nextSlashIndex = name.substr(1).indexOf('/');\n    var nextDoubleSlashIndex = name.substr(1).indexOf('//');\n    return nextSlashIndex === nextDoubleSlashIndex;\n  } else {\n    // If there are no initial slashes, it is only terminal if it is the empty\n    // string.\n    return name.length === 0;\n  }\n};\n\n/**\n  * Converts a veyron name to a terminal name. This is used to generate a final\n  * name when a name has finished resolving.\n  * @param {string} The initial veyron name.\n  * @return {string} A terminal veyron name.\n  */\nvar convertToTerminalName = function(name) {\n  // '' -> '' and '/' -> ''\n  if (name === '' || name === '/') {\n    return '';\n  }\n\n  if (isRooted(name)) {\n    if (name.substr(1).indexOf('/') === -1) {\n      // '/endpoint' -> '/endpoint'\n      return name;\n    }\n    if (name.substr(1).indexOf('/') === name.length - 2) {\n      // '/endpoint/' -> '/endpoint'\n      return name.substring(0, name.length - 1);\n    }\n    // '/endpoint/something' -> '/endpoint//something'\n    // '/endpoint//something -> '/endpoint//something'\n    return name.replace(/^(\\/[^/]+?)[/]*\\//, '$1//');\n  } else {\n    // '/////something' -> '//something'\n    return '//' + _removeInitialSlashes(name);\n  }\n};\n\nmodule.exports = {\n  join: join,\n  isTerminal: isTerminal,\n  isRooted: isRooted,\n  convertToTerminalName: convertToTerminalName\n};\n","/**\n *  @fileoverview Client for the Veyron store.\n *\n *  Usage:\n *  // With transactions:\n *  var tr = Veyron.transaction();\n *  var store = veyron.newStore();\n *  store.bindTo('/addr/of/object1').then(function(s) {\n *    return s.get(tr);\n *  }.then(function(obj1) {\n *    return store.bindTo('/addr/of/object2').then(function(s) {\n *      return s.put(tr, obj1.value);\n *    });\n *  }).then(function() {\n *    return tr.commit(); // (tr.abort is also an option)\n *  });\n *\n *  // Operations without setting up transactions manually:\n *  var stream = store.bindTo('/path/to/glob').glob('*');\n *  stream.on('data', function(item) {\n *    console.log('Glob result: ' + item);\n *  });\n *  stream.on('error', function(err) {\n *    console.err('Error occured in glob: ' + err);\n *  });\n */\n\nvar Promise = require('../lib/promise');\nvar names = require('../namespace/util.js');\n\n// Modifies stream in rpcPromise to emit 'error' events when the promise\n// rejects.\n// TODO(bprosnitz) This should probably happen to all veyron streams.\nvar _makeStreamWithErrors = function(rpcPromise) {\n  // TODO(bprosnitz) Cancelling a stream should cancel the RPC (for watch).\n  var stream = rpcPromise.stream;\n  rpcPromise.catch(function(err) {\n    stream.emit('error', err);\n  });\n  return stream;\n};\n\n// Generate a transaction id. This uses the same algorithm as go.\n// TODO(bprosnitz) Should we use an algorithm that better covers the 64 bit\n// space?\nvar _createTransactionID = function() {\n  // 1 << 62 is greatest int 64 val.\n  // This does not actually generate 62 bits of entropy because javascript uses\n  // floating point numbers.\n  return Math.floor(Math.random() * (1 << 62));\n};\n\n// Gets a transaction ID from a transaction, or return 0 (the signal to make\n// a transaction for the duration of the method) if the transaction is falsy.\nvar _getTrId = function(tr) {\n  if (tr) {\n    return tr._id;\n  }\n  return 0;\n};\n\n/**\n * Transaction represents a transaction in the store.\n * It is only valid against one store.\n * @constructor\n */\nvar Transaction = function() {\n  if (!(this instanceof Transaction)) {\n    return new Transaction();\n  }\n  this._id = _createTransactionID();\n  this._client = null;\n  this._storageService = null;\n};\n\nTransaction.prototype._updateTransaction = function(client, service) {\n  // TODO(bprosnitz) The check below fails in the tests. Figure out why and\n  // fix this.\n  /*if (this._client && client !== this._client) {\n    throw new Error('Cannot change a transaction\\'s client.');\n  }*/\n  this._client = client;\n  this._storageService = names.join(service, '.store');\n  if (!this._transactionCreation) {\n    var trid = this._id;\n    this._transactionCreation = this._client.bindTo(\n      this._storageService).then(function(srvc) {\n      return srvc.createTransaction(trid, []);\n    });\n  }\n  return this._transactionCreation;\n};\n\nTransaction.prototype.commit = function() {\n  if (this._client === null) {\n    // Empty transaction.\n    return Promise.resolve();\n  }\n  var trid = this._id;\n  return this._client.bindTo(this._storageService).then(function(srvc) {\n    return srvc.commit(trid);\n  });\n};\n\nTransaction.prototype.abort = function() {\n  if (this._client === null) {\n    // Empty transaction.\n    return Promise.resolve();\n  }\n  var trid = this._id;\n  return this._client.bindTo(this._storageService).then(function(srvc) {\n    return srvc.abort(trid);\n  });\n};\n\n/**\n * StoreObject represents an object in the store.\n * The methods on this object are defined in services/store/service.idl\n * @param {object} client The veyron client.\n * @param {string} The path of the store object.\n * @constructor\n */\nvar StoreObject = function(client, path) {\n  this._client = client;\n  this._path = path;\n  this._bindPromise = this._client.bindTo(names.join(this._path, '/'));\n};\n\nStoreObject.prototype._updateTransactionAndBind = function(tr) {\n  if (!tr)  {\n    return this._bindPromise;\n  }\n  var self = this;\n  return tr._updateTransaction(this._client, this._path).then(function() {\n    return self._bindPromise;\n  });\n};\n\n// See store/service.vdl for method descriptions.\nStoreObject.prototype.exists = function(tr) {\n  return this._updateTransactionAndBind(tr).then(function(srvc) {\n    return srvc.exists(_getTrId(tr));\n  });\n};\nStoreObject.prototype.get = function(tr) {\n  return this._updateTransactionAndBind(tr).then(function(srvc) {\n    return srvc.get(_getTrId(tr));\n  });\n};\nStoreObject.prototype.put = function(tr, v) {\n  return this._updateTransactionAndBind(tr).then(function(srvc) {\n    return srvc.put(_getTrId(tr), v);\n  });\n};\nStoreObject.prototype.remove = function(tr) {\n  return this._updateTransactionAndBind(tr).then(function(srvc) {\n    return srvc.remove(_getTrId(tr));\n  });\n};\nStoreObject.prototype.setAttr = function(tr, attrs) {\n  return this._updateTransactionAndBind(tr).then(function(srvc) {\n    return srvc.setAttr(_getTrId(tr), attrs);\n  });\n};\nStoreObject.prototype.stat = function(tr) {\n  return this._updateTransactionAndBind(tr).then(function(srvc) {\n    return srvc.stat(_getTrId(tr));\n  });\n};\nStoreObject.prototype.query = function(tr, query) {\n  return this._updateTransactionAndBind(tr).then(function(srvc) {\n    return _makeStreamWithErrors(srvc.query(_getTrId(tr), query));\n  });\n};\nStoreObject.prototype.watchGlob = function(pattern, resumeMarker) {\n  return this._bindPromise.then(function(srvc) {\n    var globRequest = {\n      Pattern: pattern,\n      ResumeMarker: resumeMarker\n    };\n    return _makeStreamWithErrors(srvc.watchGlob(globRequest));\n  });\n};\nStoreObject.prototype.watchQuery = function(query, resumeMarker) {\n  return this._bindPromise.then(function(srvc) {\n    var queryRequest = {\n      Query: query,\n      ResumeMarker: resumeMarker\n    };\n    return _makeStreamWithErrors(srvc.watchQuery(queryRequest));\n  });\n};\nStoreObject.prototype.glob = function(pattern) {\n  return this._bindPromise.then(function(srvc) {\n    return _makeStreamWithErrors(srvc.glob(pattern));\n  });\n};\nStoreObject.prototype.globT = function(tr, pattern) {\n  return this._updateTransactionAndBind(tr).then(function(srvc) {\n    return _makeStreamWithErrors(srvc.globT(_getTrId(tr), pattern));\n  });\n};\n\n// Generate an object with the store automatically updated on it based on a\n// query.\n// Usage: (outdated)\n// var obj = store.object('whatever').wire('query')\n// console.log('Current val: ' + obj.a.val);\n// obj.on('change', 'location') //Some mechanism to receive event notifications.\n// obj.cancelUpdates();\n// TODO(bprosnitz) Add this\nStoreObject.prototype.wire = function(query) {\n  //...\n};\n\n// Get an observable with updates from the query. Make it cancellable.\n// TODO(bprosnitz) Add this\nStoreObject.prototype.wireObservable = function(query) {\n  //...\n};\n\n/**\n * Store represents the top level veyron store.\n * @param {object} client the veyron client\n * @constructor\n */\nvar Store = function(client) {\n  if (!(this instanceof Store)) {\n    return new Store(client);\n  }\n  this._client = client;\n};\n\nStore.prototype.bindTo = function(path) {\n  var obj = new StoreObject(this._client, path);\n  return obj._bindPromise.then(function() {\n    return obj;\n  });\n};\n\nmodule.exports = {};\nmodule.exports.Store = Store;\nmodule.exports.Transaction = Transaction;\n","var State = {\n  // The entity exists and its full value is included in Value.\n  Exists: 0,\n  // The entity does not exist.\n  DoesNotExist: 1,\n  // The root entity and its children may or may not exist. Used only\n  // for initial state delivery when the client is not interested in\n  // fetching the initial state. See the \"Initial State\" section\n  // above.\n  InitialStateSkipped: 2\n};\n\nvar ResumeMarkers = {\n  // UTF-8 encoding of \"now\".\n  Now: [110, 111, 119]\n};\n\nmodule.exports = {};\nmodule.exports.State = State;\nmodule.exports.ResumeMarkers = ResumeMarkers;","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  // Allow for deprecating things in the process of starting up.\n  if (isUndefined(global.process)) {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  if (process.noDeprecation === true) {\n    return fn;\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n","// Generated by CoffeeScript 1.6.3\n(function() {\n  var EventEmitter, Postie,\n    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    __hasProp = {}.hasOwnProperty,\n    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    __slice = [].slice;\n\n  EventEmitter = require('events').EventEmitter;\n\n  Postie = (function(_super) {\n    __extends(Postie, _super);\n\n    Postie.prototype.target = null;\n\n    Postie.prototype.origin = null;\n\n    function Postie(target, origin) {\n      if (origin == null) {\n        origin = '*';\n      }\n      this.handleMessage = __bind(this.handleMessage, this);\n      if (!(this instanceof Postie)) {\n        return new Postie(target, origin);\n      }\n      Postie.__super__.constructor.call(this);\n      this.target = target;\n      this.origin = origin;\n      this.listen();\n    }\n\n    /*\n    Sends a package over channel.\n    \n    - `channel` (String): The channel to send the package over\n    - `pkg...` (Array...): The package to send. It will take any arguments after the first,\n      stick them in a JSON array and then on the other end call the callback\n      with those arguments applied to the callback.\n    \n    Returns the result of the postMessage call.\n    */\n\n\n    Postie.prototype.post = function() {\n      var channel, packed, pkg;\n      channel = arguments[0], pkg = 2 <= arguments.length ? __slice.call(arguments, 1) : [];\n      packed = this.pack(channel, pkg);\n      return this.target.postMessage(packed, this.origin);\n    };\n\n    /*\n    Sets up the postMessage handler\n    */\n\n\n    Postie.prototype.listen = function() {\n      if (window.addEventListener) {\n        return window.addEventListener('message', this.handleMessage);\n      } else {\n        return window.attachEvent('onmessage', this.handleMessage);\n      }\n    };\n\n    /*\n    Handles a postmessage event. Attempt to unpack it, and if we can emit an\n    event.\n    \n    - `event` (Event): The event to handle.\n    */\n\n\n    Postie.prototype.handleMessage = function(event) {\n      var unpackaged;\n      if (unpackaged = this.unpack(event.data)) {\n        return this.emit.apply(this, [unpackaged.channel].concat(__slice.call(unpackaged[\"package\"])));\n      }\n    };\n\n    /*\n    Takes a string from a postmessage event and tries to unpack it. If it is\n    successful it will return the unpacked object, otherwise it will return\n    false.\n    \n    - `data` (String): The data to attempt to unpack.\n    \n    Returns the unpacked data as an Object, or `false`.\n    */\n\n\n    Postie.prototype.unpack = function(data) {\n      var error, pkg;\n      try {\n        pkg = JSON.parse(data);\n        return {\n          channel: pkg._postie.channel,\n          \"package\": pkg._postie[\"package\"]\n        };\n      } catch (_error) {\n        error = _error;\n        return false;\n      }\n    };\n\n    /*\n    Packs a channel string and a package to send into a String that we can send\n    over postMessage to be unpacked on the other side.\n    \n    - `channel` (String): The channel the package is being sent on.\n    - `pkg` (Mixed): The package to pack with the channel into the string.\n    \n    Returns a String which can be unpacked into its old representation via\n    `@unpack()`.\n    */\n\n\n    Postie.prototype.pack = function(channel, pkg) {\n      return JSON.stringify({\n        _postie: {\n          channel: channel,\n          \"package\": pkg\n        }\n      });\n    };\n\n    return Postie;\n\n  })(EventEmitter);\n\n  module.exports = Postie;\n\n}).call(this);\n","/**\n * @fileoverview Parses the Veyron IDL\n */\n\nvar vError = require('../lib/verror');\nvar idlHelper = {};\n\n/**\n * Generates an IDL wire description for a given service by iterating over the\n * methods in the service object.\n * Method names beginning with '_' are considered private and skipped.\n * Arg names beginning with '$' are not part of the idl and are filled in by\n * the veyron libraries (e.g. $context).\n * @param {object} service a description of the service. This is a map from\n * method name to method description.\n * @return {object} a representation of the idl. This must match the format of\n * JSONServiceSignature in Veyron's go code.\n */\nidlHelper.generateIdlWireDescription = function(service) {\n  var idlWire = {};\n  var metadata = service.metadata;\n  for (var methodName in metadata) {\n    if (metadata.hasOwnProperty(methodName)) {\n      var methodMetadata = metadata[methodName];\n\n      var params = methodMetadata.params;\n      var inArgs = [];\n      for (var i = 0; i < params.length; i++) {\n        var param = params[i];\n        if (param[0] !== '$') {\n          inArgs.push(param);\n        }\n      }\n\n      idlWire[methodName] = {\n        InArgs: inArgs,\n        NumOutArgs: methodMetadata.numOutArgs + 1,\n        IsStreaming: methodMetadata.injections['$stream'] !== undefined\n      };\n    }\n  }\n\n  return idlWire;\n};\n\n/**\n * Returns an array of parameter names for a function.\n * from go/fypon (stack overflow) and based on angularjs's implementation\n * @param {function} func the function object\n * @return {string[]} list of the parameters\n */\nvar getParamNames = function(func) {\n  // represent the function as a string and strip comments\n  var fnStr = func.toString().replace(/((\\/\\/.*$)|(\\/\\*[\\s\\S]*?\\*\\/))/mg, '');\n  // get the arguments from the string\n  var result = fnStr.slice(fnStr.indexOf('(') + 1, fnStr.indexOf(')')).\n      match(/([^\\s,]+)/g);\n  if (result === null) {\n    result = [];\n  }\n  return result;\n};\n\n/**\n * Wraps a Service with annotations for each exported function.\n * @constructor\n * @param {object} service the service that is being exported.\n * @param {object} extraMetadata if provided, adds extra metadata for\n * the functions exported (such as number of return values).\n */\nidlHelper.ServiceWrapper = function(service, extraMetadata) {\n  this.object = service;\n  this.metadata = {};\n  extraMetadata = extraMetadata || {};\n\n  for (var methodName in service) {\n    if (service.hasOwnProperty(methodName) &&\n        methodName.length > 0 && methodName[0] !== '_') {\n      if (methodName[0] >= 'A' && methodName[0] <= 'Z') {\n        var camelCaseName = methodName.charAt(0).toLowerCase() +\n          methodName.slice(1);\n        throw new Error('Method names must be camel case. Perhaps rename \\'' +\n          methodName + '\\' to \\'' + camelCaseName + '\\'');\n      }\n      var method = service[methodName];\n      if (typeof method === 'function') {\n        var params = getParamNames(method);\n        var injections = {};\n        for (var i = 0; i < params.length; i++) {\n          var name = params[i];\n          if (name[0] === '$') {\n            injections[name] = i;\n          }\n        }\n        var metadata = {\n          params: params,\n          injections: injections,\n          numOutArgs: 1\n        };\n\n        // We only want to copy over the accepted metadata options.\n        if (extraMetadata[methodName]) {\n          var extra = extraMetadata[methodName];\n          if (extra.numOutArgs !== undefined) {\n            metadata.numOutArgs = extra.numOutArgs;\n          }\n        }\n\n        this.metadata[methodName] = metadata;\n      }\n    }\n  }\n};\n\nidlHelper.ServiceWrapper.prototype.validate = function(definition) {\n  for (var name in definition) {\n    if (definition.hasOwnProperty(name)) {\n      var metadata = this.metadata[name];\n      if (!metadata) {\n        return new vError.BadArgError('Missing method: ' + name);\n      }\n      var expected = definition[name];\n      var inputArgs = metadata.params.length -\n          Object.keys(metadata.injections).length;\n      if (inputArgs !== expected.numInArgs) {\n        return new vError.BadArgError('Wrong number of input args for ' +\n            name + ', got: ' + inputArgs + ', expected: ' +\n            expected.numInArgs);\n      }\n\n      if (metadata.numOutArgs !== expected.numOutArgs) {\n        return new vError.BadArgError('Wrong number of output args for ' +\n            name + ', got: ' + metadata.numOutArgs + ', expected ' +\n            expected.numOutArgs);\n      }\n\n      var hasStreaming = metadata.injections.hasOwnProperty('$stream');\n      var expectingStreaming = (expected.inputStreaming ||\n          expected.outputStreaming);\n      if (expectingStreaming && !hasStreaming) {\n        return new vError.BadArgError('Expected ' + name + ' to be ' +\n              'streaming');\n      } else if (!expectingStreaming && hasStreaming) {\n        return new vError.BadArgError('Expected ' + name + ' to not be ' +\n              'streaming');\n\n      }\n    }\n  }\n\n  for (name in this.metadata) {\n    if (this.metadata.hasOwnProperty(name) &&\n        !definition.hasOwnProperty(name)) {\n      return new vError.BadArgError('Unexpected method ' + name +\n          ' implemented.');\n    }\n  }\n  return null;\n};\n\n/**\n * Export the module\n */\nmodule.exports = idlHelper;\n","/**\n * @fileoverview Streaming RPC implementation on top of websockets.\n */\n\nvar MessageType = require('./message_type');\nvar Duplex = require('stream').Duplex;\nvar inherits = require('util').inherits;\n\n/*\n * A stream that allows sending and recieving data for a streaming rpc.  If\n * onmessage is set and a function, it will be called whenever there is data on.\n * the stream. The stream implements the promise api.  When the rpc is complete,\n * the stream will be fulfilled.  If there is an error, then the stream will be\n * rejected.\n * @constructor\n *\n * @param {number} flowId flow id\n * @param {Promise} webSocketPromise Promise of a websocket connection when\n * it's established\n * @param {boolean} isClient if set, then this is the client stream.\n */\nvar Stream = function(flowId, webSocketPromise, isClient) {\n  Duplex.call(this, { objectMode: true });\n  this.flowId = flowId;\n  this.isClient = isClient;\n  this.webSocketPromise = webSocketPromise;\n  this.onmessage = null;\n\n  // The buffer of messages that will be passed to push\n  // when the internal buffer has room.\n  this.wsBuffer = [];\n\n  // If set, objects are directly written to the internal buffer\n  // rather than wsBuffer.\n  this.shouldQueue = false;\n};\n\ninherits(Stream, Duplex);\n\n/**\n * Closes the stream, telling the other side that there is no more data.\n */\nStream.prototype.clientClose = function() {\n  var object = {\n    id: this.flowId,\n    type: MessageType.STREAM_CLOSE\n  };\n  Duplex.prototype.write.call(this, object);\n};\n\nStream.prototype.serverClose = function(value, err) {\n  var object = {\n    id: this.flowId,\n    type: MessageType.RESPONSE,\n    data: JSON.stringify({\n      results: [value || null],\n      err: err || null\n    })\n  };\n  Duplex.prototype.write.call(this, object);\n};\n\n/**\n * Implements the _read method needed by those subclassing Duplex.\n * The parameter passed in is ignored, since it doesn't really make\n * sense in object mode.\n */\nStream.prototype._read = function() {\n  // On a call to read, copy any objects in the websocket buffer into\n  // the internal stream buffer.  If we exhaust the websocket buffer\n  // and still have more room in the internal buffer, we set shouldQueue\n  // so we directly write to the internal buffer.\n  var i = 0;\n  while (i < this.wsBuffer.length && this.push(this.wsBuffer[i])) {\n    ++i;\n  }\n  if (i > 0) {\n    this.wsBuffer = this.wsBuffer.splice(i);\n  }\n\n  this.shouldQueue = this.wsBuffer.length === 0;\n};\n\n/**\n * Queue the object passed in for reading\n */\nStream.prototype._queueRead = function(object) {\n  if (this.shouldQueue) {\n    // If we have run into the limit of the internal buffer,\n    // update this.shouldQueue.\n    this.shouldQueue = this.push(object);\n  } else {\n    this.wsBuffer.push(object);\n  }\n};\n\n/**\n * Writes an object to the stream.\n * @param {*} chunk The data to write to the stream.\n * @param {null} encoding ignored for object streams.\n * @param {function} callback if set, the function to call when the write\n * completes.\n * @return {boolean} Returns false if the write buffer is full.\n */\nStream.prototype.write = function(chunk, encoding, callback) {\n  var object = {\n    id: this.flowId,\n    data: JSON.stringify(chunk),\n    type: MessageType.STREAM_VALUE\n  };\n  return Duplex.prototype.write.call(this, object, encoding, callback);\n};\n\nStream.prototype._write = function(chunk, encoding, callback) {\n  this.webSocketPromise.then(function(websocket) {\n    websocket.send(JSON.stringify(chunk));\n    callback();\n  });\n};\n\n/**\n * Writes an optional object to the stream and ends the stream.\n * @param {*} chunk The data to write to the stream.\n * @param {null} encoding ignored for object streams.\n * @param {function} callback if set, the function to call when the write\n * completes.\n */\nStream.prototype.end = function(chunk, encoding, callback) {\n  if (this.isClient) {\n    if (chunk !== undefined) {\n      this.write(chunk, encoding);\n    }\n    this.clientClose();\n  } else {\n    // We probably shouldn't allow direct calls to end, since we need\n    // a return value here, but if they are piping streams, the developer\n    // probably doesn't care about the return value.\n    this.serverClose();\n  }\n\n  Duplex.prototype.end.call(this, null, null, callback);\n};\n\nmodule.exports = Stream;\n","/**\n * @fileoverview Enum for outgoing message types\n */\n\nvar MessageType = {\n  REQUEST: 0, // Request to invoke a method on a Veyron name\n  SERVE: 1, // Request to serve a server in JavaScript under a Veyron name\n  RESPONSE: 2, // Indicates a response from a registered service in JavaScript\n  STREAM_VALUE: 3, // Indicates a stream value\n  STREAM_CLOSE: 4, // Request to close a stream\n  SIGNATURE: 5, // Request to get signature of a remote server\n  STOP: 6 // Request to stop a server\n};\n\nmodule.exports = MessageType;\n","/**\n * @fileoverview Enum for incoming payload types\n */\n\nvar IncomingPayloadType = {\n  FINAL_RESPONSE: 0, // Final response to a call originating from JS\n  STREAM_RESPONSE: 1, // Stream response to a call originating from JS\n  ERROR_RESPONSE: 2, // Error response to a call originating from JS\n  INVOKE_REQUEST: 3, // Request to invoke a method in JS originating from server\n  STREAM_CLOSE: 4  // Response saying that the stream is closed.\n};\n\nmodule.exports = IncomingPayloadType;\n","/**\n * @fileoverview conversion between JavaScript and veyron2/verror Error object\n */\n\nvar vError = require('./../lib/verror');\n\nvar ec = {};\n\n/*\n * Implements the same structure as Standard struct in veyron2/verror\n * @private\n * @param {string} Id id of the error, which in JavaScript, corresponds to the\n * name property of an Error object.\n */\nvar _standard = function(id, message) {\n  this.iD = id;\n  this.msg = message;\n};\n\n/*\n * Converts from a JavaScript error object to verror standard struct which\n * wspr expects as error format.\n * @private\n * @param {Error} err JavaScript error object\n * @return {_standard} verror standard struct\n */\nec.toStandardErrorStruct = function(err) {\n  var errId = ''; // empty ID indicate an unknown error\n  var errMessage = '';\n  if (err instanceof Error) {\n    errMessage = err.message;\n    if (err.name !== 'Error') { // default name is considered unknown\n      errId = err.name;\n    }\n  } else if (err !== undefined && err !== null) {\n    errMessage = err + '';\n  }\n\n  return new _standard(errId, errMessage);\n};\n\nvar errIdConstrMap = {};\nerrIdConstrMap[vError.Ids.Aborted] = vError.AbortedError;\nerrIdConstrMap[vError.Ids.BadArg] = vError.BadArgError;\nerrIdConstrMap[vError.Ids.BadProtocol] = vError.BadProtocolError;\nerrIdConstrMap[vError.Ids.Exists] = vError.ExistsError;\nerrIdConstrMap[vError.Ids.Internal] = vError.InternalError;\nerrIdConstrMap[vError.Ids.NotAuthorized] = vError.NotAuthorizedError;\nerrIdConstrMap[vError.Ids.NotFound] = vError.NotFoundError;\n\n/*\n * Converts from a verror standard struct which comes from wspr to JavaScript\n * Error object ensuring message and name are set properly\n * @private\n * @param {_standard} verr verror standard struct\n * @return {Error} JavaScript error object\n */\nec.toJSerror = function(verr) {\n  var err;\n\n  var ErrIdConstr = errIdConstrMap[verr.iD];\n  if(ErrIdConstr) {\n    err = new ErrIdConstr(verr.msg);\n  } else {\n    err = new vError.VeyronError(verr.msg, verr.iD);\n  }\n\n  err.stack = ''; // stack does not make sense from a remote execution\n  return err;\n};\n\nmodule.exports = ec;\n","/**\n * @fileoverview A simple handler that resolves or rejects a promise\n * on a response from the proxy.\n */\nvar IncomingPayloadType = require('./incoming_payload_type');\nvar ErrorConversion = require('./error_conversion');\nvar vError = require('./../lib/verror');\n\n/**\n * An object that rejects/resolves a promise based on a response\n * from the proxy.\n * @constructor\n * @param def the promise to resolve/reject\n * @param proxy the proxy from which to dequeue the handler\n * @param id the flow id of the message\n */\nvar Handler = function(def, proxy, id) {\n  this._proxy = proxy;\n  this._def = def;\n  this._id = id;\n};\n\nHandler.prototype.handleResponse = function(type, message) {\n  switch (type) {\n    case IncomingPayloadType.FINAL_RESPONSE:\n      this._def.resolve(message);\n      break;\n    case IncomingPayloadType.ERROR_RESPONSE:\n      var err = ErrorConversion.toJSerror(message);\n      this._def.reject(err);\n      break;\n    default:\n      this._def.reject(\n          new vError.InternalError('unknown response type ' + type));\n  }\n  this._proxy.dequeue(this._id);\n};\n\nmodule.exports = Handler;\n","/**\n * @fileoverview PublicId stub of veyron identities\n */\n\n/**\n * The public portion of a veyron identity.\n */\nfunction PublicId(names, caveats) {\n  this.names = names;\n  this._caveats = caveats;\n}\n\n// A name matches if it is a prefix of the pattern or if the pattern ends\n// in a '/*' and the pattern is a prefix of the name.\nfunction nameMatches(name, pattern) {\n  var paths = name.split('/');\n  var expectedPaths = pattern.split('/');\n  for (var i = 0; i < expectedPaths.length; i++) {\n    // If there is a star at the end of the pattern then\n    // we have a match, since the prefix of the pattern\n    // was matched by the name.\n    if (expectedPaths[i] === '*') {\n      return i === expectedPaths.length - 1;\n    }\n\n    // name is a prefix of pattern\n    if (i === paths.length) {\n      return true;\n    }\n\n    if (paths[i] !== expectedPaths[i]) {\n      return false;\n    }\n  }\n\n  return paths.length === expectedPaths.length;\n}\n\n\n/**\n * Returns whether the PublicId matches a principal pattern. There\n * are basically two types of patterns.  A fixed name pattern\n * looks like 'a/b' and matches names 'a/b' and 'a', but not\n * 'a/b/c', 'aa', or 'a/bb'. 'a' is considered a match because\n * the owner of 'a' can trivially create the name 'a/b'.  A star\n * pattern looks like 'a/b/*' and it matches anything that 'a/b' matches\n * as well as any name blessed by 'a/b', i.e 'a/b/c', 'a/b/c/d'.\n * @param {string} pattern The pattern to match against.\n * @return {boolean} Returns true iff the PublicId has a name that matches\n * the pattern passed in.\n */\nPublicId.prototype.match = function(pattern) {\n  if (pattern === '' || !pattern) {\n    return false;\n  }\n  for (var i = 0; i < this.names.length; i++) {\n    if (nameMatches(this.names[i], pattern)) {\n      return true;\n    }\n  }\n  return false;\n};\n\nmodule.exports = PublicId;\n","/**\n *  @fileoverview Web Socket provider for NodeJS\n */\n\nvar WS = require('ws');\n\n/**\n * Export module\n */\nmodule.exports = WS;\n\n","/**\n * @fileoverview An object that handles marshaling and unmarshal\n * messages from the native veyron implementation.\n */\n\nvar MessageType = require('./message_type');\nvar IncomingPayloadType = require('./incoming_payload_type');\nvar Deferred = require('./../lib/deferred');\nvar Promise = require('./../lib/promise');\nvar vLog = require('./../lib/vlog');\nvar SimpleHandler = require('./simple_handler');\n\n// Cache the service signatures for one hour.\nvar BIND_CACHE_TTL = 3600 * 1000;\n\n/**\n * A client for the native veyron implementation.\n * @constructor\n * @param {Promise} sender A promise that is resolved when we are able to send\n * a message to the native veron implementation. It should be resolved with an\n * object that has a send function that will send messages to the native\n * implementation.\n */\nfunction Proxy(sender) {\n  // We use odd numbers for the message ids, so that the server can use even\n  // numbers.\n  this.id = 1;\n  this.outstandingRequests = {};\n  this.bindCache = {};\n  this._hasResolvedConfig = false;\n  this._configDeferred = new Deferred();\n  this.config = this._configDeferred.promise;\n  this.senderPromise = sender;\n  this.incomingRequestHandlers = {};\n}\n\n/**\n * Handles a message from native veyron implementation.\n * @param {Object} messsage The message from the native veyron code.\n */\nProxy.prototype.process = function(message) {\n  if (this._hasResolvedConfig === false) { // first message is the config.\n    this._hasResolvedConfig = true;\n    this._configDeferred.resolve(message);\n    return;\n  }\n\n  // Messages originating from server are even numbers\n  var isServerOriginatedMessage = (message.id % 2) === 0;\n\n  var handler = this.outstandingRequests[message.id];\n\n  var payload;\n  try {\n    payload = JSON.parse(message.data);\n  } catch (e) {\n    if (!isServerOriginatedMessage) {\n      handler.handleResponse(IncomingPayloadType.ERROR_RESPONSE, message.data);\n    }\n    return;\n  }\n\n  // If we don't know about this flow, just drop the message. Unless it\n  // originated from the sever.\n  if (!isServerOriginatedMessage && !handler) {\n    vLog.warn('Dropping message for unknown flow ' + message.id + ' ' +\n        message.data);\n    return;\n  }\n\n  if (!handler) {\n    handler = this.incomingRequestHandlers[payload.type];\n    if (!handler) {\n      vLog.warn('Dropping message for unknown invoke payload ' + payload.type);\n      return;\n    }\n    handler.handleRequest(message.id, payload.message);\n  } else {\n    handler.handleResponse(payload.type, payload.message);\n  }\n};\n\nProxy.prototype.dequeue = function(def, id) {\n  delete this.outstandingRequests[id];\n};\n\nProxy.prototype.nextId = function() {\n  var id = this.id;\n  this.id += 2;\n  return id;\n};\n\n/**\n * Gets the signature including methods names, number of arguments for a given\n * service name.\n * @param {string} name the veyron name of the service to get signature for.\n * @return {Promise} Signature of the service in JSON format\n */\nProxy.prototype.getServiceSignature = function(name) {\n  var cachedEntry = this.bindCache[name];\n  var now = new Date();\n  if (cachedEntry && now - cachedEntry.fetched < BIND_CACHE_TTL) {\n    return Promise.resolve(cachedEntry.signature);\n  }\n\n  var def = new Deferred();\n\n  var self = this;\n  def.promise.then(function(signature) {\n    self.bindCache[name] = {\n      signature: signature,\n      fetched: now\n    };\n  });\n  var messageJSON = { name: name };\n  var message = JSON.stringify(messageJSON);\n\n  var id = this.nextId();\n  // Send the get signature request to the proxy\n  var handler = new SimpleHandler(def, this, id);\n  this.sendRequest(message, MessageType.SIGNATURE, handler, id);\n\n  return def.promise;\n};\n\n\nProxy.prototype.addIncomingHandler = function(type, handler) {\n  this.incomingRequestHandlers[type] = handler;\n};\n\nProxy.prototype.addIncomingStreamHandler = function(id, handler) {\n  this.outstandingRequests[id] = handler;\n};\n\n/**\n * Establishes the connection if needed, frames the message with the next id,\n * adds the given deferred to outstanding requests queue and sends the request\n * to the server\n * @param {Object} message Message to send\n * @param {MessageType} type Type of message to send\n * @param {Object} handler An object with a handleResponse method that takes\n * a response type and a message.  If null, then responses for this flow\n * are ignored.\n * @param {Number} id Use this flow id instead of generating\n * a new one.\n */\nProxy.prototype.sendRequest = function(message, type, handler, id) {\n  if (handler) {\n    this.outstandingRequests[id] = handler;\n  }\n  var body = JSON.stringify({ id: id, data: message, type: type });\n\n  this.senderPromise.then(function(sender) {\n    sender.send(body);\n  },function(e) {\n    var h = this.outstandingRequests[id];\n    if (h) {\n      h.handleResponse(IncomingPayloadType.ERROR_RESPONSE, e);\n      delete this.outstandingRequests[id];\n    }\n  });\n};\n\n/**\n * Export the module\n */\nmodule.exports = Proxy;\n","module.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        throw TypeError('Uncaught, unspecified \"error\" event.');\n      }\n      return false;\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        len = arguments.length;\n        args = new Array(len - 1);\n        for (i = 1; i < len; i++)\n          args[i - 1] = arguments[i];\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    len = arguments.length;\n    args = new Array(len - 1);\n    for (i = 1; i < len; i++)\n      args[i - 1] = arguments[i];\n\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    var m;\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  var ret;\n  if (!emitter._events || !emitter._events[type])\n    ret = 0;\n  else if (isFunction(emitter._events[type]))\n    ret = 1;\n  else\n    ret = emitter._events[type].length;\n  return ret;\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nmodule.exports = Stream;\n\nvar EE = require('events').EventEmitter;\nvar inherits = require('inherits');\n\ninherits(Stream, EE);\nStream.Readable = require('readable-stream/readable.js');\nStream.Writable = require('readable-stream/writable.js');\nStream.Duplex = require('readable-stream/duplex.js');\nStream.Transform = require('readable-stream/transform.js');\nStream.PassThrough = require('readable-stream/passthrough.js');\n\n// Backwards-compat with node 0.4.x\nStream.Stream = Stream;\n\n\n\n// old-style streams.  Note that the pipe method (the only relevant\n// part of this class) is overridden in the Readable class.\n\nfunction Stream() {\n  EE.call(this);\n}\n\nStream.prototype.pipe = function(dest, options) {\n  var source = this;\n\n  function ondata(chunk) {\n    if (dest.writable) {\n      if (false === dest.write(chunk) && source.pause) {\n        source.pause();\n      }\n    }\n  }\n\n  source.on('data', ondata);\n\n  function ondrain() {\n    if (source.readable && source.resume) {\n      source.resume();\n    }\n  }\n\n  dest.on('drain', ondrain);\n\n  // If the 'end' option is not supplied, dest.end() will be called when\n  // source gets the 'end' or 'close' events.  Only dest.end() once.\n  if (!dest._isStdio && (!options || options.end !== false)) {\n    source.on('end', onend);\n    source.on('close', onclose);\n  }\n\n  var didOnEnd = false;\n  function onend() {\n    if (didOnEnd) return;\n    didOnEnd = true;\n\n    dest.end();\n  }\n\n\n  function onclose() {\n    if (didOnEnd) return;\n    didOnEnd = true;\n\n    if (typeof dest.destroy === 'function') dest.destroy();\n  }\n\n  // don't leave dangling pipes when there are errors.\n  function onerror(er) {\n    cleanup();\n    if (EE.listenerCount(this, 'error') === 0) {\n      throw er; // Unhandled stream error in pipe.\n    }\n  }\n\n  source.on('error', onerror);\n  dest.on('error', onerror);\n\n  // remove all the event listeners that were added.\n  function cleanup() {\n    source.removeListener('data', ondata);\n    dest.removeListener('drain', ondrain);\n\n    source.removeListener('end', onend);\n    source.removeListener('close', onclose);\n\n    source.removeListener('error', onerror);\n    dest.removeListener('error', onerror);\n\n    source.removeListener('end', cleanup);\n    source.removeListener('close', cleanup);\n\n    dest.removeListener('close', cleanup);\n  }\n\n  source.on('end', cleanup);\n  source.on('close', cleanup);\n\n  dest.on('close', cleanup);\n\n  dest.emit('pipe', source);\n\n  // Allow for unix-like usage: A.pipe(B).pipe(C)\n  return dest;\n};\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","\"use strict\";\nvar Promise = require(\"./promise/promise\").Promise;\nvar polyfill = require(\"./promise/polyfill\").polyfill;\nexports.Promise = Promise;\nexports.polyfill = polyfill;","exports = module.exports = require('./lib/_stream_readable.js');\nexports.Readable = exports;\nexports.Writable = require('./lib/_stream_writable.js');\nexports.Duplex = require('./lib/_stream_duplex.js');\nexports.Transform = require('./lib/_stream_transform.js');\nexports.PassThrough = require('./lib/_stream_passthrough.js');\n","module.exports = require(\"./lib/_stream_writable.js\")\n","module.exports = require(\"./lib/_stream_duplex.js\")\n","module.exports = require(\"./lib/_stream_transform.js\")\n","module.exports = require(\"./lib/_stream_passthrough.js\")\n","\n/**\n * Module dependencies.\n */\n\nvar global = (function() { return this; })();\n\n/**\n * WebSocket constructor.\n */\n\nvar WebSocket = global.WebSocket || global.MozWebSocket;\n\n/**\n * Module exports.\n */\n\nmodule.exports = WebSocket ? ws : null;\n\n/**\n * WebSocket constructor.\n *\n * The third `opts` options object gets ignored in web browsers, since it's\n * non-standard, and throws a TypeError if passed to the constructor.\n * See: https://github.com/einaros/ws/issues/227\n *\n * @param {String} uri\n * @param {Array} protocols (optional)\n * @param {Object) opts (optional)\n * @api public\n */\n\nfunction ws(uri, protocols, opts) {\n  var instance;\n  if (protocols) {\n    instance = new WebSocket(uri, protocols);\n  } else {\n    instance = new WebSocket(uri);\n  }\n  return instance;\n}\n\nif (WebSocket) ws.prototype = WebSocket.prototype;\n","\"use strict\";\nvar config = require(\"./config\").config;\nvar configure = require(\"./config\").configure;\nvar objectOrFunction = require(\"./utils\").objectOrFunction;\nvar isFunction = require(\"./utils\").isFunction;\nvar now = require(\"./utils\").now;\nvar all = require(\"./all\").all;\nvar race = require(\"./race\").race;\nvar staticResolve = require(\"./resolve\").resolve;\nvar staticReject = require(\"./reject\").reject;\nvar asap = require(\"./asap\").asap;\n\nvar counter = 0;\n\nconfig.async = asap; // default async is asap;\n\nfunction Promise(resolver) {\n  if (!isFunction(resolver)) {\n    throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');\n  }\n\n  if (!(this instanceof Promise)) {\n    throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\");\n  }\n\n  this._subscribers = [];\n\n  invokeResolver(resolver, this);\n}\n\nfunction invokeResolver(resolver, promise) {\n  function resolvePromise(value) {\n    resolve(promise, value);\n  }\n\n  function rejectPromise(reason) {\n    reject(promise, reason);\n  }\n\n  try {\n    resolver(resolvePromise, rejectPromise);\n  } catch(e) {\n    rejectPromise(e);\n  }\n}\n\nfunction invokeCallback(settled, promise, callback, detail) {\n  var hasCallback = isFunction(callback),\n      value, error, succeeded, failed;\n\n  if (hasCallback) {\n    try {\n      value = callback(detail);\n      succeeded = true;\n    } catch(e) {\n      failed = true;\n      error = e;\n    }\n  } else {\n    value = detail;\n    succeeded = true;\n  }\n\n  if (handleThenable(promise, value)) {\n    return;\n  } else if (hasCallback && succeeded) {\n    resolve(promise, value);\n  } else if (failed) {\n    reject(promise, error);\n  } else if (settled === FULFILLED) {\n    resolve(promise, value);\n  } else if (settled === REJECTED) {\n    reject(promise, value);\n  }\n}\n\nvar PENDING   = void 0;\nvar SEALED    = 0;\nvar FULFILLED = 1;\nvar REJECTED  = 2;\n\nfunction subscribe(parent, child, onFulfillment, onRejection) {\n  var subscribers = parent._subscribers;\n  var length = subscribers.length;\n\n  subscribers[length] = child;\n  subscribers[length + FULFILLED] = onFulfillment;\n  subscribers[length + REJECTED]  = onRejection;\n}\n\nfunction publish(promise, settled) {\n  var child, callback, subscribers = promise._subscribers, detail = promise._detail;\n\n  for (var i = 0; i < subscribers.length; i += 3) {\n    child = subscribers[i];\n    callback = subscribers[i + settled];\n\n    invokeCallback(settled, child, callback, detail);\n  }\n\n  promise._subscribers = null;\n}\n\nPromise.prototype = {\n  constructor: Promise,\n\n  _state: undefined,\n  _detail: undefined,\n  _subscribers: undefined,\n\n  then: function(onFulfillment, onRejection) {\n    var promise = this;\n\n    var thenPromise = new this.constructor(function() {});\n\n    if (this._state) {\n      var callbacks = arguments;\n      config.async(function invokePromiseCallback() {\n        invokeCallback(promise._state, thenPromise, callbacks[promise._state - 1], promise._detail);\n      });\n    } else {\n      subscribe(this, thenPromise, onFulfillment, onRejection);\n    }\n\n    return thenPromise;\n  },\n\n  'catch': function(onRejection) {\n    return this.then(null, onRejection);\n  }\n};\n\nPromise.all = all;\nPromise.race = race;\nPromise.resolve = staticResolve;\nPromise.reject = staticReject;\n\nfunction handleThenable(promise, value) {\n  var then = null,\n  resolved;\n\n  try {\n    if (promise === value) {\n      throw new TypeError(\"A promises callback cannot return that same promise.\");\n    }\n\n    if (objectOrFunction(value)) {\n      then = value.then;\n\n      if (isFunction(then)) {\n        then.call(value, function(val) {\n          if (resolved) { return true; }\n          resolved = true;\n\n          if (value !== val) {\n            resolve(promise, val);\n          } else {\n            fulfill(promise, val);\n          }\n        }, function(val) {\n          if (resolved) { return true; }\n          resolved = true;\n\n          reject(promise, val);\n        });\n\n        return true;\n      }\n    }\n  } catch (error) {\n    if (resolved) { return true; }\n    reject(promise, error);\n    return true;\n  }\n\n  return false;\n}\n\nfunction resolve(promise, value) {\n  if (promise === value) {\n    fulfill(promise, value);\n  } else if (!handleThenable(promise, value)) {\n    fulfill(promise, value);\n  }\n}\n\nfunction fulfill(promise, value) {\n  if (promise._state !== PENDING) { return; }\n  promise._state = SEALED;\n  promise._detail = value;\n\n  config.async(publishFulfillment, promise);\n}\n\nfunction reject(promise, reason) {\n  if (promise._state !== PENDING) { return; }\n  promise._state = SEALED;\n  promise._detail = reason;\n\n  config.async(publishRejection, promise);\n}\n\nfunction publishFulfillment(promise) {\n  publish(promise, promise._state = FULFILLED);\n}\n\nfunction publishRejection(promise) {\n  publish(promise, promise._state = REJECTED);\n}\n\nexports.Promise = Promise;","\"use strict\";\n/*global self*/\nvar RSVPPromise = require(\"./promise\").Promise;\nvar isFunction = require(\"./utils\").isFunction;\n\nfunction polyfill() {\n  var local;\n\n  if (typeof global !== 'undefined') {\n    local = global;\n  } else if (typeof window !== 'undefined' && window.document) {\n    local = window;\n  } else {\n    local = self;\n  }\n\n  var es6PromiseSupport = \n    \"Promise\" in local &&\n    // Some of these methods are missing from\n    // Firefox/Chrome experimental implementations\n    \"resolve\" in local.Promise &&\n    \"reject\" in local.Promise &&\n    \"all\" in local.Promise &&\n    \"race\" in local.Promise &&\n    // Older version of the spec had a resolver object\n    // as the arg rather than a function\n    (function() {\n      var resolve;\n      new local.Promise(function(r) { resolve = r; });\n      return isFunction(resolve);\n    }());\n\n  if (!es6PromiseSupport) {\n    local.Promise = RSVPPromise;\n  }\n}\n\nexports.polyfill = polyfill;","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nmodule.exports = Readable;\n\n/*<replacement>*/\nvar isArray = require('isarray');\n/*</replacement>*/\n\n\n/*<replacement>*/\nvar Buffer = require('buffer').Buffer;\n/*</replacement>*/\n\nReadable.ReadableState = ReadableState;\n\nvar EE = require('events').EventEmitter;\n\n/*<replacement>*/\nif (!EE.listenerCount) EE.listenerCount = function(emitter, type) {\n  return emitter.listeners(type).length;\n};\n/*</replacement>*/\n\nvar Stream = require('stream');\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\nvar StringDecoder;\n\nutil.inherits(Readable, Stream);\n\nfunction ReadableState(options, stream) {\n  options = options || {};\n\n  // the point at which it stops calling _read() to fill the buffer\n  // Note: 0 is a valid value, means \"don't call _read preemptively ever\"\n  var hwm = options.highWaterMark;\n  this.highWaterMark = (hwm || hwm === 0) ? hwm : 16 * 1024;\n\n  // cast to ints.\n  this.highWaterMark = ~~this.highWaterMark;\n\n  this.buffer = [];\n  this.length = 0;\n  this.pipes = null;\n  this.pipesCount = 0;\n  this.flowing = false;\n  this.ended = false;\n  this.endEmitted = false;\n  this.reading = false;\n\n  // In streams that never have any data, and do push(null) right away,\n  // the consumer can miss the 'end' event if they do some I/O before\n  // consuming the stream.  So, we don't emit('end') until some reading\n  // happens.\n  this.calledRead = false;\n\n  // a flag to be able to tell if the onwrite cb is called immediately,\n  // or on a later tick.  We set this to true at first, becuase any\n  // actions that shouldn't happen until \"later\" should generally also\n  // not happen before the first write call.\n  this.sync = true;\n\n  // whenever we return null, then we set a flag to say\n  // that we're awaiting a 'readable' event emission.\n  this.needReadable = false;\n  this.emittedReadable = false;\n  this.readableListening = false;\n\n\n  // object stream flag. Used to make read(n) ignore n and to\n  // make all the buffer merging and length checks go away\n  this.objectMode = !!options.objectMode;\n\n  // Crypto is kind of old and crusty.  Historically, its default string\n  // encoding is 'binary' so we have to make this configurable.\n  // Everything else in the universe uses 'utf8', though.\n  this.defaultEncoding = options.defaultEncoding || 'utf8';\n\n  // when piping, we only care about 'readable' events that happen\n  // after read()ing all the bytes and not getting any pushback.\n  this.ranOut = false;\n\n  // the number of writers that are awaiting a drain event in .pipe()s\n  this.awaitDrain = 0;\n\n  // if true, a maybeReadMore has been scheduled\n  this.readingMore = false;\n\n  this.decoder = null;\n  this.encoding = null;\n  if (options.encoding) {\n    if (!StringDecoder)\n      StringDecoder = require('string_decoder/').StringDecoder;\n    this.decoder = new StringDecoder(options.encoding);\n    this.encoding = options.encoding;\n  }\n}\n\nfunction Readable(options) {\n  if (!(this instanceof Readable))\n    return new Readable(options);\n\n  this._readableState = new ReadableState(options, this);\n\n  // legacy\n  this.readable = true;\n\n  Stream.call(this);\n}\n\n// Manually shove something into the read() buffer.\n// This returns true if the highWaterMark has not been hit yet,\n// similar to how Writable.write() returns true if you should\n// write() some more.\nReadable.prototype.push = function(chunk, encoding) {\n  var state = this._readableState;\n\n  if (typeof chunk === 'string' && !state.objectMode) {\n    encoding = encoding || state.defaultEncoding;\n    if (encoding !== state.encoding) {\n      chunk = new Buffer(chunk, encoding);\n      encoding = '';\n    }\n  }\n\n  return readableAddChunk(this, state, chunk, encoding, false);\n};\n\n// Unshift should *always* be something directly out of read()\nReadable.prototype.unshift = function(chunk) {\n  var state = this._readableState;\n  return readableAddChunk(this, state, chunk, '', true);\n};\n\nfunction readableAddChunk(stream, state, chunk, encoding, addToFront) {\n  var er = chunkInvalid(state, chunk);\n  if (er) {\n    stream.emit('error', er);\n  } else if (chunk === null || chunk === undefined) {\n    state.reading = false;\n    if (!state.ended)\n      onEofChunk(stream, state);\n  } else if (state.objectMode || chunk && chunk.length > 0) {\n    if (state.ended && !addToFront) {\n      var e = new Error('stream.push() after EOF');\n      stream.emit('error', e);\n    } else if (state.endEmitted && addToFront) {\n      var e = new Error('stream.unshift() after end event');\n      stream.emit('error', e);\n    } else {\n      if (state.decoder && !addToFront && !encoding)\n        chunk = state.decoder.write(chunk);\n\n      // update the buffer info.\n      state.length += state.objectMode ? 1 : chunk.length;\n      if (addToFront) {\n        state.buffer.unshift(chunk);\n      } else {\n        state.reading = false;\n        state.buffer.push(chunk);\n      }\n\n      if (state.needReadable)\n        emitReadable(stream);\n\n      maybeReadMore(stream, state);\n    }\n  } else if (!addToFront) {\n    state.reading = false;\n  }\n\n  return needMoreData(state);\n}\n\n\n\n// if it's past the high water mark, we can push in some more.\n// Also, if we have no data yet, we can stand some\n// more bytes.  This is to work around cases where hwm=0,\n// such as the repl.  Also, if the push() triggered a\n// readable event, and the user called read(largeNumber) such that\n// needReadable was set, then we ought to push more, so that another\n// 'readable' event will be triggered.\nfunction needMoreData(state) {\n  return !state.ended &&\n         (state.needReadable ||\n          state.length < state.highWaterMark ||\n          state.length === 0);\n}\n\n// backwards compatibility.\nReadable.prototype.setEncoding = function(enc) {\n  if (!StringDecoder)\n    StringDecoder = require('string_decoder/').StringDecoder;\n  this._readableState.decoder = new StringDecoder(enc);\n  this._readableState.encoding = enc;\n};\n\n// Don't raise the hwm > 128MB\nvar MAX_HWM = 0x800000;\nfunction roundUpToNextPowerOf2(n) {\n  if (n >= MAX_HWM) {\n    n = MAX_HWM;\n  } else {\n    // Get the next highest power of 2\n    n--;\n    for (var p = 1; p < 32; p <<= 1) n |= n >> p;\n    n++;\n  }\n  return n;\n}\n\nfunction howMuchToRead(n, state) {\n  if (state.length === 0 && state.ended)\n    return 0;\n\n  if (state.objectMode)\n    return n === 0 ? 0 : 1;\n\n  if (isNaN(n) || n === null) {\n    // only flow one buffer at a time\n    if (state.flowing && state.buffer.length)\n      return state.buffer[0].length;\n    else\n      return state.length;\n  }\n\n  if (n <= 0)\n    return 0;\n\n  // If we're asking for more than the target buffer level,\n  // then raise the water mark.  Bump up to the next highest\n  // power of 2, to prevent increasing it excessively in tiny\n  // amounts.\n  if (n > state.highWaterMark)\n    state.highWaterMark = roundUpToNextPowerOf2(n);\n\n  // don't have that much.  return null, unless we've ended.\n  if (n > state.length) {\n    if (!state.ended) {\n      state.needReadable = true;\n      return 0;\n    } else\n      return state.length;\n  }\n\n  return n;\n}\n\n// you can override either this method, or the async _read(n) below.\nReadable.prototype.read = function(n) {\n  var state = this._readableState;\n  state.calledRead = true;\n  var nOrig = n;\n\n  if (typeof n !== 'number' || n > 0)\n    state.emittedReadable = false;\n\n  // if we're doing read(0) to trigger a readable event, but we\n  // already have a bunch of data in the buffer, then just trigger\n  // the 'readable' event and move on.\n  if (n === 0 &&\n      state.needReadable &&\n      (state.length >= state.highWaterMark || state.ended)) {\n    emitReadable(this);\n    return null;\n  }\n\n  n = howMuchToRead(n, state);\n\n  // if we've ended, and we're now clear, then finish it up.\n  if (n === 0 && state.ended) {\n    if (state.length === 0)\n      endReadable(this);\n    return null;\n  }\n\n  // All the actual chunk generation logic needs to be\n  // *below* the call to _read.  The reason is that in certain\n  // synthetic stream cases, such as passthrough streams, _read\n  // may be a completely synchronous operation which may change\n  // the state of the read buffer, providing enough data when\n  // before there was *not* enough.\n  //\n  // So, the steps are:\n  // 1. Figure out what the state of things will be after we do\n  // a read from the buffer.\n  //\n  // 2. If that resulting state will trigger a _read, then call _read.\n  // Note that this may be asynchronous, or synchronous.  Yes, it is\n  // deeply ugly to write APIs this way, but that still doesn't mean\n  // that the Readable class should behave improperly, as streams are\n  // designed to be sync/async agnostic.\n  // Take note if the _read call is sync or async (ie, if the read call\n  // has returned yet), so that we know whether or not it's safe to emit\n  // 'readable' etc.\n  //\n  // 3. Actually pull the requested chunks out of the buffer and return.\n\n  // if we need a readable event, then we need to do some reading.\n  var doRead = state.needReadable;\n\n  // if we currently have less than the highWaterMark, then also read some\n  if (state.length - n <= state.highWaterMark)\n    doRead = true;\n\n  // however, if we've ended, then there's no point, and if we're already\n  // reading, then it's unnecessary.\n  if (state.ended || state.reading)\n    doRead = false;\n\n  if (doRead) {\n    state.reading = true;\n    state.sync = true;\n    // if the length is currently zero, then we *need* a readable event.\n    if (state.length === 0)\n      state.needReadable = true;\n    // call internal read method\n    this._read(state.highWaterMark);\n    state.sync = false;\n  }\n\n  // If _read called its callback synchronously, then `reading`\n  // will be false, and we need to re-evaluate how much data we\n  // can return to the user.\n  if (doRead && !state.reading)\n    n = howMuchToRead(nOrig, state);\n\n  var ret;\n  if (n > 0)\n    ret = fromList(n, state);\n  else\n    ret = null;\n\n  if (ret === null) {\n    state.needReadable = true;\n    n = 0;\n  }\n\n  state.length -= n;\n\n  // If we have nothing in the buffer, then we want to know\n  // as soon as we *do* get something into the buffer.\n  if (state.length === 0 && !state.ended)\n    state.needReadable = true;\n\n  // If we happened to read() exactly the remaining amount in the\n  // buffer, and the EOF has been seen at this point, then make sure\n  // that we emit 'end' on the very next tick.\n  if (state.ended && !state.endEmitted && state.length === 0)\n    endReadable(this);\n\n  return ret;\n};\n\nfunction chunkInvalid(state, chunk) {\n  var er = null;\n  if (!Buffer.isBuffer(chunk) &&\n      'string' !== typeof chunk &&\n      chunk !== null &&\n      chunk !== undefined &&\n      !state.objectMode &&\n      !er) {\n    er = new TypeError('Invalid non-string/buffer chunk');\n  }\n  return er;\n}\n\n\nfunction onEofChunk(stream, state) {\n  if (state.decoder && !state.ended) {\n    var chunk = state.decoder.end();\n    if (chunk && chunk.length) {\n      state.buffer.push(chunk);\n      state.length += state.objectMode ? 1 : chunk.length;\n    }\n  }\n  state.ended = true;\n\n  // if we've ended and we have some data left, then emit\n  // 'readable' now to make sure it gets picked up.\n  if (state.length > 0)\n    emitReadable(stream);\n  else\n    endReadable(stream);\n}\n\n// Don't emit readable right away in sync mode, because this can trigger\n// another read() call => stack overflow.  This way, it might trigger\n// a nextTick recursion warning, but that's not so bad.\nfunction emitReadable(stream) {\n  var state = stream._readableState;\n  state.needReadable = false;\n  if (state.emittedReadable)\n    return;\n\n  state.emittedReadable = true;\n  if (state.sync)\n    process.nextTick(function() {\n      emitReadable_(stream);\n    });\n  else\n    emitReadable_(stream);\n}\n\nfunction emitReadable_(stream) {\n  stream.emit('readable');\n}\n\n\n// at this point, the user has presumably seen the 'readable' event,\n// and called read() to consume some data.  that may have triggered\n// in turn another _read(n) call, in which case reading = true if\n// it's in progress.\n// However, if we're not ended, or reading, and the length < hwm,\n// then go ahead and try to read some more preemptively.\nfunction maybeReadMore(stream, state) {\n  if (!state.readingMore) {\n    state.readingMore = true;\n    process.nextTick(function() {\n      maybeReadMore_(stream, state);\n    });\n  }\n}\n\nfunction maybeReadMore_(stream, state) {\n  var len = state.length;\n  while (!state.reading && !state.flowing && !state.ended &&\n         state.length < state.highWaterMark) {\n    stream.read(0);\n    if (len === state.length)\n      // didn't get any data, stop spinning.\n      break;\n    else\n      len = state.length;\n  }\n  state.readingMore = false;\n}\n\n// abstract method.  to be overridden in specific implementation classes.\n// call cb(er, data) where data is <= n in length.\n// for virtual (non-string, non-buffer) streams, \"length\" is somewhat\n// arbitrary, and perhaps not very meaningful.\nReadable.prototype._read = function(n) {\n  this.emit('error', new Error('not implemented'));\n};\n\nReadable.prototype.pipe = function(dest, pipeOpts) {\n  var src = this;\n  var state = this._readableState;\n\n  switch (state.pipesCount) {\n    case 0:\n      state.pipes = dest;\n      break;\n    case 1:\n      state.pipes = [state.pipes, dest];\n      break;\n    default:\n      state.pipes.push(dest);\n      break;\n  }\n  state.pipesCount += 1;\n\n  var doEnd = (!pipeOpts || pipeOpts.end !== false) &&\n              dest !== process.stdout &&\n              dest !== process.stderr;\n\n  var endFn = doEnd ? onend : cleanup;\n  if (state.endEmitted)\n    process.nextTick(endFn);\n  else\n    src.once('end', endFn);\n\n  dest.on('unpipe', onunpipe);\n  function onunpipe(readable) {\n    if (readable !== src) return;\n    cleanup();\n  }\n\n  function onend() {\n    dest.end();\n  }\n\n  // when the dest drains, it reduces the awaitDrain counter\n  // on the source.  This would be more elegant with a .once()\n  // handler in flow(), but adding and removing repeatedly is\n  // too slow.\n  var ondrain = pipeOnDrain(src);\n  dest.on('drain', ondrain);\n\n  function cleanup() {\n    // cleanup event handlers once the pipe is broken\n    dest.removeListener('close', onclose);\n    dest.removeListener('finish', onfinish);\n    dest.removeListener('drain', ondrain);\n    dest.removeListener('error', onerror);\n    dest.removeListener('unpipe', onunpipe);\n    src.removeListener('end', onend);\n    src.removeListener('end', cleanup);\n\n    // if the reader is waiting for a drain event from this\n    // specific writer, then it would cause it to never start\n    // flowing again.\n    // So, if this is awaiting a drain, then we just call it now.\n    // If we don't know, then assume that we are waiting for one.\n    if (!dest._writableState || dest._writableState.needDrain)\n      ondrain();\n  }\n\n  // if the dest has an error, then stop piping into it.\n  // however, don't suppress the throwing behavior for this.\n  function onerror(er) {\n    unpipe();\n    dest.removeListener('error', onerror);\n    if (EE.listenerCount(dest, 'error') === 0)\n      dest.emit('error', er);\n  }\n  // This is a brutally ugly hack to make sure that our error handler\n  // is attached before any userland ones.  NEVER DO THIS.\n  if (!dest._events || !dest._events.error)\n    dest.on('error', onerror);\n  else if (isArray(dest._events.error))\n    dest._events.error.unshift(onerror);\n  else\n    dest._events.error = [onerror, dest._events.error];\n\n\n\n  // Both close and finish should trigger unpipe, but only once.\n  function onclose() {\n    dest.removeListener('finish', onfinish);\n    unpipe();\n  }\n  dest.once('close', onclose);\n  function onfinish() {\n    dest.removeListener('close', onclose);\n    unpipe();\n  }\n  dest.once('finish', onfinish);\n\n  function unpipe() {\n    src.unpipe(dest);\n  }\n\n  // tell the dest that it's being piped to\n  dest.emit('pipe', src);\n\n  // start the flow if it hasn't been started already.\n  if (!state.flowing) {\n    // the handler that waits for readable events after all\n    // the data gets sucked out in flow.\n    // This would be easier to follow with a .once() handler\n    // in flow(), but that is too slow.\n    this.on('readable', pipeOnReadable);\n\n    state.flowing = true;\n    process.nextTick(function() {\n      flow(src);\n    });\n  }\n\n  return dest;\n};\n\nfunction pipeOnDrain(src) {\n  return function() {\n    var dest = this;\n    var state = src._readableState;\n    state.awaitDrain--;\n    if (state.awaitDrain === 0)\n      flow(src);\n  };\n}\n\nfunction flow(src) {\n  var state = src._readableState;\n  var chunk;\n  state.awaitDrain = 0;\n\n  function write(dest, i, list) {\n    var written = dest.write(chunk);\n    if (false === written) {\n      state.awaitDrain++;\n    }\n  }\n\n  while (state.pipesCount && null !== (chunk = src.read())) {\n\n    if (state.pipesCount === 1)\n      write(state.pipes, 0, null);\n    else\n      forEach(state.pipes, write);\n\n    src.emit('data', chunk);\n\n    // if anyone needs a drain, then we have to wait for that.\n    if (state.awaitDrain > 0)\n      return;\n  }\n\n  // if every destination was unpiped, either before entering this\n  // function, or in the while loop, then stop flowing.\n  //\n  // NB: This is a pretty rare edge case.\n  if (state.pipesCount === 0) {\n    state.flowing = false;\n\n    // if there were data event listeners added, then switch to old mode.\n    if (EE.listenerCount(src, 'data') > 0)\n      emitDataEvents(src);\n    return;\n  }\n\n  // at this point, no one needed a drain, so we just ran out of data\n  // on the next readable event, start it over again.\n  state.ranOut = true;\n}\n\nfunction pipeOnReadable() {\n  if (this._readableState.ranOut) {\n    this._readableState.ranOut = false;\n    flow(this);\n  }\n}\n\n\nReadable.prototype.unpipe = function(dest) {\n  var state = this._readableState;\n\n  // if we're not piping anywhere, then do nothing.\n  if (state.pipesCount === 0)\n    return this;\n\n  // just one destination.  most common case.\n  if (state.pipesCount === 1) {\n    // passed in one, but it's not the right one.\n    if (dest && dest !== state.pipes)\n      return this;\n\n    if (!dest)\n      dest = state.pipes;\n\n    // got a match.\n    state.pipes = null;\n    state.pipesCount = 0;\n    this.removeListener('readable', pipeOnReadable);\n    state.flowing = false;\n    if (dest)\n      dest.emit('unpipe', this);\n    return this;\n  }\n\n  // slow case. multiple pipe destinations.\n\n  if (!dest) {\n    // remove all.\n    var dests = state.pipes;\n    var len = state.pipesCount;\n    state.pipes = null;\n    state.pipesCount = 0;\n    this.removeListener('readable', pipeOnReadable);\n    state.flowing = false;\n\n    for (var i = 0; i < len; i++)\n      dests[i].emit('unpipe', this);\n    return this;\n  }\n\n  // try to find the right one.\n  var i = indexOf(state.pipes, dest);\n  if (i === -1)\n    return this;\n\n  state.pipes.splice(i, 1);\n  state.pipesCount -= 1;\n  if (state.pipesCount === 1)\n    state.pipes = state.pipes[0];\n\n  dest.emit('unpipe', this);\n\n  return this;\n};\n\n// set up data events if they are asked for\n// Ensure readable listeners eventually get something\nReadable.prototype.on = function(ev, fn) {\n  var res = Stream.prototype.on.call(this, ev, fn);\n\n  if (ev === 'data' && !this._readableState.flowing)\n    emitDataEvents(this);\n\n  if (ev === 'readable' && this.readable) {\n    var state = this._readableState;\n    if (!state.readableListening) {\n      state.readableListening = true;\n      state.emittedReadable = false;\n      state.needReadable = true;\n      if (!state.reading) {\n        this.read(0);\n      } else if (state.length) {\n        emitReadable(this, state);\n      }\n    }\n  }\n\n  return res;\n};\nReadable.prototype.addListener = Readable.prototype.on;\n\n// pause() and resume() are remnants of the legacy readable stream API\n// If the user uses them, then switch into old mode.\nReadable.prototype.resume = function() {\n  emitDataEvents(this);\n  this.read(0);\n  this.emit('resume');\n};\n\nReadable.prototype.pause = function() {\n  emitDataEvents(this, true);\n  this.emit('pause');\n};\n\nfunction emitDataEvents(stream, startPaused) {\n  var state = stream._readableState;\n\n  if (state.flowing) {\n    // https://github.com/isaacs/readable-stream/issues/16\n    throw new Error('Cannot switch to old mode now.');\n  }\n\n  var paused = startPaused || false;\n  var readable = false;\n\n  // convert to an old-style stream.\n  stream.readable = true;\n  stream.pipe = Stream.prototype.pipe;\n  stream.on = stream.addListener = Stream.prototype.on;\n\n  stream.on('readable', function() {\n    readable = true;\n\n    var c;\n    while (!paused && (null !== (c = stream.read())))\n      stream.emit('data', c);\n\n    if (c === null) {\n      readable = false;\n      stream._readableState.needReadable = true;\n    }\n  });\n\n  stream.pause = function() {\n    paused = true;\n    this.emit('pause');\n  };\n\n  stream.resume = function() {\n    paused = false;\n    if (readable)\n      process.nextTick(function() {\n        stream.emit('readable');\n      });\n    else\n      this.read(0);\n    this.emit('resume');\n  };\n\n  // now make it start, just in case it hadn't already.\n  stream.emit('readable');\n}\n\n// wrap an old-style stream as the async data source.\n// This is *not* part of the readable stream interface.\n// It is an ugly unfortunate mess of history.\nReadable.prototype.wrap = function(stream) {\n  var state = this._readableState;\n  var paused = false;\n\n  var self = this;\n  stream.on('end', function() {\n    if (state.decoder && !state.ended) {\n      var chunk = state.decoder.end();\n      if (chunk && chunk.length)\n        self.push(chunk);\n    }\n\n    self.push(null);\n  });\n\n  stream.on('data', function(chunk) {\n    if (state.decoder)\n      chunk = state.decoder.write(chunk);\n    if (!chunk || !state.objectMode && !chunk.length)\n      return;\n\n    var ret = self.push(chunk);\n    if (!ret) {\n      paused = true;\n      stream.pause();\n    }\n  });\n\n  // proxy all the other methods.\n  // important when wrapping filters and duplexes.\n  for (var i in stream) {\n    if (typeof stream[i] === 'function' &&\n        typeof this[i] === 'undefined') {\n      this[i] = function(method) { return function() {\n        return stream[method].apply(stream, arguments);\n      }}(i);\n    }\n  }\n\n  // proxy certain important events.\n  var events = ['error', 'close', 'destroy', 'pause', 'resume'];\n  forEach(events, function(ev) {\n    stream.on(ev, self.emit.bind(self, ev));\n  });\n\n  // when we try to consume some more bytes, simply unpause the\n  // underlying stream.\n  self._read = function(n) {\n    if (paused) {\n      paused = false;\n      stream.resume();\n    }\n  };\n\n  return self;\n};\n\n\n\n// exposed for testing purposes only.\nReadable._fromList = fromList;\n\n// Pluck off n bytes from an array of buffers.\n// Length is the combined lengths of all the buffers in the list.\nfunction fromList(n, state) {\n  var list = state.buffer;\n  var length = state.length;\n  var stringMode = !!state.decoder;\n  var objectMode = !!state.objectMode;\n  var ret;\n\n  // nothing in the list, definitely empty.\n  if (list.length === 0)\n    return null;\n\n  if (length === 0)\n    ret = null;\n  else if (objectMode)\n    ret = list.shift();\n  else if (!n || n >= length) {\n    // read it all, truncate the array.\n    if (stringMode)\n      ret = list.join('');\n    else\n      ret = Buffer.concat(list, length);\n    list.length = 0;\n  } else {\n    // read just some of it.\n    if (n < list[0].length) {\n      // just take a part of the first list item.\n      // slice is the same for buffers and strings.\n      var buf = list[0];\n      ret = buf.slice(0, n);\n      list[0] = buf.slice(n);\n    } else if (n === list[0].length) {\n      // first list is a perfect match\n      ret = list.shift();\n    } else {\n      // complex case.\n      // we have enough to cover it, but it spans past the first buffer.\n      if (stringMode)\n        ret = '';\n      else\n        ret = new Buffer(n);\n\n      var c = 0;\n      for (var i = 0, l = list.length; i < l && c < n; i++) {\n        var buf = list[0];\n        var cpy = Math.min(n - c, buf.length);\n\n        if (stringMode)\n          ret += buf.slice(0, cpy);\n        else\n          buf.copy(ret, c, 0, cpy);\n\n        if (cpy < buf.length)\n          list[0] = buf.slice(cpy);\n        else\n          list.shift();\n\n        c += cpy;\n      }\n    }\n  }\n\n  return ret;\n}\n\nfunction endReadable(stream) {\n  var state = stream._readableState;\n\n  // If we get here before consuming all the bytes, then that is a\n  // bug in node.  Should never happen.\n  if (state.length > 0)\n    throw new Error('endReadable called on non-empty stream');\n\n  if (!state.endEmitted && state.calledRead) {\n    state.ended = true;\n    process.nextTick(function() {\n      // Check that we didn't get one last unshift.\n      if (!state.endEmitted && state.length === 0) {\n        state.endEmitted = true;\n        stream.readable = false;\n        stream.emit('end');\n      }\n    });\n  }\n}\n\nfunction forEach (xs, f) {\n  for (var i = 0, l = xs.length; i < l; i++) {\n    f(xs[i], i);\n  }\n}\n\nfunction indexOf (xs, x) {\n  for (var i = 0, l = xs.length; i < l; i++) {\n    if (xs[i] === x) return i;\n  }\n  return -1;\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// A bit simpler than readable streams.\n// Implement an async ._write(chunk, cb), and it'll handle all\n// the drain event emission and buffering.\n\nmodule.exports = Writable;\n\n/*<replacement>*/\nvar Buffer = require('buffer').Buffer;\n/*</replacement>*/\n\nWritable.WritableState = WritableState;\n\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\n\nvar Stream = require('stream');\n\nutil.inherits(Writable, Stream);\n\nfunction WriteReq(chunk, encoding, cb) {\n  this.chunk = chunk;\n  this.encoding = encoding;\n  this.callback = cb;\n}\n\nfunction WritableState(options, stream) {\n  options = options || {};\n\n  // the point at which write() starts returning false\n  // Note: 0 is a valid value, means that we always return false if\n  // the entire buffer is not flushed immediately on write()\n  var hwm = options.highWaterMark;\n  this.highWaterMark = (hwm || hwm === 0) ? hwm : 16 * 1024;\n\n  // object stream flag to indicate whether or not this stream\n  // contains buffers or objects.\n  this.objectMode = !!options.objectMode;\n\n  // cast to ints.\n  this.highWaterMark = ~~this.highWaterMark;\n\n  this.needDrain = false;\n  // at the start of calling end()\n  this.ending = false;\n  // when end() has been called, and returned\n  this.ended = false;\n  // when 'finish' is emitted\n  this.finished = false;\n\n  // should we decode strings into buffers before passing to _write?\n  // this is here so that some node-core streams can optimize string\n  // handling at a lower level.\n  var noDecode = options.decodeStrings === false;\n  this.decodeStrings = !noDecode;\n\n  // Crypto is kind of old and crusty.  Historically, its default string\n  // encoding is 'binary' so we have to make this configurable.\n  // Everything else in the universe uses 'utf8', though.\n  this.defaultEncoding = options.defaultEncoding || 'utf8';\n\n  // not an actual buffer we keep track of, but a measurement\n  // of how much we're waiting to get pushed to some underlying\n  // socket or file.\n  this.length = 0;\n\n  // a flag to see when we're in the middle of a write.\n  this.writing = false;\n\n  // a flag to be able to tell if the onwrite cb is called immediately,\n  // or on a later tick.  We set this to true at first, becuase any\n  // actions that shouldn't happen until \"later\" should generally also\n  // not happen before the first write call.\n  this.sync = true;\n\n  // a flag to know if we're processing previously buffered items, which\n  // may call the _write() callback in the same tick, so that we don't\n  // end up in an overlapped onwrite situation.\n  this.bufferProcessing = false;\n\n  // the callback that's passed to _write(chunk,cb)\n  this.onwrite = function(er) {\n    onwrite(stream, er);\n  };\n\n  // the callback that the user supplies to write(chunk,encoding,cb)\n  this.writecb = null;\n\n  // the amount that is being written when _write is called.\n  this.writelen = 0;\n\n  this.buffer = [];\n\n  // True if the error was already emitted and should not be thrown again\n  this.errorEmitted = false;\n}\n\nfunction Writable(options) {\n  var Duplex = require('./_stream_duplex');\n\n  // Writable ctor is applied to Duplexes, though they're not\n  // instanceof Writable, they're instanceof Readable.\n  if (!(this instanceof Writable) && !(this instanceof Duplex))\n    return new Writable(options);\n\n  this._writableState = new WritableState(options, this);\n\n  // legacy.\n  this.writable = true;\n\n  Stream.call(this);\n}\n\n// Otherwise people can pipe Writable streams, which is just wrong.\nWritable.prototype.pipe = function() {\n  this.emit('error', new Error('Cannot pipe. Not readable.'));\n};\n\n\nfunction writeAfterEnd(stream, state, cb) {\n  var er = new Error('write after end');\n  // TODO: defer error events consistently everywhere, not just the cb\n  stream.emit('error', er);\n  process.nextTick(function() {\n    cb(er);\n  });\n}\n\n// If we get something that is not a buffer, string, null, or undefined,\n// and we're not in objectMode, then that's an error.\n// Otherwise stream chunks are all considered to be of length=1, and the\n// watermarks determine how many objects to keep in the buffer, rather than\n// how many bytes or characters.\nfunction validChunk(stream, state, chunk, cb) {\n  var valid = true;\n  if (!Buffer.isBuffer(chunk) &&\n      'string' !== typeof chunk &&\n      chunk !== null &&\n      chunk !== undefined &&\n      !state.objectMode) {\n    var er = new TypeError('Invalid non-string/buffer chunk');\n    stream.emit('error', er);\n    process.nextTick(function() {\n      cb(er);\n    });\n    valid = false;\n  }\n  return valid;\n}\n\nWritable.prototype.write = function(chunk, encoding, cb) {\n  var state = this._writableState;\n  var ret = false;\n\n  if (typeof encoding === 'function') {\n    cb = encoding;\n    encoding = null;\n  }\n\n  if (Buffer.isBuffer(chunk))\n    encoding = 'buffer';\n  else if (!encoding)\n    encoding = state.defaultEncoding;\n\n  if (typeof cb !== 'function')\n    cb = function() {};\n\n  if (state.ended)\n    writeAfterEnd(this, state, cb);\n  else if (validChunk(this, state, chunk, cb))\n    ret = writeOrBuffer(this, state, chunk, encoding, cb);\n\n  return ret;\n};\n\nfunction decodeChunk(state, chunk, encoding) {\n  if (!state.objectMode &&\n      state.decodeStrings !== false &&\n      typeof chunk === 'string') {\n    chunk = new Buffer(chunk, encoding);\n  }\n  return chunk;\n}\n\n// if we're already writing something, then just put this\n// in the queue, and wait our turn.  Otherwise, call _write\n// If we return false, then we need a drain event, so set that flag.\nfunction writeOrBuffer(stream, state, chunk, encoding, cb) {\n  chunk = decodeChunk(state, chunk, encoding);\n  if (Buffer.isBuffer(chunk))\n    encoding = 'buffer';\n  var len = state.objectMode ? 1 : chunk.length;\n\n  state.length += len;\n\n  var ret = state.length < state.highWaterMark;\n  // we must ensure that previous needDrain will not be reset to false.\n  if (!ret)\n    state.needDrain = true;\n\n  if (state.writing)\n    state.buffer.push(new WriteReq(chunk, encoding, cb));\n  else\n    doWrite(stream, state, len, chunk, encoding, cb);\n\n  return ret;\n}\n\nfunction doWrite(stream, state, len, chunk, encoding, cb) {\n  state.writelen = len;\n  state.writecb = cb;\n  state.writing = true;\n  state.sync = true;\n  stream._write(chunk, encoding, state.onwrite);\n  state.sync = false;\n}\n\nfunction onwriteError(stream, state, sync, er, cb) {\n  if (sync)\n    process.nextTick(function() {\n      cb(er);\n    });\n  else\n    cb(er);\n\n  stream._writableState.errorEmitted = true;\n  stream.emit('error', er);\n}\n\nfunction onwriteStateUpdate(state) {\n  state.writing = false;\n  state.writecb = null;\n  state.length -= state.writelen;\n  state.writelen = 0;\n}\n\nfunction onwrite(stream, er) {\n  var state = stream._writableState;\n  var sync = state.sync;\n  var cb = state.writecb;\n\n  onwriteStateUpdate(state);\n\n  if (er)\n    onwriteError(stream, state, sync, er, cb);\n  else {\n    // Check if we're actually ready to finish, but don't emit yet\n    var finished = needFinish(stream, state);\n\n    if (!finished && !state.bufferProcessing && state.buffer.length)\n      clearBuffer(stream, state);\n\n    if (sync) {\n      process.nextTick(function() {\n        afterWrite(stream, state, finished, cb);\n      });\n    } else {\n      afterWrite(stream, state, finished, cb);\n    }\n  }\n}\n\nfunction afterWrite(stream, state, finished, cb) {\n  if (!finished)\n    onwriteDrain(stream, state);\n  cb();\n  if (finished)\n    finishMaybe(stream, state);\n}\n\n// Must force callback to be called on nextTick, so that we don't\n// emit 'drain' before the write() consumer gets the 'false' return\n// value, and has a chance to attach a 'drain' listener.\nfunction onwriteDrain(stream, state) {\n  if (state.length === 0 && state.needDrain) {\n    state.needDrain = false;\n    stream.emit('drain');\n  }\n}\n\n\n// if there's something in the buffer waiting, then process it\nfunction clearBuffer(stream, state) {\n  state.bufferProcessing = true;\n\n  for (var c = 0; c < state.buffer.length; c++) {\n    var entry = state.buffer[c];\n    var chunk = entry.chunk;\n    var encoding = entry.encoding;\n    var cb = entry.callback;\n    var len = state.objectMode ? 1 : chunk.length;\n\n    doWrite(stream, state, len, chunk, encoding, cb);\n\n    // if we didn't call the onwrite immediately, then\n    // it means that we need to wait until it does.\n    // also, that means that the chunk and cb are currently\n    // being processed, so move the buffer counter past them.\n    if (state.writing) {\n      c++;\n      break;\n    }\n  }\n\n  state.bufferProcessing = false;\n  if (c < state.buffer.length)\n    state.buffer = state.buffer.slice(c);\n  else\n    state.buffer.length = 0;\n}\n\nWritable.prototype._write = function(chunk, encoding, cb) {\n  cb(new Error('not implemented'));\n};\n\nWritable.prototype.end = function(chunk, encoding, cb) {\n  var state = this._writableState;\n\n  if (typeof chunk === 'function') {\n    cb = chunk;\n    chunk = null;\n    encoding = null;\n  } else if (typeof encoding === 'function') {\n    cb = encoding;\n    encoding = null;\n  }\n\n  if (typeof chunk !== 'undefined' && chunk !== null)\n    this.write(chunk, encoding);\n\n  // ignore unnecessary end() calls.\n  if (!state.ending && !state.finished)\n    endWritable(this, state, cb);\n};\n\n\nfunction needFinish(stream, state) {\n  return (state.ending &&\n          state.length === 0 &&\n          !state.finished &&\n          !state.writing);\n}\n\nfunction finishMaybe(stream, state) {\n  var need = needFinish(stream, state);\n  if (need) {\n    state.finished = true;\n    stream.emit('finish');\n  }\n  return need;\n}\n\nfunction endWritable(stream, state, cb) {\n  state.ending = true;\n  finishMaybe(stream, state);\n  if (cb) {\n    if (state.finished)\n      process.nextTick(cb);\n    else\n      stream.once('finish', cb);\n  }\n  state.ended = true;\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// a duplex stream is just a stream that is both readable and writable.\n// Since JS doesn't have multiple prototypal inheritance, this class\n// prototypally inherits from Readable, and then parasitically from\n// Writable.\n\nmodule.exports = Duplex;\n\n/*<replacement>*/\nvar objectKeys = Object.keys || function (obj) {\n  var keys = [];\n  for (var key in obj) keys.push(key);\n  return keys;\n}\n/*</replacement>*/\n\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\nvar Readable = require('./_stream_readable');\nvar Writable = require('./_stream_writable');\n\nutil.inherits(Duplex, Readable);\n\nforEach(objectKeys(Writable.prototype), function(method) {\n  if (!Duplex.prototype[method])\n    Duplex.prototype[method] = Writable.prototype[method];\n});\n\nfunction Duplex(options) {\n  if (!(this instanceof Duplex))\n    return new Duplex(options);\n\n  Readable.call(this, options);\n  Writable.call(this, options);\n\n  if (options && options.readable === false)\n    this.readable = false;\n\n  if (options && options.writable === false)\n    this.writable = false;\n\n  this.allowHalfOpen = true;\n  if (options && options.allowHalfOpen === false)\n    this.allowHalfOpen = false;\n\n  this.once('end', onend);\n}\n\n// the no-half-open enforcer\nfunction onend() {\n  // if we allow half-open state, or if the writable side ended,\n  // then we're ok.\n  if (this.allowHalfOpen || this._writableState.ended)\n    return;\n\n  // no more data can be written.\n  // But allow more writes to happen in this tick.\n  process.nextTick(this.end.bind(this));\n}\n\nfunction forEach (xs, f) {\n  for (var i = 0, l = xs.length; i < l; i++) {\n    f(xs[i], i);\n  }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\n// a transform stream is a readable/writable stream where you do\n// something with the data.  Sometimes it's called a \"filter\",\n// but that's not a great name for it, since that implies a thing where\n// some bits pass through, and others are simply ignored.  (That would\n// be a valid example of a transform, of course.)\n//\n// While the output is causally related to the input, it's not a\n// necessarily symmetric or synchronous transformation.  For example,\n// a zlib stream might take multiple plain-text writes(), and then\n// emit a single compressed chunk some time in the future.\n//\n// Here's how this works:\n//\n// The Transform stream has all the aspects of the readable and writable\n// stream classes.  When you write(chunk), that calls _write(chunk,cb)\n// internally, and returns false if there's a lot of pending writes\n// buffered up.  When you call read(), that calls _read(n) until\n// there's enough pending readable data buffered up.\n//\n// In a transform stream, the written data is placed in a buffer.  When\n// _read(n) is called, it transforms the queued up data, calling the\n// buffered _write cb's as it consumes chunks.  If consuming a single\n// written chunk would result in multiple output chunks, then the first\n// outputted bit calls the readcb, and subsequent chunks just go into\n// the read buffer, and will cause it to emit 'readable' if necessary.\n//\n// This way, back-pressure is actually determined by the reading side,\n// since _read has to be called to start processing a new chunk.  However,\n// a pathological inflate type of transform can cause excessive buffering\n// here.  For example, imagine a stream where every byte of input is\n// interpreted as an integer from 0-255, and then results in that many\n// bytes of output.  Writing the 4 bytes {ff,ff,ff,ff} would result in\n// 1kb of data being output.  In this case, you could write a very small\n// amount of input, and end up with a very large amount of output.  In\n// such a pathological inflating mechanism, there'd be no way to tell\n// the system to stop doing the transform.  A single 4MB write could\n// cause the system to run out of memory.\n//\n// However, even in such a pathological case, only a single written chunk\n// would be consumed, and then the rest would wait (un-transformed) until\n// the results of the previous transformed chunk were consumed.\n\nmodule.exports = Transform;\n\nvar Duplex = require('./_stream_duplex');\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\nutil.inherits(Transform, Duplex);\n\n\nfunction TransformState(options, stream) {\n  this.afterTransform = function(er, data) {\n    return afterTransform(stream, er, data);\n  };\n\n  this.needTransform = false;\n  this.transforming = false;\n  this.writecb = null;\n  this.writechunk = null;\n}\n\nfunction afterTransform(stream, er, data) {\n  var ts = stream._transformState;\n  ts.transforming = false;\n\n  var cb = ts.writecb;\n\n  if (!cb)\n    return stream.emit('error', new Error('no writecb in Transform class'));\n\n  ts.writechunk = null;\n  ts.writecb = null;\n\n  if (data !== null && data !== undefined)\n    stream.push(data);\n\n  if (cb)\n    cb(er);\n\n  var rs = stream._readableState;\n  rs.reading = false;\n  if (rs.needReadable || rs.length < rs.highWaterMark) {\n    stream._read(rs.highWaterMark);\n  }\n}\n\n\nfunction Transform(options) {\n  if (!(this instanceof Transform))\n    return new Transform(options);\n\n  Duplex.call(this, options);\n\n  var ts = this._transformState = new TransformState(options, this);\n\n  // when the writable side finishes, then flush out anything remaining.\n  var stream = this;\n\n  // start out asking for a readable event once data is transformed.\n  this._readableState.needReadable = true;\n\n  // we have implemented the _read method, and done the other things\n  // that Readable wants before the first _read call, so unset the\n  // sync guard flag.\n  this._readableState.sync = false;\n\n  this.once('finish', function() {\n    if ('function' === typeof this._flush)\n      this._flush(function(er) {\n        done(stream, er);\n      });\n    else\n      done(stream);\n  });\n}\n\nTransform.prototype.push = function(chunk, encoding) {\n  this._transformState.needTransform = false;\n  return Duplex.prototype.push.call(this, chunk, encoding);\n};\n\n// This is the part where you do stuff!\n// override this function in implementation classes.\n// 'chunk' is an input chunk.\n//\n// Call `push(newChunk)` to pass along transformed output\n// to the readable side.  You may call 'push' zero or more times.\n//\n// Call `cb(err)` when you are done with this chunk.  If you pass\n// an error, then that'll put the hurt on the whole operation.  If you\n// never call cb(), then you'll never get another chunk.\nTransform.prototype._transform = function(chunk, encoding, cb) {\n  throw new Error('not implemented');\n};\n\nTransform.prototype._write = function(chunk, encoding, cb) {\n  var ts = this._transformState;\n  ts.writecb = cb;\n  ts.writechunk = chunk;\n  ts.writeencoding = encoding;\n  if (!ts.transforming) {\n    var rs = this._readableState;\n    if (ts.needTransform ||\n        rs.needReadable ||\n        rs.length < rs.highWaterMark)\n      this._read(rs.highWaterMark);\n  }\n};\n\n// Doesn't matter what the args are here.\n// _transform does all the work.\n// That we got here means that the readable side wants more data.\nTransform.prototype._read = function(n) {\n  var ts = this._transformState;\n\n  if (ts.writechunk !== null && ts.writecb && !ts.transforming) {\n    ts.transforming = true;\n    this._transform(ts.writechunk, ts.writeencoding, ts.afterTransform);\n  } else {\n    // mark that we need a transform, so that any data that comes in\n    // will get processed, now that we've asked for it.\n    ts.needTransform = true;\n  }\n};\n\n\nfunction done(stream, er) {\n  if (er)\n    return stream.emit('error', er);\n\n  // if there's nothing in the write buffer, then that means\n  // that nothing more will ever be provided\n  var ws = stream._writableState;\n  var rs = stream._readableState;\n  var ts = stream._transformState;\n\n  if (ws.length)\n    throw new Error('calling transform done when ws.length != 0');\n\n  if (ts.transforming)\n    throw new Error('calling transform done when still transforming');\n\n  return stream.push(null);\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// a passthrough stream.\n// basically just the most minimal sort of Transform stream.\n// Every written chunk gets output as-is.\n\nmodule.exports = PassThrough;\n\nvar Transform = require('./_stream_transform');\n\n/*<replacement>*/\nvar util = require('core-util-is');\nutil.inherits = require('inherits');\n/*</replacement>*/\n\nutil.inherits(PassThrough, Transform);\n\nfunction PassThrough(options) {\n  if (!(this instanceof PassThrough))\n    return new PassThrough(options);\n\n  Transform.call(this, options);\n}\n\nPassThrough.prototype._transform = function(chunk, encoding, cb) {\n  cb(null, chunk);\n};\n","\"use strict\";\nvar config = {\n  instrument: false\n};\n\nfunction configure(name, value) {\n  if (arguments.length === 2) {\n    config[name] = value;\n  } else {\n    return config[name];\n  }\n}\n\nexports.config = config;\nexports.configure = configure;","\"use strict\";\nfunction objectOrFunction(x) {\n  return isFunction(x) || (typeof x === \"object\" && x !== null);\n}\n\nfunction isFunction(x) {\n  return typeof x === \"function\";\n}\n\nfunction isArray(x) {\n  return Object.prototype.toString.call(x) === \"[object Array]\";\n}\n\n// Date.now is not available in browsers < IE9\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/now#Compatibility\nvar now = Date.now || function() { return new Date().getTime(); };\n\n\nexports.objectOrFunction = objectOrFunction;\nexports.isFunction = isFunction;\nexports.isArray = isArray;\nexports.now = now;","\"use strict\";\n/* global toString */\n\nvar isArray = require(\"./utils\").isArray;\nvar isFunction = require(\"./utils\").isFunction;\n\n/**\n  Returns a promise that is fulfilled when all the given promises have been\n  fulfilled, or rejected if any of them become rejected. The return promise\n  is fulfilled with an array that gives all the values in the order they were\n  passed in the `promises` array argument.\n\n  Example:\n\n  ```javascript\n  var promise1 = RSVP.resolve(1);\n  var promise2 = RSVP.resolve(2);\n  var promise3 = RSVP.resolve(3);\n  var promises = [ promise1, promise2, promise3 ];\n\n  RSVP.all(promises).then(function(array){\n    // The array here would be [ 1, 2, 3 ];\n  });\n  ```\n\n  If any of the `promises` given to `RSVP.all` are rejected, the first promise\n  that is rejected will be given as an argument to the returned promises's\n  rejection handler. For example:\n\n  Example:\n\n  ```javascript\n  var promise1 = RSVP.resolve(1);\n  var promise2 = RSVP.reject(new Error(\"2\"));\n  var promise3 = RSVP.reject(new Error(\"3\"));\n  var promises = [ promise1, promise2, promise3 ];\n\n  RSVP.all(promises).then(function(array){\n    // Code here never runs because there are rejected promises!\n  }, function(error) {\n    // error.message === \"2\"\n  });\n  ```\n\n  @method all\n  @for RSVP\n  @param {Array} promises\n  @param {String} label\n  @return {Promise} promise that is fulfilled when all `promises` have been\n  fulfilled, or rejected if any of them become rejected.\n*/\nfunction all(promises) {\n  /*jshint validthis:true */\n  var Promise = this;\n\n  if (!isArray(promises)) {\n    throw new TypeError('You must pass an array to all.');\n  }\n\n  return new Promise(function(resolve, reject) {\n    var results = [], remaining = promises.length,\n    promise;\n\n    if (remaining === 0) {\n      resolve([]);\n    }\n\n    function resolver(index) {\n      return function(value) {\n        resolveAll(index, value);\n      };\n    }\n\n    function resolveAll(index, value) {\n      results[index] = value;\n      if (--remaining === 0) {\n        resolve(results);\n      }\n    }\n\n    for (var i = 0; i < promises.length; i++) {\n      promise = promises[i];\n\n      if (promise && isFunction(promise.then)) {\n        promise.then(resolver(i), reject);\n      } else {\n        resolveAll(i, promise);\n      }\n    }\n  });\n}\n\nexports.all = all;","\"use strict\";\n/* global toString */\nvar isArray = require(\"./utils\").isArray;\n\n/**\n  `RSVP.race` allows you to watch a series of promises and act as soon as the\n  first promise given to the `promises` argument fulfills or rejects.\n\n  Example:\n\n  ```javascript\n  var promise1 = new RSVP.Promise(function(resolve, reject){\n    setTimeout(function(){\n      resolve(\"promise 1\");\n    }, 200);\n  });\n\n  var promise2 = new RSVP.Promise(function(resolve, reject){\n    setTimeout(function(){\n      resolve(\"promise 2\");\n    }, 100);\n  });\n\n  RSVP.race([promise1, promise2]).then(function(result){\n    // result === \"promise 2\" because it was resolved before promise1\n    // was resolved.\n  });\n  ```\n\n  `RSVP.race` is deterministic in that only the state of the first completed\n  promise matters. For example, even if other promises given to the `promises`\n  array argument are resolved, but the first completed promise has become\n  rejected before the other promises became fulfilled, the returned promise\n  will become rejected:\n\n  ```javascript\n  var promise1 = new RSVP.Promise(function(resolve, reject){\n    setTimeout(function(){\n      resolve(\"promise 1\");\n    }, 200);\n  });\n\n  var promise2 = new RSVP.Promise(function(resolve, reject){\n    setTimeout(function(){\n      reject(new Error(\"promise 2\"));\n    }, 100);\n  });\n\n  RSVP.race([promise1, promise2]).then(function(result){\n    // Code here never runs because there are rejected promises!\n  }, function(reason){\n    // reason.message === \"promise2\" because promise 2 became rejected before\n    // promise 1 became fulfilled\n  });\n  ```\n\n  @method race\n  @for RSVP\n  @param {Array} promises array of promises to observe\n  @param {String} label optional string for describing the promise returned.\n  Useful for tooling.\n  @return {Promise} a promise that becomes fulfilled with the value the first\n  completed promises is resolved with if the first completed promise was\n  fulfilled, or rejected with the reason that the first completed promise\n  was rejected with.\n*/\nfunction race(promises) {\n  /*jshint validthis:true */\n  var Promise = this;\n\n  if (!isArray(promises)) {\n    throw new TypeError('You must pass an array to race.');\n  }\n  return new Promise(function(resolve, reject) {\n    var results = [], promise;\n\n    for (var i = 0; i < promises.length; i++) {\n      promise = promises[i];\n\n      if (promise && typeof promise.then === 'function') {\n        promise.then(resolve, reject);\n      } else {\n        resolve(promise);\n      }\n    }\n  });\n}\n\nexports.race = race;","\"use strict\";\nfunction resolve(value) {\n  /*jshint validthis:true */\n  if (value && typeof value === 'object' && value.constructor === this) {\n    return value;\n  }\n\n  var Promise = this;\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n}\n\nexports.resolve = resolve;","\"use strict\";\n/**\n  `RSVP.reject` returns a promise that will become rejected with the passed\n  `reason`. `RSVP.reject` is essentially shorthand for the following:\n\n  ```javascript\n  var promise = new RSVP.Promise(function(resolve, reject){\n    reject(new Error('WHOOPS'));\n  });\n\n  promise.then(function(value){\n    // Code here doesn't run because the promise is rejected!\n  }, function(reason){\n    // reason.message === 'WHOOPS'\n  });\n  ```\n\n  Instead of writing the above, your code now simply becomes the following:\n\n  ```javascript\n  var promise = RSVP.reject(new Error('WHOOPS'));\n\n  promise.then(function(value){\n    // Code here doesn't run because the promise is rejected!\n  }, function(reason){\n    // reason.message === 'WHOOPS'\n  });\n  ```\n\n  @method reject\n  @for RSVP\n  @param {Any} reason value that the returned promise will be rejected with.\n  @param {String} label optional string for identifying the returned promise.\n  Useful for tooling.\n  @return {Promise} a promise that will become rejected with the given\n  `reason`.\n*/\nfunction reject(reason) {\n  /*jshint validthis:true */\n  var Promise = this;\n\n  return new Promise(function (resolve, reject) {\n    reject(reason);\n  });\n}\n\nexports.reject = reject;","\"use strict\";\nvar browserGlobal = (typeof window !== 'undefined') ? window : {};\nvar BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;\nvar local = (typeof global !== 'undefined') ? global : (this === undefined? window:this);\n\n// node\nfunction useNextTick() {\n  return function() {\n    process.nextTick(flush);\n  };\n}\n\nfunction useMutationObserver() {\n  var iterations = 0;\n  var observer = new BrowserMutationObserver(flush);\n  var node = document.createTextNode('');\n  observer.observe(node, { characterData: true });\n\n  return function() {\n    node.data = (iterations = ++iterations % 2);\n  };\n}\n\nfunction useSetTimeout() {\n  return function() {\n    local.setTimeout(flush, 1);\n  };\n}\n\nvar queue = [];\nfunction flush() {\n  for (var i = 0; i < queue.length; i++) {\n    var tuple = queue[i];\n    var callback = tuple[0], arg = tuple[1];\n    callback(arg);\n  }\n  queue = [];\n}\n\nvar scheduleFlush;\n\n// Decide what async method to use to triggering processing of queued callbacks:\nif (typeof process !== 'undefined' && {}.toString.call(process) === '[object process]') {\n  scheduleFlush = useNextTick();\n} else if (BrowserMutationObserver) {\n  scheduleFlush = useMutationObserver();\n} else {\n  scheduleFlush = useSetTimeout();\n}\n\nfunction asap(callback, arg) {\n  var length = queue.push([callback, arg]);\n  if (length === 1) {\n    // If length is 1, that means that we need to schedule an async flush.\n    // If additional callbacks are queued before the queue is flushed, they\n    // will be processed by this flush that we are scheduling.\n    scheduleFlush();\n  }\n}\n\nexports.asap = asap;","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = Buffer\nexports.INSPECT_MAX_BYTES = 50\nBuffer.poolSize = 8192\n\n/**\n * If `TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Note:\n *\n * - Implementation must support adding new properties to `Uint8Array` instances.\n *   Firefox 4-29 lacked support, fixed in Firefox 30+.\n *   See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *  - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *  - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *    incorrect length in some situations.\n *\n * We detect these buggy browsers and set `TYPED_ARRAY_SUPPORT` to `false` so they will\n * get the Object implementation, which is slower but will work correctly.\n */\nvar TYPED_ARRAY_SUPPORT = (function () {\n  try {\n    var buf = new ArrayBuffer(0)\n    var arr = new Uint8Array(buf)\n    arr.foo = function () { return 42 }\n    return 42 === arr.foo() && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        new Uint8Array(1).subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n})()\n\n/**\n * Class: Buffer\n * =============\n *\n * The Buffer constructor returns instances of `Uint8Array` that are augmented\n * with function properties for all the node `Buffer` API functions. We use\n * `Uint8Array` so that square bracket notation works as expected -- it returns\n * a single octet.\n *\n * By augmenting the instances, we can avoid modifying the `Uint8Array`\n * prototype.\n */\nfunction Buffer (subject, encoding, noZero) {\n  if (!(this instanceof Buffer))\n    return new Buffer(subject, encoding, noZero)\n\n  var type = typeof subject\n\n  // Find the length\n  var length\n  if (type === 'number')\n    length = subject > 0 ? subject >>> 0 : 0\n  else if (type === 'string') {\n    if (encoding === 'base64')\n      subject = base64clean(subject)\n    length = Buffer.byteLength(subject, encoding)\n  } else if (type === 'object' && subject !== null) { // assume object is array-like\n    if (subject.type === 'Buffer' && isArray(subject.data))\n      subject = subject.data\n    length = +subject.length > 0 ? Math.floor(+subject.length) : 0\n  } else\n    throw new Error('First argument needs to be a number, array or string.')\n\n  var buf\n  if (TYPED_ARRAY_SUPPORT) {\n    // Preferred: Return an augmented `Uint8Array` instance for best performance\n    buf = Buffer._augment(new Uint8Array(length))\n  } else {\n    // Fallback: Return THIS instance of Buffer (created by `new`)\n    buf = this\n    buf.length = length\n    buf._isBuffer = true\n  }\n\n  var i\n  if (TYPED_ARRAY_SUPPORT && typeof subject.byteLength === 'number') {\n    // Speed optimization -- use set if we're copying from a typed array\n    buf._set(subject)\n  } else if (isArrayish(subject)) {\n    // Treat array-ish objects as a byte array\n    if (Buffer.isBuffer(subject)) {\n      for (i = 0; i < length; i++)\n        buf[i] = subject.readUInt8(i)\n    } else {\n      for (i = 0; i < length; i++)\n        buf[i] = ((subject[i] % 256) + 256) % 256\n    }\n  } else if (type === 'string') {\n    buf.write(subject, 0, encoding)\n  } else if (type === 'number' && !TYPED_ARRAY_SUPPORT && !noZero) {\n    for (i = 0; i < length; i++) {\n      buf[i] = 0\n    }\n  }\n\n  return buf\n}\n\n// STATIC METHODS\n// ==============\n\nBuffer.isEncoding = function (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'binary':\n    case 'base64':\n    case 'raw':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.isBuffer = function (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.byteLength = function (str, encoding) {\n  var ret\n  str = str.toString()\n  switch (encoding || 'utf8') {\n    case 'hex':\n      ret = str.length / 2\n      break\n    case 'utf8':\n    case 'utf-8':\n      ret = utf8ToBytes(str).length\n      break\n    case 'ascii':\n    case 'binary':\n    case 'raw':\n      ret = str.length\n      break\n    case 'base64':\n      ret = base64ToBytes(str).length\n      break\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      ret = str.length * 2\n      break\n    default:\n      throw new Error('Unknown encoding')\n  }\n  return ret\n}\n\nBuffer.concat = function (list, totalLength) {\n  assert(isArray(list), 'Usage: Buffer.concat(list[, length])')\n\n  if (list.length === 0) {\n    return new Buffer(0)\n  } else if (list.length === 1) {\n    return list[0]\n  }\n\n  var i\n  if (totalLength === undefined) {\n    totalLength = 0\n    for (i = 0; i < list.length; i++) {\n      totalLength += list[i].length\n    }\n  }\n\n  var buf = new Buffer(totalLength)\n  var pos = 0\n  for (i = 0; i < list.length; i++) {\n    var item = list[i]\n    item.copy(buf, pos)\n    pos += item.length\n  }\n  return buf\n}\n\nBuffer.compare = function (a, b) {\n  assert(Buffer.isBuffer(a) && Buffer.isBuffer(b), 'Arguments must be Buffers')\n  var x = a.length\n  var y = b.length\n  for (var i = 0, len = Math.min(x, y); i < len && a[i] === b[i]; i++) {}\n  if (i !== len) {\n    x = a[i]\n    y = b[i]\n  }\n  if (x < y) {\n    return -1\n  }\n  if (y < x) {\n    return 1\n  }\n  return 0\n}\n\n// BUFFER INSTANCE METHODS\n// =======================\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  assert(strLen % 2 === 0, 'Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; i++) {\n    var byte = parseInt(string.substr(i * 2, 2), 16)\n    assert(!isNaN(byte), 'Invalid hex string')\n    buf[offset + i] = byte\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  var charsWritten = blitBuffer(utf8ToBytes(string), buf, offset, length)\n  return charsWritten\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  var charsWritten = blitBuffer(asciiToBytes(string), buf, offset, length)\n  return charsWritten\n}\n\nfunction binaryWrite (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  var charsWritten = blitBuffer(base64ToBytes(string), buf, offset, length)\n  return charsWritten\n}\n\nfunction utf16leWrite (buf, string, offset, length) {\n  var charsWritten = blitBuffer(utf16leToBytes(string), buf, offset, length)\n  return charsWritten\n}\n\nBuffer.prototype.write = function (string, offset, length, encoding) {\n  // Support both (string, offset, length, encoding)\n  // and the legacy (string, encoding, offset, length)\n  if (isFinite(offset)) {\n    if (!isFinite(length)) {\n      encoding = length\n      length = undefined\n    }\n  } else {  // legacy\n    var swap = encoding\n    encoding = offset\n    offset = length\n    length = swap\n  }\n\n  offset = Number(offset) || 0\n  var remaining = this.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n  encoding = String(encoding || 'utf8').toLowerCase()\n\n  var ret\n  switch (encoding) {\n    case 'hex':\n      ret = hexWrite(this, string, offset, length)\n      break\n    case 'utf8':\n    case 'utf-8':\n      ret = utf8Write(this, string, offset, length)\n      break\n    case 'ascii':\n      ret = asciiWrite(this, string, offset, length)\n      break\n    case 'binary':\n      ret = binaryWrite(this, string, offset, length)\n      break\n    case 'base64':\n      ret = base64Write(this, string, offset, length)\n      break\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      ret = utf16leWrite(this, string, offset, length)\n      break\n    default:\n      throw new Error('Unknown encoding')\n  }\n  return ret\n}\n\nBuffer.prototype.toString = function (encoding, start, end) {\n  var self = this\n\n  encoding = String(encoding || 'utf8').toLowerCase()\n  start = Number(start) || 0\n  end = (end === undefined) ? self.length : Number(end)\n\n  // Fastpath empty strings\n  if (end === start)\n    return ''\n\n  var ret\n  switch (encoding) {\n    case 'hex':\n      ret = hexSlice(self, start, end)\n      break\n    case 'utf8':\n    case 'utf-8':\n      ret = utf8Slice(self, start, end)\n      break\n    case 'ascii':\n      ret = asciiSlice(self, start, end)\n      break\n    case 'binary':\n      ret = binarySlice(self, start, end)\n      break\n    case 'base64':\n      ret = base64Slice(self, start, end)\n      break\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      ret = utf16leSlice(self, start, end)\n      break\n    default:\n      throw new Error('Unknown encoding')\n  }\n  return ret\n}\n\nBuffer.prototype.toJSON = function () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nBuffer.prototype.equals = function (b) {\n  assert(Buffer.isBuffer(b), 'Argument must be a Buffer')\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.compare = function (b) {\n  assert(Buffer.isBuffer(b), 'Argument must be a Buffer')\n  return Buffer.compare(this, b)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function (target, target_start, start, end) {\n  var source = this\n\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (!target_start) target_start = 0\n\n  // Copy 0 bytes; we're done\n  if (end === start) return\n  if (target.length === 0 || source.length === 0) return\n\n  // Fatal error conditions\n  assert(end >= start, 'sourceEnd < sourceStart')\n  assert(target_start >= 0 && target_start < target.length,\n      'targetStart out of bounds')\n  assert(start >= 0 && start < source.length, 'sourceStart out of bounds')\n  assert(end >= 0 && end <= source.length, 'sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length)\n    end = this.length\n  if (target.length - target_start < end - start)\n    end = target.length - target_start + start\n\n  var len = end - start\n\n  if (len < 100 || !TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < len; i++) {\n      target[i + target_start] = this[i + start]\n    }\n  } else {\n    target._set(this.subarray(start, start + len), target_start)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  var res = ''\n  var tmp = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    if (buf[i] <= 0x7F) {\n      res += decodeUtf8Char(tmp) + String.fromCharCode(buf[i])\n      tmp = ''\n    } else {\n      tmp += '%' + buf[i].toString(16)\n    }\n  }\n\n  return res + decodeUtf8Char(tmp)\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction binarySlice (buf, start, end) {\n  return asciiSlice(buf, start, end)\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; i++) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len;\n    if (start < 0)\n      start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0)\n      end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start)\n    end = start\n\n  if (TYPED_ARRAY_SUPPORT) {\n    return Buffer._augment(this.subarray(start, end))\n  } else {\n    var sliceLen = end - start\n    var newBuf = new Buffer(sliceLen, undefined, true)\n    for (var i = 0; i < sliceLen; i++) {\n      newBuf[i] = this[i + start]\n    }\n    return newBuf\n  }\n}\n\n// `get` will be removed in Node 0.13+\nBuffer.prototype.get = function (offset) {\n  console.log('.get() is deprecated. Access using array indexes instead.')\n  return this.readUInt8(offset)\n}\n\n// `set` will be removed in Node 0.13+\nBuffer.prototype.set = function (v, offset) {\n  console.log('.set() is deprecated. Access using array indexes instead.')\n  return this.writeUInt8(v, offset)\n}\n\nBuffer.prototype.readUInt8 = function (offset, noAssert) {\n  if (!noAssert) {\n    assert(offset !== undefined && offset !== null, 'missing offset')\n    assert(offset < this.length, 'Trying to read beyond buffer length')\n  }\n\n  if (offset >= this.length)\n    return\n\n  return this[offset]\n}\n\nfunction readUInt16 (buf, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')\n    assert(offset !== undefined && offset !== null, 'missing offset')\n    assert(offset + 1 < buf.length, 'Trying to read beyond buffer length')\n  }\n\n  var len = buf.length\n  if (offset >= len)\n    return\n\n  var val\n  if (littleEndian) {\n    val = buf[offset]\n    if (offset + 1 < len)\n      val |= buf[offset + 1] << 8\n  } else {\n    val = buf[offset] << 8\n    if (offset + 1 < len)\n      val |= buf[offset + 1]\n  }\n  return val\n}\n\nBuffer.prototype.readUInt16LE = function (offset, noAssert) {\n  return readUInt16(this, offset, true, noAssert)\n}\n\nBuffer.prototype.readUInt16BE = function (offset, noAssert) {\n  return readUInt16(this, offset, false, noAssert)\n}\n\nfunction readUInt32 (buf, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')\n    assert(offset !== undefined && offset !== null, 'missing offset')\n    assert(offset + 3 < buf.length, 'Trying to read beyond buffer length')\n  }\n\n  var len = buf.length\n  if (offset >= len)\n    return\n\n  var val\n  if (littleEndian) {\n    if (offset + 2 < len)\n      val = buf[offset + 2] << 16\n    if (offset + 1 < len)\n      val |= buf[offset + 1] << 8\n    val |= buf[offset]\n    if (offset + 3 < len)\n      val = val + (buf[offset + 3] << 24 >>> 0)\n  } else {\n    if (offset + 1 < len)\n      val = buf[offset + 1] << 16\n    if (offset + 2 < len)\n      val |= buf[offset + 2] << 8\n    if (offset + 3 < len)\n      val |= buf[offset + 3]\n    val = val + (buf[offset] << 24 >>> 0)\n  }\n  return val\n}\n\nBuffer.prototype.readUInt32LE = function (offset, noAssert) {\n  return readUInt32(this, offset, true, noAssert)\n}\n\nBuffer.prototype.readUInt32BE = function (offset, noAssert) {\n  return readUInt32(this, offset, false, noAssert)\n}\n\nBuffer.prototype.readInt8 = function (offset, noAssert) {\n  if (!noAssert) {\n    assert(offset !== undefined && offset !== null,\n        'missing offset')\n    assert(offset < this.length, 'Trying to read beyond buffer length')\n  }\n\n  if (offset >= this.length)\n    return\n\n  var neg = this[offset] & 0x80\n  if (neg)\n    return (0xff - this[offset] + 1) * -1\n  else\n    return this[offset]\n}\n\nfunction readInt16 (buf, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')\n    assert(offset !== undefined && offset !== null, 'missing offset')\n    assert(offset + 1 < buf.length, 'Trying to read beyond buffer length')\n  }\n\n  var len = buf.length\n  if (offset >= len)\n    return\n\n  var val = readUInt16(buf, offset, littleEndian, true)\n  var neg = val & 0x8000\n  if (neg)\n    return (0xffff - val + 1) * -1\n  else\n    return val\n}\n\nBuffer.prototype.readInt16LE = function (offset, noAssert) {\n  return readInt16(this, offset, true, noAssert)\n}\n\nBuffer.prototype.readInt16BE = function (offset, noAssert) {\n  return readInt16(this, offset, false, noAssert)\n}\n\nfunction readInt32 (buf, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')\n    assert(offset !== undefined && offset !== null, 'missing offset')\n    assert(offset + 3 < buf.length, 'Trying to read beyond buffer length')\n  }\n\n  var len = buf.length\n  if (offset >= len)\n    return\n\n  var val = readUInt32(buf, offset, littleEndian, true)\n  var neg = val & 0x80000000\n  if (neg)\n    return (0xffffffff - val + 1) * -1\n  else\n    return val\n}\n\nBuffer.prototype.readInt32LE = function (offset, noAssert) {\n  return readInt32(this, offset, true, noAssert)\n}\n\nBuffer.prototype.readInt32BE = function (offset, noAssert) {\n  return readInt32(this, offset, false, noAssert)\n}\n\nfunction readFloat (buf, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')\n    assert(offset + 3 < buf.length, 'Trying to read beyond buffer length')\n  }\n\n  return ieee754.read(buf, offset, littleEndian, 23, 4)\n}\n\nBuffer.prototype.readFloatLE = function (offset, noAssert) {\n  return readFloat(this, offset, true, noAssert)\n}\n\nBuffer.prototype.readFloatBE = function (offset, noAssert) {\n  return readFloat(this, offset, false, noAssert)\n}\n\nfunction readDouble (buf, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')\n    assert(offset + 7 < buf.length, 'Trying to read beyond buffer length')\n  }\n\n  return ieee754.read(buf, offset, littleEndian, 52, 8)\n}\n\nBuffer.prototype.readDoubleLE = function (offset, noAssert) {\n  return readDouble(this, offset, true, noAssert)\n}\n\nBuffer.prototype.readDoubleBE = function (offset, noAssert) {\n  return readDouble(this, offset, false, noAssert)\n}\n\nBuffer.prototype.writeUInt8 = function (value, offset, noAssert) {\n  if (!noAssert) {\n    assert(value !== undefined && value !== null, 'missing value')\n    assert(offset !== undefined && offset !== null, 'missing offset')\n    assert(offset < this.length, 'trying to write beyond buffer length')\n    verifuint(value, 0xff)\n  }\n\n  if (offset >= this.length) return\n\n  this[offset] = value\n  return offset + 1\n}\n\nfunction writeUInt16 (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    assert(value !== undefined && value !== null, 'missing value')\n    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')\n    assert(offset !== undefined && offset !== null, 'missing offset')\n    assert(offset + 1 < buf.length, 'trying to write beyond buffer length')\n    verifuint(value, 0xffff)\n  }\n\n  var len = buf.length\n  if (offset >= len)\n    return\n\n  for (var i = 0, j = Math.min(len - offset, 2); i < j; i++) {\n    buf[offset + i] =\n        (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n            (littleEndian ? i : 1 - i) * 8\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16LE = function (value, offset, noAssert) {\n  return writeUInt16(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeUInt16BE = function (value, offset, noAssert) {\n  return writeUInt16(this, value, offset, false, noAssert)\n}\n\nfunction writeUInt32 (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    assert(value !== undefined && value !== null, 'missing value')\n    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')\n    assert(offset !== undefined && offset !== null, 'missing offset')\n    assert(offset + 3 < buf.length, 'trying to write beyond buffer length')\n    verifuint(value, 0xffffffff)\n  }\n\n  var len = buf.length\n  if (offset >= len)\n    return\n\n  for (var i = 0, j = Math.min(len - offset, 4); i < j; i++) {\n    buf[offset + i] =\n        (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32LE = function (value, offset, noAssert) {\n  return writeUInt32(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeUInt32BE = function (value, offset, noAssert) {\n  return writeUInt32(this, value, offset, false, noAssert)\n}\n\nBuffer.prototype.writeInt8 = function (value, offset, noAssert) {\n  if (!noAssert) {\n    assert(value !== undefined && value !== null, 'missing value')\n    assert(offset !== undefined && offset !== null, 'missing offset')\n    assert(offset < this.length, 'Trying to write beyond buffer length')\n    verifsint(value, 0x7f, -0x80)\n  }\n\n  if (offset >= this.length)\n    return\n\n  if (value >= 0)\n    this.writeUInt8(value, offset, noAssert)\n  else\n    this.writeUInt8(0xff + value + 1, offset, noAssert)\n  return offset + 1\n}\n\nfunction writeInt16 (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    assert(value !== undefined && value !== null, 'missing value')\n    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')\n    assert(offset !== undefined && offset !== null, 'missing offset')\n    assert(offset + 1 < buf.length, 'Trying to write beyond buffer length')\n    verifsint(value, 0x7fff, -0x8000)\n  }\n\n  var len = buf.length\n  if (offset >= len)\n    return\n\n  if (value >= 0)\n    writeUInt16(buf, value, offset, littleEndian, noAssert)\n  else\n    writeUInt16(buf, 0xffff + value + 1, offset, littleEndian, noAssert)\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16LE = function (value, offset, noAssert) {\n  return writeInt16(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeInt16BE = function (value, offset, noAssert) {\n  return writeInt16(this, value, offset, false, noAssert)\n}\n\nfunction writeInt32 (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    assert(value !== undefined && value !== null, 'missing value')\n    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')\n    assert(offset !== undefined && offset !== null, 'missing offset')\n    assert(offset + 3 < buf.length, 'Trying to write beyond buffer length')\n    verifsint(value, 0x7fffffff, -0x80000000)\n  }\n\n  var len = buf.length\n  if (offset >= len)\n    return\n\n  if (value >= 0)\n    writeUInt32(buf, value, offset, littleEndian, noAssert)\n  else\n    writeUInt32(buf, 0xffffffff + value + 1, offset, littleEndian, noAssert)\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32LE = function (value, offset, noAssert) {\n  return writeInt32(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeInt32BE = function (value, offset, noAssert) {\n  return writeInt32(this, value, offset, false, noAssert)\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    assert(value !== undefined && value !== null, 'missing value')\n    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')\n    assert(offset !== undefined && offset !== null, 'missing offset')\n    assert(offset + 3 < buf.length, 'Trying to write beyond buffer length')\n    verifIEEE754(value, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n\n  var len = buf.length\n  if (offset >= len)\n    return\n\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    assert(value !== undefined && value !== null, 'missing value')\n    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')\n    assert(offset !== undefined && offset !== null, 'missing offset')\n    assert(offset + 7 < buf.length,\n        'Trying to write beyond buffer length')\n    verifIEEE754(value, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n\n  var len = buf.length\n  if (offset >= len)\n    return\n\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// fill(value, start=0, end=buffer.length)\nBuffer.prototype.fill = function (value, start, end) {\n  if (!value) value = 0\n  if (!start) start = 0\n  if (!end) end = this.length\n\n  assert(end >= start, 'end < start')\n\n  // Fill 0 bytes; we're done\n  if (end === start) return\n  if (this.length === 0) return\n\n  assert(start >= 0 && start < this.length, 'start out of bounds')\n  assert(end >= 0 && end <= this.length, 'end out of bounds')\n\n  var i\n  if (typeof value === 'number') {\n    for (i = start; i < end; i++) {\n      this[i] = value\n    }\n  } else {\n    var bytes = utf8ToBytes(value.toString())\n    var len = bytes.length\n    for (i = start; i < end; i++) {\n      this[i] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\nBuffer.prototype.inspect = function () {\n  var out = []\n  var len = this.length\n  for (var i = 0; i < len; i++) {\n    out[i] = toHex(this[i])\n    if (i === exports.INSPECT_MAX_BYTES) {\n      out[i + 1] = '...'\n      break\n    }\n  }\n  return '<Buffer ' + out.join(' ') + '>'\n}\n\n/**\n * Creates a new `ArrayBuffer` with the *copied* memory of the buffer instance.\n * Added in Node 0.12. Only available in browsers that support ArrayBuffer.\n */\nBuffer.prototype.toArrayBuffer = function () {\n  if (typeof Uint8Array !== 'undefined') {\n    if (TYPED_ARRAY_SUPPORT) {\n      return (new Buffer(this)).buffer\n    } else {\n      var buf = new Uint8Array(this.length)\n      for (var i = 0, len = buf.length; i < len; i += 1) {\n        buf[i] = this[i]\n      }\n      return buf.buffer\n    }\n  } else {\n    throw new Error('Buffer.toArrayBuffer not supported in this browser')\n  }\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar BP = Buffer.prototype\n\n/**\n * Augment a Uint8Array *instance* (not the Uint8Array class!) with Buffer methods\n */\nBuffer._augment = function (arr) {\n  arr._isBuffer = true\n\n  // save reference to original Uint8Array get/set methods before overwriting\n  arr._get = arr.get\n  arr._set = arr.set\n\n  // deprecated, will be removed in node 0.13+\n  arr.get = BP.get\n  arr.set = BP.set\n\n  arr.write = BP.write\n  arr.toString = BP.toString\n  arr.toLocaleString = BP.toString\n  arr.toJSON = BP.toJSON\n  arr.equals = BP.equals\n  arr.compare = BP.compare\n  arr.copy = BP.copy\n  arr.slice = BP.slice\n  arr.readUInt8 = BP.readUInt8\n  arr.readUInt16LE = BP.readUInt16LE\n  arr.readUInt16BE = BP.readUInt16BE\n  arr.readUInt32LE = BP.readUInt32LE\n  arr.readUInt32BE = BP.readUInt32BE\n  arr.readInt8 = BP.readInt8\n  arr.readInt16LE = BP.readInt16LE\n  arr.readInt16BE = BP.readInt16BE\n  arr.readInt32LE = BP.readInt32LE\n  arr.readInt32BE = BP.readInt32BE\n  arr.readFloatLE = BP.readFloatLE\n  arr.readFloatBE = BP.readFloatBE\n  arr.readDoubleLE = BP.readDoubleLE\n  arr.readDoubleBE = BP.readDoubleBE\n  arr.writeUInt8 = BP.writeUInt8\n  arr.writeUInt16LE = BP.writeUInt16LE\n  arr.writeUInt16BE = BP.writeUInt16BE\n  arr.writeUInt32LE = BP.writeUInt32LE\n  arr.writeUInt32BE = BP.writeUInt32BE\n  arr.writeInt8 = BP.writeInt8\n  arr.writeInt16LE = BP.writeInt16LE\n  arr.writeInt16BE = BP.writeInt16BE\n  arr.writeInt32LE = BP.writeInt32LE\n  arr.writeInt32BE = BP.writeInt32BE\n  arr.writeFloatLE = BP.writeFloatLE\n  arr.writeFloatBE = BP.writeFloatBE\n  arr.writeDoubleLE = BP.writeDoubleLE\n  arr.writeDoubleBE = BP.writeDoubleBE\n  arr.fill = BP.fill\n  arr.inspect = BP.inspect\n  arr.toArrayBuffer = BP.toArrayBuffer\n\n  return arr\n}\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-z]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction isArray (subject) {\n  return (Array.isArray || function (subject) {\n    return Object.prototype.toString.call(subject) === '[object Array]'\n  })(subject)\n}\n\nfunction isArrayish (subject) {\n  return isArray(subject) || Buffer.isBuffer(subject) ||\n      subject && typeof subject === 'object' &&\n      typeof subject.length === 'number'\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    var b = str.charCodeAt(i)\n    if (b <= 0x7F) {\n      byteArray.push(b)\n    } else {\n      var start = i\n      if (b >= 0xD800 && b <= 0xDFFF) i++\n      var h = encodeURIComponent(str.slice(start, i+1)).substr(1).split('%')\n      for (var j = 0; j < h.length; j++) {\n        byteArray.push(parseInt(h[j], 16))\n      }\n    }\n  }\n  return byteArray\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(str)\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; i++) {\n    if ((i + offset >= dst.length) || (i >= src.length))\n      break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction decodeUtf8Char (str) {\n  try {\n    return decodeURIComponent(str)\n  } catch (err) {\n    return String.fromCharCode(0xFFFD) // UTF 8 invalid char\n  }\n}\n\n/*\n * We have to make sure that the value is a valid integer. This means that it\n * is non-negative. It has no fractional component and that it does not\n * exceed the maximum allowed value.\n */\nfunction verifuint (value, max) {\n  assert(typeof value === 'number', 'cannot write a non-number as a number')\n  assert(value >= 0, 'specified a negative value for writing an unsigned value')\n  assert(value <= max, 'value is larger than maximum value for type')\n  assert(Math.floor(value) === value, 'value has a fractional component')\n}\n\nfunction verifsint (value, max, min) {\n  assert(typeof value === 'number', 'cannot write a non-number as a number')\n  assert(value <= max, 'value larger than maximum allowed value')\n  assert(value >= min, 'value smaller than minimum allowed value')\n  assert(Math.floor(value) === value, 'value has a fractional component')\n}\n\nfunction verifIEEE754 (value, max, min) {\n  assert(typeof value === 'number', 'cannot write a non-number as a number')\n  assert(value <= max, 'value larger than maximum allowed value')\n  assert(value >= min, 'value smaller than minimum allowed value')\n}\n\nfunction assert (test, message) {\n  if (!test) throw new Error(message || 'Failed assertion')\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar Buffer = require('buffer').Buffer;\n\nvar isBufferEncoding = Buffer.isEncoding\n  || function(encoding) {\n       switch (encoding && encoding.toLowerCase()) {\n         case 'hex': case 'utf8': case 'utf-8': case 'ascii': case 'binary': case 'base64': case 'ucs2': case 'ucs-2': case 'utf16le': case 'utf-16le': case 'raw': return true;\n         default: return false;\n       }\n     }\n\n\nfunction assertEncoding(encoding) {\n  if (encoding && !isBufferEncoding(encoding)) {\n    throw new Error('Unknown encoding: ' + encoding);\n  }\n}\n\nvar StringDecoder = exports.StringDecoder = function(encoding) {\n  this.encoding = (encoding || 'utf8').toLowerCase().replace(/[-_]/, '');\n  assertEncoding(encoding);\n  switch (this.encoding) {\n    case 'utf8':\n      // CESU-8 represents each of Surrogate Pair by 3-bytes\n      this.surrogateSize = 3;\n      break;\n    case 'ucs2':\n    case 'utf16le':\n      // UTF-16 represents each of Surrogate Pair by 2-bytes\n      this.surrogateSize = 2;\n      this.detectIncompleteChar = utf16DetectIncompleteChar;\n      break;\n    case 'base64':\n      // Base-64 stores 3 bytes in 4 chars, and pads the remainder.\n      this.surrogateSize = 3;\n      this.detectIncompleteChar = base64DetectIncompleteChar;\n      break;\n    default:\n      this.write = passThroughWrite;\n      return;\n  }\n\n  this.charBuffer = new Buffer(6);\n  this.charReceived = 0;\n  this.charLength = 0;\n};\n\n\nStringDecoder.prototype.write = function(buffer) {\n  var charStr = '';\n  var offset = 0;\n\n  // if our last write ended with an incomplete multibyte character\n  while (this.charLength) {\n    // determine how many remaining bytes this buffer has to offer for this char\n    var i = (buffer.length >= this.charLength - this.charReceived) ?\n                this.charLength - this.charReceived :\n                buffer.length;\n\n    // add the new bytes to the char buffer\n    buffer.copy(this.charBuffer, this.charReceived, offset, i);\n    this.charReceived += (i - offset);\n    offset = i;\n\n    if (this.charReceived < this.charLength) {\n      // still not enough chars in this buffer? wait for more ...\n      return '';\n    }\n\n    // get the character that was split\n    charStr = this.charBuffer.slice(0, this.charLength).toString(this.encoding);\n\n    // lead surrogate (D800-DBFF) is also the incomplete character\n    var charCode = charStr.charCodeAt(charStr.length - 1);\n    if (charCode >= 0xD800 && charCode <= 0xDBFF) {\n      this.charLength += this.surrogateSize;\n      charStr = '';\n      continue;\n    }\n    this.charReceived = this.charLength = 0;\n\n    // if there are no more bytes in this buffer, just emit our char\n    if (i == buffer.length) return charStr;\n\n    // otherwise cut off the characters end from the beginning of this buffer\n    buffer = buffer.slice(i, buffer.length);\n    break;\n  }\n\n  var lenIncomplete = this.detectIncompleteChar(buffer);\n\n  var end = buffer.length;\n  if (this.charLength) {\n    // buffer the incomplete character bytes we got\n    buffer.copy(this.charBuffer, 0, buffer.length - lenIncomplete, end);\n    this.charReceived = lenIncomplete;\n    end -= lenIncomplete;\n  }\n\n  charStr += buffer.toString(this.encoding, 0, end);\n\n  var end = charStr.length - 1;\n  var charCode = charStr.charCodeAt(end);\n  // lead surrogate (D800-DBFF) is also the incomplete character\n  if (charCode >= 0xD800 && charCode <= 0xDBFF) {\n    var size = this.surrogateSize;\n    this.charLength += size;\n    this.charReceived += size;\n    this.charBuffer.copy(this.charBuffer, size, 0, size);\n    this.charBuffer.write(charStr.charAt(charStr.length - 1), this.encoding);\n    return charStr.substring(0, end);\n  }\n\n  // or just emit the charStr\n  return charStr;\n};\n\nStringDecoder.prototype.detectIncompleteChar = function(buffer) {\n  // determine how many bytes we have to check at the end of this buffer\n  var i = (buffer.length >= 3) ? 3 : buffer.length;\n\n  // Figure out if one of the last i bytes of our buffer announces an\n  // incomplete char.\n  for (; i > 0; i--) {\n    var c = buffer[buffer.length - i];\n\n    // See http://en.wikipedia.org/wiki/UTF-8#Description\n\n    // 110XXXXX\n    if (i == 1 && c >> 5 == 0x06) {\n      this.charLength = 2;\n      break;\n    }\n\n    // 1110XXXX\n    if (i <= 2 && c >> 4 == 0x0E) {\n      this.charLength = 3;\n      break;\n    }\n\n    // 11110XXX\n    if (i <= 3 && c >> 3 == 0x1E) {\n      this.charLength = 4;\n      break;\n    }\n  }\n\n  return i;\n};\n\nStringDecoder.prototype.end = function(buffer) {\n  var res = '';\n  if (buffer && buffer.length)\n    res = this.write(buffer);\n\n  if (this.charReceived) {\n    var cr = this.charReceived;\n    var buf = this.charBuffer;\n    var enc = this.encoding;\n    res += buf.slice(0, cr).toString(enc);\n  }\n\n  return res;\n};\n\nfunction passThroughWrite(buffer) {\n  return buffer.toString(this.encoding);\n}\n\nfunction utf16DetectIncompleteChar(buffer) {\n  var incomplete = this.charReceived = buffer.length % 2;\n  this.charLength = incomplete ? 2 : 0;\n  return incomplete;\n}\n\nfunction base64DetectIncompleteChar(buffer) {\n  var incomplete = this.charReceived = buffer.length % 3;\n  this.charLength = incomplete ? 3 : 0;\n  return incomplete;\n}\n","module.exports = Array.isArray || function (arr) {\n  return Object.prototype.toString.call(arr) == '[object Array]';\n};\n","exports.read = function(buffer, offset, isLE, mLen, nBytes) {\n  var e, m,\n      eLen = nBytes * 8 - mLen - 1,\n      eMax = (1 << eLen) - 1,\n      eBias = eMax >> 1,\n      nBits = -7,\n      i = isLE ? (nBytes - 1) : 0,\n      d = isLE ? -1 : 1,\n      s = buffer[offset + i];\n\n  i += d;\n\n  e = s & ((1 << (-nBits)) - 1);\n  s >>= (-nBits);\n  nBits += eLen;\n  for (; nBits > 0; e = e * 256 + buffer[offset + i], i += d, nBits -= 8);\n\n  m = e & ((1 << (-nBits)) - 1);\n  e >>= (-nBits);\n  nBits += mLen;\n  for (; nBits > 0; m = m * 256 + buffer[offset + i], i += d, nBits -= 8);\n\n  if (e === 0) {\n    e = 1 - eBias;\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity);\n  } else {\n    m = m + Math.pow(2, mLen);\n    e = e - eBias;\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen);\n};\n\nexports.write = function(buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c,\n      eLen = nBytes * 8 - mLen - 1,\n      eMax = (1 << eLen) - 1,\n      eBias = eMax >> 1,\n      rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0),\n      i = isLE ? 0 : (nBytes - 1),\n      d = isLE ? 1 : -1,\n      s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0;\n\n  value = Math.abs(value);\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0;\n    e = eMax;\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2);\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--;\n      c *= 2;\n    }\n    if (e + eBias >= 1) {\n      value += rt / c;\n    } else {\n      value += rt * Math.pow(2, 1 - eBias);\n    }\n    if (value * c >= 2) {\n      e++;\n      c /= 2;\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0;\n      e = eMax;\n    } else if (e + eBias >= 1) {\n      m = (value * c - 1) * Math.pow(2, mLen);\n      e = e + eBias;\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen);\n      e = 0;\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8);\n\n  e = (e << mLen) | m;\n  eLen += mLen;\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8);\n\n  buffer[offset + i - d] |= s * 128;\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nfunction isBuffer(arg) {\n  return Buffer.isBuffer(arg);\n}\nexports.isBuffer = isBuffer;\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}","var lookup = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\n;(function (exports) {\n\t'use strict';\n\n  var Arr = (typeof Uint8Array !== 'undefined')\n    ? Uint8Array\n    : Array\n\n\tvar PLUS   = '+'.charCodeAt(0)\n\tvar SLASH  = '/'.charCodeAt(0)\n\tvar NUMBER = '0'.charCodeAt(0)\n\tvar LOWER  = 'a'.charCodeAt(0)\n\tvar UPPER  = 'A'.charCodeAt(0)\n\n\tfunction decode (elt) {\n\t\tvar code = elt.charCodeAt(0)\n\t\tif (code === PLUS)\n\t\t\treturn 62 // '+'\n\t\tif (code === SLASH)\n\t\t\treturn 63 // '/'\n\t\tif (code < NUMBER)\n\t\t\treturn -1 //no match\n\t\tif (code < NUMBER + 10)\n\t\t\treturn code - NUMBER + 26 + 26\n\t\tif (code < UPPER + 26)\n\t\t\treturn code - UPPER\n\t\tif (code < LOWER + 26)\n\t\t\treturn code - LOWER + 26\n\t}\n\n\tfunction b64ToByteArray (b64) {\n\t\tvar i, j, l, tmp, placeHolders, arr\n\n\t\tif (b64.length % 4 > 0) {\n\t\t\tthrow new Error('Invalid string. Length must be a multiple of 4')\n\t\t}\n\n\t\t// the number of equal signs (place holders)\n\t\t// if there are two placeholders, than the two characters before it\n\t\t// represent one byte\n\t\t// if there is only one, then the three characters before it represent 2 bytes\n\t\t// this is just a cheap hack to not do indexOf twice\n\t\tvar len = b64.length\n\t\tplaceHolders = '=' === b64.charAt(len - 2) ? 2 : '=' === b64.charAt(len - 1) ? 1 : 0\n\n\t\t// base64 is 4/3 + up to two characters of the original data\n\t\tarr = new Arr(b64.length * 3 / 4 - placeHolders)\n\n\t\t// if there are placeholders, only get up to the last complete 4 chars\n\t\tl = placeHolders > 0 ? b64.length - 4 : b64.length\n\n\t\tvar L = 0\n\n\t\tfunction push (v) {\n\t\t\tarr[L++] = v\n\t\t}\n\n\t\tfor (i = 0, j = 0; i < l; i += 4, j += 3) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 18) | (decode(b64.charAt(i + 1)) << 12) | (decode(b64.charAt(i + 2)) << 6) | decode(b64.charAt(i + 3))\n\t\t\tpush((tmp & 0xFF0000) >> 16)\n\t\t\tpush((tmp & 0xFF00) >> 8)\n\t\t\tpush(tmp & 0xFF)\n\t\t}\n\n\t\tif (placeHolders === 2) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 2) | (decode(b64.charAt(i + 1)) >> 4)\n\t\t\tpush(tmp & 0xFF)\n\t\t} else if (placeHolders === 1) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 10) | (decode(b64.charAt(i + 1)) << 4) | (decode(b64.charAt(i + 2)) >> 2)\n\t\t\tpush((tmp >> 8) & 0xFF)\n\t\t\tpush(tmp & 0xFF)\n\t\t}\n\n\t\treturn arr\n\t}\n\n\tfunction uint8ToBase64 (uint8) {\n\t\tvar i,\n\t\t\textraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes\n\t\t\toutput = \"\",\n\t\t\ttemp, length\n\n\t\tfunction encode (num) {\n\t\t\treturn lookup.charAt(num)\n\t\t}\n\n\t\tfunction tripletToBase64 (num) {\n\t\t\treturn encode(num >> 18 & 0x3F) + encode(num >> 12 & 0x3F) + encode(num >> 6 & 0x3F) + encode(num & 0x3F)\n\t\t}\n\n\t\t// go through the array every three bytes, we'll deal with trailing stuff later\n\t\tfor (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {\n\t\t\ttemp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2])\n\t\t\toutput += tripletToBase64(temp)\n\t\t}\n\n\t\t// pad the end with zeros, but make sure to not forget the extra bytes\n\t\tswitch (extraBytes) {\n\t\t\tcase 1:\n\t\t\t\ttemp = uint8[uint8.length - 1]\n\t\t\t\toutput += encode(temp >> 2)\n\t\t\t\toutput += encode((temp << 4) & 0x3F)\n\t\t\t\toutput += '=='\n\t\t\t\tbreak\n\t\t\tcase 2:\n\t\t\t\ttemp = (uint8[uint8.length - 2] << 8) + (uint8[uint8.length - 1])\n\t\t\t\toutput += encode(temp >> 10)\n\t\t\t\toutput += encode((temp >> 4) & 0x3F)\n\t\t\t\toutput += encode((temp << 2) & 0x3F)\n\t\t\t\toutput += '='\n\t\t\t\tbreak\n\t\t}\n\n\t\treturn output\n\t}\n\n\texports.toByteArray = b64ToByteArray\n\texports.fromByteArray = uint8ToBase64\n}(typeof exports === 'undefined' ? (this.base64js = {}) : exports))\n"]}