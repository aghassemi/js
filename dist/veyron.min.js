(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function Buffer(t,e,r){if(!(this instanceof Buffer))return new Buffer(t,e,r);var n,i=typeof t;if("number"===i)n=t>0?t>>>0:0;else if("string"===i)"base64"===e&&(t=base64clean(t)),n=Buffer.byteLength(t,e);else{if("object"!==i||null===t)throw new TypeError("must start with number, buffer, array or string");"Buffer"===t.type&&isArray(t.data)&&(t=t.data),n=+t.length>0?Math.floor(+t.length):0}if(this.length>kMaxLength)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength.toString(16)+" bytes");var f;Buffer.TYPED_ARRAY_SUPPORT?f=Buffer._augment(new Uint8Array(n)):(f=this,f.length=n,f._isBuffer=!0);var o;if(Buffer.TYPED_ARRAY_SUPPORT&&"number"==typeof t.byteLength)f._set(t);else if(isArrayish(t))if(Buffer.isBuffer(t))for(o=0;n>o;o++)f[o]=t.readUInt8(o);else for(o=0;n>o;o++)f[o]=(t[o]%256+256)%256;else if("string"===i)f.write(t,0,e);else if("number"===i&&!Buffer.TYPED_ARRAY_SUPPORT&&!r)for(o=0;n>o;o++)f[o]=0;return f}function hexWrite(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n),n>i&&(n=i)):n=i;var f=e.length;if(f%2!==0)throw new Error("Invalid hex string");n>f/2&&(n=f/2);for(var o=0;n>o;o++){var u=parseInt(e.substr(2*o,2),16);if(isNaN(u))throw new Error("Invalid hex string");t[r+o]=u}return o}function utf8Write(t,e,r,n){var i=blitBuffer(utf8ToBytes(e),t,r,n);return i}function asciiWrite(t,e,r,n){var i=blitBuffer(asciiToBytes(e),t,r,n);return i}function binaryWrite(t,e,r,n){return asciiWrite(t,e,r,n)}function base64Write(t,e,r,n){var i=blitBuffer(base64ToBytes(e),t,r,n);return i}function utf16leWrite(t,e,r,n){var i=blitBuffer(utf16leToBytes(e),t,r,n);return i}function base64Slice(t,e,r){return base64.fromByteArray(0===e&&r===t.length?t:t.slice(e,r))}function utf8Slice(t,e,r){var n="",i="";r=Math.min(t.length,r);for(var f=e;r>f;f++)t[f]<=127?(n+=decodeUtf8Char(i)+String.fromCharCode(t[f]),i=""):i+="%"+t[f].toString(16);return n+decodeUtf8Char(i)}function asciiSlice(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;r>i;i++)n+=String.fromCharCode(t[i]);return n}function binarySlice(t,e,r){return asciiSlice(t,e,r)}function hexSlice(t,e,r){var n=t.length;(!e||0>e)&&(e=0),(!r||0>r||r>n)&&(r=n);for(var i="",f=e;r>f;f++)i+=toHex(t[f]);return i}function utf16leSlice(t,e,r){for(var n=t.slice(e,r),i="",f=0;f<n.length;f+=2)i+=String.fromCharCode(n[f]+256*n[f+1]);return i}function checkOffset(t,e,r){if(t%1!==0||0>t)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(t,e,r,n,i,f){if(!Buffer.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");if(e>i||f>e)throw new TypeError("value is out of bounds");if(r+n>t.length)throw new TypeError("index out of range")}function objectWriteUInt16(t,e,r,n){0>e&&(e=65535+e+1);for(var i=0,f=Math.min(t.length-r,2);f>i;i++)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function objectWriteUInt32(t,e,r,n){0>e&&(e=4294967295+e+1);for(var i=0,f=Math.min(t.length-r,4);f>i;i++)t[r+i]=e>>>8*(n?i:3-i)&255}function checkIEEE754(t,e,r,n,i,f){if(e>i||f>e)throw new TypeError("value is out of bounds");if(r+n>t.length)throw new TypeError("index out of range")}function writeFloat(t,e,r,n,i){return i||checkIEEE754(t,e,r,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(t,e,r,n,23,4),r+4}function writeDouble(t,e,r,n,i){return i||checkIEEE754(t,e,r,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(t,e,r,n,52,8),r+8}function base64clean(t){for(t=stringtrim(t).replace(INVALID_BASE64_RE,"");t.length%4!==0;)t+="=";return t}function stringtrim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function isArrayish(t){return isArray(t)||Buffer.isBuffer(t)||t&&"object"==typeof t&&"number"==typeof t.length}function toHex(t){return 16>t?"0"+t.toString(16):t.toString(16)}function utf8ToBytes(t){for(var e=[],r=0;r<t.length;r++){var n=t.charCodeAt(r);if(127>=n)e.push(n);else{var i=r;n>=55296&&57343>=n&&r++;for(var f=encodeURIComponent(t.slice(i,r+1)).substr(1).split("%"),o=0;o<f.length;o++)e.push(parseInt(f[o],16))}}return e}function asciiToBytes(t){for(var e=[],r=0;r<t.length;r++)e.push(255&t.charCodeAt(r));return e}function utf16leToBytes(t){for(var e,r,n,i=[],f=0;f<t.length;f++)e=t.charCodeAt(f),r=e>>8,n=e%256,i.push(n),i.push(r);return i}function base64ToBytes(t){return base64.toByteArray(t)}function blitBuffer(t,e,r,n){for(var i=0;n>i&&!(i+r>=e.length||i>=t.length);i++)e[i+r]=t[i];return i}function decodeUtf8Char(t){try{return decodeURIComponent(t)}catch(e){return String.fromCharCode(65533)}}var base64=require("base64-js"),ieee754=require("ieee754"),isArray=require("is-array");exports.Buffer=Buffer,exports.SlowBuffer=Buffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192;var kMaxLength=1073741823;Buffer.TYPED_ARRAY_SUPPORT=function(){try{var t=new ArrayBuffer(0),e=new Uint8Array(t);return e.foo=function(){return 42},42===e.foo()&&"function"==typeof e.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(r){return!1}}(),Buffer.isBuffer=function(t){return!(null==t||!t._isBuffer)},Buffer.compare=function(t,e){if(!Buffer.isBuffer(t)||!Buffer.isBuffer(e))throw new TypeError("Arguments must be Buffers");for(var r=t.length,n=e.length,i=0,f=Math.min(r,n);f>i&&t[i]===e[i];i++);return i!==f&&(r=t[i],n=e[i]),n>r?-1:r>n?1:0},Buffer.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(t,e){if(!isArray(t))throw new TypeError("Usage: Buffer.concat(list[, length])");if(0===t.length)return new Buffer(0);if(1===t.length)return t[0];var r;if(void 0===e)for(e=0,r=0;r<t.length;r++)e+=t[r].length;var n=new Buffer(e),i=0;for(r=0;r<t.length;r++){var f=t[r];f.copy(n,i),i+=f.length}return n},Buffer.byteLength=function(t,e){var r;switch(t+="",e||"utf8"){case"ascii":case"binary":case"raw":r=t.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":r=2*t.length;break;case"hex":r=t.length>>>1;break;case"utf8":case"utf-8":r=utf8ToBytes(t).length;break;case"base64":r=base64ToBytes(t).length;break;default:r=t.length}return r},Buffer.prototype.length=void 0,Buffer.prototype.parent=void 0,Buffer.prototype.toString=function(t,e,r){var n=!1;if(e>>>=0,r=void 0===r||1/0===r?this.length:r>>>0,t||(t="utf8"),0>e&&(e=0),r>this.length&&(r=this.length),e>=r)return"";for(;;)switch(t){case"hex":return hexSlice(this,e,r);case"utf8":case"utf-8":return utf8Slice(this,e,r);case"ascii":return asciiSlice(this,e,r);case"binary":return binarySlice(this,e,r);case"base64":return base64Slice(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}},Buffer.prototype.equals=function(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return 0===Buffer.compare(this,t)},Buffer.prototype.inspect=function(){var t="",e=exports.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},Buffer.prototype.compare=function(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return Buffer.compare(this,t)},Buffer.prototype.get=function(t){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(t)},Buffer.prototype.set=function(t,e){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(t,e)},Buffer.prototype.write=function(t,e,r,n){if(isFinite(e))isFinite(r)||(n=r,r=void 0);else{var i=n;n=e,e=r,r=i}e=Number(e)||0;var f=this.length-e;r?(r=Number(r),r>f&&(r=f)):r=f,n=String(n||"utf8").toLowerCase();var o;switch(n){case"hex":o=hexWrite(this,t,e,r);break;case"utf8":case"utf-8":o=utf8Write(this,t,e,r);break;case"ascii":o=asciiWrite(this,t,e,r);break;case"binary":o=binaryWrite(this,t,e,r);break;case"base64":o=base64Write(this,t,e,r);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":o=utf16leWrite(this,t,e,r);break;default:throw new TypeError("Unknown encoding: "+n)}return o},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Buffer.prototype.slice=function(t,e){var r=this.length;if(t=~~t,e=void 0===e?r:~~e,0>t?(t+=r,0>t&&(t=0)):t>r&&(t=r),0>e?(e+=r,0>e&&(e=0)):e>r&&(e=r),t>e&&(e=t),Buffer.TYPED_ARRAY_SUPPORT)return Buffer._augment(this.subarray(t,e));for(var n=e-t,i=new Buffer(n,void 0,!0),f=0;n>f;f++)i[f]=this[f+t];return i},Buffer.prototype.readUInt8=function(t,e){return e||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function(t,e){return e||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function(t,e){return e||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function(t,e){return e||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUInt32BE=function(t,e){return e||checkOffset(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readInt8=function(t,e){return e||checkOffset(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function(t,e){e||checkOffset(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function(t,e){e||checkOffset(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function(t,e){return e||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function(t,e){return e||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function(t,e){return e||checkOffset(t,4,this.length),ieee754.read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function(t,e){return e||checkOffset(t,4,this.length),ieee754.read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function(t,e){return e||checkOffset(t,8,this.length),ieee754.read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function(t,e){return e||checkOffset(t,8,this.length),ieee754.read(this,t,!1,52,8)},Buffer.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||checkInt(this,t,e,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=t,e+1},Buffer.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=t):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||checkInt(this,t,e,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),0>t&&(t=255+t+1),this[e]=t,e+1},Buffer.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||checkInt(this,t,e,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||checkInt(this,t,e,4,2147483647,-2147483648),0>t&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeFloatLE=function(t,e,r){return writeFloat(this,t,e,!0,r)},Buffer.prototype.writeFloatBE=function(t,e,r){return writeFloat(this,t,e,!1,r)},Buffer.prototype.writeDoubleLE=function(t,e,r){return writeDouble(this,t,e,!0,r)},Buffer.prototype.writeDoubleBE=function(t,e,r){return writeDouble(this,t,e,!1,r)},Buffer.prototype.copy=function(t,e,r,n){var i=this;if(r||(r=0),n||0===n||(n=this.length),e||(e=0),n!==r&&0!==t.length&&0!==i.length){if(r>n)throw new TypeError("sourceEnd < sourceStart");if(0>e||e>=t.length)throw new TypeError("targetStart out of bounds");if(0>r||r>=i.length)throw new TypeError("sourceStart out of bounds");if(0>n||n>i.length)throw new TypeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var f=n-r;if(100>f||!Buffer.TYPED_ARRAY_SUPPORT)for(var o=0;f>o;o++)t[o+e]=this[o+r];else t._set(this.subarray(r,r+f),e)}},Buffer.prototype.fill=function(t,e,r){if(t||(t=0),e||(e=0),r||(r=this.length),e>r)throw new TypeError("end < start");if(r!==e&&0!==this.length){if(0>e||e>=this.length)throw new TypeError("start out of bounds");if(0>r||r>this.length)throw new TypeError("end out of bounds");var n;if("number"==typeof t)for(n=e;r>n;n++)this[n]=t;else{var i=utf8ToBytes(t.toString()),f=i.length;for(n=e;r>n;n++)this[n]=i[n%f]}return this}},Buffer.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(Buffer.TYPED_ARRAY_SUPPORT)return new Buffer(this).buffer;for(var t=new Uint8Array(this.length),e=0,r=t.length;r>e;e+=1)t[e]=this[e];return t.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var BP=Buffer.prototype;Buffer._augment=function(t){return t._isBuffer=!0,t._get=t.get,t._set=t.set,t.get=BP.get,t.set=BP.set,t.write=BP.write,t.toString=BP.toString,t.toLocaleString=BP.toString,t.toJSON=BP.toJSON,t.equals=BP.equals,t.compare=BP.compare,t.copy=BP.copy,t.slice=BP.slice,t.readUInt8=BP.readUInt8,t.readUInt16LE=BP.readUInt16LE,t.readUInt16BE=BP.readUInt16BE,t.readUInt32LE=BP.readUInt32LE,t.readUInt32BE=BP.readUInt32BE,t.readInt8=BP.readInt8,t.readInt16LE=BP.readInt16LE,t.readInt16BE=BP.readInt16BE,t.readInt32LE=BP.readInt32LE,t.readInt32BE=BP.readInt32BE,t.readFloatLE=BP.readFloatLE,t.readFloatBE=BP.readFloatBE,t.readDoubleLE=BP.readDoubleLE,t.readDoubleBE=BP.readDoubleBE,t.writeUInt8=BP.writeUInt8,t.writeUInt16LE=BP.writeUInt16LE,t.writeUInt16BE=BP.writeUInt16BE,t.writeUInt32LE=BP.writeUInt32LE,t.writeUInt32BE=BP.writeUInt32BE,t.writeInt8=BP.writeInt8,t.writeInt16LE=BP.writeInt16LE,t.writeInt16BE=BP.writeInt16BE,t.writeInt32LE=BP.writeInt32LE,t.writeInt32BE=BP.writeInt32BE,t.writeFloatLE=BP.writeFloatLE,t.writeFloatBE=BP.writeFloatBE,t.writeDoubleLE=BP.writeDoubleLE,t.writeDoubleBE=BP.writeDoubleBE,t.fill=BP.fill,t.inspect=BP.inspect,t.toArrayBuffer=BP.toArrayBuffer,t};var INVALID_BASE64_RE=/[^+\/0-9A-z]/g;
},{"base64-js":2,"ieee754":3,"is-array":4}],2:[function(require,module,exports){
var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(t){"use strict";function r(t){var r=t.charCodeAt(0);return r===h?62:r===c?63:o>r?-1:o+10>r?r-o+26+26:i+26>r?r-i:A+26>r?r-A+26:void 0}function e(t){function e(t){i[f++]=t}var n,h,c,o,A,i;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var u=t.length;A="="===t.charAt(u-2)?2:"="===t.charAt(u-1)?1:0,i=new a(3*t.length/4-A),c=A>0?t.length-4:t.length;var f=0;for(n=0,h=0;c>n;n+=4,h+=3)o=r(t.charAt(n))<<18|r(t.charAt(n+1))<<12|r(t.charAt(n+2))<<6|r(t.charAt(n+3)),e((16711680&o)>>16),e((65280&o)>>8),e(255&o);return 2===A?(o=r(t.charAt(n))<<2|r(t.charAt(n+1))>>4,e(255&o)):1===A&&(o=r(t.charAt(n))<<10|r(t.charAt(n+1))<<4|r(t.charAt(n+2))>>2,e(o>>8&255),e(255&o)),i}function n(t){function r(t){return lookup.charAt(t)}function e(t){return r(t>>18&63)+r(t>>12&63)+r(t>>6&63)+r(63&t)}var n,a,h,c=t.length%3,o="";for(n=0,h=t.length-c;h>n;n+=3)a=(t[n]<<16)+(t[n+1]<<8)+t[n+2],o+=e(a);switch(c){case 1:a=t[t.length-1],o+=r(a>>2),o+=r(a<<4&63),o+="==";break;case 2:a=(t[t.length-2]<<8)+t[t.length-1],o+=r(a>>10),o+=r(a>>4&63),o+=r(a<<2&63),o+="="}return o}var a="undefined"!=typeof Uint8Array?Uint8Array:Array,h="+".charCodeAt(0),c="/".charCodeAt(0),o="0".charCodeAt(0),A="a".charCodeAt(0),i="A".charCodeAt(0);t.toByteArray=e,t.fromByteArray=n}("undefined"==typeof exports?this.base64js={}:exports);
},{}],3:[function(require,module,exports){
exports.read=function(o,t,a,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,n=a?h-1:0,s=a?-1:1,N=o[t+n];for(n+=s,M=N&(1<<-i)-1,N>>=-i,i+=w;i>0;M=256*M+o[t+n],n+=s,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+o[t+n],n+=s,i-=8);if(0===M)M=1-e;else{if(M===f)return p?0/0:1/0*(N?-1:1);p+=Math.pow(2,r),M-=e}return(N?-1:1)*p*Math.pow(2,M-r)},exports.write=function(o,t,a,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,n=i>>1,s=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,N=r?0:M-1,u=r?1:-1,l=0>t||0===t&&0>1/t?1:0;for(t=Math.abs(t),isNaN(t)||1/0===t?(w=isNaN(t)?1:0,p=i):(p=Math.floor(Math.log(t)/Math.LN2),t*(f=Math.pow(2,-p))<1&&(p--,f*=2),t+=p+n>=1?s/f:s*Math.pow(2,1-n),t*f>=2&&(p++,f/=2),p+n>=i?(w=0,p=i):p+n>=1?(w=(t*f-1)*Math.pow(2,h),p+=n):(w=t*Math.pow(2,n-1)*Math.pow(2,h),p=0));h>=8;o[a+N]=255&w,N+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;o[a+N]=255&p,N+=u,p/=256,e-=8);o[a+N-u]|=128*l};
},{}],4:[function(require,module,exports){
var isArray=Array.isArray,str=Object.prototype.toString;module.exports=isArray||function(r){return!!r&&"[object Array]"==str.call(r)};
},{}],5:[function(require,module,exports){
function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,n,s,i,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],isUndefined(n))return!1;if(isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];n.apply(this,i)}else if(isObject(n)){for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];for(o=n.slice(),s=o.length,r=0;s>r;r++)o[r].apply(this,i)}return!0},EventEmitter.prototype.addListener=function(e,t){var n;if(!isFunction(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned){var n;n=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function n(){this.removeListener(e,n),s||(s=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var s=!1;return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var n,s,i,r;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,s=-1,n===t||isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(n)){for(r=i;r-->0;)if(n[r]===t||n[r].listener&&n[r].listener===t){s=r;break}if(0>s)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],isFunction(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?isFunction(e._events[t])?1:e._events[t].length:0};
},{}],6:[function(require,module,exports){
module.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};
},{}],7:[function(require,module,exports){
function noop(){}var process=module.exports={};process.nextTick=function(){var o="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(o)return function(o){return window.setImmediate(o)};if(e){var s=[];return window.addEventListener("message",function(o){var e=o.source;if((e===window||null===e)&&"process-tick"===o.data&&(o.stopPropagation(),s.length>0)){var n=s.shift();n()}},!0),function(o){s.push(o),window.postMessage("process-tick","*")}}return function(o){setTimeout(o,0)}}(),process.title="browser",process.browser=!0,process.env={},process.argv=[],process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")};
},{}],8:[function(require,module,exports){
module.exports=require("./lib/_stream_duplex.js");
},{"./lib/_stream_duplex.js":9}],9:[function(require,module,exports){
(function (process){
function Duplex(e){return this instanceof Duplex?(Readable.call(this,e),Writable.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",onend)):new Duplex(e)}function onend(){this.allowHalfOpen||this._writableState.ended||process.nextTick(this.end.bind(this))}function forEach(e,t){for(var i=0,r=e.length;r>i;i++)t(e[i],i)}module.exports=Duplex;var objectKeys=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t},util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable"),Writable=require("./_stream_writable");util.inherits(Duplex,Readable),forEach(objectKeys(Writable.prototype),function(e){Duplex.prototype[e]||(Duplex.prototype[e]=Writable.prototype[e])});
}).call(this,require("FWaASH"))
},{"./_stream_readable":11,"./_stream_writable":13,"FWaASH":7,"core-util-is":14,"inherits":6}],10:[function(require,module,exports){
function PassThrough(r){return this instanceof PassThrough?void Transform.call(this,r):new PassThrough(r)}module.exports=PassThrough;var Transform=require("./_stream_transform"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(r,s,i){i(null,r)};
},{"./_stream_transform":12,"core-util-is":14,"inherits":6}],11:[function(require,module,exports){
(function (process){
function ReadableState(e){e=e||{};var t=e.highWaterMark;this.highWaterMark=t||0===t?t:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!e.objectMode,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(e.encoding),this.encoding=e.encoding)}function Readable(e){return this instanceof Readable?(this._readableState=new ReadableState(e,this),this.readable=!0,void Stream.call(this)):new Readable(e)}function readableAddChunk(e,t,n,r,i){var a=chunkInvalid(t,n);if(a)e.emit("error",a);else if(null===n||void 0===n)t.reading=!1,t.ended||onEofChunk(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var d=new Error("stream.push() after EOF");e.emit("error",d)}else if(t.endEmitted&&i){var d=new Error("stream.unshift() after end event");e.emit("error",d)}else!t.decoder||i||r||(n=t.decoder.write(n)),t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):(t.reading=!1,t.buffer.push(n)),t.needReadable&&emitReadable(e),maybeReadMore(e,t);else i||(t.reading=!1);return needMoreData(t)}function needMoreData(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function roundUpToNextPowerOf2(e){if(e>=MAX_HWM)e=MAX_HWM;else{e--;for(var t=1;32>t;t<<=1)e|=e>>t;e++}return e}function howMuchToRead(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:0>=e?0:(e>t.highWaterMark&&(t.highWaterMark=roundUpToNextPowerOf2(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function chunkInvalid(e,t){var n=null;return Buffer.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function onEofChunk(e,t){if(t.decoder&&!t.ended){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.length>0?emitReadable(e):endReadable(e)}function emitReadable(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,t.sync?process.nextTick(function(){emitReadable_(e)}):emitReadable_(e))}function emitReadable_(e){e.emit("readable")}function maybeReadMore(e,t){t.readingMore||(t.readingMore=!0,process.nextTick(function(){maybeReadMore_(e,t)}))}function maybeReadMore_(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function pipeOnDrain(e){return function(){var t=e._readableState;t.awaitDrain--,0===t.awaitDrain&&flow(e)}}function flow(e){function t(e){var t=e.write(n);!1===t&&r.awaitDrain++}var n,r=e._readableState;for(r.awaitDrain=0;r.pipesCount&&null!==(n=e.read());)if(1===r.pipesCount?t(r.pipes,0,null):forEach(r.pipes,t),e.emit("data",n),r.awaitDrain>0)return;return 0===r.pipesCount?(r.flowing=!1,void(EE.listenerCount(e,"data")>0&&emitDataEvents(e))):void(r.ranOut=!0)}function pipeOnReadable(){this._readableState.ranOut&&(this._readableState.ranOut=!1,flow(this))}function emitDataEvents(e,t){var n=e._readableState;if(n.flowing)throw new Error("Cannot switch to old mode now.");var r=t||!1,i=!1;e.readable=!0,e.pipe=Stream.prototype.pipe,e.on=e.addListener=Stream.prototype.on,e.on("readable",function(){i=!0;for(var t;!r&&null!==(t=e.read());)e.emit("data",t);null===t&&(i=!1,e._readableState.needReadable=!0)}),e.pause=function(){r=!0,this.emit("pause")},e.resume=function(){r=!1,i?process.nextTick(function(){e.emit("readable")}):this.read(0),this.emit("resume")},e.emit("readable")}function fromList(e,t){var n,r=t.buffer,i=t.length,a=!!t.decoder,d=!!t.objectMode;if(0===r.length)return null;if(0===i)n=null;else if(d)n=r.shift();else if(!e||e>=i)n=a?r.join(""):Buffer.concat(r,i),r.length=0;else if(e<r[0].length){var o=r[0];n=o.slice(0,e),r[0]=o.slice(e)}else if(e===r[0].length)n=r.shift();else{n=a?"":new Buffer(e);for(var l=0,s=0,u=r.length;u>s&&e>l;s++){var o=r[0],h=Math.min(e-l,o.length);a?n+=o.slice(0,h):o.copy(n,l,0,h),h<o.length?r[0]=o.slice(h):r.shift(),l+=h}}return n}function endReadable(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");!t.endEmitted&&t.calledRead&&(t.ended=!0,process.nextTick(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function forEach(e,t){for(var n=0,r=e.length;r>n;n++)t(e[n],n)}function indexOf(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1}module.exports=Readable;var isArray=require("isarray"),Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;EE.listenerCount||(EE.listenerCount=function(e,t){return e.listeners(t).length});var Stream=require("stream"),util=require("core-util-is");util.inherits=require("inherits");var StringDecoder;util.inherits(Readable,Stream),Readable.prototype.push=function(e,t){var n=this._readableState;return"string"!=typeof e||n.objectMode||(t=t||n.defaultEncoding,t!==n.encoding&&(e=new Buffer(e,t),t="")),readableAddChunk(this,n,e,t,!1)},Readable.prototype.unshift=function(e){var t=this._readableState;return readableAddChunk(this,t,e,"",!0)},Readable.prototype.setEncoding=function(e){StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(e),this._readableState.encoding=e};var MAX_HWM=8388608;Readable.prototype.read=function(e){var t=this._readableState;t.calledRead=!0;var n,r=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return emitReadable(this),null;if(e=howMuchToRead(e,t),0===e&&t.ended)return n=null,t.length>0&&t.decoder&&(n=fromList(e,t),t.length-=n.length),0===t.length&&endReadable(this),n;var i=t.needReadable;return t.length-e<=t.highWaterMark&&(i=!0),(t.ended||t.reading)&&(i=!1),i&&(t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),i&&!t.reading&&(e=howMuchToRead(r,t)),n=e>0?fromList(e,t):null,null===n&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),t.ended&&!t.endEmitted&&0===t.length&&endReadable(this),n},Readable.prototype._read=function(){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(e,t){function n(e){e===s&&i()}function r(){e.end()}function i(){e.removeListener("close",d),e.removeListener("finish",o),e.removeListener("drain",p),e.removeListener("error",a),e.removeListener("unpipe",n),s.removeListener("end",r),s.removeListener("end",i),(!e._writableState||e._writableState.needDrain)&&p()}function a(t){l(),e.removeListener("error",a),0===EE.listenerCount(e,"error")&&e.emit("error",t)}function d(){e.removeListener("finish",o),l()}function o(){e.removeListener("close",d),l()}function l(){s.unpipe(e)}var s=this,u=this._readableState;switch(u.pipesCount){case 0:u.pipes=e;break;case 1:u.pipes=[u.pipes,e];break;default:u.pipes.push(e)}u.pipesCount+=1;var h=(!t||t.end!==!1)&&e!==process.stdout&&e!==process.stderr,f=h?r:i;u.endEmitted?process.nextTick(f):s.once("end",f),e.on("unpipe",n);var p=pipeOnDrain(s);return e.on("drain",p),e._events&&e._events.error?isArray(e._events.error)?e._events.error.unshift(a):e._events.error=[a,e._events.error]:e.on("error",a),e.once("close",d),e.once("finish",o),e.emit("pipe",s),u.flowing||(this.on("readable",pipeOnReadable),u.flowing=!0,process.nextTick(function(){flow(s)})),e},Readable.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,this.removeListener("readable",pipeOnReadable),t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,this.removeListener("readable",pipeOnReadable),t.flowing=!1;for(var i=0;r>i;i++)n[i].emit("unpipe",this);return this}var i=indexOf(t.pipes,e);return-1===i?this:(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},Readable.prototype.on=function(e,t){var n=Stream.prototype.on.call(this,e,t);if("data"!==e||this._readableState.flowing||emitDataEvents(this),"readable"===e&&this.readable){var r=this._readableState;r.readableListening||(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading?r.length&&emitReadable(this,r):this.read(0))}return n},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){emitDataEvents(this),this.read(0),this.emit("resume")},Readable.prototype.pause=function(){emitDataEvents(this,!0),this.emit("pause")},Readable.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;e.on("end",function(){if(t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(i){if(t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)){var a=r.push(i);a||(n=!0,e.pause())}});for(var i in e)"function"==typeof e[i]&&"undefined"==typeof this[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));var a=["error","close","destroy","pause","resume"];return forEach(a,function(t){e.on(t,r.emit.bind(r,t))}),r._read=function(){n&&(n=!1,e.resume())},r},Readable._fromList=fromList;
}).call(this,require("FWaASH"))
},{"FWaASH":7,"buffer":1,"core-util-is":14,"events":5,"inherits":6,"isarray":15,"stream":21,"string_decoder/":16}],12:[function(require,module,exports){
function TransformState(r,t){this.afterTransform=function(r,e){return afterTransform(t,r,e)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function afterTransform(r,t,e){var n=r._transformState;n.transforming=!1;var a=n.writecb;if(!a)return r.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,null!==e&&void 0!==e&&r.push(e),a&&a(t);var i=r._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&r._read(i.highWaterMark)}function Transform(r){if(!(this instanceof Transform))return new Transform(r);Duplex.call(this,r);var t=(this._transformState=new TransformState(r,this),this);this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(r){done(t,r)}):done(t)})}function done(r,t){if(t)return r.emit("error",t);var e=r._writableState,n=(r._readableState,r._transformState);if(e.length)throw new Error("calling transform done when ws.length != 0");if(n.transforming)throw new Error("calling transform done when still transforming");return r.push(null)}module.exports=Transform;var Duplex=require("./_stream_duplex"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(Transform,Duplex),Transform.prototype.push=function(r,t){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,r,t)},Transform.prototype._transform=function(){throw new Error("not implemented")},Transform.prototype._write=function(r,t,e){var n=this._transformState;if(n.writecb=e,n.writechunk=r,n.writeencoding=t,!n.transforming){var a=this._readableState;(n.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}},Transform.prototype._read=function(){var r=this._transformState;null!==r.writechunk&&r.writecb&&!r.transforming?(r.transforming=!0,this._transform(r.writechunk,r.writeencoding,r.afterTransform)):r.needTransform=!0};
},{"./_stream_duplex":9,"core-util-is":14,"inherits":6}],13:[function(require,module,exports){
(function (process){
function WriteReq(e,t,i){this.chunk=e,this.encoding=t,this.callback=i}function WritableState(e,t){e=e||{};var i=e.highWaterMark;this.highWaterMark=i||0===i?i:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var r=e.decodeStrings===!1;this.decodeStrings=!r,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){onwrite(t,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function Writable(e){var t=require("./_stream_duplex");return this instanceof Writable||this instanceof t?(this._writableState=new WritableState(e,this),this.writable=!0,void Stream.call(this)):new Writable(e)}function writeAfterEnd(e,t,i){var r=new Error("write after end");e.emit("error",r),process.nextTick(function(){i(r)})}function validChunk(e,t,i,r){var n=!0;if(!Buffer.isBuffer(i)&&"string"!=typeof i&&null!==i&&void 0!==i&&!t.objectMode){var f=new TypeError("Invalid non-string/buffer chunk");e.emit("error",f),process.nextTick(function(){r(f)}),n=!1}return n}function decodeChunk(e,t,i){return e.objectMode||e.decodeStrings===!1||"string"!=typeof t||(t=new Buffer(t,i)),t}function writeOrBuffer(e,t,i,r,n){i=decodeChunk(t,i,r),Buffer.isBuffer(i)&&(r="buffer");var f=t.objectMode?1:i.length;t.length+=f;var o=t.length<t.highWaterMark;return o||(t.needDrain=!0),t.writing?t.buffer.push(new WriteReq(i,r,n)):doWrite(e,t,f,i,r,n),o}function doWrite(e,t,i,r,n,f){t.writelen=i,t.writecb=f,t.writing=!0,t.sync=!0,e._write(r,n,t.onwrite),t.sync=!1}function onwriteError(e,t,i,r,n){i?process.nextTick(function(){n(r)}):n(r),e._writableState.errorEmitted=!0,e.emit("error",r)}function onwriteStateUpdate(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function onwrite(e,t){var i=e._writableState,r=i.sync,n=i.writecb;if(onwriteStateUpdate(i),t)onwriteError(e,i,r,t,n);else{var f=needFinish(e,i);f||i.bufferProcessing||!i.buffer.length||clearBuffer(e,i),r?process.nextTick(function(){afterWrite(e,i,f,n)}):afterWrite(e,i,f,n)}}function afterWrite(e,t,i,r){i||onwriteDrain(e,t),r(),i&&finishMaybe(e,t)}function onwriteDrain(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function clearBuffer(e,t){t.bufferProcessing=!0;for(var i=0;i<t.buffer.length;i++){var r=t.buffer[i],n=r.chunk,f=r.encoding,o=r.callback,a=t.objectMode?1:n.length;if(doWrite(e,t,a,n,f,o),t.writing){i++;break}}t.bufferProcessing=!1,i<t.buffer.length?t.buffer=t.buffer.slice(i):t.buffer.length=0}function needFinish(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function finishMaybe(e,t){var i=needFinish(e,t);return i&&(t.finished=!0,e.emit("finish")),i}function endWritable(e,t,i){t.ending=!0,finishMaybe(e,t),i&&(t.finished?process.nextTick(i):e.once("finish",i)),t.ended=!0}module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream),Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},Writable.prototype.write=function(e,t,i){var r=this._writableState,n=!1;return"function"==typeof t&&(i=t,t=null),Buffer.isBuffer(e)?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof i&&(i=function(){}),r.ended?writeAfterEnd(this,r,i):validChunk(this,r,e,i)&&(n=writeOrBuffer(this,r,e,t,i)),n},Writable.prototype._write=function(e,t,i){i(new Error("not implemented"))},Writable.prototype.end=function(e,t,i){var r=this._writableState;"function"==typeof e?(i=e,e=null,t=null):"function"==typeof t&&(i=t,t=null),"undefined"!=typeof e&&null!==e&&this.write(e,t),r.ending||r.finished||endWritable(this,r,i)};
}).call(this,require("FWaASH"))
},{"./_stream_duplex":9,"FWaASH":7,"buffer":1,"core-util-is":14,"inherits":6,"stream":21}],14:[function(require,module,exports){
(function (Buffer){
function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function isBuffer(e){return Buffer.isBuffer(e)}function objectToString(e){return Object.prototype.toString.call(e)}exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=isBuffer;
}).call(this,require("buffer").Buffer)
},{"buffer":1}],15:[function(require,module,exports){
module.exports=Array.isArray||function(r){return"[object Array]"==Object.prototype.toString.call(r)};
},{}],16:[function(require,module,exports){
function assertEncoding(e){if(e&&!isBufferEncoding(e))throw new Error("Unknown encoding: "+e)}function passThroughWrite(e){return e.toString(this.encoding)}function utf16DetectIncompleteChar(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var Buffer=require("buffer").Buffer,isBufferEncoding=Buffer.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},StringDecoder=exports.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),assertEncoding(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0};StringDecoder.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";e=e.slice(r,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var h=t.charCodeAt(t.length-1);if(!(h>=55296&&56319>=h)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,h=t.charCodeAt(i);if(h>=55296&&56319>=h){var c=this.surrogateSize;return this.charLength+=c,this.charReceived+=c,this.charBuffer.copy(this.charBuffer,c,0,c),e.copy(this.charBuffer,0,0,c),t.substring(0,i)}return t},StringDecoder.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(2>=t&&r>>4==14){this.charLength=3;break}if(3>=t&&r>>3==30){this.charLength=4;break}}this.charReceived=t},StringDecoder.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,h=this.charBuffer,i=this.encoding;t+=h.slice(0,r).toString(i)}return t};
},{"buffer":1}],17:[function(require,module,exports){
module.exports=require("./lib/_stream_passthrough.js");
},{"./lib/_stream_passthrough.js":10}],18:[function(require,module,exports){
exports=module.exports=require("./lib/_stream_readable.js"),exports.Readable=exports,exports.Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js");
},{"./lib/_stream_duplex.js":9,"./lib/_stream_passthrough.js":10,"./lib/_stream_readable.js":11,"./lib/_stream_transform.js":12,"./lib/_stream_writable.js":13}],19:[function(require,module,exports){
module.exports=require("./lib/_stream_transform.js");
},{"./lib/_stream_transform.js":12}],20:[function(require,module,exports){
module.exports=require("./lib/_stream_writable.js");
},{"./lib/_stream_writable.js":13}],21:[function(require,module,exports){
function Stream(){EE.call(this)}module.exports=Stream;var EE=require("events").EventEmitter,inherits=require("inherits");inherits(Stream,EE),Stream.Readable=require("readable-stream/readable.js"),Stream.Writable=require("readable-stream/writable.js"),Stream.Duplex=require("readable-stream/duplex.js"),Stream.Transform=require("readable-stream/transform.js"),Stream.PassThrough=require("readable-stream/passthrough.js"),Stream.Stream=Stream,Stream.prototype.pipe=function(e,r){function t(r){e.writable&&!1===e.write(r)&&m.pause&&m.pause()}function n(){m.readable&&m.resume&&m.resume()}function a(){u||(u=!0,e.end())}function o(){u||(u=!0,"function"==typeof e.destroy&&e.destroy())}function i(e){if(s(),0===EE.listenerCount(this,"error"))throw e}function s(){m.removeListener("data",t),e.removeListener("drain",n),m.removeListener("end",a),m.removeListener("close",o),m.removeListener("error",i),e.removeListener("error",i),m.removeListener("end",s),m.removeListener("close",s),e.removeListener("close",s)}var m=this;m.on("data",t),e.on("drain",n),e._isStdio||r&&r.end===!1||(m.on("end",a),m.on("close",o));var u=!1;return m.on("error",i),e.on("error",i),m.on("end",s),m.on("close",s),e.on("close",s),e.emit("pipe",m),e};
},{"events":5,"inherits":6,"readable-stream/duplex.js":8,"readable-stream/passthrough.js":17,"readable-stream/readable.js":18,"readable-stream/transform.js":19,"readable-stream/writable.js":20}],22:[function(require,module,exports){
module.exports=function(o){return o&&"object"==typeof o&&"function"==typeof o.copy&&"function"==typeof o.fill&&"function"==typeof o.readUInt8};
},{}],23:[function(require,module,exports){
(function (process,global){
function inspect(e,r){var t={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(t.depth=arguments[2]),arguments.length>=4&&(t.colors=arguments[3]),isBoolean(r)?t.showHidden=r:r&&exports._extend(t,r),isUndefined(t.showHidden)&&(t.showHidden=!1),isUndefined(t.depth)&&(t.depth=2),isUndefined(t.colors)&&(t.colors=!1),isUndefined(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=stylizeWithColor),formatValue(t,e,t.depth)}function stylizeWithColor(e,r){var t=inspect.styles[r];return t?"["+inspect.colors[t][0]+"m"+e+"["+inspect.colors[t][1]+"m":e}function stylizeNoColor(e){return e}function arrayToHash(e){var r={};return e.forEach(function(e){r[e]=!0}),r}function formatValue(e,r,t){if(e.customInspect&&r&&isFunction(r.inspect)&&r.inspect!==exports.inspect&&(!r.constructor||r.constructor.prototype!==r)){var n=r.inspect(t,e);return isString(n)||(n=formatValue(e,n,t)),n}var i=formatPrimitive(e,r);if(i)return i;var o=Object.keys(r),s=arrayToHash(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),isError(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError(r);if(0===o.length){if(isFunction(r)){var u=r.name?": "+r.name:"";return e.stylize("[Function"+u+"]","special")}if(isRegExp(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(isDate(r))return e.stylize(Date.prototype.toString.call(r),"date");if(isError(r))return formatError(r)}var a="",c=!1,l=["{","}"];if(isArray(r)&&(c=!0,l=["[","]"]),isFunction(r)){var p=r.name?": "+r.name:"";a=" [Function"+p+"]"}if(isRegExp(r)&&(a=" "+RegExp.prototype.toString.call(r)),isDate(r)&&(a=" "+Date.prototype.toUTCString.call(r)),isError(r)&&(a=" "+formatError(r)),0===o.length&&(!c||0==r.length))return l[0]+a+l[1];if(0>t)return isRegExp(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special");e.seen.push(r);var f;return f=c?formatArray(e,r,t,s,o):o.map(function(n){return formatProperty(e,r,t,s,n,c)}),e.seen.pop(),reduceToSingleString(f,a,l)}function formatPrimitive(e,r){if(isUndefined(r))return e.stylize("undefined","undefined");if(isString(r)){var t="'"+JSON.stringify(r).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(t,"string")}return isNumber(r)?e.stylize(""+r,"number"):isBoolean(r)?e.stylize(""+r,"boolean"):isNull(r)?e.stylize("null","null"):void 0}function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}function formatArray(e,r,t,n,i){for(var o=[],s=0,u=r.length;u>s;++s)o.push(hasOwnProperty(r,String(s))?formatProperty(e,r,t,n,String(s),!0):"");return i.forEach(function(i){i.match(/^\d+$/)||o.push(formatProperty(e,r,t,n,i,!0))}),o}function formatProperty(e,r,t,n,i,o){var s,u,a;if(a=Object.getOwnPropertyDescriptor(r,i)||{value:r[i]},a.get?u=a.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):a.set&&(u=e.stylize("[Setter]","special")),hasOwnProperty(n,i)||(s="["+i+"]"),u||(e.seen.indexOf(a.value)<0?(u=isNull(t)?formatValue(e,a.value,null):formatValue(e,a.value,t-1),u.indexOf("\n")>-1&&(u=o?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n"))):u=e.stylize("[Circular]","special")),isUndefined(s)){if(o&&i.match(/^\d+$/))return u;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+u}function reduceToSingleString(e,r,t){var n=0,i=e.reduce(function(e,r){return n++,r.indexOf("\n")>=0&&n++,e+r.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?t[0]+(""===r?"":r+"\n ")+" "+e.join(",\n  ")+" "+t[1]:t[0]+r+" "+e.join(", ")+" "+t[1]}function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function objectToString(e){return Object.prototype.toString.call(e)}function pad(e){return 10>e?"0"+e.toString(10):e.toString(10)}function timestamp(){var e=new Date,r=[pad(e.getHours()),pad(e.getMinutes()),pad(e.getSeconds())].join(":");return[e.getDate(),months[e.getMonth()],r].join(" ")}function hasOwnProperty(e,r){return Object.prototype.hasOwnProperty.call(e,r)}var formatRegExp=/%[sdj%]/g;exports.format=function(e){if(!isString(e)){for(var r=[],t=0;t<arguments.length;t++)r.push(inspect(arguments[t]));return r.join(" ")}for(var t=1,n=arguments,i=n.length,o=String(e).replace(formatRegExp,function(e){if("%%"===e)return"%";if(t>=i)return e;switch(e){case"%s":return String(n[t++]);case"%d":return Number(n[t++]);case"%j":try{return JSON.stringify(n[t++])}catch(r){return"[Circular]"}default:return e}}),s=n[t];i>t;s=n[++t])o+=isNull(s)||!isObject(s)?" "+s:" "+inspect(s);return o},exports.deprecate=function(e,r){function t(){if(!n){if(process.throwDeprecation)throw new Error(r);process.traceDeprecation?console.trace(r):console.error(r),n=!0}return e.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(e,r).apply(this,arguments)};if(process.noDeprecation===!0)return e;var n=!1;return t};var debugs={},debugEnviron;exports.debuglog=function(e){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!debugs[e])if(new RegExp("\\b"+e+"\\b","i").test(debugEnviron)){var r=process.pid;debugs[e]=function(){var t=exports.format.apply(exports,arguments);console.error("%s %d: %s",e,r,t)}}else debugs[e]=function(){};return debugs[e]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(e,r){if(!r||!isObject(r))return e;for(var t=Object.keys(r),n=t.length;n--;)e[t[n]]=r[t[n]];return e};
}).call(this,require("FWaASH"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./support/isBuffer":22,"FWaASH":7,"inherits":6}],24:[function(require,module,exports){
"use strict";var Promise=require("./promise/promise").Promise,polyfill=require("./promise/polyfill").polyfill;exports.Promise=Promise,exports.polyfill=polyfill;
},{"./promise/polyfill":28,"./promise/promise":29}],25:[function(require,module,exports){
"use strict";function all(r){var n=this;if(!isArray(r))throw new TypeError("You must pass an array to all.");return new n(function(n,t){function i(r){return function(n){u(r,n)}}function u(r,t){e[r]=t,0===--s&&n(e)}var a,e=[],s=r.length;0===s&&n([]);for(var o=0;o<r.length;o++)a=r[o],a&&isFunction(a.then)?a.then(i(o),t):u(o,a)})}var isArray=require("./utils").isArray,isFunction=require("./utils").isFunction;exports.all=all;
},{"./utils":33}],26:[function(require,module,exports){
(function (process,global){
"use strict";function useNextTick(){return function(){process.nextTick(flush)}}function useMutationObserver(){var e=0,t=new BrowserMutationObserver(flush),u=document.createTextNode("");return t.observe(u,{characterData:!0}),function(){u.data=e=++e%2}}function useSetTimeout(){return function(){local.setTimeout(flush,1)}}function flush(){for(var e=0;e<queue.length;e++){var t=queue[e],u=t[0],o=t[1];u(o)}queue=[]}function asap(e,t){var u=queue.push([e,t]);1===u&&scheduleFlush()}var browserGlobal="undefined"!=typeof window?window:{},BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver,local="undefined"!=typeof global?global:void 0===this?window:this,queue=[],scheduleFlush;scheduleFlush="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?useNextTick():BrowserMutationObserver?useMutationObserver():useSetTimeout(),exports.asap=asap;
}).call(this,require("FWaASH"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"FWaASH":7}],27:[function(require,module,exports){
"use strict";function configure(n,i){return 2!==arguments.length?config[n]:void(config[n]=i)}var config={instrument:!1};exports.config=config,exports.configure=configure;
},{}],28:[function(require,module,exports){
(function (global){
"use strict";function polyfill(){var i;i="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var e="Promise"in i&&"resolve"in i.Promise&&"reject"in i.Promise&&"all"in i.Promise&&"race"in i.Promise&&function(){var e;return new i.Promise(function(i){e=i}),isFunction(e)}();e||(i.Promise=RSVPPromise)}var RSVPPromise=require("./promise").Promise,isFunction=require("./utils").isFunction;exports.polyfill=polyfill;
}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./promise":29,"./utils":33}],29:[function(require,module,exports){
"use strict";function Promise(e){if(!isFunction(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof Promise))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],invokeResolver(e,this)}function invokeResolver(e,t){function r(e){resolve(t,e)}function i(e){reject(t,e)}try{e(r,i)}catch(n){i(n)}}function invokeCallback(e,t,r,i){var n,s,o,c,u=isFunction(r);if(u)try{n=r(i),o=!0}catch(l){c=!0,s=l}else n=i,o=!0;handleThenable(t,n)||(u&&o?resolve(t,n):c?reject(t,s):e===FULFILLED?resolve(t,n):e===REJECTED&&reject(t,n))}function subscribe(e,t,r,i){var n=e._subscribers,s=n.length;n[s]=t,n[s+FULFILLED]=r,n[s+REJECTED]=i}function publish(e,t){for(var r,i,n=e._subscribers,s=e._detail,o=0;o<n.length;o+=3)r=n[o],i=n[o+t],invokeCallback(t,r,i,s);e._subscribers=null}function handleThenable(e,t){var r,i=null;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(objectOrFunction(t)&&(i=t.then,isFunction(i)))return i.call(t,function(i){return r?!0:(r=!0,void(t!==i?resolve(e,i):fulfill(e,i)))},function(t){return r?!0:(r=!0,void reject(e,t))}),!0}catch(n){return r?!0:(reject(e,n),!0)}return!1}function resolve(e,t){e===t?fulfill(e,t):handleThenable(e,t)||fulfill(e,t)}function fulfill(e,t){e._state===PENDING&&(e._state=SEALED,e._detail=t,config.async(publishFulfillment,e))}function reject(e,t){e._state===PENDING&&(e._state=SEALED,e._detail=t,config.async(publishRejection,e))}function publishFulfillment(e){publish(e,e._state=FULFILLED)}function publishRejection(e){publish(e,e._state=REJECTED)}var config=require("./config").config,configure=require("./config").configure,objectOrFunction=require("./utils").objectOrFunction,isFunction=require("./utils").isFunction,now=require("./utils").now,all=require("./all").all,race=require("./race").race,staticResolve=require("./resolve").resolve,staticReject=require("./reject").reject,asap=require("./asap").asap,counter=0;config.async=asap;var PENDING=void 0,SEALED=0,FULFILLED=1,REJECTED=2;Promise.prototype={constructor:Promise,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(e,t){var r=this,i=new this.constructor(function(){});if(this._state){var n=arguments;config.async(function(){invokeCallback(r._state,i,n[r._state-1],r._detail)})}else subscribe(this,i,e,t);return i},"catch":function(e){return this.then(null,e)}},Promise.all=all,Promise.race=race,Promise.resolve=staticResolve,Promise.reject=staticReject,exports.Promise=Promise;
},{"./all":25,"./asap":26,"./config":27,"./race":30,"./reject":31,"./resolve":32,"./utils":33}],30:[function(require,module,exports){
"use strict";function race(r){var e=this;if(!isArray(r))throw new TypeError("You must pass an array to race.");return new e(function(e,t){for(var a,n=0;n<r.length;n++)a=r[n],a&&"function"==typeof a.then?a.then(e,t):e(a)})}var isArray=require("./utils").isArray;exports.race=race;
},{"./utils":33}],31:[function(require,module,exports){
"use strict";function reject(e){var t=this;return new t(function(t,r){r(e)})}exports.reject=reject;
},{}],32:[function(require,module,exports){
"use strict";function resolve(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=this;return new t(function(t){t(e)})}exports.resolve=resolve;
},{}],33:[function(require,module,exports){
"use strict";function objectOrFunction(t){return isFunction(t)||"object"==typeof t&&null!==t}function isFunction(t){return"function"==typeof t}function isArray(t){return"[object Array]"===Object.prototype.toString.call(t)}var now=Date.now||function(){return(new Date).getTime()};exports.objectOrFunction=objectOrFunction,exports.isFunction=isFunction,exports.isArray=isArray,exports.now=now;
},{}],34:[function(require,module,exports){
(function(){var t,e,n=function(t,e){return function(){return t.apply(e,arguments)}},r={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var a in e)r.call(e,a)&&(t[a]=e[a]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o=[].slice;t=require("events").EventEmitter,e=function(t){function e(t,r){return null==r&&(r="*"),this.handleMessage=n(this.handleMessage,this),this instanceof e?(e.__super__.constructor.call(this),this.target=t,this.origin=r,void this.listen()):new e(t,r)}return a(e,t),e.prototype.target=null,e.prototype.origin=null,e.prototype.post=function(){var t,e,n;return t=arguments[0],n=2<=arguments.length?o.call(arguments,1):[],e=this.pack(t,n),this.target.postMessage(e,this.origin)},e.prototype.listen=function(){return window.addEventListener?window.addEventListener("message",this.handleMessage):window.attachEvent("onmessage",this.handleMessage)},e.prototype.handleMessage=function(t){var e;return(e=this.unpack(t.data))?this.emit.apply(this,[e.channel].concat(o.call(e["package"]))):void 0},e.prototype.unpack=function(t){var e,n;try{return n=JSON.parse(t),{channel:n._postie.channel,"package":n._postie["package"]}}catch(r){return e=r,!1}},e.prototype.pack=function(t,e){return JSON.stringify({_postie:{channel:t,"package":e}})},e}(t),module.exports=e}).call(this);
},{"events":5}],35:[function(require,module,exports){
function ws(e,o){var t;return t=o?new WebSocket(e,o):new WebSocket(e)}var global=function(){return this}(),WebSocket=global.WebSocket||global.MozWebSocket;module.exports=WebSocket?ws:null,WebSocket&&(ws.prototype=WebSocket.prototype);
},{}],36:[function(require,module,exports){
var vError=require("../lib/verror"),idlHelper={};idlHelper.generateIdlWireDescription=function(r){var e={},t=r.metadata;for(var n in t)if(t.hasOwnProperty(n)){for(var a=t[n],o=a.params,i=[],s=0;s<o.length;s++){var u=o[s];"$"!==u[0]&&i.push(u)}e[n]={InArgs:i,NumOutArgs:a.numOutArgs+1,IsStreaming:void 0!==a.injections.$stream}}return e};var getParamNames=function(r){var e=r.toString().replace(/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,""),t=e.slice(e.indexOf("(")+1,e.indexOf(")")).match(/([^\s,]+)/g);return null===t&&(t=[]),t};idlHelper.ServiceWrapper=function(r,e){this.object=r,this.metadata={},e=e||{};for(var t in r)if(r.hasOwnProperty(t)&&t.length>0&&"_"!==t[0]){if(t[0]>="A"&&t[0]<="Z"){var n=t.charAt(0).toLowerCase()+t.slice(1);throw new Error("Method names must be camel case. Perhaps rename '"+t+"' to '"+n+"'")}var a=r[t];if("function"==typeof a){for(var o=getParamNames(a),i={},s=0;s<o.length;s++){var u=o[s];"$"===u[0]&&(i[u]=s)}var m={params:o,injections:i,numOutArgs:1};if(e[t]){var g=e[t];void 0!==g.numOutArgs&&(m.numOutArgs=g.numOutArgs)}this.metadata[t]=m}}},idlHelper.ServiceWrapper.prototype.validate=function(r){for(var e in r)if(r.hasOwnProperty(e)){var t=this.metadata[e];if(!t)return new vError.BadArgError("Missing method: "+e);var n=r[e],a=t.params.length-Object.keys(t.injections).length;if(a!==n.numInArgs)return new vError.BadArgError("Wrong number of input args for "+e+", got: "+a+", expected: "+n.numInArgs);if(t.numOutArgs!==n.numOutArgs)return new vError.BadArgError("Wrong number of output args for "+e+", got: "+t.numOutArgs+", expected "+n.numOutArgs);var o=t.injections.hasOwnProperty("$stream"),i=n.inputStreaming||n.outputStreaming;if(i&&!o)return new vError.BadArgError("Expected "+e+" to be streaming");if(!i&&o)return new vError.BadArgError("Expected "+e+" to not be streaming")}for(e in this.metadata)if(this.metadata.hasOwnProperty(e)&&!r.hasOwnProperty(e))return new vError.BadArgError("Unexpected method "+e+" implemented.");return null},module.exports=idlHelper;
},{"../lib/verror":41}],37:[function(require,module,exports){
function Client(e){return this instanceof Client?void(this._proxyConnection=e):new Client(e)}var Promise=require("es6-promise").Promise,Deferred=require("../lib/deferred"),vLog=require("../lib/vlog"),ErrorConversion=require("../proxy/error_conversion"),Stream=require("../proxy/stream"),vError=require("../lib/verror"),MessageType=require("../proxy/message_type"),IncomingPayloadType=require("../proxy/incoming_payload_type"),OutstandingRPC=function(e,r){this._proxy=e.proxy,this._id=-1,this._name=e.name,this._methodName=e.methodName,this._args=e.args,this._numOutParams=e.numOutParams,this._isStreaming=e.isStreaming||!1,this._cb=r,this._def=null};OutstandingRPC.prototype.start=function(){this._id=this._proxy.nextId();var e=new Deferred(this._cb),r=null;this._isStreaming&&(r=new Deferred,e.stream=new Stream(this._id,r.promise,!0),e.promise.stream=e.stream);var t=this.constructMessage();return this._def=e,this._proxy.sendRequest(t,MessageType.REQUEST,this,this._id),r&&this._proxy.senderPromise.then(function(e){r.resolve(e)},function(e){r.reject(e)}),e.promise},OutstandingRPC.prototype.handleResponse=function(e,r){switch(e){case IncomingPayloadType.FINAL_RESPONSE:this.handleCompletion(r);break;case IncomingPayloadType.STREAM_RESPONSE:this.handleStreamData(r);break;case IncomingPayloadType.ERROR_RESPONSE:this.handleError(r);break;case IncomingPayloadType.STREAM_CLOSE:this.handleStreamClose();break;default:this.handleError(new vError.InternalError("Recieved unknown response type from wspr"))}},OutstandingRPC.prototype.handleCompletion=function(e){1===e.length&&(e=e[0]),this._def.resolve(e),this._def.stream&&this._def.stream._queueRead(null),this._proxy.dequeue(this._id)},OutstandingRPC.prototype.handleStreamData=function(e){this._def.stream?this._def.stream._queueRead(e):vLog.warn("Ignoring streaming message for non-streaming flow : "+this._id)},OutstandingRPC.prototype.handleStreamClose=function(){this._def.stream&&this._def.stream._queueRead(null)},OutstandingRPC.prototype.handleError=function(e){var r;r=e instanceof vError.VeyronError?e:ErrorConversion.toJSerror(e),this._def.stream&&(this._def.stream.emit("error",r),this._def.stream.queueRead(null)),this._def.reject(r),this._proxy.dequeue(this._id)},OutstandingRPC.prototype.constructMessage=function(){var e={name:this._name,method:this._methodName,inArgs:this._args||[],numOutArgs:this._numOutParams||1,isStreaming:this._isStreaming};return JSON.stringify(e)},Client.prototype.bindTo=function(e,r,t){var n=this;"function"==typeof r&&(t=r,r=void 0);var i,s=new Deferred(t);void 0!==r?i=Promise.resolve(r):(vLog.debug("Requesting service signature for:",e),i=n._proxyConnection.getServiceSignature(e));var o=s.promise;return i.then(function(r){vLog.debug("Received signature for:",e,r);var t={},i=function(i){var s=r[i],o=s.numOutArgs;t[i]=function(){var r=Array.prototype.slice.call(arguments,0),t=null;if(r.length===s.inArgs.length+1&&(t=r[r.length-1],r=r.slice(0,s.inArgs.length)),r.length!==s.inArgs.length)throw new Error('Invalid number of arguments to "'+i+'". Expected '+s.inArgs.length+" but there were "+r.length);var a=new OutstandingRPC({proxy:n._proxyConnection,name:e,methodName:i,args:r,numOutParams:o,isStreaming:s.isStreaming},t);return a.start()}};for(var o in r)r.hasOwnProperty(o)&&i(o);t.signature=function(){return Promise.resolve(r)},s.resolve(t)}).catch(s.reject),o},module.exports=Client;
},{"../lib/deferred":40,"../lib/verror":41,"../lib/vlog":42,"../proxy/error_conversion":46,"../proxy/incoming_payload_type":47,"../proxy/message_type":48,"../proxy/stream":51,"es6-promise":24}],38:[function(require,module,exports){
function Server(e){return this instanceof Server?(this._router=e,this.id=nextServerID++,this.serviceObject=null,void(this._knownServiceDefinitions={})):new Server(e)}var Deferred=require("./../lib/deferred"),IdlHelper=require("./../idl/idl"),vError=require("./../lib/verror"),ServiceWrapper=IdlHelper.ServiceWrapper,nextServerID=1;Server.prototype.addIDL=function(e){var r=e.package;for(var t in e)t[0]===t[0].toUpperCase()&&e.hasOwnProperty(t)&&(this._knownServiceDefinitions[r+"."+t]=e[t])},Server.prototype._getAndValidateMetadata=function(e,r){var t=!1;if("string"==typeof r&&(r=[r]),Array.isArray(r)){t=!0;for(var i={},n=0;n<r.length;n++){var o=r[n],v=this._knownServiceDefinitions[o];if(!v)return new vError.NotFoundError("unknown service "+o);for(var a in v)v.hasOwnProperty(a)&&(i[a]=v[a])}r=i}var s=new ServiceWrapper(e,r);if(t){var p=s.validate(r);if(p)return p}return this.serviceObject=s,null},Server.prototype.serve=function(e,r,t,i){i||"function"!=typeof t||(i=t,t=null);var n=this._getAndValidateMetadata(r,t);if(n){var o=new Deferred(i);return o.reject(n),o.promise}return this._router.serve(e,this,i)},Server.prototype.stop=function(e){return this._router.stopServer(this,e)},Server.prototype.generateIdlWireDescription=function(){return IdlHelper.generateIdlWireDescription(this.serviceObject)},module.exports=Server;
},{"./../idl/idl":36,"./../lib/deferred":40,"./../lib/verror":41}],39:[function(require,module,exports){
var Promise=require("es6-promise").Promise,Stream=require("../proxy/stream"),MessageType=require("../proxy/message_type"),IncomingPayloadType=require("../proxy/incoming_payload_type"),ErrorConversion=require("../proxy/error_conversion"),Deferred=require("./../lib/deferred"),vLog=require("./../lib/vlog"),SimpleHandler=require("../proxy/simple_handler"),PublicId=require("../security/public"),ServerStream=function(e){this._stream=e};ServerStream.prototype.handleResponse=function(e,r){switch(e){case IncomingPayloadType.STREAM_RESPONSE:this._stream._queueRead(r);break;case IncomingPayloadType.STREAM_CLOSE:this._stream._queueRead(null);break;case IncomingPayloadType.ERROR_RESPONSE:this._stream.emit("error",ErrorConversion.toJSerror(r))}};var Router=function(e){this._servers={},this._proxy=e,this._streamMap={},e.addIncomingHandler(IncomingPayloadType.INVOKE_REQUEST,this)},inject=function(e,r,t){var o=Object.keys(r),n={};o.forEach(function(e){n[r[e]]=e});var s=o.map(function(e){return r[e]});s.filter(function(e){return void 0!==e}),s.sort();var i=[];return s.forEach(function(r){var o=n[r];e.splice(r,0,t[o]),i.push(o)}),i};Router.prototype.invokeMethod=function(e,r,t){try{return r.apply(e,t)}catch(o){return o instanceof Error?o:new Error(o)}},Router.prototype.handleRequest=function(e,r){var t,o=this._servers[r.serverId];if(!o)return t=new Error("Request for unknown server "+r.serverId),void this.sendResult(e,r.method,null,t);var n=o.serviceObject;if(!n)return t=new Error("No service found"),void this.sendResulttResult(e,r.method,null,t);var s=n.object,i=s[r.method];if(void 0===i)return t=new Error("Requested method "+r.method+" not found on"),void this.sendResult(e,r.method,null,t);var a=n.metadata[r.method],u=this,d=function(t,o){var n;t instanceof Error&&void 0!==t.stack&&(n=t.stack),vLog.debug("Requested method "+r.method+" threw an exception on invoke: ",t,n);var s,i=o.numOutArgs;switch(i){case 0:break;case 1:s=null;break;default:s=new Array(i)}u.sendResult(e,r.method,s,t,o)},m=r.args,c={suffix:r.context.suffix,name:r.context.name,remoteId:new PublicId(r.context.remoteID.names,r.context.remoteID.handle,this._proxy)},l=!1,v=function(t,o){l||(l=!0,c.remoteId.release(),u.sendResult(e,r.method,o,t,a))},p={$stream:new Stream(e,this._proxy.senderPromise,!1),$callback:v,$context:c,$suffix:c.suffix,$name:c.name,$remoteId:c.remoteId},h=inject(m,a.injections,p);if(-1!==h.indexOf("$stream")){var f=p.$stream;this._streamMap[e]=f;var y=new ServerStream(f);this._proxy.addIncomingStreamHandler(e,y)}var g=this.invokeMethod(s,i,m);if(g instanceof Error)return void d(g,a);var _=Promise.resolve(g);-1===h.indexOf("$callback")&&_.then(function(t){l||(c.remoteId.release(),l=!0,u.sendResult(e,r.method,t,null,a))},function(e){l||(l=!0,d(e,a))})},Router.prototype.sendResult=function(e,r,t,o,n){var s=[];if(n)switch(n.numOutArgs){case 0:void 0!==t&&vLog.error("Unexpected return value from "+r+": "+t),s=[];break;case 1:s=[t];break;default:Array.isArray(t)?(t.length!==n.numOutArgs&&vLog.error("Wrong number of arguments returned by "+r+". expected: "+n.numOutArgs+", got:"+t.length),s=t):(vLog.error("Wrong number of arguments returned by "+r+". expected: "+n.numOutArgs+", got: 1"),s=[t])}else s=[t];var i=null;void 0!==o&&null!==o&&(i=ErrorConversion.toStandardErrorStruct(o));var a=this._streamMap[e];if(a)a.serverClose(t,i),this._proxy.dequeue(e);else{var u={results:s,err:i},d=JSON.stringify(u);this._proxy.sendRequest(d,MessageType.RESPONSE,null,e)}},Router.prototype.serve=function(e,r,t){vLog.info("Serving under the name: ",e);var o={name:e,serverId:r.id,service:r.generateIdlWireDescription()};this._servers[r.id]=r;var n=new Deferred(t),s=JSON.stringify(o),i=this._proxy.id;this._proxy.id+=2;var a=new SimpleHandler(n,this._proxy,i);return this._proxy.sendRequest(s,MessageType.SERVE,a,i),n.promise},Router.prototype.stopServer=function(e,r){var t=this,o=new Deferred(r),n=this._proxy.id;this._proxy.id+=2;var s=new SimpleHandler(o,this._proxy,n);return this._proxy.sendRequest(e.id.toString(),MessageType.STOP,s,n),o.promise.then(function(r){return delete t._servers[e.id],r})},module.exports=Router;
},{"../proxy/error_conversion":46,"../proxy/incoming_payload_type":47,"../proxy/message_type":48,"../proxy/simple_handler":50,"../proxy/stream":51,"../security/public":55,"./../lib/deferred":40,"./../lib/vlog":42,"es6-promise":24}],40:[function(require,module,exports){
(function (process){
var Promise=require("es6-promise").Promise,Deferred=function(e){var r=this;this.promise=new Promise(function(e,i){r.resolve=e,r.reject=i}),e&&this.promise.then(function(r){e(null,r)},function(r){e(r)}).catch(function(e){process.nextTick(function(){throw e})})};module.exports=Deferred;
}).call(this,require("FWaASH"))
},{"FWaASH":7,"es6-promise":24}],41:[function(require,module,exports){
var inherits=require("util").inherits,vError={};vError.Ids={Aborted:"veyron2/verror.Aborted",BadArg:"veyron2/verror.BadArg",BadProtocol:"veyron2/verror.BadProtocol",Exists:"veyron2/verror.Exists",Internal:"veyron2/verror.Internal",NotAuthorized:"veyron2/verror.NotAuthorized",NotFound:"veyron2/verror.NotFound"},vError.VeyronError=function(r,o){return this instanceof vError.VeyronError?(Error.call(this),this.message=r,o&&(this.name=o),void("function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,vError.VeyronError):this.stack=(new Error).stack)):new vError.VeyronError(r,o)},inherits(vError.VeyronError,Error),vError.equals=function(r,o){var E=r instanceof vError.VeyronError,n=o instanceof vError.VeyronError;return E&&n?r.message===o.message&&r.id===o.id:!1},vError.AbortedError=function(r){return this instanceof vError.AbortedError?void vError.VeyronError.call(this,r,vError.Ids.Aborted):new vError.AbortedError(r)},inherits(vError.AbortedError,vError.VeyronError),vError.BadArgError=function(r){return this instanceof vError.BadArgError?void vError.VeyronError.call(this,r,vError.Ids.BadArg):new vError.BadArgError(r)},inherits(vError.BadArgError,vError.VeyronError),vError.BadProtocolError=function(r){return this instanceof vError.BadProtocolError?void vError.VeyronError.call(this,r,vError.Ids.BadProtocol):new vError.BadProtocolError(r)},inherits(vError.BadProtocolError,vError.VeyronError),vError.ExistsError=function(r){return this instanceof vError.ExistsError?void vError.VeyronError.call(this,r,vError.Ids.Exists):new vError.ExistsError(r)},inherits(vError.ExistsError,vError.VeyronError),vError.InternalError=function(r){return this instanceof vError.InternalError?void vError.VeyronError.call(this,r,vError.Ids.Internal):new vError.InternalError(r)},inherits(vError.InternalError,vError.VeyronError),vError.NotAuthorizedError=function(r){return this instanceof vError.NotAuthorizedError?void vError.VeyronError.call(this,r,vError.Ids.NotAuthorized):new vError.NotAuthorizedError(r)},inherits(vError.NotAuthorizedError,vError.VeyronError),vError.NotFoundError=function(r){return this instanceof vError.NotFoundError?void vError.VeyronError.call(this,r,vError.Ids.NotFound):new vError.NotFoundError(r)},inherits(vError.NotFoundError,vError.VeyronError),module.exports=vError;
},{"util":23}],42:[function(require,module,exports){
var vlog=function(){this.level=this.levels.NOLOG};vlog.prototype.levels={NOLOG:0,ERROR:1,WARN:2,DEBUG:3,INFO:4},vlog.prototype.error=function(){this._log(this.levels.ERROR,arguments)},vlog.prototype.warn=function(){this._log(this.levels.WARN,arguments)},vlog.prototype.debug=function(){this._log(this.levels.DEBUG,arguments)},vlog.prototype.info=function(){this._log(this.levels.INFO,arguments)},vlog.prototype._log=function(e,o){this.level>=e&&this._write(e,o)},vlog.prototype._write=function(e,o){var t=this._getConsole();if(t){var l=t.log;switch(e){case this.levels.ERROR:l=t.error;break;case this.levels.WARN:l=t.warn;break;case this.levels.DEBUG:l=t.log;break;case this.levels.INFO:l=t.info}l.apply(t,o)}},vlog.prototype._getConsole=function(){return"undefined"!=typeof console?console:null};var vlogInstance=new vlog;module.exports=vlogInstance;
},{}],43:[function(require,module,exports){
var WS=require("ws");module.exports=WS;
},{"ws":35}],44:[function(require,module,exports){
function convertServersToStrings(e){for(var r=e[0],o=e[1],t=[],n=0;n<r.length;n++){var a=r[n].server;""!==o&&(a=nameUtil.join(a,o)),t.push(a)}return t}function makeAllTerminal(e){return e.map(nameUtil.convertToTerminalName)}function allAreTerminal(e){return e.every(nameUtil.isTerminal)}var Promise=require("es6-promise").Promise,nameUtil=require("./util.js"),Deferred=require("../lib/deferred"),vError=require("../lib/verror"),Namespace=function(e,r){this._client=e,this._roots=r};Namespace.errNotAMountTable=function(){return new vError.VeyronError("Resolution target is not a mount table",vError.Ids.Aborted)},Namespace.errNoSuchName=function(){return new vError.VeyronError("Name doesn't exist",vError.Ids.NotFound)},Namespace.errNoSuchNameRoot=function(){return new vError.VeyronError("Name doesn't exist: root of namespace",vError.NotFound)},Namespace._maxDepth=32,Namespace.prototype._rootNames=function(e){if(nameUtil.isRooted(e)&&"/"!==e)return[e];for(var r=[],o=0;o<this._roots.length;o++)r.push(nameUtil.join(this._roots[o],e));return r},Namespace.prototype._resolveAgainstMountTable=function(e){if(0===e.length)return Promise.reject(new vError.BadArgError("No servers to resolve query."));var r=this,o=nameUtil.convertToTerminalName(e[0]);return this._client.bindTo(o).then(function(e){if(void 0===e.resolveStep)throw Namespace.errNotAMountTable();return e.resolveStep().then(convertServersToStrings)}).catch(function(o){if(vError.equals(o,Namespace.errNoSuchName())||vError.equals(o,Namespace.errNoSuchNameRoot())||e.length<=1)throw o;return r._resolveAgainstMountTable(e.slice(1))})},Namespace.prototype._resolveLoop=function(e,r,o,t){var n=this;return n._resolveAgainstMountTable(e).then(function(r){if(allAreTerminal(r))return r;if(o++,o>Namespace._maxDepth)throw new vError.InternalError("Maxiumum resolution depth exceeded.");return n._resolveLoop(r,e,o,t)},function(o){return t(o,e,r)})},Namespace.prototype.resolveToMountTable=function(e,r){var o=this._rootNames(e),t=new Deferred(r),n=function(e,r,o){if(vError.equals(e,Namespace.errNoSuchNameRoot())||vError.equals(e,Namespace.errNotAMountTable()))return makeAllTerminal(o);if(vError.equals(e,Namespace.errNoSuchName()))return makeAllTerminal(r);throw e};return t.resolve(this._resolveLoop(o,o,0,n)),t.promise},Namespace.prototype.resolveMaximally=function(e,r){var o=this._rootNames(e),t=new Deferred(r),n=function(e,r){if(vError.equals(e,Namespace.errNoSuchNameRoot())||vError.equals(e,Namespace.errNoSuchName())||vError.equals(e,Namespace.errNotAMountTable()))return makeAllTerminal(r);throw e};return t.resolve(this._resolveLoop(o,o,0,n)),t.promise},module.exports=Namespace;
},{"../lib/deferred":40,"../lib/verror":41,"./util.js":45,"es6-promise":24}],45:[function(require,module,exports){
var _numInitialSlashes=function(e){for(var n=0;n<e.length;n++)if("/"!==e.charAt(n))return n;return e.length},_numTailSlashes=function(e){for(var n=e.length-1;n>=0;n--)if("/"!==e.charAt(n))return e.length-1-n;return e.length},_removeInitialSlashes=function(e){return e.replace(/^\/*/g,"")},_removeTailSlashes=function(e){return e.replace(/\/*$/g,"")},_joinNamePartsOnArray=function(e){if(0===e.length)return"";for(var n=e[0],r=1;r<e.length;r++){var t=e[r],i=_numTailSlashes(n),a=_numInitialSlashes(t);0!==i||0!==a?a>i?(n=_removeTailSlashes(n),n+=t):n+=_removeInitialSlashes(t):n+="/"+t}return n},join=function(e){return _joinNamePartsOnArray(Array.isArray(e)?e:Array.prototype.slice.call(arguments))},isRooted=function(e){return 1===_numInitialSlashes(e)},isTerminal=function(e){var n=_numInitialSlashes(e);if(n>=2)return!0;if(1===n){var r=e.substr(1).indexOf("/"),t=e.substr(1).indexOf("//");return r===t}return 0===e.length},convertToTerminalName=function(e){return""===e||"/"===e?"":isRooted(e)?-1===e.substr(1).indexOf("/")?e:e.substr(1).indexOf("/")===e.length-2?e.substring(0,e.length-1):e.replace(/^(\/[^/]+?)[/]*\//,"$1//"):"//"+_removeInitialSlashes(e)};module.exports={join:join,isTerminal:isTerminal,isRooted:isRooted,convertToTerminalName:convertToTerminalName};
},{}],46:[function(require,module,exports){
var vError=require("./../lib/verror"),ec={},_standard=function(r,o){this.iD=r,this.msg=o};ec.toStandardErrorStruct=function(r){var o="",t="";return r instanceof Error?(t=r.message,"Error"!==r.name&&(o=r.name)):void 0!==r&&null!==r&&(t=r+""),new _standard(o,t)};var errIdConstrMap={};errIdConstrMap[vError.Ids.Aborted]=vError.AbortedError,errIdConstrMap[vError.Ids.BadArg]=vError.BadArgError,errIdConstrMap[vError.Ids.BadProtocol]=vError.BadProtocolError,errIdConstrMap[vError.Ids.Exists]=vError.ExistsError,errIdConstrMap[vError.Ids.Internal]=vError.InternalError,errIdConstrMap[vError.Ids.NotAuthorized]=vError.NotAuthorizedError,errIdConstrMap[vError.Ids.NotFound]=vError.NotFoundError,ec.toJSerror=function(r){var o,t=errIdConstrMap[r.iD];return o=t?new t(r.msg):new vError.VeyronError(r.msg,r.iD),o.stack="",o},module.exports=ec;
},{"./../lib/verror":41}],47:[function(require,module,exports){
var IncomingPayloadType={FINAL_RESPONSE:0,STREAM_RESPONSE:1,ERROR_RESPONSE:2,INVOKE_REQUEST:3,STREAM_CLOSE:4};module.exports=IncomingPayloadType;
},{}],48:[function(require,module,exports){
var MessageType={REQUEST:0,SERVE:1,RESPONSE:2,STREAM_VALUE:3,STREAM_CLOSE:4,SIGNATURE:5,STOP:6,BLESS:8,UNLINK_ID:9,NEW_ID:10};module.exports=MessageType;
},{}],49:[function(require,module,exports){
function Proxy(e){this.id=1,this.outstandingRequests={},this.bindCache={},this._hasResolvedConfig=!1,this._configDeferred=new Deferred,this.config=this._configDeferred.promise,this.senderPromise=e,this.incomingRequestHandlers={}}var MessageType=require("./message_type"),IncomingPayloadType=require("./incoming_payload_type"),Deferred=require("./../lib/deferred"),Promise=require("es6-promise").Promise,vLog=require("./../lib/vlog"),SimpleHandler=require("./simple_handler"),BIND_CACHE_TTL=36e5;Proxy.prototype.process=function(e){if(this._hasResolvedConfig===!1)return this._hasResolvedConfig=!0,void this._configDeferred.resolve(e);var i,n=e.id%2===0,t=this.outstandingRequests[e.id];try{i=JSON.parse(e.data)}catch(s){return void(n||t.handleResponse(IncomingPayloadType.ERROR_RESPONSE,e.data))}if(!n&&!t)return void vLog.warn("Dropping message for unknown flow "+e.id+" "+e.data);if(t)t.handleResponse(i.type,i.message);else{if(t=this.incomingRequestHandlers[i.type],!t)return void vLog.warn("Dropping message for unknown invoke payload "+i.type);t.handleRequest(e.id,i.message)}},Proxy.prototype.dequeue=function(e,i){delete this.outstandingRequests[i]},Proxy.prototype.nextId=function(){var e=this.id;return this.id+=2,e},Proxy.prototype.getServiceSignature=function(e){var i=this.bindCache[e],n=new Date;if(i&&n-i.fetched<BIND_CACHE_TTL)return Promise.resolve(i.signature);var t=new Deferred,s=this;t.promise.then(function(i){s.bindCache[e]={signature:i,fetched:n}});var r={name:e},o=JSON.stringify(r),a=this.nextId(),d=new SimpleHandler(t,this,a);return this.sendRequest(o,MessageType.SIGNATURE,d,a),t.promise},Proxy.prototype.addIncomingHandler=function(e,i){this.incomingRequestHandlers[e]=i},Proxy.prototype.addIncomingStreamHandler=function(e,i){this.outstandingRequests[e]=i},Proxy.prototype.sendRequest=function(e,i,n,t){n&&(this.outstandingRequests[t]=n);var s=JSON.stringify({id:t,data:e,type:i}),r=this;this.senderPromise.then(function(e){e.send(s)}).catch(function(e){var i=r.outstandingRequests[t];i&&(i.handleResponse(IncomingPayloadType.ERROR_RESPONSE,e),delete r.outstandingRequests[t])})},module.exports=Proxy;
},{"./../lib/deferred":40,"./../lib/vlog":42,"./incoming_payload_type":47,"./message_type":48,"./simple_handler":50,"es6-promise":24}],50:[function(require,module,exports){
var IncomingPayloadType=require("./incoming_payload_type"),ErrorConversion=require("./error_conversion"),vError=require("./../lib/verror"),Handler=function(r,e,o){this._proxy=e,this._def=r,this._id=o};Handler.prototype.handleResponse=function(r,e){switch(r){case IncomingPayloadType.FINAL_RESPONSE:this._def.resolve(e);break;case IncomingPayloadType.ERROR_RESPONSE:var o=ErrorConversion.toJSerror(e);this._def.reject(o);break;default:this._def.reject(new vError.InternalError("unknown response type "+r))}this._proxy.dequeue(this._id)},module.exports=Handler;
},{"./../lib/verror":41,"./error_conversion":46,"./incoming_payload_type":47}],51:[function(require,module,exports){
var MessageType=require("./message_type"),Duplex=require("stream").Duplex,inherits=require("util").inherits,Stream=function(e,t,s){Duplex.call(this,{objectMode:!0}),this.flowId=e,this.isClient=s,this.webSocketPromise=t,this.onmessage=null,this.wsBuffer=[],this.shouldQueue=!1};inherits(Stream,Duplex),Stream.prototype.clientClose=function(){var e={id:this.flowId,type:MessageType.STREAM_CLOSE};Duplex.prototype.write.call(this,e)},Stream.prototype.serverClose=function(e,t){var s={id:this.flowId,type:MessageType.RESPONSE,data:JSON.stringify({results:[e||null],err:t||null})};Duplex.prototype.write.call(this,s)},Stream.prototype._read=function(){for(var e=0;e<this.wsBuffer.length&&this.push(this.wsBuffer[e]);)++e;e>0&&(this.wsBuffer=this.wsBuffer.splice(e)),this.shouldQueue=0===this.wsBuffer.length},Stream.prototype._queueRead=function(e){this.shouldQueue?this.shouldQueue=this.push(e):this.wsBuffer.push(e)},Stream.prototype.write=function(e,t,s){var i={id:this.flowId,data:JSON.stringify(e),type:MessageType.STREAM_VALUE};return Duplex.prototype.write.call(this,i,t,s)},Stream.prototype._write=function(e,t,s){this.webSocketPromise.then(function(t){t.send(JSON.stringify(e)),s()})},Stream.prototype.end=function(e,t,s){this.isClient?(void 0!==e&&this.write(e,t),this.clientClose()):this.serverClose(),Duplex.prototype.end.call(this,null,null,s)},module.exports=Stream;
},{"./message_type":48,"stream":21,"util":23}],52:[function(require,module,exports){
function ProxyConnection(e){this.url=e.replace(/^(http|https)/,"ws")+"/ws",this.currentWebSocketPromise=null;var o=new Deferred;Proxy.call(this,o.promise),o.resolve(this.getWebSocket())}var WebSocket=require("./../lib/websocket"),Deferred=require("./../lib/deferred"),vLog=require("./../lib/vlog"),Proxy=require("./proxy");ProxyConnection.prototype=Object.create(Proxy.prototype),ProxyConnection.prototype.constructor=ProxyConnection,ProxyConnection.prototype.getWebSocket=function(){if(this.currentWebSocketPromise)return this.currentWebSocketPromise;var e=new WebSocket(this.url),o=this,r=new Deferred;this.currentWebSocketPromise=r.promise,e.onopen=function(){vLog.info("Connected to proxy at",o.url),r.resolve(e)};var t=this._configDeferred;return e.onerror=function(e){vLog.error("Failed to connect to proxy at url:",o.url),r.reject(e),t.reject("Proxy connection closed, failed to get config "+e)},e.onmessage=function(e){var r;try{r=JSON.parse(e.data)}catch(t){return void vLog.warn("Failed to parse "+e.data)}o.process(r)},r.promise},module.exports=ProxyConnection;
},{"./../lib/deferred":40,"./../lib/vlog":42,"./../lib/websocket":43,"./proxy":49}],53:[function(require,module,exports){
function Runtime(e){return this instanceof Runtime?(this.identityName=e.identityName,this._wspr=e.wspr,void(this.identity=new PrivateId(this._getProxyConnection()))):new Runtime(e)}var Promise=require("es6-promise").Promise,Server=require("../ipc/server"),ServerRouter=require("../ipc/server_router"),Client=require("../ipc/client"),ProxyConnection=require("../proxy/websocket"),MessageType=require("../proxy/message_type"),Namespace=require("../namespace/namespace"),PrivateId=require("../security/private"),PublicId=require("../security/public"),Deferred=require("../lib/deferred"),SimpleHandler=require("../proxy/simple_handler");module.exports=Runtime,Runtime.prototype.bindTo=function(e,t,r){var n=this._getClient();return n.bindTo(e,t,r)},Runtime.prototype.stop=function(e){var t=this;t._getProxyConnection().getWebSocket().then(function(t){t.on("close",function(t,r){e(null,t,r)}),t.close()})},Runtime.prototype.serve=function(e,t,r,n){var i=this._getServer();return i.serve(e,t,r,n)},Runtime.prototype.addIDL=function(e){var t=this._getServer();return t.addIDL(e)},Runtime.prototype._getProxyConnection=function(){return this._proxyConnection||(this._proxyConnection=new ProxyConnection(this._wspr)),this._proxyConnection},Runtime.prototype._getRouter=function(){return this._router||(this._router=new ServerRouter(this._getProxyConnection())),this._router},Runtime.prototype._getClient=function(){return this._client=this._client||new Client(this._getProxyConnection()),this._client},Runtime.prototype._getServer=function(){return this._server=this._server||new Server(this._getRouter()),this._server},Runtime.prototype.newNamespace=function(e){var t=this,r=this._getProxyConnection();return e?Promise.resolve(new Namespace(this._getClient(),e)):(r.getWebSocket(),r.config.then(function(e){return new Namespace(t._getClient(),e.mounttableRoot)}))},Runtime.prototype.newIdentity=function(e,t){var r=new Deferred(t),n=this._getProxyConnection(),i=n.nextId(),o=new SimpleHandler(r,n,i);return n.sendRequest(JSON.stringify(e),MessageType.NEW_ID,o,i),r.promise.then(function(e){return new PublicId(e.names,e.handle,n)})};
},{"../ipc/client":37,"../ipc/server":38,"../ipc/server_router":39,"../lib/deferred":40,"../namespace/namespace":44,"../proxy/message_type":48,"../proxy/simple_handler":50,"../proxy/websocket":52,"../security/private":54,"../security/public":55,"es6-promise":24}],54:[function(require,module,exports){
function PrivateId(e){this._proxy=e}var Deferred=require("../lib/deferred"),SimpleHandler=require("../proxy/simple_handler"),PublicId=require("./public"),MessageType=require("../proxy/message_type");PrivateId.prototype.bless=function(e,r,i,n,s){var t=new Deferred(s);if(!(e instanceof PublicId))return t.reject(new Error("blessee should be of type PublicId")),t.promise;var a=JSON.stringify({handle:e._id,name:r,durationMs:i,caveats:n}),d=this._proxy.nextId(),o=new SimpleHandler(t,this._proxy,d);this._proxy.sendRequest(a,MessageType.BLESS,o,d);var p=this._proxy;return t.promise.then(function(e){var r=new PublicId(e.names,e.handle,p._proxy);return r})},module.exports=PrivateId;
},{"../lib/deferred":40,"../proxy/message_type":48,"../proxy/simple_handler":50,"./public":55}],55:[function(require,module,exports){
function PublicId(t,e,i){this.names=t,this._id=e,this._count=1,this._proxy=i}function nameMatches(t,e){for(var i=t.split("/"),n=e.split("/"),r=0;r<n.length;r++){if("*"===n[r])return r===n.length-1;if(r===i.length)return!0;if(i[r]!==n[r])return!1}return i.length===n.length}var MessageType=require("../proxy/message_type");PublicId.prototype.match=function(t){if(""===t||!t)return!1;for(var e=0;e<this.names.length;e++)if(nameMatches(this.names[e],t))return!0;return!1},PublicId.prototype.retain=function(){this._count++},PublicId.prototype.release=function(){if(this._count--,0===this._count){var t=JSON.stringify(this._id);this._proxy.sendRequest(t,MessageType.UNLINK_ID,null,this._proxy.nextId())}},PublicId.prototype.toJSON=function(){return{id:this._id,names:this.names}},module.exports=PublicId;
},{"../proxy/message_type":48}],56:[function(require,module,exports){
(function (process){
function init(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},vlog.level=e.logLevel||vlog.level,e.authTimeout=e.authTimeout||5e3;var n=new Deferred(t),r={wspr:e.wspr||process.env.WSPR||"http://localhost:8124"},i="object"==typeof window;return"undefined"==typeof e.requireAuthenticatedIdentity&&(e.requireAuthenticatedIdentity=!0),i&&e.requireAuthenticatedIdentity?getIdentity(e.authTimeout,function(e,t){return e?(n.reject(e),n.promise):(r.identityName=t,void n.resolve(new Runtime(r)))}):(r.identityName="unknown",n.resolve(new Runtime(r))),n.promise}function getIdentity(e,t){function n(e){u(),t(null,e.name)}function r(e){u(),t(e)}function i(){window.clearInterval(c),window.clearTimeout(d)}function o(){r(new Error("Auth timeout. Please ensure that the Veyron Chrome Extension is installed and enabled."))}function u(){window.clearInterval(c),window.clearTimeout(d),s.removeListener("auth:success",n),s.removeListener("auth:error",r)}var l="object"==typeof window;if(!l)return process.nextTick(t.bind(null,null));var a=require("postie"),s=new a(window);s.on("auth:success",n),s.on("auth:error",r),s.on("auth:received",i);var c=window.setInterval(function(){s.post("auth")},e),d=setTimeout(o,5e3)}var Runtime=require("./runtime/runtime"),Deferred=require("./lib/deferred"),vlog=require("./lib/vlog");module.exports={init:init,logLevels:require("./lib/vlog").levels,namespaceUtil:require("./namespace/util"),errors:require("./lib/verror")};
}).call(this,require("FWaASH"))
},{"./lib/deferred":40,"./lib/verror":41,"./lib/vlog":42,"./namespace/util":45,"./runtime/runtime":53,"FWaASH":7,"postie":34}]},{},[56])


//# sourceMappingURL=dist/veyron.js.map